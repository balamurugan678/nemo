!function (a) {
    a.fn.appendAround = function () {
        return this.each(function () {
            function b() {
                c.is(":hidden") && c.appendTo(e.filter(":visible:eq(0)")), a(window).trigger("append-around-complete")
            }

            var c = a(this), d = "data-set", e = a("[" + d + "='" + c.closest("[" + d + "]").attr(d) + "']");
            b(), a(window).on("changeBreakpoint", b)
        })
    }
}(jQuery), function (a) {
    "use strict";
    var b = 0, c = null;
    a.fn.resetBreakpoints = function () {
        a(window).unbind("resize"), b = 0
    }, a.fn.setBreakpoints = function (d) {
        var e = jQuery.extend({distinct: !0, useInnerWidth: !0, breakpoints: [
            {name: "Small", resolution: 10},
            {name: "Medium", resolution: 580},
            {name: "Large", resolution: 900}
        ]}, d);
        c = e.breakpoints.sort(function (a, b) {
            return b.resolution - a.resolution
        }), a(window).on("resize", function () {
            var d;
            d = "innerWidth"in window ? window.innerWidth : a(window).width();
            var f = !1, g = !1;
            for (var h in c) {
                var i = e.breakpoints[h].resolution;
                if (!f && d >= i && i > b) {
                    if (e.distinct) {
                        for (var j in c)a("body").hasClass("breakpoint-" + e.breakpoints[j].name) && (a("body").removeClass("breakpoint-" + e.breakpoints[j].name), a(window).trigger("exitBreakpoint" + e.breakpoints[j].name));
                        f = !0
                    }
                    a("body").addClass("breakpoint-" + e.breakpoints[h].name), a(window).trigger("enterBreakpoint" + e.breakpoints[h].name), g = !0
                }
                d < e.breakpoints[h].resolution && b >= e.breakpoints[h].resolution && (a("body").removeClass("breakpoint-" + e.breakpoints[h].name), a(window).trigger("exitBreakpoint" + e.breakpoints[h].name), g = !0), e.distinct && d >= e.breakpoints[h].resolution && d < e.breakpoints[h - 1].resolution && b > d && b > 0 && !a("body").hasClass("breakpoint-" + e.breakpoints[h].name) && (a("body").addClass("breakpoint-" + e.breakpoints[h].name), a(window).trigger("enterBreakpoint" + e.breakpoints[h].name), g = !0)
            }
            g && a(window).trigger("changeBreakpoint"), b !== d && (b = d)
        }), a(window).resize()
    }
}(jQuery), function (a, b, c) {
    function d(a) {
        return a
    }

    function e(a) {
        return decodeURIComponent(a.replace(f, " "))
    }

    var f = /\+/g, g = a.cookie = function (f, h, i) {
        if (h !== c) {
            if (i = a.extend({}, g.defaults, i), null === h && (i.expires = -1), "number" == typeof i.expires) {
                var j = i.expires, k = i.expires = new Date;
                k.setDate(k.getDate() + j)
            }
            return h = g.json ? JSON.stringify(h) : String(h), b.cookie = [encodeURIComponent(f), "=", g.raw ? h : encodeURIComponent(h), i.expires ? "; expires=" + i.expires.toUTCString() : "", i.path ? "; path=" + i.path : "", i.domain ? "; domain=" + i.domain : "", i.secure ? "; secure" : ""].join("")
        }
        for (var l = g.raw ? d : e, m = b.cookie.split("; "), n = 0, o = m.length; o > n; n++) {
            var p = m[n].split("=");
            if (l(p.shift()) === f) {
                var q = l(p.join("="));
                return g.json ? JSON.parse(q) : q
            }
        }
        return null
    };
    g.defaults = {}, a.removeCookie = function (b, c) {
        return null !== a.cookie(b) ? (a.cookie(b, null, c), !0) : !1
    }
}(jQuery, document), function (a) {
    a.fn.pajinate = function (b) {
        function c(c) {
            new_page = parseInt(j.data(p)) - 1, 1 == a(c).siblings(".active_page").prev(".page_link").length ? (g(c, new_page), e(new_page)) : b.wrap_around && e(o - 1)
        }

        function d(c) {
            new_page = parseInt(j.data(p)) + 1, 1 == a(c).siblings(".active_page").next(".page_link").length ? (f(c, new_page), e(new_page)) : b.wrap_around && e(0)
        }

        function e(a) {
            a = parseInt(a, 10);
            var c = parseInt(j.data(q));
            start_from = a * c, end_on = start_from + c;
            var d = m.hide().slice(start_from, end_on);
            d.show(), l.find(b.nav_panel_id).children(".page_link[data-longdesc=" + a + "]").addClass("active_page " + t).siblings(".active_page").removeClass("active_page " + t), j.data(p, a);
            var e = parseInt(j.data(p) + 1), f = k.children().size(), g = Math.ceil(f / b.items_per_page);
            l.find(b.nav_info_id).html(b.nav_label_info.replace("{0}", start_from + 1).replace("{1}", start_from + d.length).replace("{2}", m.length).replace("{3}", e).replace("{4}", g)), h(), i(), "undefined" != typeof b.onPageDisplayed && b.onPageDisplayed.call(this, a + 1)
        }

        function f(c, d) {
            var e = d, f = a(c).siblings(".active_page");
            "none" == f.siblings(".page_link[data-longdesc=" + e + "]").css("display") && n.each(function () {
                a(this).children(".page_link").hide().slice(parseInt(e - b.num_page_links_to_display + 1), e + 1).show()
            })
        }

        function g(c, d) {
            var e = d, f = a(c).siblings(".active_page");
            "none" == f.siblings(".page_link[data-longdesc=" + e + "]").css("display") && n.each(function () {
                a(this).children(".page_link").hide().slice(e, e + parseInt(b.num_page_links_to_display)).show()
            })
        }

        function h() {
            n.children(".page_link:visible").hasClass("last") ? n.children(".more").hide() : n.children(".more").show(), n.children(".page_link:visible").hasClass("first") ? n.children(".less").hide() : n.children(".less").show()
        }

        function i() {
            n.children(".last").hasClass("active_page") ? n.children(".next_link").add(".last_link").addClass("no_more " + u) : n.children(".next_link").add(".last_link").removeClass("no_more " + u), n.children(".first").hasClass("active_page") ? n.children(".previous_link").add(".first_link").addClass("no_more " + u) : n.children(".previous_link").add(".first_link").removeClass("no_more " + u)
        }

        var j, k, l, m, n, o, p = "current_page", q = "items_per_page", r = {item_container_id: ".content", items_per_page: 10, nav_panel_id: ".page_navigation", nav_info_id: ".info_text", num_page_links_to_display: 20, start_page: 0, wrap_around: !1, nav_label_first: "First", nav_label_prev: "Prev", nav_label_next: "Next", nav_label_last: "Last", nav_order: ["first", "prev", "num", "next", "last"], nav_label_info: "Showing {0}-{1} of {2} results", show_first_last: !0, abort_on_small_lists: !1, jquery_ui: !1, jquery_ui_active: "ui-state-highlight", jquery_ui_default: "ui-state-default", jquery_ui_disabled: "ui-state-disabled"}, b = a.extend(r, b), s = b.jquery_ui ? b.jquery_ui_default : "", t = b.jquery_ui ? b.jquery_ui_active : "", u = b.jquery_ui ? b.jquery_ui_disabled : "";
        return this.each(function () {
            if (l = a(this), k = a(this).find(b.item_container_id), m = l.find(b.item_container_id).children(), b.abort_on_small_lists && b.items_per_page >= m.size())return l;
            j = l, j.data(p, 0), j.data(q, b.items_per_page);
            for (var r = k.children().size(), u = Math.ceil(r / b.items_per_page), v = '<span class="ellipse more">...</span>', w = '<span class="ellipse less">...</span>', x = b.show_first_last ? '<a class="first_link ' + s + '" href="">' + b.nav_label_first + "</a>" : "", y = b.show_first_last ? '<a class="last_link ' + s + '" href="">' + b.nav_label_last + "</a>" : "", z = "", A = 0; A < b.nav_order.length; A++)switch (b.nav_order[A]) {
                case"first":
                    z += x;
                    break;
                case"last":
                    z += y;
                    break;
                case"next":
                    z += '<a id="next-link" class="next_link hide-text ' + s + '" href="">' + b.nav_label_next + "</a>";
                    break;
                case"prev":
                    z += '<a id="prev-link" class="previous_link hide-text ' + s + '" href="">' + b.nav_label_prev + "</a>";
                    break;
                case"num":
                    z += w;
                    for (var B = 0; u > B;)z += '<a class="page_link ' + s + '" href="" data-longdesc="' + B + '">' + (B + 1) + "</a>", B++;
                    z += v
            }
            n = l.find(b.nav_panel_id), n.html(z).each(function () {
                a(this).find(".page_link:first").addClass("first"), a(this).find(".page_link:last").addClass("last")
            }), n.children(".ellipse").hide(), n.find(".previous_link").next().next().addClass("active_page " + t), m.hide(), m.slice(0, j.data(q)).show(), o = l.find(b.nav_panel_id + ":first").children(".page_link").size(), b.num_page_links_to_display = Math.min(b.num_page_links_to_display, o), n.children(".page_link").hide(), n.each(function () {
                a(this).children(".page_link").slice(0, b.num_page_links_to_display).show()
            }), l.find(".first_link").click(function (b) {
                b.preventDefault(), g(a(this), 0), e(0)
            }), l.find(".last_link").click(function (b) {
                b.preventDefault();
                var c = o - 1;
                f(a(this), c), e(c)
            }), l.find(".previous_link").click(function (b) {
                b.preventDefault(), c(a(this))
            }), l.find(".next_link").click(function (b) {
                b.preventDefault(), d(a(this))
            }), l.find(".page_link").click(function (b) {
                b.preventDefault(), e(a(this).attr("data-longdesc"))
            }), e(parseInt(b.start_page)), h(), b.wrap_around || i()
        })
    }
}(jQuery), function (a) {
    var b = {FOCUSSABLE_ELEMS: ["input", "select", "textarea", "button"], isTabbable: function (a) {
        return b.hasTabindex(a) && b.isFocussable(a) && b.isVisible(a)
    }, hasTabindex: function (a) {
        return a.tabIndex >= 0
    }, isVisible: function (b) {
        return a(b).is(":visible")
    }, isFocussable: function (a) {
        var c = a.nodeName, d = RegExp(b.FOCUSSABLE_ELEMS.join("|"), "gi");
        return d.test(c) && !a.disabled ? !0 : /a/i.test(c) && a.href ? !0 : !1
    }};
    a.expr[":"].tabbable = b.isTabbable
}(jQuery), function (a) {
    a.fn.clearSearch = function (b) {
        var c = a.extend({clearClass: "clear_input", divClass: this.clearClass + "_div", focusAfterClear: !0, linkText: "&times;", distanceFromEdge: 5}, b);
        return this.each(function () {
            function b() {
                h.val("").change(), d(), c.focusAfterClear && h.focus(), "function" == typeof c.callback && c.callback()
            }

            function d() {
                e() ? g.show() : g.hide(), f()
            }

            function e() {
                return h.val().replace(/^\s+|\s+$/g, "").length > 0
            }

            function f() {
                var a = h.outerHeight();
                g.css({top: a / 2 - g.height() / 2, right: c.distanceFromEdge})
            }

            var g, h = a(this);
            h.parent().hasClass(c.divClass) || (h.wrap('<div style="position: relative;" class="' + c.divClass + '">' + h.html() + "</div>"), h.after('<a href="javascript:void(0)" style="position: absolute; cursor: pointer;" class="' + c.clearClass + '">' + c.linkText + "</a>")), g = h.next(), g.on("click", b), h.on("keyup keydown change focus", d), d()
        })
    }
}(jQuery);
var Hogan = {};
!function (a, b) {
    function c(a) {
        return String(null === a || void 0 === a ? "" : a)
    }

    function d(a) {
        return a = c(a), j.test(a) ? a.replace(e, "&amp;").replace(f, "&lt;").replace(g, "&gt;").replace(h, "&#39;").replace(i, "&quot;") : a
    }

    a.Template = function (a, c, d, e) {
        this.r = a || this.r, this.c = d, this.options = e, this.text = c || "", this.buf = b ? [] : ""
    }, a.Template.prototype = {r: function () {
        return""
    }, v: d, t: c, render: function (a, b, c) {
        return this.ri([a], b || {}, c)
    }, ri: function (a, b, c) {
        return this.r(a, b, c)
    }, rp: function (a, b, c, d) {
        var e = c[a];
        return e ? (this.c && "string" == typeof e && (e = this.c.compile(e, this.options)), e.ri(b, c, d)) : ""
    }, rs: function (a, b, c) {
        var d = a[a.length - 1];
        if (!k(d))return void c(a, b, this);
        for (var e = 0; e < d.length; e++)a.push(d[e]), c(a, b, this), a.pop()
    }, s: function (a, b, c, d, e, f, g) {
        var h;
        return k(a) && 0 === a.length ? !1 : ("function" == typeof a && (a = this.ls(a, b, c, d, e, f, g)), h = "" === a || !!a, !d && h && b && b.push("object" == typeof a ? a : b[b.length - 1]), h)
    }, d: function (a, b, c, d) {
        var e = a.split("."), f = this.f(e[0], b, c, d), g = null;
        if ("." === a && k(b[b.length - 2]))return b[b.length - 1];
        for (var h = 1; h < e.length; h++)f && "object" == typeof f && e[h]in f ? (g = f, f = f[e[h]]) : f = "";
        return d && !f ? !1 : (d || "function" != typeof f || (b.push(g), f = this.lv(f, b, c), b.pop()), f)
    }, f: function (a, b, c, d) {
        for (var e = !1, f = null, g = !1, h = b.length - 1; h >= 0; h--)if (f = b[h], f && "object" == typeof f && a in f) {
            e = f[a], g = !0;
            break
        }
        return g ? (d || "function" != typeof e || (e = this.lv(e, b, c)), e) : d ? !1 : ""
    }, ho: function (a, b, c, d, e) {
        var f = this.c, g = this.options;
        g.delimiters = e;
        var d = a.call(b, d);
        return d = null == d ? String(d) : d.toString(), this.b(f.compile(d, g).render(b, c)), !1
    }, b: b ? function (a) {
        this.buf.push(a)
    } : function (a) {
        this.buf += a
    }, fl: b ? function () {
        var a = this.buf.join("");
        return this.buf = [], a
    } : function () {
        var a = this.buf;
        return this.buf = "", a
    }, ls: function (a, b, c, d, e, f, g) {
        var h = b[b.length - 1], i = null;
        if (!d && this.c && a.length > 0)return this.ho(a, h, c, this.text.substring(e, f), g);
        if (i = a.call(h), "function" == typeof i) {
            if (d)return!0;
            if (this.c)return this.ho(i, h, c, this.text.substring(e, f), g)
        }
        return i
    }, lv: function (a, b, d) {
        var e = b[b.length - 1], f = a.call(e);
        return"function" == typeof f && (f = c(f.call(e)), this.c && ~f.indexOf("{{")) ? this.c.compile(f, this.options).render(e, d) : c(f)
    }};
    var e = /&/g, f = /</g, g = />/g, h = /\'/g, i = /\"/g, j = /[&<>\"\']/, k = Array.isArray || function (a) {
        return"[object Array]" === Object.prototype.toString.call(a)
    }
}("undefined" != typeof exports ? exports : Hogan), function (a) {
    function b(a) {
        "}" === a.n.substr(a.n.length - 1) && (a.n = a.n.substring(0, a.n.length - 1))
    }

    function c(a) {
        return a.trim ? a.trim() : a.replace(/^\s*|\s*$/g, "")
    }

    function d(a, b, c) {
        if (b.charAt(c) != a.charAt(0))return!1;
        for (var d = 1, e = a.length; e > d; d++)if (b.charAt(c + d) != a.charAt(d))return!1;
        return!0
    }

    function e(a, b, c, d) {
        for (var h = [], i = null, j = null; a.length > 0;)if (j = a.shift(), "#" == j.tag || "^" == j.tag || f(j, d))c.push(j), j.nodes = e(a, j.tag, c, d), h.push(j); else {
            if ("/" == j.tag) {
                if (0 === c.length)throw new Error("Closing tag without opener: /" + j.n);
                if (i = c.pop(), j.n != i.n && !g(j.n, i.n, d))throw new Error("Nesting error: " + i.n + " vs. " + j.n);
                return i.end = j.i, h
            }
            h.push(j)
        }
        if (c.length > 0)throw new Error("missing closing tag: " + c.pop().n);
        return h
    }

    function f(a, b) {
        for (var c = 0, d = b.length; d > c; c++)if (b[c].o == a.n)return a.tag = "#", !0
    }

    function g(a, b, c) {
        for (var d = 0, e = c.length; e > d; d++)if (c[d].c == a && c[d].o == b)return!0
    }

    function h(a) {
        return a.replace(u, "\\\\").replace(r, '\\"').replace(s, "\\n").replace(t, "\\r")
    }

    function i(a) {
        return~a.indexOf(".") ? "d" : "f"
    }

    function j(a) {
        for (var b = "", c = 0, d = a.length; d > c; c++) {
            var e = a[c].tag;
            "#" == e ? b += k(a[c].nodes, a[c].n, i(a[c].n), a[c].i, a[c].end, a[c].otag + " " + a[c].ctag) : "^" == e ? b += l(a[c].nodes, a[c].n, i(a[c].n)) : "<" == e || ">" == e ? b += m(a[c]) : "{" == e || "&" == e ? b += n(a[c].n, i(a[c].n)) : "\n" == e ? b += p('"\\n"' + (a.length - 1 == c ? "" : " + i")) : "_v" == e ? b += o(a[c].n, i(a[c].n)) : void 0 === e && (b += p('"' + h(a[c]) + '"'))
        }
        return b
    }

    function k(a, b, c, d, e, f) {
        return"if(_.s(_." + c + '("' + h(b) + '",c,p,1),c,p,0,' + d + "," + e + ',"' + f + '")){_.rs(c,p,function(c,p,_){' + j(a) + "});c.pop();}"
    }

    function l(a, b, c) {
        return"if(!_.s(_." + c + '("' + h(b) + '",c,p,1),c,p,1,0,0,"")){' + j(a) + "};"
    }

    function m(a) {
        return'_.b(_.rp("' + h(a.n) + '",c,p,"' + (a.indent || "") + '"));'
    }

    function n(a, b) {
        return"_.b(_.t(_." + b + '("' + h(a) + '",c,p,0)));'
    }

    function o(a, b) {
        return"_.b(_.v(_." + b + '("' + h(a) + '",c,p,0)));'
    }

    function p(a) {
        return"_.b(" + a + ");"
    }

    var q = /\S/, r = /\"/g, s = /\n/g, t = /\r/g, u = /\\/g, v = {"#": 1, "^": 2, "/": 3, "!": 4, ">": 5, "<": 6, "=": 7, _v: 8, "{": 9, "&": 10};
    a.scan = function (a, e) {
        function f() {
            r.length > 0 && (s.push(new String(r)), r = "")
        }

        function g() {
            for (var a = !0, b = w; b < s.length; b++)if (a = s[b].tag && v[s[b].tag] < v._v || !s[b].tag && null === s[b].match(q), !a)return!1;
            return a
        }

        function h(a, b) {
            if (f(), a && g())for (var c, d = w; d < s.length; d++)s[d].tag || ((c = s[d + 1]) && ">" == c.tag && (c.indent = s[d].toString()), s.splice(d, 1)); else b || s.push({tag: "\n"});
            t = !1, w = s.length
        }

        function i(a, b) {
            var d = "=" + y, e = a.indexOf(d, b), f = c(a.substring(a.indexOf("=", b) + 1, e)).split(" ");
            return x = f[0], y = f[1], e + d.length - 1
        }

        var j = a.length, k = 0, l = 1, m = 2, n = k, o = null, p = null, r = "", s = [], t = !1, u = 0, w = 0, x = "{{", y = "}}";
        for (e && (e = e.split(" "), x = e[0], y = e[1]), u = 0; j > u; u++)n == k ? d(x, a, u) ? (--u, f(), n = l) : "\n" == a.charAt(u) ? h(t) : r += a.charAt(u) : n == l ? (u += x.length - 1, p = v[a.charAt(u + 1)], o = p ? a.charAt(u + 1) : "_v", "=" == o ? (u = i(a, u), n = k) : (p && u++, n = m), t = u) : d(y, a, u) ? (s.push({tag: o, n: c(r), otag: x, ctag: y, i: "/" == o ? t - y.length : u + x.length}), r = "", u += y.length - 1, n = k, "{" == o && ("}}" == y ? u++ : b(s[s.length - 1]))) : r += a.charAt(u);
        return h(t, !0), s
    }, a.generate = function (b, c, d) {
        var e = 'var _=this;_.b(i=i||"");' + j(b) + "return _.fl();";
        return d.asString ? "function(c,p,i){" + e + ";}" : new a.Template(new Function("c", "p", "i", e), c, a, d)
    }, a.parse = function (a, b, c) {
        return c = c || {}, e(a, "", [], c.sectionTags || [])
    }, a.cache = {}, a.compile = function (a, b) {
        b = b || {};
        var c = a + "||" + !!b.asString, d = this.cache[c];
        return d ? d : (d = this.generate(this.parse(this.scan(a, b.delimiters), a, b), a, b), this.cache[c] = d)
    }
}("undefined" != typeof exports ? exports : Hogan), function (a) {
    var b = {isMsie: function () {
        return/(msie|trident)/i.test(navigator.userAgent) ? navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2] : !1
    }, isBlankString: function (a) {
        return!a || /^\s*$/.test(a)
    }, escapeRegExChars: function (a) {
        return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g, "\\$&")
    }, isString: function (a) {
        return"string" == typeof a
    }, isNumber: function (a) {
        return"number" == typeof a
    }, isArray: a.isArray, isFunction: a.isFunction, isObject: a.isPlainObject, isUndefined: function (a) {
        return"undefined" == typeof a
    }, bind: a.proxy, each: function (b, c) {
        function d(a, b) {
            return c(b, a)
        }

        a.each(b, d)
    }, map: a.map, filter: a.grep, every: function (b, c) {
        var d = !0;
        return b ? (a.each(b, function (a, e) {
            return(d = c.call(null, e, a, b)) ? void 0 : !1
        }), !!d) : d
    }, some: function (b, c) {
        var d = !1;
        return b ? (a.each(b, function (a, e) {
            return(d = c.call(null, e, a, b)) ? !1 : void 0
        }), !!d) : d
    }, mixin: a.extend, getUniqueId: function () {
        var a = 0;
        return function () {
            return a++
        }
    }(), templatify: function (b) {
        function c() {
            return String(b)
        }

        return a.isFunction(b) ? b : c
    }, defer: function (a) {
        setTimeout(a, 0)
    }, debounce: function (a, b, c) {
        var d, e;
        return function () {
            var f, g, h = this, i = arguments;
            return f = function () {
                d = null, c || (e = a.apply(h, i))
            }, g = c && !d, clearTimeout(d), d = setTimeout(f, b), g && (e = a.apply(h, i)), e
        }
    }, throttle: function (a, b) {
        var c, d, e, f, g, h;
        return g = 0, h = function () {
            g = new Date, e = null, f = a.apply(c, d)
        }, function () {
            var i = new Date, j = b - (i - g);
            return c = this, d = arguments, 0 >= j ? (clearTimeout(e), e = null, g = i, f = a.apply(c, d)) : e || (e = setTimeout(h, j)), f
        }
    }, noop: function () {
    }}, c = "0.10.1", d = function () {
        function a(a) {
            this.maxSize = a || 100, this.size = 0, this.hash = {}, this.list = new c
        }

        function c() {
            this.head = this.tail = null
        }

        function d(a, b) {
            this.key = a, this.val = b, this.prev = this.next = null
        }

        return b.mixin(a.prototype, {set: function (a, b) {
            var c, e = this.list.tail;
            this.size >= this.maxSize && (this.list.remove(e), delete this.hash[e.key]), (c = this.hash[a]) ? (c.val = b, this.list.moveToFront(c)) : (c = new d(a, b), this.list.add(c), this.hash[a] = c, this.size++)
        }, get: function (a) {
            var b = this.hash[a];
            return b ? (this.list.moveToFront(b), b.val) : void 0
        }}), b.mixin(c.prototype, {add: function (a) {
            this.head && (a.next = this.head, this.head.prev = a), this.head = a, this.tail = this.tail || a
        }, remove: function (a) {
            a.prev ? a.prev.next = a.next : this.head = a.next, a.next ? a.next.prev = a.prev : this.tail = a.prev
        }, moveToFront: function (a) {
            this.remove(a), this.add(a)
        }}), a
    }(this), e = function () {
        function a(a) {
            this.prefix = ["__", a, "__"].join(""), this.ttlKey = "__ttl__", this.keyMatcher = new RegExp("^" + this.prefix)
        }

        function c() {
            return(new Date).getTime()
        }

        function d(a) {
            return JSON.stringify(b.isUndefined(a) ? null : a)
        }

        function e(a) {
            return JSON.parse(a)
        }

        var f, g;
        try {
            f = window.localStorage, f.setItem("~~~", "!"), f.removeItem("~~~")
        } catch (h) {
            f = null
        }
        return g = f && window.JSON ? {_prefix: function (a) {
            return this.prefix + a
        }, _ttlKey: function (a) {
            return this._prefix(a) + this.ttlKey
        }, get: function (a) {
            return this.isExpired(a) && this.remove(a), e(f.getItem(this._prefix(a)))
        }, set: function (a, e, g) {
            return b.isNumber(g) ? f.setItem(this._ttlKey(a), d(c() + g)) : f.removeItem(this._ttlKey(a)), f.setItem(this._prefix(a), d(e))
        }, remove: function (a) {
            return f.removeItem(this._ttlKey(a)), f.removeItem(this._prefix(a)), this
        }, clear: function () {
            var a, b, c = [], d = f.length;
            for (a = 0; d > a; a++)(b = f.key(a)).match(this.keyMatcher) && c.push(b.replace(this.keyMatcher, ""));
            for (a = c.length; a--;)this.remove(c[a]);
            return this
        }, isExpired: function (a) {
            var d = e(f.getItem(this._ttlKey(a)));
            return b.isNumber(d) && c() > d ? !0 : !1
        }} : {get: b.noop, set: b.noop, remove: b.noop, clear: b.noop, isExpired: b.noop}, b.mixin(a.prototype, g), a
    }(), f = function () {
        function c(b) {
            b = b || {}, this._send = b.transport ? e(b.transport) : a.ajax, this._get = b.rateLimiter ? b.rateLimiter(this._get) : this._get
        }

        function e(c) {
            return function (d, e) {
                function f(a) {
                    b.defer(function () {
                        h.resolve(a)
                    })
                }

                function g(a) {
                    b.defer(function () {
                        h.reject(a)
                    })
                }

                var h = a.Deferred();
                return c(d, e, f, g), h
            }
        }

        var f = 0, g = {}, h = 6, i = new d(10);
        return c.setMaxPendingRequests = function (a) {
            h = a
        }, c.resetCache = function () {
            i = new d(10)
        }, b.mixin(c.prototype, {_get: function (a, b, c) {
            function d(b) {
                c && c(b), i.set(a, b)
            }

            function e() {
                f--, delete g[a], k.onDeckRequestArgs && (k._get.apply(k, k.onDeckRequestArgs), k.onDeckRequestArgs = null)
            }

            var j, k = this;
            (j = g[a]) ? j.done(d) : h > f ? (f++, g[a] = this._send(a, b).done(d).always(e)) : this.onDeckRequestArgs = [].slice.call(arguments, 0)
        }, get: function (a, c, d) {
            var e;
            return b.isFunction(c) && (d = c, c = {}), (e = i.get(a)) ? b.defer(function () {
                d && d(e)
            }) : this._get(a, c, d), !!e
        }}), c
    }(), g = function () {
        function c(b) {
            b = b || {}, b.datumTokenizer && b.queryTokenizer || a.error("datumTokenizer and queryTokenizer are both required"), this.datumTokenizer = b.datumTokenizer, this.queryTokenizer = b.queryTokenizer, this.datums = [], this.trie = e()
        }

        function d(a) {
            return"undefined" != typeof a ? (a = b.filter(a, function (a) {
                return!!a
            }), a = b.map(a, function (a) {
                return a.toLowerCase()
            })) : void 0
        }

        function e() {
            return{ids: [], children: {}}
        }

        function f(a) {
            for (var b = {}, c = [], d = 0; d < a.length; d++)b[a[d]] || (b[a[d]] = !0, c.push(a[d]));
            return c
        }

        function g(a, b) {
            function c(a, b) {
                return a - b
            }

            var d = 0, e = 0, f = [];
            for (a = a.sort(c), b = b.sort(c); d < a.length && e < b.length;)a[d] < b[e] ? d++ : a[d] > b[e] ? e++ : (f.push(a[d]), d++, e++);
            return f
        }

        return b.mixin(c.prototype, {bootstrap: function (a) {
            this.datums = a.datums, this.trie = a.trie
        }, add: function (a) {
            var c = this;
            a = b.isArray(a) ? a : [a], b.each(a, function (a) {
                var f, g;
                f = c.datums.push(a) - 1, g = d(c.datumTokenizer(a)), "undefined" != typeof g && b.each(g, function (a) {
                    var b, d, g;
                    for (b = c.trie, d = a.split(""); g = d.shift();)b = b.children[g] || (b.children[g] = e()), b.ids.push(f)
                })
            })
        }, get: function (a) {
            var c, e, h = this;
            return c = d(this.queryTokenizer(a)), b.each(c, function (a) {
                var b, c, d, f;
                if (e && 0 === e.length)return!1;
                for (b = h.trie, c = a.split(""); b && (d = c.shift());)b = b.children[d];
                return b && 0 === c.length ? (f = b.ids.slice(0), void(e = e ? g(e, f) : f)) : (e = [], !1)
            }), e ? b.map(f(e), function (a) {
                return h.datums[a]
            }) : []
        }, all: function () {
            return this.datums.slice(0)
        }, serialize: function () {
            return{datums: this.datums, trie: this.trie}
        }}), c
    }(), h = function () {
        function d(a) {
            var c = a.local || null;
            return b.isFunction(c) && (c = c.call(null)), c
        }

        function e(d) {
            var e, f;
            return f = {url: null, thumbprint: "", ttl: 864e5, filter: null, ajax: {}}, (e = d.prefetch || null) && (e = b.isString(e) ? {url: e} : e, e = b.mixin(f, e), e.thumbprint = c + e.thumbprint, e.ajax.type = e.ajax.type || "GET", e.ajax.dataType = e.ajax.dataType || "json", !e.url && a.error("prefetch requires url to be set")), e
        }

        function f(c) {
            function d(a) {
                return function (c) {
                    return b.debounce(c, a)
                }
            }

            function e(a) {
                return function (c) {
                    return b.throttle(c, a)
                }
            }

            var f, g;
            return g = {url: null, wildcard: "%QUERY", replace: null, rateLimitBy: "debounce", rateLimitWait: 300, send: null, filter: null, ajax: {}}, (f = c.remote || null) && (f = b.isString(f) ? {url: f} : f, f = b.mixin(g, f), f.rateLimiter = /^throttle$/i.test(f.rateLimitBy) ? e(f.rateLimitWait) : d(f.rateLimitWait), f.ajax.type = f.ajax.type || "GET", f.ajax.dataType = f.ajax.dataType || "json", delete f.rateLimitBy, delete f.rateLimitWait, !f.url && a.error("remote requires url to be set")), f
        }

        return{local: d, prefetch: e, remote: f}
    }(), i = (window.Bloodhound = function () {
        function c(c) {
            c && (c.local || c.prefetch || c.remote) || a.error("one of local, prefetch, or remote is required"), this.limit = c.limit || 5, this.sorter = d(c.sorter), this.dupDetector = c.dupDetector || i, this.local = h.local(c), this.minLength = b.isNumber(c.minLength) ? c.minLength : 1, this.prefetch = h.prefetch(c), this.remote = h.remote(c), this.cacheKey = this.prefetch ? this.prefetch.cacheKey || this.prefetch.url : null, this.index = new g({datumTokenizer: c.datumTokenizer, queryTokenizer: c.queryTokenizer}), this.storage = this.cacheKey ? new e(this.cacheKey) : null
        }

        function d(a) {
            function c(b) {
                return b.sort(a)
            }

            function d(a) {
                return a
            }

            return b.isFunction(a) ? c : d
        }

        function i() {
            return!1
        }

        var j;
        return j = {data: "data", protocol: "protocol", thumbprint: "thumbprint"}, c.tokenizers = {whitespace: function (a) {
            return a.split(/\s+/)
        }, nonword: function (a) {
            return a.split(/\W+/)
        }}, b.mixin(c.prototype, {_loadPrefetch: function (b) {
            function c(a) {
                var c;
                a && "undefined" != typeof a && (c = b.filter ? b.filter(a) : a, f.add(c), f._saveToStorage(f.index.serialize(), b.thumbprint, b.ttl))
            }

            var d, e, f = this;
            return(d = this._readFromStorage(b.thumbprint)) ? (this.index.bootstrap(d), e = a.Deferred().resolve()) : e = a.ajax(b.url, b.ajax).done(c), e
        }, _getFromRemote: function (a, b) {
            function c(a) {
                var c = f.remote.filter ? f.remote.filter(a) : a;
                b(c)
            }

            var d, e, f = this;
            return a = a || "", e = encodeURIComponent(a), d = this.remote.replace ? this.remote.replace(this.remote.url, a) : this.remote.url.replace(this.remote.wildcard, e), this.transport.get(d, this.remote.ajax, c)
        }, _saveToStorage: function (a, b, c) {
            this.storage && (this.storage.set(j.data, a, c), this.storage.set(j.protocol, location.protocol, c), this.storage.set(j.thumbprint, b, c))
        }, _readFromStorage: function (a) {
            var b, c = {};
            return this.storage && (c.data = this.storage.get(j.data), c.protocol = this.storage.get(j.protocol), c.thumbprint = this.storage.get(j.thumbprint)), b = c.thumbprint !== a || c.protocol !== location.protocol, c.data && !b ? c.data : null
        }, initialize: function () {
            function b() {
                d.add(d.local)
            }

            var c, d = this;
            return c = this.prefetch ? this._loadPrefetch(this.prefetch) : a.Deferred().resolve(), this.local && c.done(b), this.transport = this.remote ? new f(this.remote) : null, this.initialize = function () {
                return c.promise()
            }, c.promise()
        }, add: function (a) {
            this.index.add(a)
        }, get: function (a, c) {
            function d(a) {
                var d = e.slice(0);
                b.each(a, function (a) {
                    var c;
                    return c = b.some(d, function (b) {
                        return f.dupDetector(a, b)
                    }), !c && d.push(a), d.length < f.limit
                }), c && c(f.sorter(d))
            }

            var e, f = this, g = !1;
            if ("" === a && 0 === this.minLength)e = this.index.all(); else {
                if (!("" !== a && a.length >= this.minLength))return;
                e = this.index.get(a), e.length < this.limit && this.transport && (g = this._getFromRemote(a, d))
            }
            e = this.sorter(e).slice(0, this.limit), !g && c && c(e)
        }, ttAdapter: function () {
            return b.bind(this.get, this)
        }}), c
    }(), {wrapper: '<span class="twitter-typeahead"></span>', dropdown: '<span class="tt-dropdown-menu"></span>', dataset: '<div class="tt-dataset-%CLASS%"></div>', suggestions: '<span class="tt-suggestions"></span>', suggestion: '<div class="tt-suggestion">%BODY%</div>'}), j = {wrapper: {position: "relative", display: "inline-block"}, hint: {position: "absolute", top: "0", left: "0", borderColor: "transparent", boxShadow: "none"}, input: {position: "relative", verticalAlign: "top", backgroundColor: "transparent"}, inputWithNoHint: {position: "relative", verticalAlign: "top"}, dropdown: {position: "absolute", top: "100%", left: "0", zIndex: "100", display: "none"}, suggestions: {display: "block"}, suggestion: {whiteSpace: "nowrap", cursor: "pointer"}, suggestionChild: {whiteSpace: "normal"}, ltr: {left: "0", right: "auto"}, rtl: {left: "auto", right: " 0"}};
    b.isMsie() && b.mixin(j.input, {backgroundImage: "url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)"}), b.isMsie() && b.isMsie() <= 7 && b.mixin(j.input, {marginTop: "-1px"});
    var k = function () {
        function c(b) {
            b && b.el || a.error("EventBus initialized without el"), this.$el = a(b.el)
        }

        var d = "typeahead:";
        return b.mixin(c.prototype, {trigger: function (a) {
            var b = [].slice.call(arguments, 1);
            this.$el.trigger(d + a, b)
        }}), c
    }(), l = function () {
        function a(a, b, c, d) {
            var e;
            if (!c)return this;
            for (b = b.split(i), c = d ? h(c, d) : c, this._callbacks = this._callbacks || {}; e = b.shift();)this._callbacks[e] = this._callbacks[e] || {sync: [], async: []}, this._callbacks[e][a].push(c);
            return this
        }

        function b(b, c, d) {
            return a.call(this, "async", b, c, d)
        }

        function c(b, c, d) {
            return a.call(this, "sync", b, c, d)
        }

        function d(a) {
            var b;
            if (!this._callbacks)return this;
            for (a = a.split(i); b = a.shift();)delete this._callbacks[b];
            return this
        }

        function e(a) {
            var b, c, d, e, g;
            if (!this._callbacks)return this;
            for (a = a.split(i), d = [].slice.call(arguments, 1); (b = a.shift()) && (c = this._callbacks[b]);)e = f(c.sync, this, [b].concat(d)), g = f(c.async, this, [b].concat(d)), e() && j(g);
            return this
        }

        function f(a, b, c) {
            function d() {
                for (var d, e = 0; !d && e < a.length; e += 1)d = a[e].apply(b, c) === !1;
                return!d
            }

            return d
        }

        function g() {
            var a;
            return a = window.setImmediate ? function (a) {
                setImmediate(function () {
                    a()
                })
            } : function (a) {
                setTimeout(function () {
                    a()
                }, 0)
            }
        }

        function h(a, b) {
            return a.bind ? a.bind(b) : function () {
                a.apply(b, [].slice.call(arguments, 0))
            }
        }

        var i = /\s+/, j = g();
        return{onSync: c, onAsync: b, off: d, trigger: e}
    }(), m = function (a) {
        function c(a, c, d) {
            for (var e, f = [], g = 0; g < a.length; g++)f.push(b.escapeRegExChars(a[g]));
            return e = d ? "\\b(" + f.join("|") + ")\\b" : "(" + f.join("|") + ")", c ? new RegExp(e) : new RegExp(e, "i")
        }

        var d = {node: null, pattern: null, tagName: "strong", className: null, wordsOnly: !1, caseSensitive: !1};
        return function (e) {
            function f(b) {
                var c, d;
                return(c = h.exec(b.data)) && (wrapperNode = a.createElement(e.tagName), e.className && (wrapperNode.className = e.className), d = b.splitText(c.index), d.splitText(c[0].length), wrapperNode.appendChild(d.cloneNode(!0)), b.parentNode.replaceChild(wrapperNode, d)), !!c
            }

            function g(a, b) {
                for (var c, d = 3, e = 0; e < a.childNodes.length; e++)c = a.childNodes[e], c.nodeType === d ? e += b(c) ? 1 : 0 : g(c, b)
            }

            var h;
            e = b.mixin({}, d, e), e.node && e.pattern && (e.pattern = b.isArray(e.pattern) ? e.pattern : [e.pattern], h = c(e.pattern, e.caseSensitive, e.wordsOnly), g(e.node, f))
        }
    }(window.document), n = function () {
        function c(c) {
            var e, f, h, i, j = this;
            c = c || {}, c.input || a.error("input is missing"), e = b.bind(this._onBlur, this), f = b.bind(this._onFocus, this), h = b.bind(this._onKeydown, this), i = b.bind(this._onInput, this), this.$hint = a(c.hint), this.$input = a(c.input).on("blur.tt", e).on("focus.tt", f).on("keydown.tt", h), 0 === this.$hint.length && (this.setHintValue = this.getHintValue = this.clearHint = b.noop), b.isMsie() ? this.$input.on("keydown.tt keypress.tt cut.tt paste.tt", function (a) {
                g[a.which || a.keyCode] || b.defer(b.bind(j._onInput, j, a))
            }) : this.$input.on("input.tt", i), this.query = this.$input.val(), this.$overflowHelper = d(this.$input)
        }

        function d(b) {
            return a('<pre aria-hidden="true"></pre>').css({position: "absolute", visibility: "hidden", whiteSpace: "nowrap", fontFamily: b.css("font-family"), fontSize: b.css("font-size"), fontStyle: b.css("font-style"), fontVariant: b.css("font-variant"), fontWeight: b.css("font-weight"), wordSpacing: b.css("word-spacing"), letterSpacing: b.css("letter-spacing"), textIndent: b.css("text-indent"), textRendering: b.css("text-rendering"), textTransform: b.css("text-transform")}).insertAfter(b)
        }

        function e(a, b) {
            return c.normalizeQuery(a) === c.normalizeQuery(b)
        }

        function f(a) {
            return a.altKey || a.ctrlKey || a.metaKey || a.shiftKey
        }

        var g;
        return g = {9: "tab", 27: "esc", 37: "left", 39: "right", 13: "enter", 38: "up", 40: "down"}, c.normalizeQuery = function (a) {
            return(a || "").replace(/^\s*/g, "").replace(/\s{2,}/g, " ")
        }, b.mixin(c.prototype, l, {_onBlur: function () {
            this.resetInputValue(), this.trigger("blurred")
        }, _onFocus: function () {
            this.trigger("focused")
        }, _onKeydown: function (a) {
            var b = g[a.which || a.keyCode];
            this._managePreventDefault(b, a), b && this._shouldTrigger(b, a) && this.trigger(b + "Keyed", a)
        }, _onInput: function () {
            this._checkInputValue()
        }, _managePreventDefault: function (a, b) {
            var c, d, e;
            switch (a) {
                case"tab":
                    d = this.getHintValue(), e = this.getInputValue(), c = d && d !== e && !f(b);
                    break;
                case"up":
                case"down":
                    c = !f(b);
                    break;
                default:
                    c = !1
            }
            c && b.preventDefault()
        }, _shouldTrigger: function (a, b) {
            var c;
            switch (a) {
                case"tab":
                    c = !f(b);
                    break;
                default:
                    c = !0
            }
            return c
        }, _checkInputValue: function () {
            var a, b, c;
            a = this.getInputValue(), b = e(a, this.query), c = b ? this.query.length !== a.length : !1, b ? c && this.trigger("whitespaceChanged", this.query) : this.trigger("queryChanged", this.query = a)
        }, focus: function () {
            this.$input.focus()
        }, blur: function () {
            this.$input.blur()
        }, getQuery: function () {
            return this.query
        }, setQuery: function (a) {
            this.query = a
        }, getInputValue: function () {
            return this.$input.val()
        }, setInputValue: function (a, b) {
            this.$input.val(a), !b && this._checkInputValue()
        }, getHintValue: function () {
            return this.$hint.val()
        }, setHintValue: function (a) {
            this.$hint.val(a)
        }, resetInputValue: function () {
            this.$input.val(this.query)
        }, clearHint: function () {
            this.$hint.val("")
        }, getLanguageDirection: function () {
            return(this.$input.css("direction") || "ltr").toLowerCase()
        }, hasOverflow: function () {
            var a = this.$input.width() - 2;
            return this.$overflowHelper.text(this.getInputValue()), this.$overflowHelper.width() >= a
        }, isCursorAtEnd: function () {
            var a, c, d;
            return a = this.$input.val().length, c = this.$input[0].selectionStart, b.isNumber(c) ? c === a : document.selection ? (d = document.selection.createRange(), d.moveStart("character", -a), a === d.text.length) : !0
        }, destroy: function () {
            this.$hint.off(".tt"), this.$input.off(".tt"), this.$hint = this.$input = this.$overflowHelper = null
        }}), c
    }(), o = function () {
        function c(c) {
            c = c || {}, c.templates = c.templates || {}, c.source || a.error("missing source"), c.name && !f(c.name) && a.error("invalid dataset name: " + c.name), this.query = null, this.highlight = !!c.highlight, this.name = c.name || b.getUniqueId(), this.source = c.source, this.displayFn = d(c.display || c.displayKey), this.templates = e(c.templates, this.displayFn), this.$el = a(i.dataset.replace("%CLASS%", this.name))
        }

        function d(a) {
            function c(b) {
                return b[a]
            }

            return a = a || "value", b.isFunction(a) ? a : c
        }

        function e(a, c) {
            function d(a) {
                return"<p>" + c(a) + "</p>"
            }

            return{empty: a.empty && b.templatify(a.empty), header: a.header && b.templatify(a.header), footer: a.footer && b.templatify(a.footer), suggestion: a.suggestion || d}
        }

        function f(a) {
            return/^[_a-zA-Z0-9-]+$/.test(a)
        }

        var g = "ttDataset", h = "ttValue", k = "ttDatum";
        return c.extractDatasetName = function (b) {
            return a(b).data(g)
        }, c.extractValue = function (b) {
            return a(b).data(h)
        }, c.extractDatum = function (b) {
            return a(b).data(k)
        }, b.mixin(c.prototype, l, {_render: function (c, d) {
            function e() {
                return p.templates.empty({query: c, isEmpty: !0})
            }

            function f() {
                function e(b) {
                    var c, d, e;
                    return d = p.templates.suggestion(b), e = i.suggestion.replace("%BODY%", d), c = a(e).data(g, p.name).data(h, p.displayFn(b)).data(k, b), c.children().each(function () {
                        a(this).css(j.suggestionChild)
                    }), c
                }

                var f, l;
                return f = a(i.suggestions).css(j.suggestions), l = b.map(d, e), f.append.apply(f, l), p.highlight && m({node: f[0], pattern: c}), f
            }

            function l() {
                return p.templates.header({query: c, isEmpty: !o})
            }

            function n() {
                return p.templates.footer({query: c, isEmpty: !o})
            }

            if (this.$el) {
                var o, p = this;
                this.$el.empty(), o = d && d.length, !o && this.templates.empty ? this.$el.html(e()).prepend(p.templates.header ? l() : null).append(p.templates.footer ? n() : null) : o && this.$el.html(f()).prepend(p.templates.header ? l() : null).append(p.templates.footer ? n() : null), this.trigger("rendered")
            }
        }, getRoot: function () {
            return this.$el
        }, update: function (a) {
            function b(b) {
                a === c.query && c._render(a, b)
            }

            var c = this;
            this.query = a, this.source(a, b)
        }, clear: function () {
            this._render(this.query || "")
        }, isEmpty: function () {
            return this.$el.is(":empty")
        }, destroy: function () {
            this.$el = null
        }}), c
    }(), p = function () {
        function c(c) {
            var e, f, g, h = this;
            c = c || {}, c.menu || a.error("menu is required"), this.isOpen = !1, this.isEmpty = !0, this.datasets = b.map(c.datasets, d), e = b.bind(this._onSuggestionClick, this), f = b.bind(this._onSuggestionMouseEnter, this), g = b.bind(this._onSuggestionMouseLeave, this), this.$menu = a(c.menu).on("click.tt", ".tt-suggestion", e).on("mouseenter.tt", ".tt-suggestion", f).on("mouseleave.tt", ".tt-suggestion", g), b.each(this.datasets, function (a) {
                h.$menu.append(a.getRoot()), a.onSync("rendered", h._onRendered, h)
            })
        }

        function d(a) {
            return new o(a)
        }

        return b.mixin(c.prototype, l, {_onSuggestionClick: function (b) {
            this.trigger("suggestionClicked", a(b.currentTarget))
        }, _onSuggestionMouseEnter: function (b) {
            this._removeCursor(), this._setCursor(a(b.currentTarget), !0)
        }, _onSuggestionMouseLeave: function () {
            this._removeCursor()
        }, _onRendered: function () {
            function a(a) {
                return a.isEmpty()
            }

            this.isEmpty = b.every(this.datasets, a), this.isEmpty ? this._hide() : this.isOpen && this._show(), this.trigger("datasetRendered")
        }, _hide: function () {
            this.$menu.hide()
        }, _show: function () {
            this.$menu.css("display", "block")
        }, _getSuggestions: function () {
            return this.$menu.find(".tt-suggestion")
        }, _getCursor: function () {
            return this.$menu.find(".tt-cursor").first()
        }, _setCursor: function (a, b) {
            a.first().addClass("tt-cursor"), !b && this.trigger("cursorMoved")
        }, _removeCursor: function () {
            this._getCursor().removeClass("tt-cursor")
        }, _moveCursor: function (a) {
            var b, c, d, e;
            if (this.isOpen) {
                if (c = this._getCursor(), b = this._getSuggestions(), this._removeCursor(), d = b.index(c) + a, d = (d + 1) % (b.length + 1) - 1, -1 === d)return void this.trigger("cursorRemoved");
                -1 > d && (d = b.length - 1), this._setCursor(e = b.eq(d)), this._ensureVisible(e)
            }
        }, _ensureVisible: function (a) {
            var b, c, d, e;
            b = a.position().top, c = b + a.outerHeight(!0), d = this.$menu.scrollTop(), e = this.$menu.height() + parseInt(this.$menu.css("paddingTop"), 10) + parseInt(this.$menu.css("paddingBottom"), 10), 0 > b ? this.$menu.scrollTop(d + b) : c > e && this.$menu.scrollTop(d + (c - e))
        }, close: function () {
            this.isOpen && (this.isOpen = !1, this._removeCursor(), this._hide(), this.trigger("closed"))
        }, open: function () {
            this.isOpen || (this.isOpen = !0, !this.isEmpty && this._show(), this.trigger("opened"))
        }, setLanguageDirection: function (a) {
            this.$menu.css("ltr" === a ? j.ltr : j.rtl)
        }, moveCursorUp: function () {
            this._moveCursor(-1)
        }, moveCursorDown: function () {
            this._moveCursor(1)
        }, getDatumForSuggestion: function (a) {
            var b = null;
            return a.length && (b = {raw: o.extractDatum(a), value: o.extractValue(a), datasetName: o.extractDatasetName(a)}), b
        }, getDatumForCursor: function () {
            return this.getDatumForSuggestion(this._getCursor().first())
        }, getDatumForTopSuggestion: function () {
            return this.getDatumForSuggestion(this._getSuggestions().first())
        }, update: function (a) {
            function c(b) {
                b.update(a)
            }

            b.each(this.datasets, c)
        }, empty: function () {
            function a(a) {
                a.clear()
            }

            b.each(this.datasets, a), this.isEmpty = !0
        }, isVisible: function () {
            return this.isOpen && !this.isEmpty
        }, destroy: function () {
            function a(a) {
                a.destroy()
            }

            this.$menu.off(".tt"), b.each(this.datasets, a)
        }}), c
    }(), q = function () {
        function c(c) {
            var e, f, g;
            c = c || {}, c.input || a.error("missing input"), this.autoselect = !!c.autoselect, this.minLength = b.isNumber(c.minLength) ? c.minLength : 1, this.$node = d(c.input, c.withHint), e = this.$node.find(".tt-dropdown-menu"), f = this.$node.find(".tt-input"), g = this.$node.find(".tt-hint"), this.eventBus = c.eventBus || new k({el: f}), this.dropdown = new p({menu: e, datasets: c.datasets}).onSync("suggestionClicked", this._onSuggestionClicked, this).onSync("cursorMoved", this._onCursorMoved, this).onSync("cursorRemoved", this._onCursorRemoved, this).onSync("opened", this._onOpened, this).onSync("closed", this._onClosed, this).onAsync("datasetRendered", this._onDatasetRendered, this), this.input = new n({input: f, hint: g}).onSync("focused", this._onFocused, this).onSync("blurred", this._onBlurred, this).onSync("enterKeyed", this._onEnterKeyed, this).onSync("tabKeyed", this._onTabKeyed, this).onSync("escKeyed", this._onEscKeyed, this).onSync("upKeyed", this._onUpKeyed, this).onSync("downKeyed", this._onDownKeyed, this).onSync("leftKeyed", this._onLeftKeyed, this).onSync("rightKeyed", this._onRightKeyed, this).onSync("queryChanged", this._onQueryChanged, this).onSync("whitespaceChanged", this._onWhitespaceChanged, this), e.on("mousedown.tt", function (a) {
                b.isMsie() && b.isMsie() < 9 && (f[0].onbeforedeactivate = function () {
                    window.event.returnValue = !1, f[0].onbeforedeactivate = null
                }), a.preventDefault()
            })
        }

        function d(b, c) {
            var d, f, h, k;
            d = a(b), f = a(i.wrapper).css(j.wrapper), h = a(i.dropdown).css(j.dropdown), k = d.clone().css(j.hint).css(e(d)), k.val("").removeData().addClass("tt-hint").removeAttr("id name placeholder").prop("disabled", !0).attr({autocomplete: "off", spellcheck: "false"}), d.data(g, {dir: d.attr("dir"), autocomplete: d.attr("autocomplete"), spellcheck: d.attr("spellcheck"), style: d.attr("style")}), d.addClass("tt-input").attr({autocomplete: "off", spellcheck: !1}).css(c ? j.input : j.inputWithNoHint);
            try {
                !d.attr("dir") && d.attr("dir", "auto")
            } catch (l) {
            }
            return d.wrap(f).parent().prepend(c ? k : null).append(h)
        }

        function e(a) {
            return{backgroundAttachment: a.css("background-attachment"), backgroundClip: a.css("background-clip"), backgroundColor: a.css("background-color"), backgroundImage: a.css("background-image"), backgroundOrigin: a.css("background-origin"), backgroundPosition: a.css("background-position"), backgroundRepeat: a.css("background-repeat"), backgroundSize: a.css("background-size")}
        }

        function f(a) {
            var c = a.find(".tt-input");
            b.each(c.data(g), function (a, d) {
                b.isUndefined(a) ? c.removeAttr(d) : c.attr(d, a)
            }), c.detach().removeData(g).removeClass("tt-input").insertAfter(a), a.remove()
        }

        var g = "ttAttrs";
        return b.mixin(c.prototype, {_onSuggestionClicked: function (a, b) {
            var c;
            (c = this.dropdown.getDatumForSuggestion(b)) && this._select(c)
        }, _onCursorMoved: function () {
            var a = this.dropdown.getDatumForCursor();
            this.input.clearHint(), this.input.setInputValue(a.value, !0), this.eventBus.trigger("cursorchanged", a.raw, a.datasetName)
        }, _onCursorRemoved: function () {
            this.input.resetInputValue(), this._updateHint()
        }, _onDatasetRendered: function () {
            this._updateHint()
        }, _onOpened: function () {
            0 === this.minLength && "" === this.input.getQuery() && this.dropdown.update(""), this._updateHint(), this.eventBus.trigger("opened")
        }, _onClosed: function () {
            this.input.clearHint(), this.eventBus.trigger("closed")
        }, _onFocused: function () {
            this.dropdown.empty(), this.dropdown.open()
        }, _onBlurred: function () {
            this.dropdown.close()
        }, _onEnterKeyed: function (a, b) {
            var c, d;
            c = this.dropdown.getDatumForCursor(), d = this.dropdown.getDatumForTopSuggestion(), c ? (this._select(c), b.preventDefault()) : this.autoselect && d && (this._select(d), b.preventDefault())
        }, _onTabKeyed: function (a, b) {
            var c;
            (c = this.dropdown.getDatumForCursor()) ? (this._select(c), b.preventDefault()) : this._autocomplete()
        }, _onEscKeyed: function () {
            this.dropdown.close(), this.input.resetInputValue()
        }, _onUpKeyed: function () {
            var a = this.input.getQuery();
            !this.dropdown.isOpen && a.length >= this.minLength && this.dropdown.update(a), this.dropdown.open(), this.dropdown.moveCursorUp()
        }, _onDownKeyed: function () {
            var a = this.input.getQuery();
            !this.dropdown.isOpen && a.length >= this.minLength && this.dropdown.update(a), this.dropdown.open(), this.dropdown.moveCursorDown()
        }, _onLeftKeyed: function () {
            "rtl" === this.dir && this._autocomplete()
        }, _onRightKeyed: function () {
            "ltr" === this.dir && this._autocomplete()
        }, _onQueryChanged: function (a, b) {
            this.input.clearHint(), this.dropdown.empty(), b.length >= this.minLength && this.dropdown.update(b), this.dropdown.open(), this._setLanguageDirection()
        }, _onWhitespaceChanged: function () {
            this._updateHint(), this.dropdown.open()
        }, _setLanguageDirection: function () {
            var a;
            this.dir !== (a = this.input.getLanguageDirection()) && (this.dir = a, this.$node.css("direction", a), this.dropdown.setLanguageDirection(a))
        }, _updateHint: function () {
            var a, c, d, e, f, g;
            a = this.dropdown.getDatumForTopSuggestion(), a && this.dropdown.isVisible() && !this.input.hasOverflow() && (c = this.input.getInputValue(), d = n.normalizeQuery(c), e = b.escapeRegExChars(d), f = new RegExp("^(?:" + e + ")(.*$)", "i"), g = f.exec(a.value), this.input.setHintValue(c + (g ? g[1] : "")))
        }, _autocomplete: function () {
            var a, b, c;
            a = this.input.getHintValue(), b = this.input.getQuery(), a && b !== a && this.input.isCursorAtEnd() && (c = this.dropdown.getDatumForTopSuggestion(), c && this.input.setInputValue(c.value), this.eventBus.trigger("autocompleted", c.raw, c.datasetName))
        }, _select: function (a) {
            this.input.clearHint(), this.input.setQuery(a.value), this.input.setInputValue(a.value, !0), this._setLanguageDirection(), this.eventBus.trigger("selected", a.raw, a.datasetName), this.dropdown.close(), b.defer(b.bind(this.dropdown.empty, this.dropdown))
        }, open: function () {
            this.dropdown.open()
        }, close: function () {
            this.dropdown.close()
        }, getQuery: function () {
            return this.input.getQuery()
        }, setQuery: function (a) {
            this.input.setInputValue(a)
        }, destroy: function () {
            this.input.destroy(), this.dropdown.destroy(), f(this.$node), this.$node = null
        }}), c
    }();
    !function () {
        var c, d, e;
        c = a.fn.typeahead, d = "ttTypeahead", e = {initialize: function (c, e) {
            function f() {
                var f, g, h = a(this);
                b.each(e, function (a) {
                    a.highlight = !!c.highlight
                }), g = new q({input: h, eventBus: f = new k({el: h}), withHint: b.isUndefined(c.hint) ? !0 : !!c.hint, minLength: c.minLength, autoselect: c.autoselect, datasets: e}), h.data(d, g)
            }

            return e = b.isArray(e) ? e : [].slice.call(arguments, 1), c = c || {}, this.each(f)
        }, open: function () {
            function b() {
                var b, c = a(this);
                (b = c.data(d)) && b.open()
            }

            return this.each(b)
        }, close: function () {
            function b() {
                var b, c = a(this);
                (b = c.data(d)) && b.close()
            }

            return this.each(b)
        }, val: function (b) {
            function c() {
                var c, e = a(this);
                (c = e.data(d)) && c.setQuery(b)
            }

            function e(a) {
                var b, c;
                return(b = a.data(d)) && (c = b.getQuery()), c
            }

            return arguments.length ? this.each(c) : e(this.first())
        }, destroy: function () {
            function b() {
                var b, c = a(this);
                (b = c.data(d)) && (b.destroy(), c.removeData(d))
            }

            return this.each(b)
        }}, a.fn.typeahead = function (a) {
            return e[a] ? e[a].apply(this, [].slice.call(arguments, 1)) : e.initialize.apply(this, arguments)
        }, a.fn.typeahead.noConflict = function () {
            return a.fn.typeahead = c, this
        }
    }()
}(window.jQuery), function (a) {
    "use strict";
    tfl.logs.create("tfl.storage: loaded");
    var b = window.localStorage;
    a.isLocalStorageSupported = function () {
        return"localStorage"in window && null !== window.localStorage ? (tfl.logs.create("tfl.storage: isLocalStorageSupported true"), !0) : (tfl.logs.create("tfl.storage: isLocalStorageSupported false"), !1)
    }, a.set = function (a, c, d) {
        if ((b || d) && void 0 !== a)try {
            var e = b;
            d && (e = d);
            var f = JSON.stringify(c);
            e.setItem(a, f), tfl.logs.create("tfl.storage.set: " + a + ":" + f)
        } catch (g) {
            tfl.logs.create("tfl.storage.set:" + g.message, "error")
        }
    }, a.setSessionStorage = function (b, c) {
        a.set(b, c, window.sessionStorage)
    }, a.get = function (a, c, d) {
        if (b || d)try {
            var e = b;
            d && (e = d);
            var f = e.getItem(a);
            if (null !== f)return JSON.parse(f)
        } catch (g) {
            tfl.logs.create("tfl.storage.get:" + g.message, "error")
        }
        return"" !== c ? (tfl.logs.create("tfl.storage.get: " + a + ":" + c), c) : (tfl.logs.create("tfl.storage.get: " + a + ": []"), [])
    }, a.getSessionStorage = function (b, c) {
        return a.get(b, c, window.sessionStorage)
    }, a.showIfNotDisabled = function (c, d) {
        if (b)try {
            var e = JSON.parse(a.get(c, !1));
            e || d()
        } catch (f) {
            d()
        } else d()
    }
}(window.tfl.storage = window.tfl.storage || {}), function (a) {
    a.extend(a.fn, {validate: function (b) {
        if (!this.length)return void(b && b.debug && window.console && console.warn("nothing selected, can't validate, returning nothing"));
        var c = a.data(this[0], "validator");
        if (c)return c;
        if (this.attr("novalidate", "novalidate"), c = new a.validator(b, this[0]), a.data(this[0], "validator", c), c.settings.onsubmit) {
            var d = this.find("input, button");
            d.filter(".cancel").click(function () {
                c.cancelSubmit = !0
            }), c.settings.submitHandler && d.filter(":submit").click(function () {
                c.submitButton = this
            }), this.submit(function (b) {
                function d() {
                    if (c.settings.submitHandler) {
                        if (c.submitButton)var b = a("<input type='hidden'/>").attr("name", c.submitButton.name).val(c.submitButton.value).appendTo(c.currentForm);
                        return c.settings.submitHandler.call(c, c.currentForm), c.submitButton && b.remove(), !1
                    }
                    return!0
                }

                return c.settings.debug && b.preventDefault(), c.cancelSubmit ? (c.cancelSubmit = !1, d()) : c.form() ? c.pendingRequest ? (c.formSubmitted = !0, !1) : d() : (c.focusInvalid(), !1)
            })
        }
        return c
    }, valid: function () {
        if (a(this[0]).is("form"))return this.validate().form();
        var b = !0, c = a(this[0].form).validate();
        return this.each(function () {
            b &= c.element(this)
        }), b
    }, removeAttrs: function (b) {
        var c = {}, d = this;
        return a.each(b.split(/\s/), function (a, b) {
            c[b] = d.attr(b), d.removeAttr(b)
        }), c
    }, rules: function (b, c) {
        var d = this[0];
        if (b) {
            var e = a.data(d.form, "validator").settings, f = e.rules, g = a.validator.staticRules(d);
            switch (b) {
                case"add":
                    a.extend(g, a.validator.normalizeRule(c)), f[d.name] = g, c.messages && (e.messages[d.name] = a.extend(e.messages[d.name], c.messages));
                    break;
                case"remove":
                    if (!c)return delete f[d.name], g;
                    var h = {};
                    return a.each(c.split(/\s/), function (a, b) {
                        h[b] = g[b], delete g[b]
                    }), h
            }
        }
        var i = a.validator.normalizeRules(a.extend({}, a.validator.metadataRules(d), a.validator.classRules(d), a.validator.attributeRules(d), a.validator.staticRules(d)), d);
        if (i.required) {
            var j = i.required;
            delete i.required, i = a.extend({required: j}, i)
        }
        return i
    }}), a.extend(a.expr[":"], {blank: function (b) {
        return!a.trim("" + b.value)
    }, filled: function (b) {
        return!!a.trim("" + b.value)
    }, unchecked: function (a) {
        return!a.checked
    }}), a.validator = function (b, c) {
        this.settings = a.extend(!0, {}, a.validator.defaults, b), this.currentForm = c, this.init()
    }, a.validator.format = function (b, c) {
        return 1 == arguments.length ? function () {
            var c = a.makeArray(arguments);
            return c.unshift(b), a.validator.format.apply(this, c)
        } : (arguments.length > 2 && c.constructor != Array && (c = a.makeArray(arguments).slice(1)), c.constructor != Array && (c = [c]), a.each(c, function (a, c) {
            b = b.replace(new RegExp("\\{" + a + "\\}", "g"), c)
        }), b)
    }, a.extend(a.validator, {defaults: {messages: {}, groups: {}, rules: {}, errorClass: "error", validClass: "valid", errorElement: "label", focusInvalid: !0, errorContainer: a([]), errorLabelContainer: a([]), onsubmit: !0, ignore: ":hidden", ignoreTitle: !1, onfocusin: function (a) {
        this.lastActive = a, this.settings.focusCleanup && !this.blockFocusCleanup && (this.settings.unhighlight && this.settings.unhighlight.call(this, a, this.settings.errorClass, this.settings.validClass), this.addWrapper(this.errorsFor(a)).hide())
    }, onfocusout: function (a) {
        this.checkable(a) || !(a.name in this.submitted) && this.optional(a) || this.element(a)
    }, onkeyup: function (a) {
        (a.name in this.submitted || a == this.lastElement) && this.element(a)
    }, onclick: function (a) {
        a.name in this.submitted ? this.element(a) : a.parentNode.name in this.submitted && this.element(a.parentNode)
    }, highlight: function (b, c, d) {
        "radio" === b.type ? this.findByName(b.name).addClass(c).removeClass(d) : a(b).addClass(c).removeClass(d)
    }, unhighlight: function (b, c, d) {
        "radio" === b.type ? this.findByName(b.name).removeClass(c).addClass(d) : a(b).removeClass(c).addClass(d)
    }}, setDefaults: function (b) {
        a.extend(a.validator.defaults, b)
    }, messages: {required: "This field is required.", remote: "Please fix this field.", email: "Please enter a valid email address.", url: "Please enter a valid URL.", date: "Please enter a valid date.", dateISO: "Please enter a valid date (ISO).", number: "Please enter a valid number.", digits: "Please enter only digits.", creditcard: "Please enter a valid credit card number.", equalTo: "Please enter the same value again.", accept: "Please enter a value with a valid extension.", maxlength: a.validator.format("Please enter no more than {0} characters."), minlength: a.validator.format("Please enter at least {0} characters."), rangelength: a.validator.format("Please enter a value between {0} and {1} characters long."), range: a.validator.format("Please enter a value between {0} and {1}."), max: a.validator.format("Please enter a value less than or equal to {0}."), min: a.validator.format("Please enter a value greater than or equal to {0}.")}, autoCreateRanges: !1, prototype: {init: function () {
        function b(b) {
            var c = a.data(this[0].form, "validator"), d = "on" + b.type.replace(/^validate/, "");
            c.settings[d] && c.settings[d].call(c, this[0], b)
        }

        this.labelContainer = a(this.settings.errorLabelContainer), this.errorContext = this.labelContainer.length && this.labelContainer || a(this.currentForm), this.containers = a(this.settings.errorContainer).add(this.settings.errorLabelContainer), this.submitted = {}, this.valueCache = {}, this.pendingRequest = 0, this.pending = {}, this.invalid = {}, this.reset();
        var c = this.groups = {};
        a.each(this.settings.groups, function (b, d) {
            a.each(d.split(/\s/), function (a, d) {
                c[d] = b
            })
        });
        var d = this.settings.rules;
        a.each(d, function (b, c) {
            d[b] = a.validator.normalizeRule(c)
        }), a(this.currentForm).validateDelegate("[type='text'], [type='password'], [type='file'], select, textarea, [type='number'], [type='search'] ,[type='tel'], [type='url'], [type='email'], [type='datetime'], [type='date'], [type='month'], [type='week'], [type='time'], [type='datetime-local'], [type='range'], [type='color'] ", "focusin focusout keyup", b).validateDelegate("[type='radio'], [type='checkbox'], select, option", "click", b), this.settings.invalidHandler && a(this.currentForm).bind("invalid-form.validate", this.settings.invalidHandler)
    }, form: function () {
        return this.checkForm(), a.extend(this.submitted, this.errorMap), this.invalid = a.extend({}, this.errorMap), this.valid() || a(this.currentForm).triggerHandler("invalid-form", [this]), this.showErrors(), this.valid()
    }, checkForm: function () {
        this.prepareForm();
        for (var a = 0, b = this.currentElements = this.elements(); b[a]; a++)this.check(b[a]);
        return this.valid()
    }, element: function (b) {
        b = this.validationTargetFor(this.clean(b)), this.lastElement = b, this.prepareElement(b), this.currentElements = a(b);
        var c = this.check(b);
        return c ? delete this.invalid[b.name] : this.invalid[b.name] = !0, this.numberOfInvalids() || (this.toHide = this.toHide.add(this.containers)), this.showErrors(), c
    }, showErrors: function (b) {
        if (b) {
            a.extend(this.errorMap, b), this.errorList = [];
            for (var c in b)this.errorList.push({message: b[c], element: this.findByName(c)[0]});
            this.successList = a.grep(this.successList, function (a) {
                return!(a.name in b)
            })
        }
        this.settings.showErrors ? this.settings.showErrors.call(this, this.errorMap, this.errorList) : this.defaultShowErrors()
    }, resetForm: function () {
        a.fn.resetForm && a(this.currentForm).resetForm(), this.submitted = {}, this.lastElement = null, this.prepareForm(), this.hideErrors(), this.elements().removeClass(this.settings.errorClass)
    }, numberOfInvalids: function () {
        return this.objectLength(this.invalid)
    }, objectLength: function (a) {
        var b = 0;
        for (var c in a)b++;
        return b
    }, hideErrors: function () {
        this.addWrapper(this.toHide).hide()
    }, valid: function () {
        return 0 == this.size()
    }, size: function () {
        return this.errorList.length
    }, focusInvalid: function () {
        if (this.settings.focusInvalid)try {
            a(this.findLastActive() || this.errorList.length && this.errorList[0].element || []).filter(":visible").focus().trigger("focusin")
        } catch (b) {
        }
    }, findLastActive: function () {
        var b = this.lastActive;
        return b && 1 == a.grep(this.errorList, function (a) {
            return a.element.name == b.name
        }).length && b
    }, elements: function () {
        var b = this, c = {};
        return a(this.currentForm).find("input, select, textarea").not(":submit, :reset, :image, [disabled]").not(this.settings.ignore).filter(function () {
            return!this.name && b.settings.debug && window.console && console.error("%o has no name assigned", this), this.name in c || !b.objectLength(a(this).rules()) ? !1 : (c[this.name] = !0, !0)
        })
    }, clean: function (b) {
        return a(b)[0]
    }, errors: function () {
        return a(this.settings.errorElement + "." + this.settings.errorClass, this.errorContext)
    }, reset: function () {
        this.successList = [], this.errorList = [], this.errorMap = {}, this.toShow = a([]), this.toHide = a([]), this.currentElements = a([])
    }, prepareForm: function () {
        this.reset(), this.toHide = this.errors().add(this.containers)
    }, prepareElement: function (a) {
        this.reset(), this.toHide = this.errorsFor(a)
    }, check: function (b) {
        b = this.validationTargetFor(this.clean(b));
        var c = a(b).rules(), d = !1;
        for (var e in c) {
            var f = {method: e, parameters: c[e]};
            try {
                var g = a.validator.methods[e].call(this, b.value.replace(/\r/g, ""), b, f.parameters);
                if ("dependency-mismatch" == g) {
                    d = !0;
                    continue
                }
                if (d = !1, "pending" == g)return void(this.toHide = this.toHide.not(this.errorsFor(b)));
                if (!g)return this.formatAndAdd(b, f), !1
            } catch (h) {
                throw this.settings.debug && window.console && console.log("exception occured when checking element " + b.id + ", check the '" + f.method + "' method", h), h
            }
        }
        return d ? void 0 : (this.objectLength(c) && this.successList.push(b), !0)
    }, customMetaMessage: function (b, c) {
        if (a.metadata) {
            var d = this.settings.meta ? a(b).metadata()[this.settings.meta] : a(b).metadata();
            return d && d.messages && d.messages[c]
        }
    }, customMessage: function (a, b) {
        var c = this.settings.messages[a];
        return c && (c.constructor == String ? c : c[b])
    }, findDefined: function () {
        for (var a = 0; a < arguments.length; a++)if (void 0 !== arguments[a])return arguments[a];
        return void 0
    }, defaultMessage: function (b, c) {
        return this.findDefined(this.customMessage(b.name, c), this.customMetaMessage(b, c), !this.settings.ignoreTitle && b.title || void 0, a.validator.messages[c], "<strong>Warning: No message defined for " + b.name + "</strong>")
    }, formatAndAdd: function (a, b) {
        var c = this.defaultMessage(a, b.method), d = /\$?\{(\d+)\}/g;
        "function" == typeof c ? c = c.call(this, b.parameters, a) : d.test(c) && (c = jQuery.format(c.replace(d, "{$1}"), b.parameters)), this.errorList.push({message: c, element: a}), this.errorMap[a.name] = c, this.submitted[a.name] = c
    }, addWrapper: function (a) {
        return this.settings.wrapper && (a = a.add(a.parent(this.settings.wrapper))), a
    }, defaultShowErrors: function () {
        for (var a = 0; this.errorList[a]; a++) {
            var b = this.errorList[a];
            this.settings.highlight && this.settings.highlight.call(this, b.element, this.settings.errorClass, this.settings.validClass), this.showLabel(b.element, b.message)
        }
        if (this.errorList.length && (this.toShow = this.toShow.add(this.containers)), this.settings.success)for (var a = 0; this.successList[a]; a++)this.showLabel(this.successList[a]);
        if (this.settings.unhighlight)for (var a = 0, c = this.validElements(); c[a]; a++)this.settings.unhighlight.call(this, c[a], this.settings.errorClass, this.settings.validClass);
        this.toHide = this.toHide.not(this.toShow), this.hideErrors(), this.addWrapper(this.toShow).show()
    }, validElements: function () {
        return this.currentElements.not(this.invalidElements())
    }, invalidElements: function () {
        return a(this.errorList).map(function () {
            return this.element
        })
    }, showLabel: function (b, c) {
        var d = this.errorsFor(b);
        d.length ? (d.removeClass(this.settings.validClass).addClass(this.settings.errorClass), d.attr("generated") && d.html(c)) : (d = a("<" + this.settings.errorElement + "/>").attr({"for": this.idOrName(b), generated: !0}).addClass(this.settings.errorClass).html(c || ""), this.settings.wrapper && (d = d.hide().show().wrap("<" + this.settings.wrapper + "/>").parent()), this.labelContainer.append(d).length || (this.settings.errorPlacement ? this.settings.errorPlacement(d, a(b)) : d.insertAfter(b))), !c && this.settings.success && (d.text(""), "string" == typeof this.settings.success ? d.addClass(this.settings.success) : this.settings.success(d)), this.toShow = this.toShow.add(d)
    }, errorsFor: function (b) {
        var c = this.idOrName(b);
        return this.errors().filter(function () {
            return a(this).attr("for") == c
        })
    }, idOrName: function (a) {
        return this.groups[a.name] || (this.checkable(a) ? a.name : a.id || a.name)
    }, validationTargetFor: function (a) {
        return this.checkable(a) && (a = this.findByName(a.name).not(this.settings.ignore)[0]), a
    }, checkable: function (a) {
        return/radio|checkbox/i.test(a.type)
    }, findByName: function (b) {
        var c = this.currentForm;
        return a(document.getElementsByName(b)).map(function (a, d) {
            return d.form == c && d.name == b && d || null
        })
    }, getLength: function (b, c) {
        switch (c.nodeName.toLowerCase()) {
            case"select":
                return a("option:selected", c).length;
            case"input":
                if (this.checkable(c))return this.findByName(c.name).filter(":checked").length
        }
        return b.length
    }, depend: function (a, b) {
        return this.dependTypes[typeof a] ? this.dependTypes[typeof a](a, b) : !0
    }, dependTypes: {"boolean": function (a) {
        return a
    }, string: function (b, c) {
        return!!a(b, c.form).length
    }, "function": function (a, b) {
        return a(b)
    }}, optional: function (b) {
        return!a.validator.methods.required.call(this, a.trim(b.value), b) && "dependency-mismatch"
    }, startRequest: function (a) {
        this.pending[a.name] || (this.pendingRequest++, this.pending[a.name] = !0)
    }, stopRequest: function (b, c) {
        this.pendingRequest--, this.pendingRequest < 0 && (this.pendingRequest = 0), delete this.pending[b.name], c && 0 == this.pendingRequest && this.formSubmitted && this.form() ? (a(this.currentForm).submit(), this.formSubmitted = !1) : !c && 0 == this.pendingRequest && this.formSubmitted && (a(this.currentForm).triggerHandler("invalid-form", [this]), this.formSubmitted = !1)
    }, previousValue: function (b) {
        return a.data(b, "previousValue") || a.data(b, "previousValue", {old: null, valid: !0, message: this.defaultMessage(b, "remote")})
    }}, classRuleSettings: {required: {required: !0}, email: {email: !0}, url: {url: !0}, date: {date: !0}, dateISO: {dateISO: !0}, dateDE: {dateDE: !0}, number: {number: !0}, numberDE: {numberDE: !0}, digits: {digits: !0}, creditcard: {creditcard: !0}}, addClassRules: function (b, c) {
        b.constructor == String ? this.classRuleSettings[b] = c : a.extend(this.classRuleSettings, b)
    }, classRules: function (b) {
        var c = {}, d = a(b).attr("class");
        return d && a.each(d.split(" "), function () {
            this in a.validator.classRuleSettings && a.extend(c, a.validator.classRuleSettings[this])
        }), c
    }, attributeRules: function (b) {
        var c = {}, d = a(b);
        for (var e in a.validator.methods) {
            var f;
            f = "required" === e && "function" == typeof a.fn.prop ? d.prop(e) : d.attr(e), f ? c[e] = f : d[0].getAttribute("type") === e && (c[e] = !0)
        }
        return c.maxlength && /-1|2147483647|524288/.test(c.maxlength) && delete c.maxlength, c
    }, metadataRules: function (b) {
        if (!a.metadata)return{};
        var c = a.data(b.form, "validator").settings.meta;
        return c ? a(b).metadata()[c] : a(b).metadata()
    }, staticRules: function (b) {
        var c = {}, d = a.data(b.form, "validator");
        return d.settings.rules && (c = a.validator.normalizeRule(d.settings.rules[b.name]) || {}), c
    }, normalizeRules: function (b, c) {
        return a.each(b, function (d, e) {
            if (e === !1)return void delete b[d];
            if (e.param || e.depends) {
                var f = !0;
                switch (typeof e.depends) {
                    case"string":
                        f = !!a(e.depends, c.form).length;
                        break;
                    case"function":
                        f = e.depends.call(c, c)
                }
                f ? b[d] = void 0 !== e.param ? e.param : !0 : delete b[d]
            }
        }), a.each(b, function (d, e) {
            b[d] = a.isFunction(e) ? e(c) : e
        }), a.each(["minlength", "maxlength", "min", "max"], function () {
            b[this] && (b[this] = Number(b[this]))
        }), a.each(["rangelength", "range"], function () {
            b[this] && (b[this] = [Number(b[this][0]), Number(b[this][1])])
        }), a.validator.autoCreateRanges && (b.min && b.max && (b.range = [b.min, b.max], delete b.min, delete b.max), b.minlength && b.maxlength && (b.rangelength = [b.minlength, b.maxlength], delete b.minlength, delete b.maxlength)), b.messages && delete b.messages, b
    }, normalizeRule: function (b) {
        if ("string" == typeof b) {
            var c = {};
            a.each(b.split(/\s/), function () {
                c[this] = !0
            }), b = c
        }
        return b
    }, addMethod: function (b, c, d) {
        a.validator.methods[b] = c, a.validator.messages[b] = void 0 != d ? d : a.validator.messages[b], c.length < 3 && a.validator.addClassRules(b, a.validator.normalizeRule(b))
    }, methods: {required: function (b, c, d) {
        if (!this.depend(d, c))return"dependency-mismatch";
        switch (c.nodeName.toLowerCase()) {
            case"select":
                var e = a(c).val();
                return e && e.length > 0;
            case"input":
                if (this.checkable(c))return this.getLength(b, c) > 0;
            default:
                return a.trim(b).length > 0
        }
    }, remote: function (b, c, d) {
        if (this.optional(c))return"dependency-mismatch";
        var e = this.previousValue(c);
        if (this.settings.messages[c.name] || (this.settings.messages[c.name] = {}), e.originalMessage = this.settings.messages[c.name].remote, this.settings.messages[c.name].remote = e.message, d = "string" == typeof d && {url: d} || d, this.pending[c.name])return"pending";
        if (e.old === b)return e.valid;
        e.old = b;
        var f = this;
        this.startRequest(c);
        var g = {};
        return g[c.name] = b, a.ajax(a.extend(!0, {url: d, mode: "abort", port: "validate" + c.name, dataType: "json", data: g, success: function (d) {
            f.settings.messages[c.name].remote = e.originalMessage;
            var g = d === !0;
            if (g) {
                var h = f.formSubmitted;
                f.prepareElement(c), f.formSubmitted = h, f.successList.push(c), f.showErrors()
            } else {
                var i = {}, j = d || f.defaultMessage(c, "remote");
                i[c.name] = e.message = a.isFunction(j) ? j(b) : j, f.showErrors(i)
            }
            e.valid = g, f.stopRequest(c, g)
        }}, d)), "pending"
    }, minlength: function (b, c, d) {
        return this.optional(c) || this.getLength(a.trim(b), c) >= d
    }, maxlength: function (b, c, d) {
        return this.optional(c) || this.getLength(a.trim(b), c) <= d
    }, rangelength: function (b, c, d) {
        var e = this.getLength(a.trim(b), c);
        return this.optional(c) || e >= d[0] && e <= d[1]
    }, min: function (a, b, c) {
        return this.optional(b) || a >= c
    }, max: function (a, b, c) {
        return this.optional(b) || c >= a
    }, range: function (a, b, c) {
        return this.optional(b) || a >= c[0] && a <= c[1]
    }, email: function (a, b) {
        return this.optional(b) || /^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(a)
    }, url: function (a, b) {
        return this.optional(b) || /^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(a)
    }, date: function (a, b) {
        return this.optional(b) || !/Invalid|NaN/.test(new Date(a))
    }, dateISO: function (a, b) {
        return this.optional(b) || /^\d{4}[\/-]\d{1,2}[\/-]\d{1,2}$/.test(a)
    }, number: function (a, b) {
        return this.optional(b) || /^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/.test(a)
    }, digits: function (a, b) {
        return this.optional(b) || /^\d+$/.test(a)
    }, creditcard: function (a, b) {
        if (this.optional(b))return"dependency-mismatch";
        if (/[^0-9 -]+/.test(a))return!1;
        var c = 0, d = 0, e = !1;
        a = a.replace(/\D/g, "");
        for (var f = a.length - 1; f >= 0; f--) {
            var g = a.charAt(f), d = parseInt(g, 10);
            e && (d *= 2) > 9 && (d -= 9), c += d, e = !e
        }
        return c % 10 == 0
    }, accept: function (a, b, c) {
        return c = "string" == typeof c ? c.replace(/,/g, "|") : "png|jpe?g|gif", this.optional(b) || a.match(new RegExp(".(" + c + ")$", "i"))
    }, equalTo: function (b, c, d) {
        var e = a(d).unbind(".validate-equalTo").bind("blur.validate-equalTo", function () {
            a(c).valid()
        });
        return b == e.val()
    }}}), a.format = a.validator.format
}(jQuery), function (a) {
    var b = {};
    if (a.ajaxPrefilter)a.ajaxPrefilter(function (a, c, d) {
        var e = a.port;
        "abort" == a.mode && (b[e] && b[e].abort(), b[e] = d)
    }); else {
        var c = a.ajax;
        a.ajax = function (d) {
            var e = ("mode"in d ? d : a.ajaxSettings).mode, f = ("port"in d ? d : a.ajaxSettings).port;
            return"abort" == e ? (b[f] && b[f].abort(), b[f] = c.apply(this, arguments)) : c.apply(this, arguments)
        }
    }
}(jQuery), function (a) {
    jQuery.event.special.focusin || jQuery.event.special.focusout || !document.addEventListener || a.each({focus: "focusin", blur: "focusout"}, function (b, c) {
        function d(b) {
            return b = a.event.fix(b), b.type = c, a.event.handle.call(this, b)
        }

        a.event.special[c] = {setup: function () {
            this.addEventListener(b, d, !0)
        }, teardown: function () {
            this.removeEventListener(b, d, !0)
        }, handler: function (b) {
            return arguments[0] = a.event.fix(b), arguments[0].type = c, a.event.handle.apply(this, arguments)
        }}
    }), a.extend(a.fn, {validateDelegate: function (b, c, d) {
        return this.bind(c, function (c) {
            var e = a(c.target);
            return e.is(b) ? d.apply(e, arguments) : void 0
        })
    }})
}(jQuery), function (a) {
    function b(a, b, c) {
        a.rules[b] = c, a.message && (a.messages[b] = a.message)
    }

    function c(a) {
        return a.replace(/^\s+|\s+$/g, "").split(/\s*,\s*/g)
    }

    function d(a) {
        return a.substr(0, a.lastIndexOf(".") + 1)
    }

    function e(a, b) {
        return 0 === a.indexOf("*.") && (a = a.replace("*.", b)), a
    }

    function f(b, c) {
        var d = a(this).find("[data-valmsg-for='" + c[0].name + "']"), e = a.parseJSON(d.attr("data-valmsg-replace")) !== !1;
        d.removeClass("field-validation-valid").addClass("field-validation-error"), b.data("unobtrusiveContainer", d), e ? (d.empty(), b.removeClass("input-validation-error").appendTo(d)) : b.hide()
    }

    function g(b, c) {
        var d = a(this).find("[data-valmsg-summary=true]"), e = d.find("ul");
        e && e.length && c.errorList.length && (e.empty(), d.addClass("validation-summary-errors").removeClass("validation-summary-valid"), a.each(c.errorList, function () {
            a("<li />").html(this.message).appendTo(e)
        }))
    }

    function h(b) {
        var c = b.data("unobtrusiveContainer"), d = a.parseJSON(c.attr("data-valmsg-replace"));
        c && (c.addClass("field-validation-valid").removeClass("field-validation-error"), b.removeData("unobtrusiveContainer"), d && c.empty())
    }

    function i(b) {
        var c = a(b), d = c.data(l);
        return d || (d = {options: {errorClass: "input-validation-error", errorElement: "span", errorPlacement: a.proxy(f, b), invalidHandler: a.proxy(g, b), messages: {}, rules: {}, success: a.proxy(h, b)}, attachValidation: function () {
            c.validate(this.options)
        }, validate: function () {
            return c.validate(), c.valid()
        }}, c.data(l, d)), d
    }

    var j, k = a.validator, l = "unobtrusiveValidation";
    k.unobtrusive = {adapters: [], parseElement: function (b, c) {
        var d, e, f, g = a(b), h = g.parents("form")[0];
        h && (d = i(h), d.options.rules[b.name] = e = {}, d.options.messages[b.name] = f = {}, a.each(this.adapters, function () {
            var c = "data-val-" + this.name, d = g.attr(c), i = {};
            void 0 !== d && (c += "-", a.each(this.params, function () {
                i[this] = g.attr(c + this)
            }), this.adapt({element: b, form: h, message: d, params: i, rules: e, messages: f}))
        }), jQuery.extend(e, {__dummy__: !0}), !c && d.attachValidation())
    }, parse: function (b) {
        a(b).find(":input[data-val=true]").each(function () {
            k.unobtrusive.parseElement(this, !0)
        }), a("form").each(function () {
            var a = i(this);
            a && a.attachValidation()
        })
    }}, j = k.unobtrusive.adapters, j.add = function (a, b, c) {
        return c || (c = b, b = []), this.push({name: a, params: b, adapt: c}), this
    }, j.addBool = function (a, c) {
        return this.add(a, function (d) {
            b(d, c || a, !0)
        })
    }, j.addMinMax = function (a, c, d, e, f, g) {
        return this.add(a, [f || "min", g || "max"], function (a) {
            var f = a.params.min, g = a.params.max;
            f && g ? b(a, e, [f, g]) : f ? b(a, c, f) : g && b(a, d, g)
        })
    }, j.addSingleVal = function (a, c, d) {
        return this.add(a, [c || "val"], function (e) {
            b(e, d || a, e.params[c])
        })
    }, k.addMethod("__dummy__", function () {
        return!0
    }), k.addMethod("regex", function (a, b, c) {
        var d;
        return this.optional(b) ? !0 : (d = new RegExp(c).exec(a), d && 0 === d.index && d[0].length === a.length)
    }), j.addSingleVal("accept", "exts").addSingleVal("regex", "pattern"), j.addBool("creditcard").addBool("date").addBool("digits").addBool("email").addBool("number").addBool("url"), j.addMinMax("length", "minlength", "maxlength", "rangelength").addMinMax("range", "min", "max", "range"), j.add("equalto", ["other"], function (c) {
        var f = d(c.element.name), g = c.params.other, h = e(g, f), i = a(c.form).find(":input[name=" + h + "]")[0];
        b(c, "equalTo", i)
    }), j.add("required", function (a) {
        ("INPUT" !== a.element.tagName.toUpperCase() || "CHECKBOX" !== a.element.type.toUpperCase()) && b(a, "required", !0)
    }), j.add("remote", ["url", "type", "additionalfields"], function (f) {
        var g = {url: f.params.url, type: f.params.type || "GET", data: {}}, h = d(f.element.name);
        a.each(c(f.params.additionalfields || f.element.name), function (b, c) {
            var d = e(c, h);
            g.data[d] = function () {
                return a(f.form).find(":input[name='" + d + "']").val()
            }
        }), b(f, "remote", g)
    }), a(function () {
        k.unobtrusive.parse(document)
    })
}(jQuery), function (a) {
    "use strict";
    function b() {
        a.requestAnimFrame = window.requestAnimationFrame ? function (a) {
            window.requestAnimationFrame(a)
        } : window.webkitRequestAnimationFrame ? function (a) {
            window.webkitRequestAnimationFrame(a)
        } : window.mozRequestAnimationFrame ? function (a) {
            window.mozRequestAnimationFrame(a)
        } : function (a) {
            window.setTimeout(a, 1e3 / 60)
        }
    }

    function c() {
        Array.prototype.indexOf = function (a) {
            var b, c, d = Object(this), e = d.length >>> 0;
            if (0 === e)return-1;
            if (b = 0, arguments.length > 1 && (b = Number(arguments[1]), b !== b ? b = 0 : 0 !== b && 1 / 0 !== b && b !== -1 / 0 && (b = (b > 0 || -1) * Math.floor(Math.abs(b)))), b >= e)return-1;
            for (c = b >= 0 ? b : Math.max(e - Math.abs(b), 0); e > c; c++)if (c in d && d[c] === a)return c;
            return-1
        }
    }

    function d() {
        Function.prototype.bind = function (a) {
            if ("function" != typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");
            var b = Array.prototype.slice.call(arguments, 1), c = this, d = function () {
            }, e = function () {
                return c.apply(this instanceof d && a ? this : a, b.concat(Array.prototype.slice.call(arguments)))
            };
            return d.prototype = this.prototype, e.prototype = new d, e
        }
    }

    function e() {
        String.prototype.trim = function () {
            return this.replace(/^\s+|\s+$/g, "")
        }
    }

    function f() {
        tfl.logs.create("tfl.utils: started"), a.supportsSVG(), a.supportsFlexbox(), Array.prototype.indexOf || c(), Function.prototype.bind || d(), String.prototype.trim || e(), b()
    }

    tfl.logs.create("tfl.utils: loaded");
    var g = function () {
        return!0
    }, h = function () {
        return!1
    };
    a.supportsSVG = function () {
        document.createElementNS && document.createElementNS("http://www.w3.org/2000/svg", "svg").createSVGRect ? a.supportsSVG = g : ($(document.body).addClass("nosvg"), a.supportsSVG = h)
    }, a.supportsFlexbox = function () {
        var b = ["flexWrap", "webkitFlexWrap", "mozFlexWrap", "msFlexWrap"];
        for (var c in b)if (void 0 !== document.body.style[c])return $(document.body).addClass("flexbox"), a.supportsFlexbox = g, !0;
        return $(document.body).addClass("no-flexbox"), a.supportsFlexbox = h, !1
    }, a.isTouchDevice = function () {
        return!!("ontouchstart"in window) || !!("onmsgesturechange"in window)
    }, a.runOnImgComplete = function (a, b) {
        1 === a.nodeType && "img" === a.tagName.toLowerCase() && "" !== a.src && (a.complete || 4 === a.readyState ? b() : "uninitialized" === a.readyState && 0 === a.src.indexOf("data:") ? tfl.logs.create("tfl.utils.runOnImgComplete: failed to load " + a.src) : $(a).one("load", b))
    }, f()
}(window.tfl.utils = window.tfl.utils || {}), function (a) {
    "use strict";
    a.dictionary = {MoreOptions: "Accessibility & travel options", LessOptions: "Fewer options", CustomisedOptions: null !== $.cookie("jp-pref") ? " (customised)" : "", ShowDetailedView: "View Details", HideDetailedView: "Hide Details", ShowAllStops: "View all stops", HideAllStops: "Hide all stops", ShowTextInstructions: "View text instructions", HideTextInstructions: "Hide text instructions", NowText: "Now", TodayText: "Today", RemoveContentClass: ".remove-content", JpTypeCycling: "cycling", JpTypeWalking: "walking", FirstServiceText: "First service", LastServiceText: "Last service", CurrentLocationText: "Current location "}, a.logs.create("tfl.dictionary: loaded")
}(window.tfl = window.tfl || {}), function (a) {
    "use strict";
    function b(a) {
        return void 0 === a ? (tfl.logs.create("error instantiating object - mandatory field not populated"), !1) : !0
    }

    a.modes = [tfl.modeNameTube, tfl.modeNameBus, tfl.modeNameTram, tfl.modeNameRiver, tfl.modeNameCableCar, tfl.modeNameMultiModal], a.SSPObject = function (c, d, e) {
        return e = e || {}, b(c) && b(d) ? a.modes.indexOf(d) < 0 ? {error: "invalid mode supplied"} : (this.naptanId = c, this.mode = d, void(this.props = $.extend({lines: [], name: "", towards: ""}, e))) : {error: "naptanId and mode are mandatory"}
    }, tfl.logs.create("tfl.objects: loaded")
}(window.tfl.objects = window.tfl.objects || {});
var tfl = tfl || {};
!function (a) {
    "use strict";
    a.logs.create("tfl.core: loaded"), a.init = function () {
        a.logs.create("tfl.core: started"), a.responsive.init(), a.interactions.init()
    }, a.getQueryParam = function (a, b) {
        b || (b = window.location.search), a = a.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]").toLowerCase();
        var c = "[\\?&]" + a + "=([^&#]*)", d = new RegExp(c), e = d.exec(b.toLowerCase());
        return null === e ? "" : decodeURIComponent(e[1].replace(/\+/g, " "))
    }, a.interactions = {init: function () {
        a.logs.create("tfl.interactions: started"), a.interactions.externalLinks(), $(".top-row .more").click(a.interactions.toggleNavigation), $(".show-mobile-search").click(a.interactions.toggleMobileSearch), $("#footer h2.heading").wrap('<a href="#info-for" class="info-for-link" />'), $("#footer a.info-for-link").click(a.interactions.toggleFooter), $(".cookie-policy-button a").click(a.interactions.hideCookiesPolicyNotice), a.storage.showIfNotDisabled("cookiePolicyNoticeHidden", function () {
            $(".cookie-policy-notice").show()
        }), $(document).keydown(function (a) {
            var b = [], c = $(document.activeElement);
            if (a.shiftKey && 9 === a.keyCode) {
                var d = c.attr("data-jumpback") || c.data("jumpback");
                void 0 !== d && (b = "string" == typeof d ? $(d) : b = d)
            } else if (9 === a.which) {
                var e = c.attr("data-jumpto") || c.data("jumpto");
                void 0 !== e && (b = "string" == typeof e ? $(e) : b = e)
            }
            return b.length > 0 ? (b = b.length > 1 ? b.first() : b, b.focus(), $(".ui-menu-item").hide(), !1) : void 0
        }), $("input[type='text']").attr("autocomplete", "off")
    }, hideCookiesPolicyNotice: function () {
        if ($(".cookie-policy-notice").hide(), a.storage.set("cookiePolicyNoticeHidden", "true"), $("html.lt-ie8").length > 0) {
            var b = $(".top-row, #full-width-content");
            b.addClass("ie7-fix"), window.setTimeout(function () {
                b.removeClass("ie7-fix")
            }, 5)
        }
        return!1
    }, toggleNavigation: function () {
        var b = $(".extra-nav");
        return $(".top-row.show-search").is(":visible") && a.interactions.toggleMobileSearch(), $(".top-row .more").children("a").toggleClass("expanded"), b.toggleClass("expanded"), $("#container").toggleClass("menu-visible"), b.find(".menu-sub-section:last").find("ul").find("li:last").find("a").blur(function () {
            $("input#q").focus()
        }), !1
    }, externalLinks: function () {
        a.logs.create("external link classes: initialised"), $("a").filter(function () {
            return this.hostname && this.hostname !== location.hostname
        }).addClass("external-link"), $("a.external-link,a.document-download-wrap").attr("target", "_parent"), a.logs.create("external link classes: added")
    }, toggleMobileSearch: function () {
        $(".extra-nav.expanded").is(":visible") && a.interactions.toggleNavigation();
        var b = $(".show-mobile-search"), c = ".journey-form #plan-a-journey tabbable:first,#main-hero :tabbable:first", d = "#query";
        return b.attr("data-jumpto") === c ? b.attr("data-jumpto", d) : b.attr("data-jumpto") === d && b.attr("data-jumpto", c), $(".search-tools").find("a").css("top", "5px"), $(".top-row").toggleClass("show-search"), !1
    }, toggleFooter: function () {
        return $(".primary-footer").toggleClass("expanded"), !1
    }}, a.responsive = {init: function () {
        a.logs.create("tfl.responsive: started"), a.responsive.setupBreakpoints(), $(".top-row .logo").after("<ul class='collapsible-menu clearfix'>&nbsp;</ul>");
        var b = $(".collapsible-menu");
        b.append($(".plan-journey").clone()), b.append($(".status-update").clone()), b.append($(".maps").clone()), b.append($(".fares-and-payments").clone()), $(".collapsible-menu a").removeAttr("data-jumpback"), b.append("<li class='more'><a href='javascript:void(0)' data-jumpto='.extra-nav a:visible:first'><span class='text'>More...</span><span class='arrow'>&nbsp;</span></a></li></li>"), $(".texts").append('<div class="search"><a href="javascript:void(0);" class="show-mobile-search" data-jumpto=".journey-form #plan-a-journey tabbable:first,#main-hero :tabbable:first"><span class="search-icon hide-text">Search</span><span class="collapse"></span><span class="expand"></span></a></div>'), $(".top-row-extras").prepend("<div class='more'><a href='javascript:void(0)' data-jumpto='.extra-nav a:first:visible'><span class='text'>Menu</span><span class='arrow'>&nbsp;</span></a></li></div>"), $(".moving-source-order").appendAround(), a.responsive.initLazyLoadedImages()
    }, setupBreakpoints: function () {
        $(window).setBreakpoints({distinct: !1, breakpoints: a.settings.devices})
    }, initLazyLoadedImages: function () {
        $("[data-img]").each(function () {
            var a = $(this), b = function () {
                $(a).children("img").remove();
                var b = $("<img>").attr({src: a.attr("data-img"), alt: a.attr("data-img-alt")}).load(function () {
                    a.data("img-background") ? a.css("background-image", "url(" + a.attr("data-img") + ")") : (a.prepend(b), b.attr({width: b.width(), height: b.height()}))
                });
                b[0].width && b.load()
            };
            "medium" === $(this).attr("data-img-breakpoint") ? ($(window).one("enterBreakpointMedium", b), $("body.breakpoint-Medium").length > 0 && $(window).trigger("enterBreakpointMedium")) : ($(window).one("enterBreakpointLarge", b), $("body.breakpoint-Large").length > 0 && $(window).trigger("enterBreakpointLarge"))
        })
    }}, $.fn.tflPopup = function (b) {
        var c = $(this), d = $.extend({title: "This is the default title", content: "", showingPercentage: 100, displayNoThanksLink: !0, displayNotAgainLink: !0, noThanksLinkText: "No thanks", notAgainLinkText: "No thanks, and don't ask me again", links: [], campaignId: "DefaultPopup"}, b);
        if (0 !== d.showingPercentage && !a.storage.get("Popups." + d.campaignId) && !a.storage.getSessionStorage("Popups." + d.campaignId)) {
            if (d.showingPercentage < 100) {
                var e = Math.floor(100 * Math.random());
                if (e > d.showingPercentage)return
            }
            var f = $("<div></div>").addClass("popup"), g = $("<div></div>").addClass("popup-title").text(d.title), h = $('<span class="popup-title-icon white-up-arrow"></span>'), i = $("<div></div>").addClass("popup-content");
            d.content.length > 0 && i.append($("<p></p>").text(d.content));
            for (var j = 0; j < d.links.length; j++) {
                var k = d.links[j], l = $("<a></a>").attr({href: k.url, title: k.title}).addClass("plain-button").text(k.title);
                i.append(l)
            }
            var m = function (b) {
                b.stopPropagation(), b.preventDefault(), f.css({bottom: -1 * t + "px"}), a.storage.setSessionStorage("Popups." + d.campaignId, !0), window.setTimeout(function () {
                    f.addClass("hidden")
                }, 1e3)
            }, n = function (b) {
                a.storage.set("Popups." + d.campaignId, !0), b.preventDefault()
            };
            if (d.displayNoThanksLink) {
                var o = $("<a></a>").attr({href: "#", title: d.noThanksLinkText}).addClass("plain-button").text(d.noThanksLinkText);
                i.append(o), o.click(m)
            }
            if (d.displayNotAgainLink && a.storage.isLocalStorageSupported()) {
                var p = $("<a></a>").attr({href: "#", title: d.notAgainLinkText}).addClass("plain-button").text(d.notAgainLinkText);
                i.append(p), p.click(m).click(n)
            }
            f.append(g.append(h)).append(i), f.css({bottom: "-1000px"}), c.append(f);
            var q = i.outerHeight(!0), r = {bottom: -1 * q + "px"}, s = {bottom: 0};
            f.click(function () {
                var a = $(this);
                "0px" === a.css("bottom") ? (a.css(r), h.attr("class", "popup-title-icon white-up-arrow")) : (a.css(s), h.attr("class", "popup-title-icon white-down-arrow"))
            });
            var t = f.outerHeight(!0);
            f.css(-1 * t + "px"), window.setTimeout(function () {
                f.css(r)
            }, 2e3)
        }
    }, $.fn.tflBanner = function (b) {
        var c = $(this), d = $.extend({title: "This is the default title", showingPercentage: 100, links: [], campaignId: "DefaultBanner"}, b);
        if (0 !== d.showingPercentage && !a.storage.get("Banners." + d.campaignId) && !a.storage.getSessionStorage("Banners." + d.campaignId)) {
            if (d.showingPercentage < 100) {
                var e = Math.floor(100 * Math.random());
                if (e > d.showingPercentage)return
            }
            var f = function (b) {
                b.stopPropagation(), b.preventDefault(), h.css({bottom: -1 * n + "px"}), a.storage.setSessionStorage("Banners." + d.campaignId, !0), window.setTimeout(function () {
                    h.addClass("hidden")
                }, 1e3)
            }, g = function (b) {
                a.storage.set("Banners." + d.campaignId, !0), b.preventDefault()
            }, h = $("<div></div>").addClass("popup-banner"), i = $("<span></span>").addClass("popup-title").text(d.title), j = $('<a href="#" class="popup-title-icon close-icon-white hide-text"><span>Close this banner</span></a>');
            j.click(f).click(g);
            for (var k = 0; k < d.links.length; k++) {
                var l = d.links[k], m = $("<a></a>").attr({href: l.url, title: l.title, "class": "popup-link"}).text(l.title);
                i.append(m)
            }
            h.append(i).append(j), c.append(h);
            var n = h.outerHeight(!0)
        }
    }, a.init()
}(tfl), function (a) {
    "use strict";
    var b = [];
    a.api = {BikePoint: a.apiUrl + "BikePoint", BikePointId: a.apiUrl + "BikePoint/{0}", LineStatus: a.apiUrl + "Line/Mode/{0}/Status?detail=true", LinePlannedWorks: a.apiUrl + "Line/Mode/{0}/Status/{1}/to/{2}?detail=true", LinesSearch: a.apiUrl + "Line/Search?query=%QUERY&modes={0}", PlacesExtraSearch: a.apiUrl + "Place/Extra/search?query=%QUERY", Routes: a.apiUrl + "Routes", StopPointsDisruptions: a.apiUrl + "StopPoint/{0}/Disruption", StopPointsSearch: a.apiUrl + "StopPoint/search?query=%QUERY&modes={0}&maxResults=25&faresOnly={1}", StopPointsDisruptionsTimePeriod: a.apiUrl + "StopPoint/{0}/Disruption/{1}/to/{2}", StopPointsDisruptionsByModeAndTimePeriod: a.apiUrl + "StopPoint/Mode/{0}/Disruption/{1}/to/{2}"}, a.autoRefresh = {BikePoint: 305e3, Predictions: 1e4, ServiceBoard: 65e3};
    var c = {app_id: a.appId, app_key: a.appKey};
    a.addAppIdAndKey = function (b) {
        return-1 !== b.indexOf("?") ? b + "&app_id=" + a.appId + "&app_key=" + a.appKey : b + "?app_id=" + a.appId + "&app_key=" + a.appKey
    }, a.ajax = function (d) {
        if ("object" != typeof d || !d.url || !d.success)return a.logs.create("invalid paramaters passed to tfl.ajax"), a.logs.create(d), "function" == typeof d.error && d.error(), !1;
        var e = {data: c, dataType: "json", success: null, error: function (b, c, d) {
            a.logs.create("tfl.ajax: Error with ajax call"), a.logs.create(c), a.logs.create(d), a.logs.create(b)
        }, autoRefreshInterval: null}, f = $.extend(!0, {}, e, d);
        null !== f.autoRefreshInterval && (f.complete = function () {
            b[f.autoRefreshId] = setTimeout(function () {
                a.ajax(d)
            }, parseInt(f.autoRefreshInterval))
        });
        var g = function () {
            a.logs.create("tfl.ajax: " + f.url), $.ajax(f)
        };
        a.utils.requestAnimFrame(g)
    }, a.stopAjaxAutoRefresh = function (a) {
        clearTimeout(b[a])
    }, a.logs.create("tfl.ajax: loaded")
}(window.tfl = window.tfl || {}), function (a) {
    a.settings = function () {
        $.validator.setDefaults({onfocusout: !1, onfocusin: !1, onkeyup: !1, onclick: !1})
    }, a.setSelectBoxSpan = function (a) {
        var b = $(a).children("option:selected").text();
        $(a).attr("title", b).siblings("span").text(b)
    }, a.updateSelectBox = function () {
        a.setSelectBoxSpan(this)
    }, a.setupSelectBoxes = function () {
        var b = $(".selector select");
        b.before("<span />"), b.each(function () {
            a.setSelectBoxSpan(this);
            var b = $(this), c = b.parent();
            b.on("focus blur", function () {
                c.toggleClass("focus")
            })
        }), b.change(a.updateSelectBox)
    }, a.setupSelectBox = function (b, c) {
        var d = $(b + " select"), e = $(b), f = e.parent();
        d.before("<span />"), d.attr("title", c).siblings("span").text(c), e.on("focus blur", function () {
            f.toggleClass("focus")
        }), d.change(a.updateSelectBox)
    }, a.modeSelectAll = function (a) {
        $(a).click(function () {
            var a = $(this).parent().siblings("ul");
            $(this).hasClass("select-all") ? (a.children("li").not(".ticked").each(function () {
                $(this).children("input").trigger("click")
            }), $(this).removeClass("select-all").text("Deselect all")) : a.children("li.ticked").each(function () {
                $(this).children("input").trigger("click")
            })
        })
    }, a.setupCheckBoxSelectall = function (b) {
        var c = $("<div class='select-deselect-option'><a href='javascript:void(0);'>Deselect All</a></div>"), d = c.children("a");
        $(b).parent().prepend(c);
        var e = $(b).find("input"), f = function () {
            for (var a = !0, b = 0; b < e.length; b++)if (!$(e[b]).is(":checked")) {
                a = !1;
                break
            }
            a ? (d.text("Deselect all"), d.removeClass("select-all")) : (d.text("Select all"), d.addClass("select-all"))
        };
        e.click(f), f(), a.modeSelectAll(d)
    }, a.setupCheckboxLists = function () {
        tfl.logs.create("tfl.forms: setup checkbox lists"), $(".to-checkbox-list").each(function () {
            {
                var b = $("<ul class='clearfix'></ul>"), c = 1;
                $(this).children("option").length
            }
            $(this).children().each(function () {
                var a = $("<li></li>");
                c % 2 === 1 && a.addClass("odd");
                var d = $(this).attr("value"), e = $(this).text(), f = $("<input type='checkbox' />").attr("id", d);
                void 0 !== $(this).attr("selected") && f.attr("checked", "checked"), a.append(f);
                var g = $("<label for='" + d + "' class='" + d + "'></label>");
                g.append(e), a.append(g), b.append(a), c++
            }), $(this).after(b), $(this).hasClass("select-all") && (b.addClass("select-all"), a.setupCheckBoxSelectall(b)), $(this).hide()
        })
    }, a.setupHorizontalToggles = function () {
        tfl.logs.create("tfl.forms: setup horizontal toggles"), $(".horizontal-toggle-buttons").each(function () {
            var a = $(this).find("input");
            a.filter(":checked").parent().addClass("selected"), a.focus(function () {
                $(this).parent().addClass("focus")
            }), a.blur(function () {
                $(this).parent().removeClass("focus")
            });
            var b = a.parent();
            a.change(function () {
                b.removeClass("selected"), $(this).parent().addClass("selected")
            })
        })
    }, a.setupCustomInputs = function () {
        $(".checkbox-list input[type='checkbox'], .radiobutton-list input[type='radio'], .styled-checkbox input[type='checkbox']").each(function () {
            "checked" === $(this).attr("checked") && $(this).parent().addClass("ticked"), $(this).focus(function () {
                $(this).parent().addClass("focus")
            }), $(this).blur(function () {
                $(this).parent().removeClass("focus")
            })
        })
    }, a.toggleCustomInput = function () {
        var a = $(this).parents(".radiobutton-list");
        a.length > 0 && $(this).parent().parent().children("li,.radiobutton-list-item").removeClass("ticked"), $(this).parent().toggleClass("ticked");
        var b = $(this).parent().parent().prev("select.to-checkbox-list");
        if (b.length > 0) {
            var c = $(this), d = function () {
                var a = "checked" === c.attr("checked");
                a ? b.find("option[value='" + c.attr("id") + "']").attr("selected", "selected") : b.find("option[value='" + c.attr("id") + "']").removeAttr("selected")
            };
            setTimeout(d, 10)
        }
    }, a.toggleMoreInfo = function (a) {
        a.preventDefault(), $(this).closest(".more-info-header").toggleClass("expanded")
    }, a.init = function () {
        a.settings(), a.setupSelectBoxes(), a.setupCheckboxLists(), a.setupHorizontalToggles(), a.setupCustomInputs(), $(".checkbox-list input[type='checkbox'], .radiobutton-list input[type='radio']").click(a.toggleCustomInput), $(".styled-checkbox input[type='checkbox']").click(a.toggleCustomInput), $(".more-info-header .show-more-info").click(a.toggleMoreInfo)
    }, a.init()
}(window.tfl.forms = window.tfl.forms || {}), function (a) {
    "use strict";
    tfl.logs.create("tfl.geolocation: loaded"), a.minAccuracy = 1e3, a.geocoder = null, a.geolocationTimeout = 1e4, a.isGeolocationSupported = function () {
        return"geolocation"in navigator && null !== navigator.geolocation ? (tfl.logs.create("tfl.geolocation: isGeolocationSupported true"), !0) : (tfl.logs.create("tfl.geolocation: isGeolocationSupported false"), !1)
    }, a.geolocateMe = function (b, c, d) {
        tfl.logs.create("tfl.geolocation: geolocate me"), a.clearGeolocationError();
        var e = $(b);
        e.typeahead("val", ""), e.originalPlaceholder = e.attr("placeholder"), e.attr("placeholder", "Finding address...");
        var f = function (f) {
            return f.coords && f.coords.accuracy && f.coords.accuracy > tfl.geolocation.minAccuracy ? (tfl.logs.create("tfl.geolocation.geolocate me: ERROR: inaccuracy too high: " + f.coords.accuracy + "m"), a.geolocationError("We cannot find your current location. Please try again", e), e.parent().siblings(tfl.removableContent.RemoveContentClass).hide(), void(d && d())) : ($(b + "Geolocation").val(f.coords.longitude + "," + f.coords.latitude), a.setupInputBoxForGeolocation(e), void(c && c.call(this, f.coords)))
        }, g = function (b) {
            e.parent().siblings(tfl.removableContent.RemoveContentClass).hide(), e.closest("[data-current-location]").removeAttr("data-current-location"), b.code ? 1 === b.code ? (tfl.logs.create("tfl.geolocation.geolocateMe: ERROR: permission denied"), a.geolocationError("Permission from browser needed before finding your location", e)) : 2 === b.code ? (tfl.logs.create("tfl.geolocation.geolocateMe: ERROR: position unavailable"), a.geolocationError("We cannot find your current location. Please try again", e)) : 3 === b.code && (tfl.logs.create("tfl.geolocation.geolocateMe: ERROR: timeout"), a.geolocationError("We cannot find your current location. Please try again", e)) : a.geolocationError("We cannot find your current location. Please try again", e), d && d.call(this, b)
        };
        try {
            navigator.geolocation.getCurrentPosition(f, g, {timeout: a.geolocationTimeout})
        } catch (h) {
            a.geolocationError("Your device does not support the location feature", e)
        }
    }, a.geolocationError = function (a, b) {
        $(".geolocation-error").text(a).removeClass("hidden"), b.attr("placeholder", b.originalPlaceholder), $("[data-current-location]").removeAttr("data-current-location"), b.focus()
    }, a.clearGeolocationError = function () {
        $(".geolocation-error").addClass("hidden")
    }, a.removeGeolocationFromInput = function (a) {
        var b = a.parent();
        b.attr("data-current-location") && (b.removeAttr("data-current-location"), b.removeClass("geocoded"), a.typeahead("val", ""), a.closest("remove-content-container").addClass("empty"), $(a.selector + "Geolocation").val(""))
    }, a.setupInputBoxForGeolocation = function (b) {
        var c = [9, 16, 17, 18, 19, 20, 33, 34, 35, 36, 37, 38, 39, 40, 45, 46, 91, 92, 93, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 144, 145], d = b.parent();
        d.attr("data-current-location", "true"), d.addClass("geocoded"), b.attr("placeholder", b.originalPlaceholder), b.typeahead("val", tfl.dictionary.CurrentLocationText).typeahead("close"), b.on("keydown", function (b) {
            c.indexOf(b.keyCode) > -1 || a.removeGeolocationFromInput($(this))
        })
    }
}(window.tfl.geolocation = window.tfl.geolocation || {}), window.tfl.autocomplete = window.tfl.autocomplete || {}, function (a) {
    "use strict";
    function b(a, b) {
        return a.a.length < b.a.length ? -1 : a.a.length > b.a.length ? 1 : 0
    }

    tfl.logs.create("tfl.autocomplete.sources: loaded"), a.autocompleteDisplayNumberLimit = 10, a.stationsStopsSelectionCallback = function (a, b) {
        var c = $(a), d = b.a || b.placeId;
        c.attr("data-" + c.attr("id").toLowerCase() + "-id", d);
        var e = JSON.stringify(b.c ? b.c : b.placeModes);
        c.attr("data-" + c.attr("id").toLowerCase() + "-modes", e)
    }, a.stationsStopsRemoveContent = function (a) {
        var b = $(a);
        b.removeAttr("data-" + b.attr("id").toLowerCase() + "-id"), b.removeAttr("data-" + b.attr("id").toLowerCase() + "-modes")
    }, a.getGeolocation = function (b) {
        var c = function (c) {
            $(c).removeAttr("data-dataset-name"), a.stationsStopsRemoveContent(c), tfl.geolocation.geolocateMe(c, b)
        }, d = Hogan.compile("<a class='geolocation-link' href='javascript:void(0)'><span class='geolocation-icon'>&nbsp</span>{{value}}</a>");
        return{typeaheadSource: {callback: c, displayKey: "value", name: "geolocation", templates: {suggestion: d.render.bind(d), footer: "<span class='source-footer'>&nbsp</span>"}}, dataEngine: new Bloodhound({datumTokenizer: function () {
            return[""]
        }, queryTokenizer: function () {
            return[""]
        }, limit: 1, minLength: 0, local: [
            {value: "Use my location"}
        ]})}
    }, a.getRecentSearches = function (a, b, c, d, e, f) {
        (null === f || void 0 === f) && (f = 5);
        var g = Hogan.compile(d);
        return{typeaheadSource: {callback: c, displayKey: e, name: a, templates: {suggestion: g.render.bind(g), footer: "<span class='source-footer'>&nbsp</span>", header: "<span class='source-header'>Recent searches</span>"}}, dataEngine: new Bloodhound({datumTokenizer: function () {
            return[""]
        }, queryTokenizer: function () {
            return[""]
        }, limit: f, minLength: 0, local: b})}
    }, a.getTurnOnOffRecentSearches = function (a, b) {
        var c = Hogan.compile("<span class='recent-searches-on-off-footer'><a href='javascript:void(0)'>{{linkText}}</a></span>");
        return b[0].dataset = a ? "recent-searches-footer-on" : "recent-searches-footer-off", {typeaheadSource: {displayKey: "linkText", name: a ? "recent-searches-footer-on" : "recent-searches-footer-off", templates: {suggestion: c.render.bind(c), footer: "<span class='source-footer'>&nbsp</span>"}}, dataEngine: new Bloodhound({datumTokenizer: function () {
            return[""]
        }, queryTokenizer: function () {
            return[""]
        }, limit: 1, minLength: 0, local: b})}
    }, a.getJourneyPlannerSuggestions = function () {
        var b = Hogan.compile("<div class='mode-icons'>{{#c}}<span class='mode-icon {{.}}-icon'>&nbsp;</span>{{/c}}</div><span class='stop-name'>{{b}}</span>");
        return{typeaheadSource: {displayKey: "b", name: "journey-planner-suggestions", templates: {suggestion: b.render.bind(b)}, callback: a.stationsStopsSelectionCallback, removeContent: a.stationsStopsRemoveContent}, dataEngine: new Bloodhound({datumTokenizer: function (a) {
            var b = tfl.autocomplete.tokenize(a, "b");
            return null !== b.tokens ? b.tokens : Bloodhound.tokenizers.whitespace(a.b)
        }, queryTokenizer: Bloodhound.tokenizers.whitespace, limit: a.autocompleteDisplayNumberLimit, minLength: 1, prefetch: {url: "/cdn/static/feed/stations-list_typeahead.json", ttl: 262974e4}})}
    }, a.routesSearchFactory = function (c, d, e) {
        var f = Hogan.compile("<span class='mode-icon {{c}}-icon'>&nbsp;<span class='{{f}}'>&nbsp;</span></span><span class='stop-name' data-id='{{b}}'>{{a}}{{#h.length}}<span class='towards-text'>towards {{h}}</span>{{/h.length}}</span>");
        return{typeaheadSource: {displayKey: "a", minLength: 1, name: "routes-search", templates: {suggestion: f.render.bind(f)}, callback: d}, dataEngine: new Bloodhound({datumTokenizer: function (a) {
            return Bloodhound.tokenizers.whitespace(a.a)
        }, queryTokenizer: Bloodhound.tokenizers.whitespace, limit: a.autocompleteDisplayNumberLimit, minLength: 1, remote: {url: tfl.addAppIdAndKey(tfl.api.LinesSearch.format(c)), cache: !0, replace: function (a, b) {
            var c = "";
            if (b === tfl.dictionary.CurrentLocationText)return c;
            if (null !== b && b.length > 0) {
                var d = new RegExp(e, "g");
                c = a.replace("%QUERY", decodeURIComponent(b).replace(d, ""))
            }
            return c
        }, filter: function (a) {
            var c = [], d = a.searchMatches;
            if (null !== d)for (var e = 0; e < d.length; e++) {
                var f = d[e];
                if (f.cssClass = f.mode === tfl.modeNameTube ? -1 !== f.lineName.indexOf(" ") ? f.lineName.substring(0, f.lineName.indexOf(" ")).toLowerCase() : f.lineName.toLowerCase() : "", f.mode === tfl.modeNameBus)for (var g = 0; g < f.lineRouteSection.length; g++) {
                    for (var h = !0, i = f.lineRouteSection[g], j = 0; j < c.length; j++) {
                        var k = c[j];
                        if (k.b === f.lineId && k.g === i.direction) {
                            h = !1;
                            break
                        }
                    }
                    f.lineName.toLowerCase() !== a.input.toLowerCase() && (h = !1), h && c.push({a: f.lineName, b: f.lineId, c: f.mode, f: f.cssClass, g: i.direction, h: [i.destination]})
                } else c.push({a: f.lineName + (f.mode === tfl.modeNameTube ? " line" : ""), b: f.lineId, c: f.mode, f: f.cssClass});
                c.sort(b)
            }
            return c
        }}})}
    }, a.stopPointsSearchFactory = function (b, c, d, e, f, g) {
        e = e !== !0 ? !1 : !0, (!d || "string" == typeof d && "false" === d.toLowerCase()) && (d = !1), (!g || "string" == typeof g && "false" === g.toLowerCase()) && (g = !1), (!e || "string" == typeof e && "false" === e.toLowerCase()) && (e = !1), f || (f = "stop-points-search");
        var h = Hogan.compile("<div class='mode-icons'>{{#c}}<span class='mode-icon {{.}}-icon'>&nbsp;</span>{{/c}}</div><span class='stop-name' data-id='{{b}}'>{{a}}</span>{{#h.length}}<div class='towards-text'>towards {{h}}</div>{{/h.length}}");
        return{typeaheadSource: {displayKey: "a", minLength: 1, name: f, templates: {suggestion: h.render.bind(h)}, callback: c}, dataEngine: new Bloodhound({datumTokenizer: function (a) {
            return Bloodhound.tokenizers.whitespace(a.value)
        }, queryTokenizer: Bloodhound.tokenizers.whitespace, limit: a.autocompleteDisplayNumberLimit, minLength: 1, remote: {url: tfl.addAppIdAndKey(tfl.api.StopPointsSearch.format(b, e)), cache: !0, replace: function (a, b) {
            var c = "";
            if (b === tfl.dictionary.CurrentLocationText)return c;
            if (null !== b && b.length > 0) {
                var d = new RegExp("[^a-zA-Z0-9 &-/().']", "g");
                return a.replace("%QUERY", decodeURIComponent(b).replace(d, ""))
            }
            return c
        }, filter: function (a) {
            function b(a, b) {
                var c = b.c.length - a.c.length;
                return 0 === c ? a.a > b.a ? 1 : -1 : c
            }

            function c(a, b) {
                for (var c = 0; c < b.length; c++)if (b[c].id === a.parentId)return!1;
                return!0
            }

            function e(a) {
                return"TransportInterchange" === a.stopType ? !1 : !0
            }

            var f = a.matches, h = [];
            if (null !== f) {
                for (var i = 0; i < f.length; i++) {
                    var j = f[i];
                    d ? e(j) && h.push({a: j.name, b: j.id, c: j.modes, d: j.lat, e: j.lon, h: j.towards ? [j.towards] : ""}) : g ? j.stopType === tfl.naptanPublicBusCoachTram && h.push({a: j.name, b: j.id, c: j.modes, d: j.lat, e: j.lon, h: j.towards ? [j.towards] : ""}) : c(j, f) && h.push({a: j.name, b: j.id, c: j.modes, d: j.lat, e: j.lon, h: j.towards ? [j.towards] : ""})
                }
                h.sort(b)
            }
            return h
        }}})}
    }, a.placesExtraSearchFactory = function (b) {
        var c = Hogan.compile("<div class='mode-icons'>{{#c}}<span class='mode-icon {{.}}-icon'>&nbsp;</span>{{/c}}</div><span class='stop-name' data-id='{{b}}'>{{a}}</span>{{#h.length}}<div class='towards-text'>towards {{h}}</div>{{/h.length}}");
        return{typeaheadSource: {displayKey: "a", minLength: 1, name: "places-extra-search", templates: {suggestion: c.render.bind(c)}, callback: b}, dataEngine: new Bloodhound({datumTokenizer: function (a) {
            return Bloodhound.tokenizers.whitespace(a.value)
        }, queryTokenizer: Bloodhound.tokenizers.whitespace, limit: a.autocompleteDisplayNumberLimit, minLength: 1, remote: {url: tfl.addAppIdAndKey(tfl.api.PlacesExtraSearch), cache: !0, replace: function (a, b) {
            var c = "";
            if (b === tfl.dictionary.CurrentLocationText)return c;
            if (null !== b && b.length > 0) {
                var d = new RegExp("[^a-zA-Z0-9 &-/().']", "g");
                return a.replace("%QUERY", decodeURIComponent(b).replace(d, ""))
            }
            return c
        }, filter: function (a) {
            var b = a.matches, c = [];
            if (null !== b)for (var d = 0; d < b.length; d++) {
                var e = b[d];
                c.push({a: e.name, b: e.id, d: e.lat, e: e.lon, f: e.types})
            }
            return c
        }}})}
    }
}(window.tfl.autocomplete.sources = window.tfl.autocomplete.sources || {}), function (a) {
    "use strict";
    tfl.logs.create("tfl.autocomplete: loaded"), a.ClearSearchBox = "clear-search-box";
    var b = {highlight: !0, hint: !1, minLength: 0};
    a.setup = function (c, d, e, f) {
        if (!$("html").hasClass("lt-ie8")) {
            tfl.logs.create("tfl.autocomplete.setup: started");
            var g = $(c);
            null === e && (e = b);
            var h = [];
            $(d).each(function () {
                if ("function" != typeof this) {
                    var a = this.typeaheadSource, b = this.dataEngine;
                    if (b.remote && b.remote.filter && b.remote.replace) {
                        var c = b.remote.replace, d = function (a, b) {
                            return g.parent(".twitter-typeahead").addClass("downloading"), c(a, b)
                        };
                        b.remote.replace = d;
                        var e = b.remote.filter, f = function (a) {
                            var b = e(a);
                            return g.parent(".twitter-typeahead").removeClass("downloading"), b
                        };
                        b.remote.filter = f
                    }
                    b.initialize(), a.source = b.ttAdapter(), h.push(a)
                }
            }), g.typeahead(e, h).on("keydown.autocomplete", function (a) {
                var b = g.attr("data-dataset-name");
                if (b)for (var d = 0; d < h.length; d++) {
                    var e = h[d];
                    if (b === e.name) {
                        e.keydown && e.keydown(a, c);
                        break
                    }
                }
            }).on("typeahead:selected typeahead:autocompleted", function (a, b, d) {
                if (g.trigger("focus"), d) {
                    for (var e = 0; e < h.length; e++) {
                        var f = h[e];
                        if (d === f.name) {
                            f.callback && f.callback(c, b, d), f.contextCallback && f.contextCallback(c, b, d);
                            break
                        }
                    }
                    g.attr("data-dataset-name", d)
                }
            }).parent().siblings(tfl.dictionary.RemoveContentClass).bind(a.ClearSearchBox, function () {
                $(this).click()
            }), f && g.parent().siblings(tfl.dictionary.RemoveContentClass).click(function () {
                var a = g.attr("data-dataset-name");
                if (a) {
                    for (var b = 0; b < h.length; b++) {
                        var c = h[b];
                        if (a === c.name) {
                            c.removeContent && c.removeContent(g);
                            break
                        }
                    }
                    g.removeAttr("data-dataset-name")
                }
                g.typeahead("val", "")
            })
        }
    }, a.tokenize = function (a, b) {
        for (var c = ["'", "(", "&", "-", ")"], d = null !== b ? a[b].trim().split(" ") : a.trim().split(" "), e = null !== b ? a[b].trim().split(" ") : a.trim().split(" "), f = !1, g = 0; g < d.length; g++) {
            var h = d[g];
            switch (h.toLowerCase()) {
                case"st":
                    e.push("st."), f = !0;
                    break;
                case"st.":
                    e.push("st"), f = !0;
                    break;
                case"&":
                    e.push("and"), f = !0;
                    break;
                case"and":
                    e.push("&"), f = !0
            }
            for (var i = 0; i < c.length; i++) {
                var j = c[i];
                -1 !== h.indexOf(j) && (e.push.apply(e, h.trim().split(j)), f = !0)
            }
        }
        if (f && e.length > 0) {
            for (var k = [], l = 0; l < e.length; l++) {
                var m = !0, n = e[l];
                e.length >= l + 1 && "s" === e[l + 1] && (n += "s");
                for (var o = 0; o < k.length; o++)if (n === k[o]) {
                    m = !1;
                    break
                }
                "s" !== n && "" !== n && m && k.push(n)
            }
            k.length > 0 && (a.tokens = k)
        }
        return a
    }
}(window.tfl.autocomplete = window.tfl.autocomplete || {}), window.tfl.autocomplete = window.tfl.autocomplete || {}, function (a) {
    "use strict";
    tfl.logs.create("tfl.autocomplete.recentMagicSearches: loaded"), a.searches = {}, a.usingRecentSearches = tfl.storage.get("usingRecentMagicSearches", !0), a.isLoaded = !1, a.recentSearchNumberLimit = 5, a.recentSearchTimeLimit = 262974e4, a.useRecentSearches = function (b) {
        return a.usingRecentSearches = b, tfl.storage.set("usingRecentMagicSearches", a.usingRecentSearches), a.searches = {}, tfl.storage.set("recentMagicSearches", a.searches), !1
    }, a.loadSearches = function () {
        if (tfl.logs.create("tfl.autocomplete.recentMagicSearches.loadSearches: initialised"), !a.isLoaded) {
            if (a.usingRecentSearches) {
                a.searches = tfl.storage.get("recentMagicSearches", {});
                var b, c = (new Date).getTime();
                for (var d in a.searches)if (a.searches.hasOwnProperty(d))for (var e in a.searches[d])if (a.searches[d].hasOwnProperty(e))for (var f = 0; f < a.searches[d][e].length; f++)if (void 0 !== a.searches[d][e][f]) {
                    var g = a.searches[d][e][f];
                    (!g.hasOwnProperty("lastSearchDate") || g.lastSearchDate < c - a.recentSearchTimeLimit) && (tfl.logs.create("tfl.autocomplete.recentMagicSearches: removing old searches"), a.searches[d][e].splice(f, 1), b = !0)
                }
                b && tfl.storage.set("recentMagicSearches", a.searches)
            }
            a.isLoaded = !0
        }
    }, a.saveSearch = function (b, c, d, e, f, g, h, i, j, k) {
        if (tfl.logs.create("tfl.autocomplete.recentMagicSearches.saveSearch: initialised"), a.loadSearches(), "" === b)return!0;
        null === c && (c = ""), null === h && (h = ""), null === i && (i = ""), null === j && (j = ""), (null === k || "false" === k) && (k = !1), "string" == typeof d && "" !== d && (d = jQuery.parseJSON(d)), null === d && (d = []);
        var l = (new Date).getTime();
        if ("lines" === e) {
            var m = d[0].toString();
            if (a.searches[e])if (a.searches[e][m])for (var n = 0; n < a.searches[e][m].length; n++) {
                var o = a.searches[e][m][n];
                if (o.id.toLowerCase() === c.toLowerCase()) {
                    a.searches[e][m].splice(n, 1);
                    break
                }
            } else a.searches[e][m] = []; else a.searches[e] = {}, a.searches[e][m] = [];
            var p = {lastSearchDate: l, name: b, id: c, mode: m, cssClass: h, direction: i, destination: j, type: e};
            a.searches[e][m].splice(0, 0, p), a.searches[e][m].length > a.recentSearchNumberLimit && (a.searches[e][m].length = a.recentSearchNumberLimit)
        } else if ("stops" === e) {
            if (a.searches[e])for (var q = 0; q < a.searches[e].length; q++) {
                var r = a.searches[e][q];
                if (r.id.toLowerCase() === c.toLowerCase()) {
                    a.searches[e].splice(q, 1);
                    break
                }
            } else a.searches[e] = [];
            var s = {lastSearchDate: l, name: b, id: c, modes: d, lat: f, lon: g, type: e, destination: j, lowestLevel: k};
            a.searches[e].splice(0, 0, s), a.searches[e].length > a.recentSearchNumberLimit && (a.searches[e].length = a.recentSearchNumberLimit)
        }
        return tfl.storage.set("recentMagicSearches", a.searches), !0
    }, a.geolocateMe = function (a, b) {
        var c = function (a) {
            $(".geolocation-error").text(a).removeClass("hidden")
        };
        tfl.logs.create("tfl.autocomplete.recentMagicSearches.geolocateMe: initialised");
        var d = $(a);
        d.typeahead("val", ""), d.attr("placeholder", "Finding address...");
        var e = function (e) {
            return e.coords && e.coords.accuracy && e.coords.accuracy > 1e6 ? (tfl.logs.create("tfl.journeyPlanner.searchForm.geolocate me: ERROR: inaccuracy too high: " + e.coords.accuracy + "m"), void c("We cannot find your current location. Please try again")) : (d.val(e.coords.longitude + "," + e.coords.latitude), $(a).append("<input type='hidden' id='lat' name='lat' value='" + e.coords.latitude + "' />"), $(a).append("<input type='hidden' id='lon' name='lon' value='" + e.coords.longitude + "' />"), void(b && b()))
        }, f = function (a) {
            a.code ? 1 === a.code ? (tfl.logs.create("tfl.journeyPlanner.searchForm.geolocateMe: ERROR: permission denied"), c("Permission from browser needed before finding your location")) : 2 === a.code ? (tfl.logs.create("tfl.journeyPlanner.searchForm.geolocateMe: ERROR: position unavailable"), c("We cannot find your current location. Please try again")) : 3 === a.code && (tfl.logs.create("tfl.journeyPlanner.searchForm.geolocateMe: ERROR: timeout"), c("We cannot find your current location. Please try again")) : c("We cannot find your current location. Please try again")
        };
        try {
            navigator.geolocation.getCurrentPosition(e, f)
        } catch (g) {
            c("Your device does not support the location feature")
        }
    }
}(window.tfl.autocomplete.recentMagicSearches = window.tfl.autocomplete.recentMagicSearches || {}), function (a) {
    var b = "data-highlight-image", c = "data-highlight-file";
    a.init = function () {
        var a = "no-background-image", d = $("[" + b + "]");
        d.push($("[" + c + "]"));
        var e = [];
        $(window).one("enterBreakpointMedium", function () {
            $.each(d, function (a, d) {
                function f(a) {
                    var b = $.grep(a, function (a) {
                        return a.active
                    }), c = b[Math.floor(Math.random() * b.length)];
                    h.attr("style", "background-image: url(" + c.backgroundImage + ")");
                    var d = h.find(".advert-link-box").attr("href", c.link).show();
                    d.find("h2").text(c.headline), d.find("p").text(c.text), d.find("img").attr("src", c.imageURL)
                }

                var g = $(d), h = $(g.attr("data-highlight-for"));
                e.push(h), g.attr(b) ? h.attr("style", "background-image: url(" + g.attr(b) + ")") : g.attr(c) && tfl.ajax({url: g.attr(c), success: f});
                var i = g.clone();
                i.find("img").each(function () {
                    $(this).remove()
                }), h.find(".content-area").append(i), g.addClass(g.attr("data-highlight-size"));
                var j = g.find(".caption");
                if (j && j.parent().hasClass("small")) {
                    var k = h.find(".content-area.medium-large");
                    k.addClass("no-caption");
                    var l = Math.max(415, h.find(".hero-row").height());
                    k.find(".advert-tile").css({height: l + "px"})
                }
            })
        }), $(window).bind("exitBreakpointMedium", function () {
            $.each(e, function (b, c) {
                $(c).addClass(a)
            })
        }), $(window).bind("enterBreakpointMedium", function () {
            $.each(e, function (b, c) {
                $(c).removeClass(a)
            })
        }), $("body.breakpoint-Medium").length > 0 && $(window).trigger("enterBreakpointMedium"), $("body.breakpoint-Large").length > 0 && $(window).trigger("enterBreakpointLarge")
    }, a.init()
}(window.tfl.heroTakeover = window.tfl.heroTakeover || {}), function (a) {
    "use strict";
    function b(a) {
        return a.replace(/-([a-z])/g, function (a) {
            return void 0 !== a[1] ? a[1].toUpperCase() : a[1]
        })
    }

    function c() {
        var c;
        for (a.values = {}, c = 0; c < tfl.objects.modes.length; c += 1)a.values[b(tfl.objects.modes[c])] = []
    }

    function d() {
        var b = tfl.storage.get("recent");
        if (null !== b) {
            for (var c in b)b.hasOwnProperty(c) && (a.values.hasOwnProperty(c) || delete b[c]);
            a.values = $.extend(a.values, b)
        }
    }

    function e() {
        tfl.storage.isLocalStorageSupported() && (c(), d()), tfl.logs.create("tfl.recent: setup")
    }

    tfl.logs.create("tfl.recent: loaded");
    var f = 5;
    a.saveRecent = function () {
        tfl.storage.set("recent", a.values)
    }, Array.prototype.remove = function (a, b) {
        var c = this.slice((b || a) + 1 || this.length);
        return this.length = 0 > a ? this.length + a : a, this.push.apply(this, c)
    }, a.addRecent = function (c) {
        if ("object" == typeof c && c.hasOwnProperty("mode") && "" !== c.mode && c.hasOwnProperty("naptanId") && "" !== c.naptanId) {
            for (var d = !1, e = 0; e < a.values[b(c.mode)].length; e += 1)if (a.values[b(c.mode)][e].naptanId === c.naptanId) {
                d = !0, a.values[b(c.mode)].remove(e), a.values[b(c.mode)].unshift(c);
                break
            }
            return d || (a.values[b(c.mode)].unshift(c), a.values[b(c.mode)].length > f && a.values[b(c.mode)].remove(f)), a.saveRecent(), !0
        }
        return tfl.logs.create("Add recent expects object defined in tfl.objects"), !1
    }, a.getRecent = function (b) {
        if ("string" != typeof b)return tfl.logs.create("Error in tfl.favourites.getRecent - Expected naptanId"), !1;
        for (var c in a.values)if (a.values.hasOwnProperty(c))for (var d = 0; d < a.values[c].length; d += 1)if (a.values[c][d].naptanId === b)return a.values[c][d];
        return!1
    }, a.getRecentArray = function (b) {
        var c = [];
        if (a.values.hasOwnProperty(b))c = a.values[b]; else for (b in a.values)a.values.hasOwnProperty(b) && (c = c.concat(tfl.recent.values[b]));
        return c
    }, a.removeRecent = function (b) {
        if ("string" != typeof b && "number" != typeof b)return tfl.logs.create("Error in tfl.recent.removeRecent - Expected naptanId"), !1;
        for (var c in a.values)if (a.values.hasOwnProperty(c))for (var d = 0; d < a.values[c].length; d += 1)a.values[c][d].naptanId === b && delete a.values[c][d];
        return a.saveRecent(), !0
    }, a.clearRecent = function () {
        c(), a.saveRecent()
    }, e()
}(window.tfl.recent = window.tfl.recent || {}), function (a) {
    "use strict";
    function b(a) {
        return a.replace(/-([a-z])/g, function (a) {
            return void 0 !== a[1] ? a[1].toUpperCase() : a[1]
        })
    }

    function c() {
        var c;
        for (a.values = {}, c = 0; c < tfl.objects.modes.length; c += 1)a.values[b(tfl.objects.modes[c])] = {}
    }

    function d() {
        var b = tfl.storage.get("favourites");
        if (null !== b) {
            for (var c in b)b.hasOwnProperty(c) && (a.values.hasOwnProperty(c) || delete b[c]);
            a.values = $.extend(a.values, b)
        }
    }

    function e(a, b) {
        var c = b ? "active" : "";
        return a.append('<a href="javascript:void(0)" class="plain-link with-icon favourite ' + c + '"><span class="i favourite-icon"></span><span class="inactive">Add Favourite</span><span class="active">Favourited <span class="visually-hidden">Click to remove from favourites</span></span></a>'), a.find(">.favourite")
    }

    function f(b, c) {
        function d() {
            var d = e.render({items: f, name: "favourite", hidden: "", itemsHeading: "favourited bus stops", noItemsMessage: "You currently don't have an favourite bus stops saved, save some bus stops as your favourites and they shall appear here in future!"}), h = e.render({items: g, name: "recent", hidden: "hidden", itemsHeading: "recently searched bus stops", noItemsMessage: "No bus stops in your recent search history."}), i = $('<div class="tab-wrapper"><ul class="tabs-style-2"><li class="selected" data-target="favourite"><a href="#">Favourites</a></li><li data-target="recent"><a href="#">Recent</a></li></ul></div>');
            i.append(d), i.append(h), b.append(i), a.setupButtons(), f.length > 5 && tfl.navigation.pagination.setup(b.find(".favourite .bus-stops").parent(), ".bus-stops", 5, f.length), g.length > 5 && tfl.navigation.pagination.setup(b.find(".recent .bus-stops").parent(), ".bus-stops", 5, g.length), i = b.find(".tabs-style-2 > li:not(.not-for-beta)"), i.on("click", function (a) {
                a.preventDefault(), a.stopPropagation();
                var b = $(this);
                if (!b.hasClass("selected")) {
                    var c = b.parent().siblings();
                    c.addClass("hidden"), c.filter("." + b.data("target")).removeClass("hidden"), b.addClass("selected").siblings(".selected").removeClass("selected")
                }
            }), $(c).find(".links-only").length || tfl.expandableBox.init()
        }

        var e = Hogan.compile(c), f = a.getFavouritesArray(tfl.modeNameBus), g = tfl.recent.getRecentArray(tfl.modeNameBus), h = f.concat(g);
        if (h.length) {
            for (var i = h.length, j = {}, k = [], l = 0; i > l; l += 1)k.indexOf(h[l].naptanId) < 0 && k.push(h[l].naptanId);
            var m = tfl.tools.getQueryStringParameter("startDate");
            j.url = null !== m ? tfl.api.StopPointsDisruptionsTimePeriod.format(k.join(","), m, tfl.tools.getQueryStringParameter("endDate")) : tfl.api.StopPointsDisruptions.format(k.join(",")), j.success = function (a) {
                for (var b = 0; b < a.length; b += 1) {
                    var c, e = a[b];
                    a:for (c = 0; c < f.length; c += 1)if (f[c].naptanId === e.stationAtcoCode) {
                        f[c].props.disrupted = "disrupted", f[c].props.hasOwnProperty("disruptionInfo") || (f[c].props.disruptionInfo = ""), f[c].props.disruptionInfo += "<p>" + a[b].description + "</p>";
                        break a
                    }
                    a:for (c = 0; c < g.length; c++)if (g[c].naptanId === e.stationAtcoCode) {
                        g[c].props.disrupted = "disrupted", g[c].props.hasOwnProperty("disruptionInfo") || (g[c].props.disruptionInfo = ""), g[c].props.disruptionInfo += "<p>" + a[b].description + "</p>";
                        break a
                    }
                }
                d()
            }, tfl.ajax(j)
        }
    }

    function g() {
        tfl.storage.isLocalStorageSupported() && (c(), d(), a.setupButtons(), a.setupFavouritesAndRecent({selector: ".favourite-and-recent", markup: "bus-stop-disruption"})), tfl.logs.create("tfl.favourites: setup")
    }

    tfl.logs.create("tfl.favourites: loaded");
    var h = {};
    a.saveFavourites = function () {
        tfl.storage.set("favourites", a.values)
    }, a.addFavourite = function (c) {
        if ("object" == typeof c && c.hasOwnProperty("mode") && "" !== c.mode && c.hasOwnProperty("naptanId") && "" !== c.naptanId) {
            if (a.values[b(c.mode)][c.naptanId] = c, a.saveFavourites(), h.hasOwnProperty(c.naptanId))for (var d = 0; d < h[c.naptanId].dom.length; d += 1)h[c.naptanId].dom[d].addClass("active");
            return!0
        }
        return tfl.logs.create("Add Favourite expects object defined in tfl.objects"), !1
    }, a.getFavourite = function (b) {
        if ("string" != typeof b)return tfl.logs.create("Error in tfl.favourites.getFavourite - Expected naptanId"), !1;
        for (var c in a.values)if (a.values.hasOwnProperty(c) && void 0 !== a.values[c][b])return a.values[c][b];
        return!1
    }, a.getFavouritesArray = function (b) {
        var c, d = [];
        if (a.values.hasOwnProperty(b))for (c in a.values[b])a.values[b].hasOwnProperty(c) && d.push(a.values[b][c]); else for (b in a.values)if (a.values.hasOwnProperty(b))for (c in a.values[b])tfl.favourites.values[b].hasOwnProperty(c) && d.push(tfl.favourites.values[b][c]);
        return d
    }, a.removeFavourite = function (b) {
        if ("string" != typeof b && "number" != typeof b)return tfl.logs.create("Error in tfl.favourites.removeFavourite - Expected naptanId"), !1;
        for (var c in a.values)a.values.hasOwnProperty(c) && delete a.values[c][b];
        if (a.saveFavourites(), h.hasOwnProperty(b))for (var d = 0; d < h[b].dom.length; d += 1)h[b].dom[d].removeClass("active");
        return!0
    }, a.clearFavourites = function () {
        c(), a.saveFavourites();
        for (var b in h)if (h.hasOwnProperty(b))for (var d = 0; d < h[b].dom.length; d += 1)h[b].dom[d].removeClass("active")
    }, a.setupButtons = function () {
        var c = $("[data-favourite]");
        c.each(function () {
            var c, d, f, g = $(this), i = g.data("favourite"), j = !1;
            if ("string" == typeof i) {
                var k = a.getFavourite(i);
                if (!k)return g.removeAttr("data-favourite"), tfl.logs.create("tfl.favourites: fail to set up button, string provided - doesnt match existing favourite"), !0;
                j = !0, c = k
            } else if ("object" != typeof i)return g.removeAttr("data-favourite"), tfl.logs.create("tfl.favourites: neither string nor object passed to setupButtons"), !0;
            if (!j) {
                if (!i.hasOwnProperty("naptanId") || !i.hasOwnProperty("mode"))return g.removeAttr("data-favourite"), tfl.logs.create("tfl.favourites: object passed to setup button has no mode or naptanId"), !0;
                if (c = new tfl.objects.SSPObject(i.naptanId, i.mode, i.props), c.hasOwnProperty("error"))return g.removeAttr("data-favourite"), tfl.logs.create("tfl.favourites: properties passed to setup button generate invalid SSPObject"), !0
            }
            d = e(g, a.values[b(c.mode)].hasOwnProperty(c.naptanId)), h.hasOwnProperty(c.naptanId) ? (h[c.naptanId].data = j ? $.extend(c, h[c.naptanId].data) : $.extend(h[c.naptanId].data, c), h[c.naptanId].dom.push(d)) : h[c.naptanId] = {data: c, dom: [d]}, d.on("click", function (b) {
                b.preventDefault(), $(this).hasClass("active") ? a.removeFavourite(c.naptanId) : a.addFavourite(h[c.naptanId].data)
            }), f = g.data("favourite-class"), void 0 !== f && d.addClass(f), g.parent().addClass("with-favourite"), g.removeAttr("data-favourite"), tfl.recent.addRecent(c)
        })
    }, a.setupFavouritesAndRecent = function (a) {
        var b = $(a.selector);
        b.length && tfl.ajax({url: "/static/" + tfl.settings.version + "/templates/" + a.markup + ".html", success: function (a) {
            f(b, a)
        }, dataType: "html"})
    }, g()
}(window.tfl.favourites = window.tfl.favourites || {}), function (a) {
    tfl.logs.create("tfl.navigation.pullContent: started");
    var b, c, d, e;
    a.dataAttr = "data-pull-content";
    var f = "data-pull-content-storage";
    a.pullContentHandler = function (g) {
        g.preventDefault(), e = $(this);
        var h, i = e.attr(f);
        if (i) {
            if (h = tfl.storage.get(i))return!1;
            tfl.storage.set(i, "true")
        }
        var j = e.attr(a.dataAttr).split(","), k = e.attr("href"), l = e.attr("data-light-box-type"), m = parseInt(e.attr("data-light-box-min-width"), 10);
        if (tfl.logs.create("tfl.navigation.pullContent: Clicked a pull link for " + k), !isNaN(m) && m > $(window).width())return window.open(k, "_blank"), !1;
        l = void 0 === l ? "alert" : l, b.attr("data-type", l);
        var n = function (a) {
            for (var b, e = $(a), f = !1, g = function (a, b) {
                f = !0;
                var d = $("<p></p>").append($(b)).html();
                c.append(d)
            }, h = 0; h < j.length; h++)$.each(e.find($.trim(j[h])), g);
            return f ? (d.focus(), b = c.find(":tabbable"), void $(b[b.length - 1]).addClass("light-box-last-tab-target").attr("data-jumpto", ".close-light-box")) : (document.location.href = k, !0)
        };
        if (k.length > 0)if ("image" === l) {
            var o = new Image;
            o.src = k, o.alt = e.text(), c.append(o), b.addClass("active"), d.focus()
        } else tfl.ajax({url: k, success: n, dataType: "text"}), b.addClass("active")
    }, a.initialised = !1, a.init = function () {
        var f = $("[" + a.dataAttr + "]"), g = function (g) {
            b = $(g), d = b.find(".close-light-box"), c = b.find(".content"), b.on("click.lightBox", function () {
                d.trigger("click.lightBox")
            }), b.find(".content-wrap").on("click.lightBox", function (a) {
                a.stopPropagation()
            }), d.on("click.lightBox", function () {
                c.empty(), b.removeClass("active"), e.focus()
            }), $(document.body).append(b), f.click(a.pullContentHandler), a.initialised = !0, tfl.logs.create("tfl.navigation.pullContent: initialised")
        };
        f.length && !a.initialised ? tfl.ajax({url: "/static/" + tfl.settings.version + "/templates/light-box.html", success: g, dataType: "text"}) : f.off("click").click(a.pullContentHandler)
    }, a.init()
}(window.tfl.navigation = window.tfl.navigation || {});
var tfl = tfl || {};
!function (a) {
    "use strict";
    a.logs.create("tfl.serviceStatus: loaded");
    var b = function (b) {
        var c = b.closest(".rainbow-list-wrapper, .rainbow-board.roads"), d = b.parent(".rainbow-list-item");
        if (d.hasClass("expandable")) {
            var e = d.data("line-id");
            if (d.hasClass("expanded")) {
                if (d.removeClass("expanded"), c.removeClass("fade-to-black"), a.hasOwnProperty("tubeMap") && a.tubeMap.resetToInitialView(), d.trigger("rainbow-list.collapsed"), void 0 !== e && null !== e) {
                    var f = window.scrollY;
                    window.location.hash = "", window.scrollTo(0, f)
                }
            } else {
                if ($(".rainbow-list-item.expanded", c).removeClass("expanded"), d.addClass("expanded"), c.addClass("fade-to-black"), a.hasOwnProperty("tubeMap")) {
                    var g = "" + d.data("severity-codes");
                    if ("undefined" !== g && ("0" === g || g.indexOf(",") >= 0 && g.split(",").indexOf("0") >= 0))return;
                    a.tubeMap.zoomToLineId(e)
                }
                d.trigger("rainbow-list.expanded"), void 0 !== e && null !== e && (window.location.hash = "line-" + e)
            }
        }
    };
    a.serviceStatus = {initServiceBoardPage: function () {
        a.logs.create("tfl.serviceStatus: initialised"), a.serviceStatus.serviceUpdatesBoard()
    }, pageSetup: function () {
        var c = $(".stations-tab");
        $(".lines-stations-tab li").click(function () {
            d($(this))
        }), $(".lines-stations-tab .lines-tab").click(function () {
            a.serviceStatus.appendHashToDatePickerAnchors("")
        }), $(".lines-stations-tab .stations-tab").click(function () {
            a.serviceStatus.appendHashToDatePickerAnchors("#stations-status")
        });
        var d = function (b) {
            if (a.logs.create("tfl.serviceStatus: click on tab"), !b.hasClass("selected")) {
                var d = $(".lines-status"), e = $(".stations-status"), f = $(".lines-tab");
                d.hasClass("visible") ? (d.removeClass("visible"), e.addClass("visible"), f.removeClass("selected"), c.addClass("selected")) : (e.removeClass("visible"), d.addClass("visible"), c.removeClass("selected"), f.addClass("selected"))
            }
        };
        if ("" !== window.location.hash) {
            var e = window.location.hash.substr(1);
            a.logs.create("tfl.serviceStatus: page hash is " + e);
            var f = e.substr(5);
            if ("stations-status" === e)$(".lines-stations-tab .stations-tab").click(); else {
                var g = $("[data-line-class=" + f.toLowerCase() + "]");
                if (g.length > 0)b(g); else {
                    var h = $("[data-station-class=" + f.toLowerCase() + "]");
                    h.length > 0 && (d(c), b(h))
                }
            }
        }
    }, serviceUpdatesBoard: function () {
        var a = $(".rainbow-list-wrapper, .rainbow-board.roads");
        $(".close-disruption-info").click(function () {
            $(this).closest(".info-dropdown").prev().removeClass("selected"), $(".rainbow-board").removeClass("fade-to-black")
        }), $(".rainbow-list-content .close-message", a).on("click", function (b) {
            b.preventDefault(), $(this).closest(".rainbow-list-item").removeClass("expanded"), a.removeClass("fade-to-black")
        }), $("[data-line-class], [data-station-class]").click(function (a) {
            b($(this)), a.preventDefault(), a.stopPropagation()
        })
    }, updateServiceBoard: function (c, d) {
        var e, f, g = window.location.hash, h = $(".lines-status .expanded");
        h.length && (e = h.find(".rainbow-list-link").data("line-class"));
        var i = $(".stations-status .expanded");
        i.length && (f = i.find(".rainbow-list-link").data("naptan-id")), $("#" + c).parent().html(d);
        var j = $(".datepicker-dropdown.dropdown-button");
        j.length && (a.serviceStatus.initServiceBoardPage(), j.html(a.tools.getTime(new Date))), void 0 !== g && null !== g && (g = g.substr(1)), "stations-status" === g && ($(".lines-stations-tab .stations-tab").removeClass("selected"), $(".lines-stations-tab .stations-tab").click()), void 0 !== e && null !== e && b($(".lines-status").find("[data-line-class='" + e + "']")), void 0 !== f && null !== f && b($(".stations-status").find("[data-naptan-id='" + f + "']"))
    }, ajaxServiceBoard: function (b, c) {
        a.ajax({url: b, success: function (b) {
            a.serviceStatus.updateServiceBoard(c, b)
        }, autoRefreshInterval: a.autoRefresh.ServiceBoard, autoRefreshId: c, dataType: "text"})
    }, initServiceBoardAutoRefresh: function (b, c) {
        var d = $("#" + c).parents(".expandable-box");
        if (d.length) {
            var e = d.find(".always-visible");
            e.on("expandable-box.expanded", function () {
                a.serviceStatus.ajaxServiceBoard(b, c)
            }), e.on("expandable-box.collapsed", function () {
                a.stopAjaxAutoRefresh(c)
            });
            var f = d.find(".content.expanded");
            f.length && a.serviceStatus.ajaxServiceBoard(b, c)
        } else window.setTimeout(function () {
            a.serviceStatus.ajaxServiceBoard(b, c)
        }, a.autoRefresh.ServiceBoard)
    }, appendHashToDatePickerAnchors: function (a) {
        ("" !== window.location.hash || null !== a) && $(".datepicker-dropdown a").each(function () {
            var b = $(this).attr("href");
            b = -1 !== b.indexOf("#") ? b.substr(0, b.indexOf("#")) : b, a = null !== a ? a : window.location.hash, $(this).attr("href", b + a)
        })
    }}, a.serviceStatus.pageSetup()
}(tfl), function (a) {
    tfl.logs.create("tfl.socialMedia: loaded"), a.init = function () {
        var a = $(".share-widget-wrapper");
        if (a.length > 0) {
            var b = $(".section-overview");
            b.length > 0 && !b.hasClass("full-width") && a.css({marginTop: 0, display: "block", cssFloat: "none"}), a.append('<a href="javascript:void(0)" class="share-widget clearfix"><div class="twitter-icon icon"></div><div class="facebook-icon icon"></div><div class="share-icon icon"></div><span class="share-text">Share <span class="visually-hidden">on social media</span></span><span class="down-arrow icon"></span></a>');
            var c = window.location.href, d = $("h1").text(), e = $('<ul class="share-list"></ul>');
            e.append('<li><a href="http://www.facebook.com/share.php?u=' + c + "&t=" + d + '" class="share-facebook clearfix" tabindex="0"><span class="facebook-icon icon"></span><span class="text">Facebook</span></a></li>'), e.append('<li><a href="http://twitter.com/home?status=' + d + " " + c + '" class="share-twitter clearfix" tabindex="0"><span class="twitter-icon icon"></span><span class="text">Twitter</span></a></li>'), a.append(e), e.find("a").focus(function () {
                e.addClass("visible-for-focus")
            }).blur(function () {
                e.removeClass("visible-for-focus")
            }), a.removeClass("hidden")
        }
    }, a.init()
}(window.tfl.socialMedia = window.tfl.socialMedia || {}), window.tfl.journeyPlanner = window.tfl.journeyPlanner || {}, function (a) {
    "use strict";
    tfl.logs.create("tfl.journeyPlanner.recentJourneys: loaded"), a.journeys = [], a.usingRecentJourneys = tfl.storage.get("usingRecentJourneys", !0), a.isLoaded = !1, a.recentJourneyNumberLimit = 5, a.loadJourneys = function () {
        a.isLoaded || (a.usingRecentJourneys && (a.journeys = tfl.storage.get("recentJourneys", [])), a.isLoaded = !0)
    }, a.useJourneys = function (b) {
        return tfl.journeyPlanner.recentJourneys.usingRecentJourneys = b, tfl.storage.set("usingRecentJourneys", a.usingRecentJourneys), a.journeys = [], tfl.storage.set("recentJourneys", a.journeys), tfl.journeyPlanner.recentSearches.searches = [], tfl.storage.set("recentSearches", tfl.journeyPlanner.recentSearches.searches), !1
    }, a.saveJourney = function (b, c, d, e, f, g) {
        if ($("#From").val() === tfl.dictionary.CurrentLocationText || $("#To").val() === tfl.dictionary.CurrentLocationText || $("#Via").val() === tfl.dictionary.CurrentLocationText)return!0;
        a.loadJourneys();
        var h = {from: $("#From").val().replace(/^\s+|\s+$/g, ""), fromId: b, fromModes: c ? jQuery.parseJSON(c) : "", to: $("#To").val().replace(/^\s+|\s+$/g, ""), toId: d, toModes: e ? jQuery.parseJSON(e) : "", via: $("#Via").val().replace(/^\s+|\s+$/g, ""), viaId: f, viaModes: g ? jQuery.parseJSON(g) : ""};
        if ("" === h.from || "" === h.to)return!0;
        for (var i = 0; i < tfl.journeyPlanner.recentJourneys.journeys.length; i++) {
            var j = tfl.journeyPlanner.recentJourneys.journeys[i];
            if (j.from.toLowerCase().replace(/ /g, "") === h.from.toLowerCase().replace(/ /g, "") && j.to.toLowerCase().replace(/ /g, "") === h.to.toLowerCase().replace(/ /g, "") && j.via.toLowerCase().replace(/ /g, "") === h.via.toLowerCase().replace(/ /g, "")) {
                "" === h.fromId && "" !== j.fromId && (h.fromId = j.fromId), "" === h.fromModes && "" !== j.fromModes && (h.fromModes = j.fromModes), "" === h.toId && "" !== j.toId && (h.toId = j.toId), "" === h.toModes && "" !== j.toModes && (h.toModes = j.toModes), "" === h.viaId && "" !== j.viaId && (h.viaId = j.viaId), "" === h.viaModes && "" !== j.viaModes && (h.viaModes = j.viaModes), tfl.journeyPlanner.recentJourneys.journeys.splice(i, 1);
                break
            }
        }
        return tfl.journeyPlanner.recentJourneys.journeys.splice(0, 0, h), tfl.journeyPlanner.recentJourneys.journeys.length > a.recentJourneyNumberLimit && (tfl.journeyPlanner.recentJourneys.journeys.length = a.recentJourneyNumberLimit), tfl.storage.set("recentJourneys", tfl.journeyPlanner.recentJourneys.journeys), !0
    }
}(window.tfl.journeyPlanner.recentJourneys = window.tfl.journeyPlanner.recentJourneys || {}), window.tfl.journeyPlanner = window.tfl.journeyPlanner || {}, function (a) {
    "use strict";
    tfl.logs.create("tfl.journeyPlanner.recentSearches: loaded"), a.searches = [], a.isLoaded = !1, a.recentSearchNumberLimit = 5, a.recentSearchTimeLimit = 262974e4, a.loadSearches = function () {
        if (!a.isLoaded) {
            if (tfl.journeyPlanner.recentJourneys.usingRecentJourneys && (a.searches = tfl.storage.get("recentSearches", []), a.searches.length > 0))for (var b = (new Date).getTime(), c = 0; c < a.searches.length; c++) {
                var d = a.searches[c];
                d.lastSearchDate < b - a.recentSearchTimeLimit && a.searches.splice(c, 1)
            }
            a.isLoaded = !0
        }
    }, a.saveSearch = function (b, c, d) {
        if ("" === b || b === tfl.dictionary.CurrentLocationText)return!0;
        b = b.replace(/^\s+|\s+$/g, ""), null === c && (c = ""), "string" == typeof d && "" !== d && (d = jQuery.parseJSON(d));
        for (var e = (new Date).getTime(), f = 0; f < tfl.journeyPlanner.recentSearches.searches.length; f++) {
            var g = tfl.journeyPlanner.recentSearches.searches[f];
            if (g.placeName.toLowerCase() === b.toLowerCase()) {
                "" === c && "" !== g.placeId && (c = g.placeId), "" === d && "" !== g.placeModes && (d = g.placeModes), tfl.journeyPlanner.recentSearches.searches.splice(f, 1);
                break
            }
        }
        var h = {placeName: b, placeId: c, placeModes: d, lastSearchDate: e};
        return tfl.journeyPlanner.recentSearches.searches.splice(0, 0, h), tfl.journeyPlanner.recentSearches.searches.length > a.recentSearchNumberLimit && (tfl.journeyPlanner.recentSearches.searches.length = a.recentSearchNumberLimit), tfl.storage.set("recentSearches", tfl.journeyPlanner.recentSearches.searches), !0
    }
}(window.tfl.journeyPlanner.recentSearches = window.tfl.journeyPlanner.recentSearches || {}), function (a) {
    "use strict";
    function b() {
        var a = new Date, b = String(a.getFullYear()) + String(a.getMonth()) + String(a.getDay()) + String(a.getHours());
        return b
    }

    tfl.logs.create("tfl.journeyPlanner: loaded"), tfl.cachingSettings = {daily: b()}, a.settings = {disambiguationItemsPerPage: 9}, a.init = function () {
        tfl.logs.create("tfl.journeyPlanner.init: started"), a.createJourneys()
    }, a.createJourneys = function () {
        if (!tfl.storage.isLocalStorageSupported())return void tfl.logs.create("tfl.journeyplanner: Not creating recent journeys box - localStorage not present.");
        tfl.logs.create("tfl.journeyplanner: Creating recent journeys box"), $("#recent-journeys").empty(), 0 === $("div[data-set=recent-journeys]").length && ($("#more-journey-options").after("<div class='small' data-set='recent-journeys' />"), $("#plan-a-journey").after("<div class='medium-large' data-set='recent-journeys'><div id='recent-journeys' class='moving-source-order' /></div>"));
        var b = $("#recent-journeys");
        if (b.empty(), b.append("<h3>Recent journeys</h3>"), tfl.journeyPlanner.recentJourneys.usingRecentJourneys)if (tfl.journeyPlanner.recentJourneys.loadJourneys(), tfl.journeyPlanner.recentJourneys.journeys.length > 0) {
            var c = $("<div class='vertical-button-container' />");
            $(tfl.journeyPlanner.recentJourneys.journeys).each(function (b) {
                var d = "<strong>" + this.from + "</strong> to <strong>" + this.to + "</strong>";
                "" !== this.via && (d += " via <strong>" + this.via + "</strong>");
                var e;
                e = $(0 === b ? "<a href='javscript:void(0)' class='plain-button' data-jumpback='#SavePreferences:visible'>" + d + "</a>" : "<a href='javscript:void(0)' class='plain-button'>" + d + "</a>"), e.click(function () {
                    return a.redoJourney(b), !1
                }), c.append(e)
            }), b.append(c), b.append("<p><a href='javascript:void(0)' class='turn-off-recent-journeys' data-jumpto='#footer a:first' data-jumpback='#SavePreferences:visible'>Turn off and clear recent journeys</a></p>")
        } else b.append("<p>You currently have no saved journeys<br/><a href='javascript:void(0)' class='turn-off-recent-journeys' data-jumpto='#footer a:first' data-jumpback='#SavePreferences:visible'>Turn off recent journeys</a></p>"); else b.append("<p>Turn on recent searches so you can access them easily again<br/><a href='javascript:void(0)' class='turn-on-recent-journeys' data-jumpback='#SavePreferences:visible' data-jumpto='#footer a:first'>Turn on recent journeys</a></p>");
        $("div.medium-large[data-set=recent-journeys]").append(b), $(".moving-source-order").appendAround(), $(".turn-on-recent-journeys").click(function (b) {
            b.preventDefault(), tfl.journeyPlanner.recentJourneys.useJourneys(!0), tfl.journeyPlanner.searchForm.destroyAutocomplete(), tfl.journeyPlanner.searchForm.setupAutocomplete(!1), 0 !== $("#recent-journeys").length && a.createJourneys()
        }), $(".turn-off-recent-journeys").click(function (b) {
            b.preventDefault(), tfl.journeyPlanner.recentJourneys.useJourneys(!1), tfl.journeyPlanner.searchForm.destroyAutocomplete(), tfl.journeyPlanner.searchForm.setupAutocomplete(!1), 0 !== $("#recent-journeys").length && a.createJourneys()
        })
    }, a.redoJourney = function (a) {
        var b = tfl.journeyPlanner.recentJourneys.journeys[a], c = !1, d = function () {
            $("#jp-search-form").submit()
        };
        b.from === tfl.dictionary.CurrentLocationText ? (c = !0, tfl.journeyPlanner.searchForm.geolocateMe("#From", d)) : ($("#From").val(b.from), $("#From").attr("data-from-id", b.fromId), $("#From").attr("data-from-modes", JSON.stringify(b.fromModes))), b.to === tfl.dictionary.CurrentLocationText ? (c = !0, tfl.journeyPlanner.searchForm.geolocateMe("#To", d)) : ($("#To").val(b.to), $("#To").attr("data-to-id", b.toId), $("#To").attr("data-to-modes", JSON.stringify(b.toModes))), null !== b.via ? b.via === tfl.dictionary.CurrentLocationText ? (c = !0, tfl.journeyPlanner.searchForm.geolocateMe("#Via", d)) : ($("#Via").val(b.via), $("#Via").attr("data-via-id", b.viaId), $("#Via").attr("data-via-modes", JSON.stringify(b.viaModes))) : $("#Via").val(""), c || d()
    }
}(window.tfl.journeyPlanner = window.tfl.journeyPlanner || {}), function (a) {
    "use strict";
    tfl.logs.create("tfl.journeyPlanner.results: loaded"), a.init = function (b) {
        tfl.logs.create("tfl.journeyPlanner.results.init: started (isAjax: " + b + ")"), b ? a.initAjaxPage() : (a.resultsFormInit(), a.processResults(), a.initSteal()), $("html").hasClass("lt-ie8") && a.initIE7()
    }, a.initGlobal = function () {
        tfl.logs.create("tfl.journeyPlanner.initGlobal: started"), tfl.expandableBox.init()
    }, a.initAjaxPage = function () {
        tfl.logs.create("tfl.journeyPlanner.results.initAjaxPage: started");
        var b = "" === $("#JpType").val() ? "publictransport" : $("#JpType").val();
        a.setupLoader(b), a.resultsFormInit();
        var c = window.location.href, d = tfl.jPResultsPageUrl;
        c = c.substring(c.indexOf("?"), c.length);
        var e = function (b) {
            var c = $(b).find(".ajax-response");
            $(".journey-details-ajax").replaceWith($(c));
            var d = $(".walking-box .journey-time");
            1 === d.length && $('[data-jp-tabs="true"] .walking.selected').length < 1 && (d.find(".visually-hidden").remove(), d = $("<span></span>").addClass("tabs-time").text("Walk this in " + d.text()), $('[data-jp-tabs="true"] [data-jptype="walking"]').addClass("has-time").append(d));
            var e = $(".cycling-box .journey-time");
            1 === e.length && $('[data-jp-tabs="true"] .cycling.selected').length < 1 && (e.find(".visually-hidden").remove(), e = $("<span></span>").addClass("tabs-time").text("Cycle in " + e.text()), $('[data-jp-tabs="true"] [data-jptype="cycling"]').addClass("has-time").append(e)), a.processResults(), a.initGlobal(), $(".disambiguation-form").length > 0 ? tfl.journeyPlanner.disambiguation.init() : $(".summary-results > .expandable-box").css({opacity: 0}).each(function (a) {
                $(this).delay(150 * a).animate({opacity: 1}, 100, function () {
                    $(this).removeAttr("style")
                })
            }), a.initSteal(), $("#alternatives").find("[data-pull-content]").click(tfl.navigation.pullContentHandler)
        };
        tfl.ajax({url: d + c + "&ispostback=true", success: e, dataType: "html"})
    }, a.initSteal = function () {
        steal(tfl.mapScriptPath).then(function () {
            function a() {
                tfl.fullscreen.display(c, !1, !0), c.controller().divResized()
            }

            tfl.logs.create("tfl.journeyPlanner.results.initSteal: started");
            var b = !1, c = null, d = null;
            $(".view-on-a-map").click(function (e, f) {
                var g = $(this);
                $(".view-on-a-map").not(this).removeClass("show-all"), g.toggleClass("show-all");
                var h;
                h = f && f.isHideAll ? $(".view-on-a-map.hide-map") : $(".view-on-a-map.hide-map").not(this), h.text("View on a map").removeClass("hide-map"), g.hasClass("hide-map") ? (g.text("View on a map").removeClass("hide-map"), c.hide()) : (b ? (c.show(), c.insertAfter($(this)), $(document.body).hasClass("breakpoint-Medium") || a()) : (g.after("<div id='leg_map' class='leg-map'></div>"), $.fixture.on = !1, c = $("#leg_map").tfl_maps_journey_planner_leg_map({url: $(".journey-results").data("api-uri"), isNationalBounds: "true" === tfl.getQueryParam("NationalSearch"), mapDeactivated: function () {
                    $(document.body).hasClass("breakpoint-Medium") || tfl.fullscreen.hide(), c.siblings(".view-on-a-map").trigger("click")
                }}), d = c.controller(), d.mapLoading.done(function () {
                    $(window).on("enterBreakpointSmall exitBreakpointMedium", function () {
                        c.is(":visible") && a()
                    }).on("enterBreakpointMedium", function () {
                        tfl.fullscreen.hide()
                    }), $(document.body).hasClass("breakpoint-Medium") || a()
                }), b = !0), d.chooseLeg(g.data("journeyindex"), g.data("legindex")), g.text("Hide map").addClass("hide-map")), e.preventDefault()
            })
        })
    }, a.initIE7 = function () {
        $(".cancel-button, .toggle-options, .edit-button").click(function () {
            var a = $(".journey-form").parents(".r").next();
            a.attr("class", a.attr("class"))
        })
    }, a.maps = function (b) {
        var c = "cycling", d = "walking";
        if (b === c || b === d) {
            var e = $(b === c ? ".summary-results.cycling .cycling-box" : ".summary-results.walking .walking-box");
            1 === e.length && $(document.body).hasClass("breakpoint-Large") && (e.find(".always-visible .show-detailed-results").click(), a.triggerMapLink($(".full-results-container .view-on-a-map")))
        }
    }, a.triggerMapLink = function (a) {
        tfl.logs.create("tfl.journeyPlanner.results: trigger click on map link"), a.trigger("click", {isHideAll: !0})
    }, a.setupLoader = function (a) {
        var b, c = $('<div id="loader-background"></div>'), d = $('<div id="loader-birds"></div>'), e = $('<div id="loader-trees"></div>'), f = $('<div class="tree-segment"></div>');
        for (b = 0; 8 > b; b++)e.append(f.clone());
        var g = $('<div id="loader-transport-method"></div>'), h = $('<div id="loader-grass"></div>'), i = $('<div class="grass-segment"></div>');
        for (b = 0; 18 > b; b++)h.append(i.clone());
        var j = $('<div id="loader-message">Fetching results</div>');
        $("#loader-window").addClass(a).append(c).append(e).append(d).append(g).append(h).append(j)
    }, a.processResults = function () {
        $(".summary-results > .expandable-box > .content > .always-visible").click(function () {
            $(this).parents(".not-selected").length > 0 && (a.unshowAllDetailedResults(), a.currentlyShowing = null)
        });
        var b = $(".summary-results");
        b.hasClass("cycling") ? a.maps("cycling") : b.hasClass("walking") && a.maps("walking"), $(".always-visible .journey-price").after("<button class='primary-button show-detailed-results' data-jumpto=''>" + tfl.dictionary.ShowDetailedView + "</button>"), $(".back-to-link").click(a.unshowAllDetailedResults);
        $(".journey-details").length > 0 && tfl.journeyPlanner.recentJourneys.usingRecentJourneys && (tfl.journeyPlanner.recentJourneys.saveJourney($("#From").attr("data-from-id"), $("#From").attr("data-from-modes"), $("#To").attr("data-to-id"), $("#To").attr("data-to-modes")), tfl.journeyPlanner.recentSearches.saveSearch($("#From").val(), $("#From").attr("data-from-id"), $("#From").attr("data-from-modes")), tfl.journeyPlanner.recentSearches.saveSearch($("#To").val(), $("#To").attr("data-to-id"), $("#To").attr("data-to-modes")), "" !== $("#Via").val() && tfl.journeyPlanner.recentSearches.saveSearch($("#Via").val(), $("#Via").attr("data-via-id"), $("#Via").attr("data-via-modes"))), $(".journey-details").each(a.generateJourneySummary);
        for (var c, d = $(".journey-steps .message-toggle"), e = $(".journey-detail-step .line-status .message-toggle"), f = function (a, b) {
            var c = b;
            a.click(function () {
                $(e[c]).parent().parent().hasClass("expanded") || $(e[c]).click(), $(this).parents(".summary").find(".show-detailed-results").click()
            })
        }, g = 0; g < d.length; g++)c = $(d[g]), f(c, g);
        $(".line-status-info .start-hidden");
        for (var h = $(".line-status-info .hide-link"), i = function (a, b) {
            var c = b;
            a.click($(e[c]).click)
        }, j = 0; j < d.length; j++)c = $(h[j]), i(c, j);
        $(".show-detailed-results").click(a.viewDetailsClick), a.expandableBoxes = $(".summary-results > .expandable-box"), $(".json-all-stops").click(a.showAllStops), $(".text-instructions-link").click(a.showTextInstructions), $(".disruption-heading").append('<span class="link-style show-details">Show details...</span><span class="link-style hide-details">Hide details...</span>'), $(".accessibility-details").append('<div class="show-hide-links"><a href="javascript:void(0)" class="show-link">Show details...</a><a href="javascript:void(0)" class="hide-link">Hide details...</a></div>'), $(".show-hide-links a").click(function (a) {
            $(".accessibility-details").toggleClass("expanded"), a.preventDefault()
        }), $(".journey-detail-step.terminus").after("<div class='jp-print-button clearfix'><a href='javascript:window.print()' class='secondary-button print-button'>Print this route</a></div>")
    }, a.generateJourneySummary = function () {
        var a = $("<table></table>").attr("class", "journey-steps").append("<caption class='visually-hidden'>Steps for journey option " + i + "</caption><thead><tr><th>Time</th><th>Mode of Transport</th><th>Instructions</th></tr></thead>");
        $(this).find(".journey-detail-step:not(.terminus)").each(function () {
            var b = ($(this).find(".step-heading .time-and-mode .centred").html(), $("<tr></tr>")), c = !1;
            $(this).find(".details .instructions .line-status").length > 0 && (c = !0);
            var d = "time";
            $(this).find(".duration").text().indexOf("hour") > 0 && (d += " wide"), b.append("<td class='" + d + "'><strong>" + $(this).find(".duration").text().replace("minute", "min").replace("hour", "hr") + "</strong></td>");
            var e = $(c ? "<td class='logo disrupted'></td>" : "<td class='logo'></td>");
            if (e.append($(this).find(".time-and-mode .centred").clone()), b.append(e), b.append(c ? "<td class='description disrupted'>" + $(this).find(".step-summary").html() + "</td>" : "<td class='description'>" + $(this).find(".step-summary").html() + "</td>"), a.append(b), $(this).find(".line-status").length > 0) {
                var f = $("<td class='disrupted'></td>").append($(this).find(".disruption-messages .line-status .message-toggle").eq(0).clone());
                a.append($("<tr><td class='time'>&nbsp;</td><td class='logo disrupted'><div class='disruption-icon centred hide-text'>Disruption</div></td></tr>").append(f))
            }
        }), a.insertBefore(this), a.after($(this).parents(".content").find(".price-and-details").clone()), i++
    }, a.viewDetailsClick = function (b) {
        b.stopPropagation();
        var c = 0;
        return c = $.inArray($(this).parents(".expandable-box").get(0), a.expandableBoxes), a.unshowAllDetailedResults(), tfl.logs.create("tfl.journeyPlanner.results: view details clicked: (index: " + c + ", currentlyshowing: " + a.currentlyShowing + ")"), c !== a.currentlyShowing ? a.showDetailedResults(c) : a.currentlyShowing = null, !1
    }, a.showDetailedResults = function (b) {
        tfl.logs.create("tfl.journeyPlanner.results: Show detailed results. Index: " + b);
        var c = a.expandableBoxes;
        a.currentlyShowing = b, c.removeClass("selected").addClass("not-selected");
        var d = $(c[b]), e = $(c[b + 1]), f = $(c[c.length - 1]);
        $(f).find(".show-detailed-results").attr("data-jumpto", ".earlier:tabbable:first"), $(f).find(".show-detailed-results").addClass("last-show-details"), d.removeClass("not-selected").addClass("selected");
        d.find(".show-detailed-results:visible");
        $(".show-detailed-results").text(tfl.dictionary.ShowDetailedView), $(d).find(".show-detailed-results").text(tfl.dictionary.HideDetailedView), $(d).find(".show-detailed-results").addClass("hide-details"), $(e).find(".show-detailed-results").addClass("next-show-details"), $(d).find(".show-detailed-results").attr("data-jumpto", ".journey-details :tabbable:first:visible"), $(d).find(".show-detailed-results").removeClass("last-show-details"), $(c[a.currentlyShowing]).children(".content").children(".start-hidden").appendTo(".full-results-container"), $(".replan-route").remove(), $(".full-results-container").append("<div class='replan-route'><a href='javascript:void(0)' class='replan-from-current-location' data-jumpto='.next-show-details:visible'>Replan route from current location</a></div>"), $(".replan-from-current-location").click(function () {
            return tfl.geolocation.geolocateMe("#From", function () {
                var a = $("#From");
                a.removeAttr("data-from-id"), a.removeAttr("data-from-modes"), a.removeAttr("data-dataset-name"), $("#jp-search-form").submit()
            }), $(".secondary-button.edit-button").click(), !1
        }), $(".full-results-container").removeClass("hidden").addClass($("#JpType").val()), $(document.body).addClass("showing-full-details");
        var g = $(".full-results-container").offset().top;
        $("html, body").animate({scrollTop: g - 10}), $(".journey-details :tabbable:first").focus();
        {
            var h = $(".full-results-container");
            h.find(".journey-detail-step")
        }
        if (!$("html").hasClass("breakpoint-Medium") && history.pushState) {
            var i = $(".back-to-link"), j = function () {
                window.onpopstate = null, history.go(-1), i.off("click", this)
            };
            history.pushState({}, null), i.on("click", j), window.onpopstate = function () {
                a.unshowAllDetailedResults(), window.onpopstate = null
            }
        }
        return!1
    }, a.unshowAllDetailedResults = function () {
        tfl.logs.create("tfl.journeyPlanner.results: Unshow all detailed results.");
        var b = a.expandableBoxes;
        return $(".full-results-container").addClass("hidden"), $(".full-results-container > .start-hidden").appendTo($(b[a.currentlyShowing]).children(".content")), $(".show-detailed-results").text(tfl.dictionary.ShowDetailedView), $(".show-detailed-results").removeClass("hide-details"), $(".show-detailed-results").removeClass("next-show-details"), $(".show-detailed-results").attr("data-jumpto", ""), b.removeClass("not-selected selected"), $(document.body).removeClass("showing-full-details"), $(".json-all-stops").text(tfl.dictionary.ShowAllStops), $(".json-all-stops").parent().siblings(".all-stops").hide(), $(".text-instructions-link").text(tfl.dictionary.ShowTextInstructions).removeClass("hide"), $(".details .text-instructions-list").hide(), !1
    }, a.showAllStops = function () {
        var a = this;
        return $(a).text() === tfl.dictionary.ShowAllStops ? ($(a).text(tfl.dictionary.HideAllStops), $(a).parent().siblings(".all-stops").show()) : ($(a).text(tfl.dictionary.ShowAllStops), $(a).parent().siblings(".all-stops").hide()), $(a).toggleClass("hide"), !1
    }, a.showTextInstructions = function () {
        var a = $(this), b = a.parent().siblings(".text-instructions-list");
        return a.text() === tfl.dictionary.ShowTextInstructions ? (a.text(tfl.dictionary.HideTextInstructions), b.show()) : (a.text(tfl.dictionary.ShowTextInstructions), b.hide()), a.toggleClass("hide"), !1
    }, a.resultsFormInit = function () {
        tfl.logs.create("tfl.journeyPlanner.results: resultsFormInit started"), $(".plan-journey-button").wrap("<div class='clearfix update-buttons' />").before("<input type='button' class='secondary-button cancel-button' value='Cancel' />"), $(".plan-journey-button").val("Update journey").submit(function () {
            $(".cancel-button").remove()
        }), $(".plan-journey-button-second").val("Update journey"), tfl.journeyPlanner.searchForm.buildSwitchButton(), $(".switch-button").click(tfl.journeyPlanner.searchForm.switchFromTo);
        var a = tfl.utils.isTouchDevice();
        if ("" !== $("#From").val() && "" !== $("#To").val()) {
            var b = "";
            a && (b = " touch");
            var c = $("<div class='journey-result-summary" + b + "' ><div class='from-to-wrapper'></div></div>");
            c.children(".from-to-wrapper").append("<div class='summary-row clearfix'><span class='label'>From:</span><strong>" + $("#From").val() + "</strong></div>"), c.children(".from-to-wrapper").append("<div class='summary-row clearfix'><span class='label'>To:</span><strong>" + $("#To").val() + "</strong></div>");
            var d = $(".leaving-or-arriving li.selected").text().replace(/^\s+|\s+$/g, ""), e = $("#Date").val();
            if (null !== e) {
                var f = parseInt(e.substring(4, 6), 10);
                f--, e = new Date(parseInt(e.substring(0, 4), 10), f, parseInt(e.substring(6, 8), 10))
            } else e = new Date;
            var g = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"], h = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"], i = "<sup>th</sup>", j = e.getDate(), k = j % 10;
            1 === k && 11 !== j ? i = "<sup>st</sup>" : 2 === k && 12 !== j ? i = "<sup>nd</sup>" : 3 === k && 13 !== j && (i = "<sup>rd</sup>");
            var l = h[e.getDay()] + " " + e.getDate() + i + " " + g[e.getMonth()];
            l += ", " + $("#Time option:selected").text();
            var m = "", n = $("#Via").val();
            "" !== n && (m += "<strong class='via-destination'>Via " + n + "</strong> ");
            var o = $(".jp-mode-cycling .accessibility-options .ticked label").html();
            m += '<strong class="travelpreferences-cycling">' + o + "</strong>";
            var p = $("#WalkingSpeed :selected").text();
            m += '<strong class="travelpreferences-walking">' + p + " walking speed</strong>", m += '<strong class="travelpreferences-publictransport">Showing ' + $("#JourneyPreference option:selected").text().toLowerCase() + "</strong> ";
            var q = $(".modes-of-transport option:selected");
            m += '<strong class="travelpreferences-publictransport">Using ';
            var r = 0;
            if (0 === $(".modes-of-transport option:not(:selected)").length)m += "all transport modes"; else if (q.length <= 4)for (r = 0; r < q.length; r++)r > 0 && r === q.length - 1 ? m += " and " : r > 0 && (m += ", "), m += $(q[r]).text().replace(/^\s+|\s+$/g, ""); else {
                for (r = 0; 3 > r; r++)r > 0 && (m += ", "), m += $(q[r]).text().replace(/^\s+|\s+$/g, "");
                m += " and " + (q.length - 3) + " others"
            }
            m += "</strong> ";
            var s = $(".accessibility-options li.ticked input").val();
            s && "" !== s && "norequirements" !== s.toLowerCase() && (m += '<strong class="travelpreferences-publictransport">Step free access required</strong> '), m += '<strong class="travelpreferences-publictransport">Max walk time ' + $("#MaxWalkingMinutes").val() + " mins</strong>", c.append("<div class='summary-row clearfix'><span class='label'>" + d + ":</span><strong>" + l + "</strong></div>");
            var t = $("<button></button>").addClass("secondary-button edit-button").text("Edit").click(function (a) {
                a.preventDefault(), $("#plan-a-journey").addClass("editing"), $("#plan-a-journey :tabbable:first:visible").focus(), $("#From, #To, #Via").trigger("change")
            });
            c.append($("<div></div>").addClass("summary-row").append(t)), c.append("<div class='travel-preferences clearfix'><div class='left-shadow' /><div class='scroller'><div><span>Travel preferences: </span>" + m + "</div></div><div class='right-shadow' /></div>"), $("#plan-a-journey").append(c)
        }
        a && (tfl.journeyPlanner.travelPrefsInnerWidth = $(".scroller > div").get(0).scrollWidth, tfl.journeyPlanner.travelPrefsScrollMax = tfl.journeyPlanner.travelPrefsInnerWidth - $(".scroller").width(), tfl.journeyPlanner.travelPrefsLeftShadow = $(".left-shadow"), tfl.journeyPlanner.travelPrefsRightShadow = $(".right-shadow"), $(".scroller").scroll(function () {
            var a = $(this).scrollLeft();
            tfl.journeyPlanner.travelPrefsLeftShadow.css({left: Math.min(0, -40 + a)}), tfl.journeyPlanner.travelPrefsRightShadow.css({right: Math.min(0, tfl.journeyPlanner.travelPrefsScrollMax - a - 40)})
        }).scroll(), $(window).resize(function () {
            tfl.journeyPlanner.travelPrefsScrollMax = tfl.journeyPlanner.travelPrefsInnerWidth - $(".scroller").width(), $(".scroller").scroll()
        })), $(".cancel-button").click(function () {
            return $(".toggle-options.less-options").click(), $("#plan-a-journey").removeClass("editing").parents(".r").removeClass("expanded"), $(".journey-result-summary .secondary-button").focus(), !1
        })
    }
}(window.tfl.journeyPlanner.results = window.tfl.journeyPlanner.results || {}), window.tfl.journeyPlanner = window.tfl.journeyPlanner || {}, function (a) {
    "use strict";
    tfl.logs.create("tfl.journeyPlanner.disambiguation: loaded"), a.init = function () {
        function a(a, b) {
            var c = tfl.maps[a].googleMap;
            c.on("optionChosen", function (a) {
                b.find(".disambiguation-option[data-id='" + a.id + "'] .disambiguation-link")[0].click()
            });
            var d = b.parent().find(".pagination");
            d.length && tfl.navigation.pagination.addMapControls(d, c.controller)
        }

        tfl.logs.create("tfl.journeyPlanner.disambiguation: initialised");
        var b = $(".disambiguation-wrapper"), c = b.length, d = 0;
        c > 0 && ($(".disambiguation-extras").prepend("<div class='pagination' />"), $(".disambiguation-box").each(function () {
            var a = $(this).find(".disambiguation-option").length;
            a > tfl.journeyPlanner.settings.disambiguationItemsPerPage && tfl.navigation.pagination.setup($(this), ".disambiguation-items", tfl.journeyPlanner.settings.disambiguationItemsPerPage, a, !0);
            var b = $(this).parents(".disambiguation-wrapper"), c = b.hasClass("from-results");
            if (c)$(".summary-row").eq(0).addClass("disambiguating"); else {
                var d = b.hasClass("to-results");
                d ? $(".summary-row").eq(1).addClass("disambiguating") : $(".via-destination").addClass("disambiguating")
            }
        })), $(".disambiguation-link").click(function () {
            var a = $(this).parents(".disambiguation-wrapper");
            a.hasClass("from-results") ? ($("#From").val($(this).find(".place-name").text()).after("<input type='hidden' name='FromId' value='" + $(this).attr("data-param") + "' />"), $("#disambiguation-map-from").html("")) : a.hasClass("to-results") ? ($("#To").val($(this).find(".place-name").text()).after("<input type='hidden' name='ToId' value='" + $(this).attr("data-param") + "' />"), $("#disambiguation-map-to").html("")) : a.hasClass("via-results") && ($("#Via").val($(this).find(".place-name").text()).after("<input type='hidden' name='ViaId' value='" + $(this).attr("data-param") + "' />"), $("#disambiguation-map-via").html(""));
            var b = a.next(".disambiguation-wrapper");
            return b.length >= 1 ? (a.hide(), b.show(), b.find(".disambiguation-map").controller().divResized()) : $("#jp-search-form").submit(), !1
        }), b.each(function () {
            d > 0 && $(this).hide(), d++
        }), tfl.mapInteractions.init(), $("#disambiguation-options-from, #disambiguation-options-to, #disambiguation-options-via").each(function () {
            var b = $(this);
            if (b.find(".disambiguation-option").length > 0) {
                var c = $(this).attr("id").replace("-options-", "-map-").replace("-", "");
                void 0 !== tfl.maps[c] ? a(c, b) : $(window).on("map-object-created-" + c, function () {
                    a(c, b)
                })
            }
        })
    }
}(window.tfl.journeyPlanner.disambiguation = window.tfl.disambiguation || {}), window.tfl.journeyPlanner = window.tfl.journeyPlanner || {}, function (a) {
    "use strict";
    function b() {
        function a(a) {
            a.removeAttr("data-" + a.attr("id").toLowerCase() + "-id"), a.removeAttr("data-" + a.attr("id").toLowerCase() + "-modes"), a.removeAttr("data-dataset-name")
        }

        $("#From, #To, #Via").each(function () {
            $(this).on("keydown", function (b) {
                9 !== b.which && 13 !== b.which && (b.which < 33 || b.which > 40) && (b.which < 16 || b.which > 20) && 45 !== b.which && 91 !== b.which && a($(this))
            }), $(this).on("paste", function () {
                a($(this))
            })
        })
    }

    tfl.logs.create("tfl.journeyPlanner.searchForm: loaded"), a.widgetInit = function () {
        tfl.logs.create("tfl.journeyPlanner.searchForm: started widgetInit"), $(".toggle-options, .change-departure-time").click(function () {
            var a = $(this), b = a.attr("href"), c = b.substr(0, b.indexOf("#")), d = b.substr(b.indexOf("#"));
            $.each(["From", "To", "FromId", "ToId", "FromGeolocation", "ToGeolocation"], function (a, b) {
                var d = $("#" + b).val();
                void 0 !== d && "" !== d && (0 === a && (c += "?"), a > 0 && (c += "&"), c += b + "=" + d)
            }), a.attr("href", c + d)
        })
    }, a.setupDateOptions = function () {
        var b = new Date, c = 6e4 * (15 - b.getMinutes() % 15), d = 1e3 * (60 - b.getSeconds() % 60);
        setTimeout(a.incrementCurrentTime, c - d)
    }, a.processTempLocalStorage = function () {
        var a = tfl.storage.get("tempJPLocalStorage", [
            []
        ]);
        if (a.length > 0)for (var b = 0; b < a.length; b++)$(a[b][0]).attr(a[b][1], a[b][2])
    }, a.submitSearchForm = function () {
        var a = $("#From"), b = $("#To"), c = $("#Via");
        a.attr("data-from-id") && (0 === $("#FromId").length ? $(this).append("<input type='hidden' id='FromId' name='FromId' value='" + a.attr("data-from-id") + "' />") : $("#FromId").val(a.attr("data-from-id"))), b.attr("data-to-id") && (0 === $("#ToId").length ? $(this).append("<input type='hidden' id='ToId' name='ToId' value='" + b.attr("data-to-id") + "' />") : $("#ToId").val(b.attr("data-to-id"))), c.attr("data-via-id") && $(this).append("<input type='hidden' id='ViaId' name='ViaId' value='" + c.attr("data-via-id") + "' />");
        var d = [
            []
        ];
        return a.attr("data-from-modes") && d.push(["#From", "data-from-modes", a.attr("data-from-modes")]), a.attr("data-dataset-name") && d.push(["#From", "data-dataset-name", a.attr("data-dataset-name")]), b.attr("data-to-modes") && d.push(["#To", "data-to-modes", b.attr("data-to-modes")]), b.attr("data-dataset-name") && d.push(["#To", "data-dataset-name", b.attr("data-dataset-name")]), c.attr("data-via-modes") && d.push(["#Via", "data-via-modes", c.attr("data-via-modes")]), c.attr("data-dataset-name") && d.push(["#Via", "data-dataset-name", c.attr("data-dataset-name")]), d.length > 0 && tfl.storage.set("tempJPLocalStorage", d), a.val() !== tfl.dictionary.CurrentLocationText && $("#FromGeolocation").val(""), b.val() !== tfl.dictionary.CurrentLocationText && $("#ToGeolocation").val(""), c.val() !== tfl.dictionary.CurrentLocationText && $("#ViaGeolocation").val(""), !0
    }, a.changeTabs = function () {
        var a = $('[data-jp-tabs="true"]'), b = a.parents(".journey-planner-results").length > 0;
        a.children().click(function () {
            var c = $("#JpType"), d = c.val(), e = $(this).children("a"), f = e.attr("data-jptype");
            if (a.removeClass(d).addClass(f), $("#jp-search-form").removeClass(d).addClass(f), c.val(f), b) {
                var g = $("#OptionsForPublictransport");
                c.val() === tfl.dictionary.JpTypeCycling || c.val() === tfl.dictionary.JpTypeWalking ? g.hide() : g.show(), e.hasClass("has-time") ? ($(".summary-results").removeClass(d).addClass(f), window.tfl.journeyPlanner.results.unshowAllDetailedResults(), window.tfl.journeyPlanner.results.currentlyShowing = null) : $("#jp-search-form").submit(), window.tfl.journeyPlanner.results.maps(f), "publictransport" === f ? $(".no-public-transport").show() : $(".no-public-transport").hide()
            }
        })
    }, a.incrementCurrentTime = function () {
        0 === $(".time-options.change-time").length && a.setCurrentTime(), setTimeout(a.incrementCurrentTime, 9e5)
    }, a.getCurrentDate = function () {
        var a = new Date, b = a.getFullYear().toString(), c = (a.getMonth() + 1).toString(), d = a.getDate().toString();
        return b + (c[1] ? c : "0" + c[0]) + (d[1] ? d : "0" + d[0])
    }, a.getCurrentTime = function () {
        var a = new Date, b = a.getMinutes();
        b = b += 15 - b % 15;
        var c = a.getHours();
        60 === b && (b = 0, c++, 24 === c && (c = 0));
        var d = "" + b;
        1 === d.length && (d = "0" + d);
        var e = "" + c;
        return 1 === e.length && (e = "0" + e), e + d
    }, a.setCurrentTime = function () {
        var a = new Date, b = a.getMinutes();
        b += 15 - b % 15;
        var c = a.getHours();
        60 === b && (b = 0, c++, 24 === c && (c = 0, $("#Date").val($("#Date option:selected").next().val()), $(".date-of-departure > span").text("Tomorrow")));
        var d = "" + b;
        1 === d.length && (d = "0" + d);
        var e = "" + c;
        1 === e.length && (e = "0" + e), $("#Time").val(e + d), $(".hours span").text(e + ":" + d)
    }, a.changeDepartureTime = function () {
        return $(".time-options").toggleClass("change-time"), !1
    }, a.toggleMoreOptions = function () {
        $(this).parents(".r").toggleClass("expanded");
        var a = $(".toggle-options");
        return a.hasClass("more-options") ? a.removeClass("more-options").addClass("less-options").text(tfl.dictionary.LessOptions) : a.removeClass("less-options").addClass("more-options").text(tfl.dictionary.MoreOptions + tfl.dictionary.CustomisedOptions), !1
    }, a.toggleMoreOptionsIsWidget = function () {
        var a = $(this), b = a.attr("href"), c = b;
        c = -1 !== b.indexOf("?") ? b.substr(0, b.indexOf("?")) : b.substr(0, b.indexOf("#"));
        var d = "", e = b.substr(b.indexOf("#"));
        $.each(["From", "To", "FromGeolocation", "ToGelocation"], function (a, b) {
            var c = $("#" + b).val();
            void 0 !== c && "" !== c && (0 === a && (d += "?"), a > 0 && (d += "&"), d += b + "=" + c)
        });
        var f = [], g = $("#From"), h = $("#To");
        g.attr("data-from-id") && f.push(["fromId", g.attr("data-from-id")]), h.attr("data-to-id") && f.push(["toId", h.attr("data-to-id")]), f.push(["date", $("#Date").find("option:selected").val()]), f.push(["timeIs", $(".leaving-or-arriving .selected input").val()]), f.push(["time", $("#Time").find("option:selected").val()]), -1 === d.indexOf("?") && (d += "?");
        for (var i = 0; i < f.length; i++)d += "&" + f[i][0] + "=" + f[i][1];
        a.attr("href", c + d + e);
        var j = [
            []
        ];
        g.attr("data-from-modes") && j.push(["#From", "data-from-modes", g.attr("data-from-modes")]), g.attr("data-dataset-name") && j.push(["#From", "data-dataset-name", g.attr("data-dataset-name")]), h.attr("data-to-modes") && j.push(["#To", "data-to-modes", h.attr("data-to-modes")]), h.attr("data-dataset-name") && j.push(["#To", "data-dataset-name", h.attr("data-dataset-name")]), j.length > 0 && tfl.storage.set("tempJPLocalStorage", j)
    }, a.buildSwitchButton = function () {
        $(".geolocation-box").after("<a href='javascript:void(0)' class='switch-button hide-text'>Switch from and to<a>")
    }, a.switchFromTo = function () {
        var a = $("#From"), b = $("#FromGeolocation"), c = $("#To"), d = $("#ToGeolocation"), e = a.val(), f = a.attr("data-from-id") ? a.attr("data-from-id") : "", g = a.attr("data-from-modes") ? a.attr("data-from-modes") : "", h = a.attr("data-dataset-name") ? a.attr("data-dataset-name") : "", i = a.parent().attr("data-current-location") ? a.parent().attr("data-current-location") : "", j = b.val(), k = c.val(), l = c.attr("data-to-id") ? c.attr("data-to-id") : "", m = c.attr("data-to-modes") ? c.attr("data-to-modes") : "", n = c.attr("data-dataset-name") ? c.attr("data-dataset-name") : "", o = c.parent().attr("data-current-location") ? c.parent().attr("data-current-location") : "", p = d.val();
        a.typeahead("val", k), a.attr("data-from-id", l), a.attr("data-from-modes", m), a.attr("data-dataset-name", n), "" !== o ? a.parent().attr("data-current-location", o) : a.parent().removeAttr("data-current-location"), a.trigger("change"), c.typeahead("val", e), c.val(e), c.attr("data-to-id", f), c.attr("data-to-modes", g), c.attr("data-dataset-name", h), "" !== i ? c.parent().attr("data-current-location", i) : c.parent().removeAttr("data-current-location"), c.trigger("change"), b.val(p), d.val(j)
    }, tfl.journeyPlanner.recentSearches.loadSearches();
    var c = tfl.autocomplete.sources.getRecentSearches("journey-planner-recent-searches", tfl.journeyPlanner.recentSearches.searches, tfl.autocomplete.sources.stationsStopsSelectionCallback, "<div class='mode-icons'>{{#placeModes}}<span class='mode-icon {{.}}-icon'>&nbsp;</span>{{/placeModes}}</div><span class='stop-name'>{{placeName}}</span>", "placeName", tfl.journeyPlanner.recentSearches.recentSearchNumberLimit);
    c.typeaheadSource.removeContent = tfl.autocomplete.sources.stationsStopsRemoveContent;
    var d, e, f = [tfl.autocomplete.sources.getJourneyPlannerSuggestions()], g = tfl.autocomplete.sources.getTurnOnOffRecentSearches(!1, [
        {linkText: "Turn off recent journeys"}
    ]), h = tfl.autocomplete.sources.getTurnOnOffRecentSearches(!0, [
        {linkText: "Turn on recent journeys"}
    ]);
    a.setupAutocomplete = function (b) {
        d = f.slice(0), e = f.slice(0), a.autocompleteAddRecentSearches(!b), a.autocompleteAddGeolocation(), g.typeaheadSource.callback = function (b) {
            tfl.journeyPlanner.recentJourneys.useJourneys(!1), 0 !== $("#recent-journeys").length && tfl.journeyPlanner.createJourneys(), $(b).parent().siblings(tfl.dictionary.RemoveContentClass).trigger("clear-search-box"), a.destroyAutocomplete(), $("#From, #To, #Via").each(function () {
                tfl.autocomplete.setup("#" + $(this).attr("id"), d, null, !0), $("#" + $(this).attr("id")).attr("placeholder", $(this).attr("id"))
            })
        }, h.typeaheadSource.callback = function (b) {
            tfl.journeyPlanner.recentJourneys.useJourneys(!0), 0 !== $("#recent-journeys").length && tfl.journeyPlanner.createJourneys(), $(b).parent().siblings(tfl.dictionary.RemoveContentClass).trigger("clear-search-box"), a.destroyAutocomplete(), $("#From, #To, #Via").each(function () {
                tfl.autocomplete.setup("#" + $(this).attr("id"), e, null, !0), $("#" + $(this).attr("id")).attr("placeholder", $(this).attr("id"))
            })
        }, tfl.journeyPlanner.recentJourneys.usingRecentJourneys ? (tfl.autocomplete.setup("#From", e, null, b), tfl.autocomplete.setup("#To", e, null, b), tfl.autocomplete.setup("#Via", e, null, b)) : (tfl.autocomplete.setup("#From", d, null, b), tfl.autocomplete.setup("#To", d, null, b), tfl.autocomplete.setup("#Via", d, null, b))
    }, a.destroyAutocomplete = function () {
        $("#From, #To, #Via").each(function () {
            $(this).parent().siblings(tfl.dictionary.RemoveContentClass).unbind("clear-search-box"), $(this).typeahead("destroy"), $(this).off("typeahead:selected typeahead:autocompleted keydown.autocomplete")
        }), e = f.slice(0), d = f.slice(0), a.autocompleteAddRecentSearches(!0), a.autocompleteAddGeolocation()
    }, a.autocompleteAddRecentSearches = function (a) {
        tfl.storage.isLocalStorageSupported() && (e.splice(0, 0, g), tfl.journeyPlanner.recentJourneys.usingRecentJourneys && !a && e.splice(0, 0, c), d.splice(0, 0, h))
    }, a.autocompleteAddGeolocation = function () {
        var a = tfl.autocomplete.sources.getGeolocation(null);
        tfl.geolocation.isGeolocationSupported() && (e.splice(0, 0, a), d.splice(0, 0, a))
    }, a.init = function (c) {
        tfl.logs.create("tfl.journeyPlanner.searchForm.init: started (widget = " + c + ")"), a.isWidget = c || !1, a.processTempLocalStorage();
        var d = $(".leaving-or-arriving .selected label").text();
        $(".time-options").prepend("<div class='time-defaults'><p><strong>" + d + ":</strong> <span>now</span></p><a href='javascript:void(0)' class='change-departure-time'>change time</a></div>"), (!String.prototype.indexOf || window.location.href.indexOf("&time=") > 0) && ($(".change-time-options").show(), $(".time-defaults").hide()), $(".extra-options").prepend('<a href="' + tfl.jPLandingPageUrl + '#more-options" class="toggle-options more-options">Accessibility &amp; travel options</a>'), $("#jp-search-form").submit(a.submitSearchForm), tfl.journeyPlanner.recentSearches.loadSearches(), $(".change-departure-time").click(a.changeDepartureTime), a.setupDateOptions(), a.isWidget ? $(".toggle-options").click(a.toggleMoreOptionsIsWidget) : (a.changeTabs(), $(".toggle-options").click(a.toggleMoreOptions)), "#more-options" === window.location.hash ? $(".toggle-options").click() : "#change-time" === window.location.hash && a.changeDepartureTime(), $("#IsAsync").val(!0), a.setupAutocomplete(!0), b();
        var e = $("#From"), f = $("#To"), g = $("#Via");
        $([e, f, g]).each(function () {
            this.val() === tfl.dictionary.CurrentLocationText && tfl.geolocation.setupInputBoxForGeolocation(this)
        })
    }
}(window.tfl.journeyPlanner.searchForm = window.tfl.journeyPlanner.searchForm || {}), function (a) {
    "use strict";
    a.initialize = function () {
        a.setUpResultTags(), a.populateSearchBoxes(), a.resetSelectBoxes(), a.checkQueryString(), a.selectBoxFiltering(), a.selectBoxChange()
    }, a.resetSelectBoxes = function () {
        $(".reset-filters").click(function () {
            $(".selector").children(".filter-box").each(function () {
                $(this).prop("selectedIndex", 0), $(this).siblings("span").text($(this).children("option:first-child").text()), a.selectBoxFiltering()
            })
        })
    }, a.checkQueryString = function () {
        var b = $(location).attr("href");
        if (b.indexOf("?") >= 0) {
            for (var c = b.split("?"), d = c[1].split("&"), e = d.length, f = 0, g = []; e > f;)g.push(d[f].replace(/%20/g, " ")), f++;
            $(".filter-box").each(function () {
                var b = $(this).attr("name");
                for (x = 0; x < g.length; x++) {
                    var c = g[x].split("=");
                    if (c[0] === b) {
                        var d = $(this).children().text();
                        d.indexOf(c[1]) <= 0 || $(this).siblings("span").text(c[1])
                    }
                    a.selectBoxFiltering()
                }
            })
        }
    }, a.selectBoxChange = function () {
        $("select.filter-box").change(function () {
            a.selectBoxFiltering()
        })
    }, a.setUpResultTags = function () {
        $(".results-list-all").find("data-pull-content").click(tfl.navigation.pullContentHandler), $(".results-list-all").hide(), $(".results-list-all").children("#results-list").children("li.search-results").each(function () {
            for (var a = $(this).children(".search-tags"), b = a.text(), c = b.split(","), d = c.length, e = 0; d > e; e++)a.append("<a class='result-tag'>" + c[e] + "</a>");
            var f = a.children().remove();
            a.text("").append(f)
        })
    }, a.selectBoxFiltering = function () {
        $("#pagination-items").empty(), $(".pagination").remove(), $(".search-results").each(function () {
            var a = !1, b = [];
            $(this).find("a.result-tag").each(function () {
                var a = $(this).text();
                b[b.length] = a
            }), $(".selector").children(".filter-box").each(function () {
                var c = $(this).siblings("span").text();
                if ("All" === c)return!0;
                var d = $.inArray(c, b);
                return-1 === d ? (a = !0, !1) : void 0
            }), a || $(this).clone(!0).appendTo("#pagination-items")
        });
        var b = $("#pagination-items > li").length;
        0 === b ? $(".field-validation-information").length < 1 && $(".results-wrapper").append("<p class='field-validation-information' id='search-filters-no-results'>There is nothing matching your search.</p>") : $("#search-filters-no-results").remove(), a.PaginateSearchFilters()
    }, a.PaginateSearchFilters = function () {
        var a = 5;
        $(".pagination-controls").remove(), $("#pagination-items .search-results").length > a && ($(".results-wrapper ul").after("<div class='pagination' />"), tfl.navigation.pagination.setup($(".results-wrapper"), "#pagination-items", a, $("#pagination-items .search-results").length, !0))
    }, a.populateSearchBoxes = function () {
        $(".search-filters-wrapper").append("<div class='search-filter filter-by-box'><a class='reset-filters'>Reset</a><p class='heading'>Filter by:</p>");
        for (var a = 0; a <= filters.length; a++)for (var b in filters[a]) {
            $(".filter-by-box").append("<div class='filter-box-wrap'></div"), $(".filter-box-wrap").eq(a).append("<label for='" + b + "' class='heading'>" + b + ":</label><div class='selector'><select class='filter-box' name=" + b + " class='valid'><option selected='selected'>All</option></select></div>");
            for (var c = 0; c < filters[a][b].length; c++)$(".filter-box-wrap").eq(a).find(".filter-box").append("<option>" + filters[a][b][c] + "</option>")
        }
        tfl.forms.setupSelectBoxes()
    }, $(document).ready(function () {
        tfl.logs.create("tfl.searchFilters: looking for search filters");
        var b = $(".search-filters-wrapper");
        b.length > 0 && (tfl.logs.create("tfl.searchFilters: loading search filters"), a.initialize())
    })
}(window.tfl.searchFilters = window.tfl.searchFilters || {}), function (a) {
    a.tabs = function (a) {
        tfl.logs.create("tfl.navigation.tabs: loaded");
        var b = $(a).children();
        b.click(function (a) {
            a.preventDefault(), b.removeClass("selected"), $(this).addClass("selected"), tfl.logs.create("tfl.navigation.tabs: " + $(this).find("a").attr("href"))
        })
    }, a.tabs("[data-tabs='true']")
}(window.tfl.navigation = window.tfl.navigation || {}), window.tfl.navigation = window.tfl.navigation || {}, function (a) {
    "use strict";
    tfl.logs.create("tfl.navigation.pagination: loaded"), a.setup = function (b, c, d, e, f) {
        tfl.logs.create("tfl.navigation.pagination: setup");
        var g = e % d > 0 ? Math.floor(e / d) + 1 : Math.floor(e / d), h = g > 5 ? 3 : g;
        f || b.append("<div class='pagination' />"), b.pajinate({items_per_page: d, item_container_id: c, nav_panel_id: ".pagination", num_page_links_to_display: h, nav_label_first: "1", nav_label_prev: "", nav_label_next: "", nav_label_last: g, show_first_last: !0, show_prev_next: !1, abort_on_small_lists: !0}), b.find(".pagination").wrap("<div class='pagination-controls' />"), b.find(".previous_link").prependTo(b.find(".pagination")), b.find(".next_link").appendTo(b.find(".pagination")), a.checkPageLinks(b, g), b.find(".pagination a").click(function () {
            a.checkPageLinks(b, g), $(window).scrollTop() > b.offset().top && window.scrollTo(0, b.offset().top)
        })
    }, a.addMapControls = function (a, b) {
        var c = 1;
        b && (a.find(".page_link").click(function () {
            c = parseInt($(this).attr("data-longdesc"), 10), b.choosePage(c)
        }), a.find(".previous_link").click(function () {
            b.choosePage(--c)
        }), a.find(".next_link").click(function () {
            b.choosePage(++c)
        }), a.find(".first_link").click(function () {
            c = 1, b.choosePage(1)
        }), a.find(".last_link").click(function () {
            a.find(".page_link.last").trigger("click")
        }))
    }, a.checkPageLinks = function (a, b) {
        if (6 > b)a.find(".first_link,.last_link").hide(); else {
            var c = a.find(".page_link");
            if ($(c[0]).hasClass("active_page"))$(c[0]).hide(), $(c[3]).show(), a.find(".next_link").prepend("<span>next-page</span>"), a.find(".previous_link").prepend("<span>previous-page</span>"), a.find(".first_link").addClass("active_page"); else if ($(c[c.length - 1]).hasClass("active_page"))$(c[c.length - 1]).hide(), $(c[c.length - 4]).show(), a.find(".last_link").addClass("active_page"); else for (var d = 2; d < c.length - 2; d++)if ($(c[d]).hasClass("active_page")) {
                $(c[d + 2]).hide(), $(c[d + 1]).show(), $(c[d - 1]).show(), $(c[d - 2]).hide();
                break
            }
        }
    }
}(window.tfl.navigation.pagination = window.tfl.navigation.pagination || {}), function (a) {
    "use strict";
    a.RemoveContentClass = ".remove-content", tfl.logs.create("tfl.removableContent.initRemoveContents: loaded"), a.initRemoveContents = function () {
        tfl.logs.create("tfl.removableContent.initRemoveContents: started");
        var a = $(":input:text").not(".disable-removable-content");
        a.clearSearch({divClass: "remove-content-container", clearClass: "remove-content", linkText: "Clear search"}), a.not(".tt-hint").each(function () {
            "" === $(this).val() && $(this).closest(".remove-content-container").addClass("empty")
        }).on("keyup", function () {
            "" === $(this).val() ? $(this).closest(".remove-content-container").addClass("empty") : $(this).closest(".remove-content-container").removeClass("empty")
        }), $(".remove-content").addClass("hide-text").click(function () {
            var a = $(this).siblings("[data-current-location]");
            0 === a.length && (a = $(this).parent("[data-current-location]")), a.length > 0 && (a.removeAttr("data-current-location"), a.find("input[type='text']").trigger("geolocation-cleared")), $(this).closest(".remove-content-container").addClass("empty")
        })
    }, a.initRemoveContents()
}(window.tfl.removableContent = window.tfl.removableContent || {}), function (a) {
    a.getQueryStringParameter = function (a) {
        var b, c = window.location.search.substring(1), d = c.split("&");
        for (b = 0; b < d.length; b += 1) {
            var e = d[b].split("=");
            if (decodeURIComponent(e[0]) === a)return decodeURIComponent(e[1])
        }
        return null
    }, a.setQueryStringParameter = function (a, b) {
        if (void 0 !== window.history.pushState) {
            var c, d = window.location.search.substring(1), e = d.split("&"), f = !1;
            for (c = 0; c < e.length; c += 1) {
                var g = e[c].split("=");
                if (decodeURIComponent(g[0]) === a) {
                    g[1] = encodeURIComponent(b), e[c] = g.join("="), window.history.pushState({}, "", "?" + e.join("&")), f = !0;
                    break
                }
            }
            f || (0 === d.length ? (d += "?" + encodeURIComponent(a) + "=" + encodeURIComponent(b), window.history.pushState({}, "", d)) : (d += "&" + encodeURIComponent(a) + "=" + encodeURIComponent(b), window.history.pushState({}, "", "?" + d)))
        }
    }, a.removeQueryStringParameter = function (a) {
        if (void 0 !== window.history.pushState) {
            var b, c = window.location.search.substring(1), d = c.split("&"), e = !1;
            for (b = 0; b < d.length; b += 1) {
                var f = d[b].split("=");
                if (decodeURIComponent(f[0]) === a) {
                    d.splice(b, 1), window.history.pushState({}, "", "?" + d.join("&")), e = !0;
                    break
                }
            }
        }
    }, a.measureElementHeight = function (a, b) {
        a.attr("style");
        a.removeAttr("style").css({position: "fixed", left: "-10000px", display: b || "block"});
        var c = a.height();
        return c
    }, a.measureElementWidth = function (a, b) {
        var c = a.attr("style");
        a.removeAttr("style").css({position: "fixed", left: "-10000px", display: b || "block"});
        var d = a.width();
        return a.removeAttr("style").attr("style", c), d
    }, a.makeMVCDate = function (a) {
        function b(a) {
            var b = "";
            return 10 > a && (b += "0"), b += a
        }

        var c = "";
        return c += a.getFullYear() + "-", c += b(a.getMonth() + 1) + "-", c += b(a.getDate()) + "T", c += b(a.getHours()) + ":", c += b(a.getMinutes()) + ":", c += b(a.getSeconds())
    }, a.makeDateFromQueryStringDate = function (a) {
        var b = new Date;
        return b.setDate(a.substring(8, 10)), b.setMonth(a.substring(5, 7) - 1), b.setYear(a.substring(0, 4)), b.setHours(a.substring(11, 13)), b.setMinutes(a.substring(14, 16)), b.setSeconds(a.substring(17, 19)), b
    }, a.getTime = function (a) {
        return(a.getHours() < 10 ? "0" : "") + a.getHours() + ":" + (a.getMinutes() < 10 ? "0" : "") + a.getMinutes()
    }, String.prototype.format || (String.prototype.format = function () {
        var a = arguments;
        return this.replace(/{(\d+)}/g, function (b, c) {
            return"undefined" != typeof a[c] ? a[c] : b
        })
    })
}(window.tfl.tools = window.tfl.tools || {}), function (a) {
    a.init = function () {
        $(".always-visible").off("click.expandableBox").on("click.expandableBox", function () {
            var a = $(this).parent();
            return a.hasClass("expanded") ? (a.removeClass("expanded"), $(this).attr("aria-expanded", "false").trigger("expandable-box.collapsed")) : (a.addClass("expanded"), $(this).attr("aria-expanded", "true").trigger("expandable-box.expanded")), !1
        }).keypress(function (a) {
            13 === a.which && $(this).click()
        })
    }, a.init()
}(window.tfl.expandableBox = window.tfl.expandableBox || {}), function (a) {
    function b(a) {
        var b = a, c = b.parent(), d = b.find(">li"), e = null, f = 0, g = 13, h = [], i = [], j = 0, k = 0, l = 0, m = !1, n = null;
        return{init: function () {
            e = $("<li class='ellipsis hidden'><a href='javascript:void(0)'>...</a></li>"), d.eq(0).after(e), f = e.width(), e.click(this.makeScrollable), d.each(function () {
                var a = $(this).width();
                h.push(a), j += a
            }), j += g, i.push(j);
            for (var a = j, b = 1; b < h.length; b++)a -= h[b], i.push(a + f);
            n = $.proxy(this.onResize, this), $(window).on("resize", n), this.onResize()
        }, onResize: function () {
            if (k = b.width(), j > k) {
                if (k <= i[l])for (m = !0, e.removeClass("hidden"); k <= i[l];)this.hideItem(l), l++; else if (k > i[l])for (; k > i[l];)this.showItem(l), l--
            } else if (m) {
                for (e.addClass("hidden"), m = !1; k >= i[l];)this.showItem(l), l--;
                0 > l && (l = 0)
            }
        }, hideItem: function (a) {
            d.eq(a + 1).hide()
        }, showItem: function (a) {
            d.eq(a + 1).show()
        }, makeScrollable: function () {
            return tfl.utils.isTouchDevice() && (c.addClass("scrolling"), b.css({width: j + "px"})), e.addClass("hidden"), d.each(function () {
                $(this).show()
            }), $(window).off("resize", n), !1
        }}
    }

    a.init = function () {
        var a = $("ul.breadcrumbs");
        $("ul.breadcrumbs").each(function () {
            a = $(this), new b(a).init()
        })
    }, a.init()
}(window.tfl.breadcrumb = window.tfl.breadcrumb || {}), function (a) {
    a.init = function (a) {
        $(a).each(function () {
            var a = $(this);
            a.wrap('<div class="fc-calendar-wrapper clearfix" />');
            var b = a.parent(), c = a.calendario({weekabbrs: ["S", "M", "T", "W", "T", "F", "S"], displayWeekAbbr: !0, month: a.attr("data-month"), year: a.attr("data-year")});
            b.prepend("<div class='current-month'><a href='javascript:void(0);' class='calendar-previous-month hide-text'>Previous month</a><span class='calendar-month'>" + c.getMonthName() + "</span> <span class='calendar-year'>" + c.getYear() + "</span><a href='javascript:void(0);' class='calendar-next-month hide-text'>Next month</a></div>"), b.find(".calendar-next-month").on("click", function () {
                $(this).hasClass("disabled") || c.gotoNextMonth(function () {
                    f(), a.attr("data-month", c.getMonth()), a.attr("data-year", c.getYear()), $(window).trigger("calendar-next-month")
                })
            }), b.find(".calendar-previous-month").on("click", function () {
                $(this).hasClass("disabled") || c.gotoPreviousMonth(function () {
                    f(), a.attr("data-month", c.getMonth()), a.attr("data-year", c.getYear()), $(window).trigger("calendar-previous-month")
                })
            });
            var d = b.find(".calendar-month"), e = b.find(".calendar-year"), f = function () {
                d.html(c.getMonthName()), e.html(c.getYear())
            }
        })
    }, a.init(".fc-calendar-container")
}(window.tfl.calendar = window.tfl.calendar || {}), function (a) {
    a.allTables = [], a.tableCellPadding = 5, a.tableShadowWidth = 15, a.ResponsiveTable = function (b) {
        var c = b, d = $(c).parent(), e = null, f = null, g = null, h = null, i = !1, j = null, k = null, l = null, m = null, n = null, o = 0, p = 0, q = 0, r = !1, s = null, t = 0, u = 0;
        return{init: function () {
            var a = this;
            a.onResize(), d.scroll(a.onParentScroll), $(d).closest(".expandable-box").length && $(d).closest(".expandable-box").find(".always-visible").on("click", function () {
                a.onResize()
            })
        }, onResize: function () {
            var b = this.isVisible;
            this.isVisible = $(d).is(":visible") ? !0 : !1, !b && this.isVisible && (this.stopHiding(), this.startHiding());
            var j = $(d).offset();
            if (e = j.left, f = j.top, g = $(c).width(), h = $(c).height(), l = $(d).width(), n) {
                o = n.height() ? n.height() : o;
                var k = $(c).offset();
                p = k.top, q = k.left, i && (n.parent().css({width: l, left: e}), this.onWindowScroll($(window).scrollTop()))
            }
            s && (t = s.width() - 2 * a.tableCellPadding), g > l ? i ? (m = g - l, this.onParentScroll()) : this.startHiding() : i && this.stopHiding()
        }, onWindowScroll: function (a) {
            var b = $(d).offset();
            e = b.left, f = b.top, i && !r && a > f && f + h - o >= a ? (r = !0, $(n).css({marginLeft: -1 * $(d).scrollLeft()}), $(n).parent().removeClass("hidden")) : r && (f >= a || a > f + h - o) && (r = !1, $(n).parent().addClass("hidden"))
        }, onParentScroll: function () {
            var b = $(d).scrollLeft();
            $(n).css({marginLeft: -1 * b}), j.css({left: t + 2 * a.tableCellPadding - a.tableShadowWidth + Math.min(b, a.tableShadowWidth)});
            var c = Math.min(m - b, a.tableShadowWidth) - a.tableShadowWidth;
            c === -1 * a.tableShadowWidth && c++, k.css({right: c})
        }, startHiding: function () {
            i = !0, d.addClass("hiding"), d.children(".hiding-table").length > 0 ? (n.css({width: g}), d.children(".hiding-table").show()) : this.createFixedHeadings(), d.parent().addClass("hiding")
        }, stopHiding: function () {
            i = !1, d.removeClass("hiding"), d.parent().removeClass("hiding"), d.parent().find(".hiding-table").hide(), r = !1, $(n).parent().addClass("hidden")
        }, createFixedHeadings: function () {
            g = $(c).width(), n = $("<table class='first-row'></table>");
            var b = $(c).find("tr:first-child");
            o = b.height(), n.append(b.clone().css({height: o, width: g})), n.find("th").replaceWith(function () {
                return $("<td />", {html: $(this).html()})
            });
            var e = b.find("th, td");
            $(n).find("th, td").each(function (a) {
                0 === a && $(this).html("<span>" + $(this).html() + "</span>"), $(this).width($(e.get(a)).width())
            }), s = $("<table class='hiding-table first-col'></table>").css({top: 0}), t = 0, u = 0, $(c).find("th:first-child,td:first-child").each(function (a) {
                0 === a && (t = $(this).width(), u = $(this).offset().left);
                var b = $("<tr></tr>");
                b.append($(this).clone().css({height: $(this).height()})), s.append(b)
            }), d.wrap("<div class='responsive-table-wrapper'></div>"), d.parent().append(s.css({width: t, position: "absolute"})), n.wrap("<div class='hidden'></div>"), s.after(n.css({width: g}).parent().css({overflow: "hidden", width: l, position: "fixed", top: 0, boxShadow: "0px 5px 5px -3px rgba(0, 0, 0, 0.3)"})), h = $(c).height(), p = $(n).parent().offset().top, q = $(c).offset().left, j = $("<div class='responsive-table-shadow left-shadow' />"), j.css({left: t + 2 * a.tableCellPadding - a.tableShadowWidth, height: h}), k = $("<div class='responsive-table-shadow right-shadow' />"), k.css({right: 0, height: h}), s.before(j), s.before(k), m = g - l, this.onWindowScroll($(window).scrollTop())
        }}
    }, a.init = function (b) {
        $(b).each(function () {
            var b = new a.ResponsiveTable(this);
            b.init(), a.allTables.push(b)
        }), a.allTables.length > 0 && ($(window).resize(function () {
            for (var b = 0; b < a.allTables.length; b++)a.allTables[b].onResize()
        }), $(window).scroll(function () {
            for (var b = $(this).scrollTop(), c = 0; c < a.allTables.length; c++)a.allTables[c].onWindowScroll(b)
        }))
    }, a.init(".table-container table")
}(window.tfl.responsiveTables = window.tfl.responsiveTables || {}), function (a) {
    function b(a) {
        var b = $('<div id="' + m.id + '"></div>');
        return a || (f = $('<button id="close-fullscreen-stage" class="fullscreen-stage-button"><span class="icon close-icon"></span></button>'), b.append(f), f.on("click", d)), $(document.body).append(b), h = !0, b
    }

    function c(b) {
        tfl.logs.create("tfl.fullscreen: enter fullscreen stage"), a.addItemToStage(b), $(document.body).addClass(m.stageActiveClass), $(window).trigger("enter-fullscreen-stage"), k && 1 === g.length && ($(document.body).addClass("panzoom"), tfl.zoomableContent.init(b))
    }

    function d() {
        tfl.logs.create("tfl.fullscreen: exit fullscreen stage");
        for (var a, b = g.length - 1; b >= 0; b--)a = g[b], j[b] ? i[b].append(a) : i[b].before(a);
        g = [], i = [], j = [], k && ($(document.body).removeClass("panzoom"), a.trigger("destroy-panzoom")), $(document.body).removeClass(m.stageActiveClass), $(window).trigger("exit-fullscreen-stage")
    }

    tfl.logs.create("tfl.fullscreen stage: loaded");
    var e, f, g = [], h = !1, i = [], j = [], k = !1, l = 0, m = {id: "fullscreen-stage", stageActiveClass: "stage-active"};
    a.addItemToStage = function (a) {
        if (!e)return void tfl.logs.create("tfl.fullscreen: Tried to add item to stage before stage was initialised");
        var b = a.next();
        0 === b.length ? (i[i.length] = a.parent(), j[j.length] = !0) : (i[i.length] = b, j[j.length] = !1), g.push(a), e.append(a)
    }, a.hide = function () {
        0 !== g.length && d(), document.body.scrollTop = l
    }, a.display = function (a, f, i) {
        h || (e = b(i || !1)), k = f, 0 !== g.length && d(), l = document.body.scrollTop, c(a)
    }
}(window.tfl.fullscreen = window.tfl.fullscreen || {}), function (a) {
    "use strict";
    tfl.logs.create("tfl.listToDropdown: loaded");
    var b, c;
    a.init = function () {
        tfl.logs.create("tfl.listToDropdown: initialised"), a.buildHtmlDropdown(), a.dropDownMouseFunctionality(), a.hideShowList(), a.datePickerDropdownBuilding()
    }, a.buildHtmlDropdown = function () {
        $(".links-list").each(function () {
            var b = $(this);
            b.addClass("hidden");
            var c = b.data("dropdown-target"), d = b.data("dropdown-label"), e = b.data("selected-item-id"), f = b.data("dropdown-option"), g = "";
            "date-dropdown-placeholder" === c && (g = "datepicker-dropdown", b.addClass(g)), b.find('li[data-item-id="' + e + '"]').hide(), b.wrap('<div class="for-dropdown" />'), b.parent().prepend("gla-list" === b.attr("id") ? '<div role="button" tabindex="0"  class="dropdown-button ' + f + " dropdown-closed " + g + '"><img src="/static/cms/images/MoL.png" alt="Mayor of London"><span class="mol-gla">GLA</span></div>' : '<div tabindex="0" role="button" aria-label="' + d + '" class="dropdown-button ' + f + " dropdown-closed " + g + '" >' + e + "</div>"), $("." + c).append(b.parent()), "gla-list" === b.attr("id") && b.attr("id") || $(b).find("li:visible:first").css("border-top", "solid 1px #cacaca"), b.siblings(".dropdown-button").click(function () {
                a.hideShowList(b.siblings(".dropdown-button"))
            }).keypress(function (a) {
                13 === a.which && $(this).click()
            })
        })
    }, a.hideShowList = function (a) {
        $(a).hasClass("dropdown-closed") && (clearTimeout(b), b = 0, c = void 0, $('ul.links-list:not(".hidden")').addClass("hidden").prev(".dropdown-button").addClass("dropdown-closed")), $(a).next("ul.links-list").toggleClass("hidden"), $("ul.links-list li:visible:first").css("border-top-width", "1px"), $(a).toggleClass("dropdown-closed"), clearTimeout(b), b = 0, c = void 0
    }, a.dropDownMouseFunctionality = function () {
        $(".for-dropdown").on("mouseleave", function () {
            var d = $(this);
            c = d, b = setTimeout(function () {
                d.children(".dropdown-button").hasClass("dropdown-closed") || a.hideShowList(d.children(".dropdown-button"))
            }, 500)
        }).on("mouseenter", function () {
            b && $(this).is(c) && (clearTimeout(b), b = 0, c = void 0)
        })
    }, a.datePickerDropdownBuilding = function () {
        $(".advance-month-container").parent().addClass("no-hover")
    }, a.init()
}(window.tfl.listToDropdown = window.tfl.listToDropdown || {}), function (a) {
    tfl.logs.create("tfl.search-icon-toggle: loaded");
    var b = $(".search-tools input:text"), c = $("#search-button"), d = $(".search-tools a.remove-content");
    a.toggleSearchIcon = function () {
        0 === b.val().length ? c.show() : c.hide()
    }, a.h1Fix = function () {
        var a = $(".search-title"), b = $(".dots").length;
        0 === b && a.append("<span class='hero-headline dots visually-hidden'>...</span>"), a.css("display", "inline-block");
        var c = a.outerWidth(), d = a.parent().outerWidth();
        d = .95 * d, d -= 20, c > d ? (a.css("display", "block"), $(".dots").removeClass("visually-hidden")) : (a.css("display", "inline-block"), $(".dots").addClass("visually-hidden"))
    }, a.toggleSearchIcon(), a.h1Fix(), b.on("keyup", a.toggleSearchIcon), d.on("click", a.toggleSearchIcon), $(window).on("resize", a.h1Fix)
}(window.tfl.searchIcon = window.tfl.searchIcon || {});