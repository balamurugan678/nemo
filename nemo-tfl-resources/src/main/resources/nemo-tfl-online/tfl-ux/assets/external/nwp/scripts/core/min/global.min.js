/* appendAround markup pattern. [c]2012, @scottjehl, Filament Group, Inc. MIT/GPL
 how-to:
 1. Insert potential element containers throughout the DOM
 2. give each container a data-set attribute with a value that matches all other containers' values
 3. Place your appendAround content in one of the potential containers
 4. Call appendAround() on that element when the DOM is ready
 */
(function (a) {
    a.fn.appendAround = function () {
        return this.each(function () {
            var b = a(this), e = "data-set", c = a("[" + e + "='" + b.closest("[" + e + "]").attr(e) + "']");

            function d() {
                if (b.is(":hidden")) {
                    b.appendTo(c.filter(":visible:eq(0)"))
                }
                a(window).trigger("append-around-complete")
            }

            d();
            a(window).on("changeBreakpoint", d)
        })
    }
}(jQuery));
(function (a) {
    var c = 0;
    var b = null;
    var d = null;
    a.fn.resetBreakpoints = function () {
        a(window).unbind("resize");
        c = 0
    };
    a.fn.setBreakpoints = function (f) {
        var e = jQuery.extend({distinct: true, useInnerWidth: true, breakpoints: [
            {name: "Small", resolution: 10},
            {name: "Medium", resolution: 580},
            {name: "Large", resolution: 900}
        ]}, f);
        d = e.breakpoints.sort(function (g, h) {
            return(h.resolution - g.resolution)
        });
        a(window).on("resize", function () {
            var l;
            if ("innerWidth" in window) {
                l = window.innerWidth
            } else {
                l = a(window).width()
            }
            var k = false;
            var h = false;
            for (var g in d) {
                var j = e.breakpoints[g].resolution;
                if (!k && l >= j && c < j) {
                    if (e.distinct) {
                        for (var m in d) {
                            if (a("body").hasClass("breakpoint-" + e.breakpoints[m].name)) {
                                a("body").removeClass("breakpoint-" + e.breakpoints[m].name);
                                a(window).trigger("exitBreakpoint" + e.breakpoints[m].name)
                            }
                        }
                        k = true
                    }
                    a("body").addClass("breakpoint-" + e.breakpoints[g].name);
                    a(window).trigger("enterBreakpoint" + e.breakpoints[g].name);
                    h = true
                }
                if (l < e.breakpoints[g].resolution && c >= e.breakpoints[g].resolution) {
                    a("body").removeClass("breakpoint-" + e.breakpoints[g].name);
                    a(window).trigger("exitBreakpoint" + e.breakpoints[g].name);
                    h = true
                }
                if (e.distinct && l >= e.breakpoints[g].resolution && l < e.breakpoints[g - 1].resolution && c > l && c > 0 && !a("body").hasClass("breakpoint-" + e.breakpoints[g].name)) {
                    a("body").addClass("breakpoint-" + e.breakpoints[g].name);
                    a(window).trigger("enterBreakpoint" + e.breakpoints[g].name);
                    h = true
                }
            }
            if (h) {
                a(window).trigger("changeBreakpoint")
            }
            if (c != l) {
                c = l
            }
        });
        a(window).resize()
    }
})(jQuery);
/* jQuery UI - v1.10.1 - 2013-02-15
 * http://jqueryui.com
 * Includes: jquery.ui.core.js
 * Copyright 2013 jQuery Foundation and other contributors; Licensed MIT */
(function (a, g) {
    function b(l, h) {
        var k, e, j, m = l.nodeName.toLowerCase();
        return"area" === m ? (k = l.parentNode, e = k.name, !l.href || !e || k.nodeName.toLowerCase() !== "map" ? !1 : (j = a("img[usemap=#" + e + "]")[0], !!j && f(j))) : (/input|select|textarea|button|object/.test(m) ? !l.disabled : "a" === m ? l.href || h : h) && f(l)
    }

    function f(e) {
        return a.expr.filters.visible(e) && !a(e).parents().addBack().filter(function () {
            return a.css(this, "visibility") === "hidden"
        }).length
    }

    var c = 0, d = /^ui-id-\d+$/;
    a.ui = a.ui || {};
    if (a.ui.version) {
        return
    }
    a.extend(a.ui, {version: "1.10.1", keyCode: {BACKSPACE: 8, COMMA: 188, DELETE: 46, DOWN: 40, END: 35, ENTER: 13, ESCAPE: 27, HOME: 36, LEFT: 37, NUMPAD_ADD: 107, NUMPAD_DECIMAL: 110, NUMPAD_DIVIDE: 111, NUMPAD_ENTER: 108, NUMPAD_MULTIPLY: 106, NUMPAD_SUBTRACT: 109, PAGE_DOWN: 34, PAGE_UP: 33, PERIOD: 190, RIGHT: 39, SPACE: 32, TAB: 9, UP: 38}}), a.fn.extend({_focus: a.fn.focus, focus: function (h, e) {
        return typeof h == "number" ? this.each(function () {
            var j = this;
            setTimeout(function () {
                a(j).focus(), e && e.call(j)
            }, h)
        }) : this._focus.apply(this, arguments)
    }, scrollParent: function () {
        var e;
        return a.ui.ie && /(static|relative)/.test(this.css("position")) || /absolute/.test(this.css("position")) ? e = this.parents().filter(function () {
            return/(relative|absolute|fixed)/.test(a.css(this, "position")) && /(auto|scroll)/.test(a.css(this, "overflow") + a.css(this, "overflow-y") + a.css(this, "overflow-x"))
        }).eq(0) : e = this.parents().filter(function () {
            return/(auto|scroll)/.test(a.css(this, "overflow") + a.css(this, "overflow-y") + a.css(this, "overflow-x"))
        }).eq(0), /fixed/.test(this.css("position")) || !e.length ? a(document) : e
    }, zIndex: function (h) {
        if (h !== g) {
            return this.css("zIndex", h)
        }
        if (this.length) {
            var j = a(this[0]), e, k;
            while (j.length && j[0] !== document) {
                e = j.css("position");
                if (e === "absolute" || e === "relative" || e === "fixed") {
                    k = parseInt(j.css("zIndex"), 10);
                    if (!isNaN(k) && k !== 0) {
                        return k
                    }
                }
                j = j.parent()
            }
        }
        return 0
    }, uniqueId: function () {
        return this.each(function () {
            this.id || (this.id = "ui-id-" + ++c)
        })
    }, removeUniqueId: function () {
        return this.each(function () {
            d.test(this.id) && a(this).removeAttr("id")
        })
    }}), a.extend(a.expr[":"], {data: a.expr.createPseudo ? a.expr.createPseudo(function (e) {
        return function (h) {
            return !!a.data(h, e)
        }
    }) : function (j, e, h) {
        return !!a.data(j, h[3])
    }, focusable: function (e) {
        return b(e, !isNaN(a.attr(e, "tabindex")))
    }, tabbable: function (j) {
        var e = a.attr(j, "tabindex"), h = isNaN(e);
        return(h || e >= 0) && b(j, !h)
    }}), a("<a>").outerWidth(1).jquery || a.each(["Width", "Height"], function (h, k) {
        function m(u, o, p, q) {
            return a.each(e, function () {
                o -= parseFloat(a.css(u, "padding" + this)) || 0, p && (o -= parseFloat(a.css(u, "border" + this + "Width")) || 0), q && (o -= parseFloat(a.css(u, "margin" + this)) || 0)
            }), o
        }

        var e = k === "Width" ? ["Left", "Right"] : ["Top", "Bottom"], l = k.toLowerCase(), j = {innerWidth: a.fn.innerWidth, innerHeight: a.fn.innerHeight, outerWidth: a.fn.outerWidth, outerHeight: a.fn.outerHeight};
        a.fn["inner" + k] = function (o) {
            return o === g ? j["inner" + k].call(this) : this.each(function () {
                a(this).css(l, m(this, o) + "px")
            })
        }, a.fn["outer" + k] = function (p, o) {
            return typeof p != "number" ? j["outer" + k].call(this, p) : this.each(function () {
                a(this).css(l, m(this, p, !0, o) + "px")
            })
        }
    }), a.fn.addBack || (a.fn.addBack = function (h) {
        return this.add(h == null ? this.prevObject : this.prevObject.filter(h))
    }), a("<a>").data("a-b", "a").removeData("a-b").data("a-b") && (a.fn.removeData = function (e) {
        return function (h) {
            return arguments.length ? e.call(this, a.camelCase(h)) : e.call(this)
        }
    }(a.fn.removeData)), a.ui.ie = !!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()), a.support.selectstart = "onselectstart" in document.createElement("div"), a.fn.extend({disableSelection: function () {
        return this.bind((a.support.selectstart ? "selectstart" : "mousedown") + ".ui-disableSelection", function (h) {
            h.preventDefault()
        })
    }, enableSelection: function () {
        return this.unbind(".ui-disableSelection")
    }}), a.extend(a.ui, {plugin: {add: function (l, h, j) {
        var e, k = a.ui[l].prototype;
        for (e in j) {
            k.plugins[e] = k.plugins[e] || [], k.plugins[e].push([h, j[e]])
        }
    }, call: function (h, m, k) {
        var l, j = h.plugins[m];
        if (!j || !h.element[0].parentNode || h.element[0].parentNode.nodeType === 11) {
            return
        }
        for (l = 0; l < j.length; l++) {
            h.options[j[l][0]] && j[l][1].apply(h.element, k)
        }
    }}, hasScroll: function (k, h) {
        if (a(k).css("overflow") === "hidden") {
            return !1
        }
        var j = h && h === "left" ? "scrollLeft" : "scrollTop", e = !1;
        return k[j] > 0 ? !0 : (k[j] = 1, e = k[j] > 0, k[j] = 0, e)
    }})
})(jQuery);
/*
 * jQuery Cookie Plugin v1.3
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2011, Klaus Hartl
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.opensource.org/licenses/GPL-2.0
 */
(function (a, d, g) {
    var e = /\+/g;

    function f(h) {
        return h
    }

    function c(h) {
        return decodeURIComponent(h.replace(e, " "))
    }

    var b = a.cookie = function (o, u, q) {
        if (u !== g) {
            q = a.extend({}, b.defaults, q);
            if (u === null) {
                q.expires = -1
            }
            if (typeof q.expires === "number") {
                var k = q.expires, s = q.expires = new Date();
                s.setDate(s.getDate() + k)
            }
            u = b.json ? JSON.stringify(u) : String(u);
            return(d.cookie = [encodeURIComponent(o), "=", b.raw ? u : encodeURIComponent(u), q.expires ? "; expires=" + q.expires.toUTCString() : "", q.path ? "; path=" + q.path : "", q.domain ? "; domain=" + q.domain : "", q.secure ? "; secure" : ""].join(""))
        }
        var m = b.raw ? f : c;
        var j = d.cookie.split("; ");
        for (var n = 0, p = j.length; n < p; n++) {
            var r = j[n].split("=");
            if (m(r.shift()) === o) {
                var h = m(r.join("="));
                return b.json ? JSON.parse(h) : h
            }
        }
        return null
    };
    b.defaults = {};
    a.removeCookie = function (h, j) {
        if (a.cookie(h) !== null) {
            a.cookie(h, null, j);
            return true
        }
        return false
    }
})(jQuery, document);
(function (a) {
    a.fn.pajinate = function (q) {
        var f = "current_page";
        var j = "items_per_page";
        var n;
        var g = {item_container_id: ".content", items_per_page: 10, nav_panel_id: ".page_navigation", nav_info_id: ".info_text", num_page_links_to_display: 20, start_page: 0, wrap_around: false, nav_label_first: "First", nav_label_prev: "Prev", nav_label_next: "Next", nav_label_last: "Last", nav_order: ["first", "prev", "num", "next", "last"], nav_label_info: "Showing {0}-{1} of {2} results", show_first_last: true, abort_on_small_lists: false, jquery_ui: false, jquery_ui_active: "ui-state-highlight", jquery_ui_default: "ui-state-default", jquery_ui_disabled: "ui-state-disabled"};
        var q = a.extend(g, q);
        var b;
        var e;
        var c;
        var d;
        var v;
        var l = q.jquery_ui ? q.jquery_ui_default : "";
        var k = q.jquery_ui ? q.jquery_ui_active : "";
        var m = q.jquery_ui ? q.jquery_ui_disabled : "";
        return this.each(function () {
            e = a(this);
            b = a(this).find(q.item_container_id);
            c = e.find(q.item_container_id).children();
            if (q.abort_on_small_lists && q.items_per_page >= c.size()) {
                return e
            }
            n = e;
            n.data(f, 0);
            n.data(j, q.items_per_page);
            var F = b.children().size();
            var E = Math.ceil(F / q.items_per_page);
            var C = '<span class="ellipse more">...</span>';
            var B = '<span class="ellipse less">...</span>';
            var y = !q.show_first_last ? "" : '<a class="first_link ' + l + '" href="">' + q.nav_label_first + "</a>";
            var A = !q.show_first_last ? "" : '<a class="last_link ' + l + '" href="">' + q.nav_label_last + "</a>";
            var D = "";
            for (var z = 0; z < q.nav_order.length; z++) {
                switch (q.nav_order[z]) {
                    case"first":
                        D += y;
                        break;
                    case"last":
                        D += A;
                        break;
                    case"next":
                        D += '<a id="next-link" class="next_link hide-text ' + l + '" href="">' + q.nav_label_next + "</a>";
                        break;
                    case"prev":
                        D += '<a id="prev-link" class="previous_link hide-text ' + l + '" href="">' + q.nav_label_prev + "</a>";
                        break;
                    case"num":
                        D += B;
                        var w = 0;
                        while (E > w) {
                            D += '<a class="page_link ' + l + '" href="" data-longdesc="' + w + '">' + (w + 1) + "</a>";
                            w++
                        }
                        D += C;
                        break;
                    default:
                        break
                }
            }
            d = e.find(q.nav_panel_id);
            d.html(D).each(function () {
                a(this).find(".page_link:first").addClass("first");
                a(this).find(".page_link:last").addClass("last")
            });
            d.children(".ellipse").hide();
            d.find(".previous_link").next().next().addClass("active_page " + k);
            c.hide();
            c.slice(0, n.data(j)).show();
            v = e.find(q.nav_panel_id + ":first").children(".page_link").size();
            q.num_page_links_to_display = Math.min(q.num_page_links_to_display, v);
            d.children(".page_link").hide();
            d.each(function () {
                a(this).children(".page_link").slice(0, q.num_page_links_to_display).show()
            });
            e.find(".first_link").click(function (G) {
                G.preventDefault();
                p(a(this), 0);
                h(0)
            });
            e.find(".last_link").click(function (G) {
                G.preventDefault();
                var H = v - 1;
                o(a(this), H);
                h(H)
            });
            e.find(".previous_link").click(function (G) {
                G.preventDefault();
                s(a(this))
            });
            e.find(".next_link").click(function (G) {
                G.preventDefault();
                r(a(this))
            });
            e.find(".page_link").click(function (G) {
                G.preventDefault();
                h(a(this).attr("data-longdesc"))
            });
            h(parseInt(q.start_page));
            u();
            if (!q.wrap_around) {
                t()
            }
        });
        function s(w) {
            new_page = parseInt(n.data(f)) - 1;
            if (a(w).siblings(".active_page").prev(".page_link").length == true) {
                p(w, new_page);
                h(new_page)
            } else {
                if (q.wrap_around) {
                    h(v - 1)
                }
            }
        }

        function r(w) {
            new_page = parseInt(n.data(f)) + 1;
            if (a(w).siblings(".active_page").next(".page_link").length == true) {
                o(w, new_page);
                h(new_page)
            } else {
                if (q.wrap_around) {
                    h(0)
                }
            }
        }

        function h(B) {
            B = parseInt(B, 10);
            var z = parseInt(n.data(j));
            start_from = B * z;
            end_on = start_from + z;
            var A = c.hide().slice(start_from, end_on);
            A.show();
            e.find(q.nav_panel_id).children(".page_link[data-longdesc=" + B + "]").addClass("active_page " + k).siblings(".active_page").removeClass("active_page " + k);
            n.data(f, B);
            var w = parseInt(n.data(f) + 1);
            var C = b.children().size();
            var y = Math.ceil(C / q.items_per_page);
            e.find(q.nav_info_id).html(q.nav_label_info.replace("{0}", start_from + 1).replace("{1}", start_from + A.length).replace("{2}", c.length).replace("{3}", w).replace("{4}", y));
            u();
            t();
            if (typeof(q.onPageDisplayed) !== "undefined") {
                q.onPageDisplayed.call(this, B + 1)
            }
        }

        function o(y, z) {
            var A = z;
            var w = a(y).siblings(".active_page");
            if (w.siblings(".page_link[data-longdesc=" + A + "]").css("display") == "none") {
                d.each(function () {
                    a(this).children(".page_link").hide().slice(parseInt(A - q.num_page_links_to_display + 1), A + 1).show()
                })
            }
        }

        function p(y, z) {
            var A = z;
            var w = a(y).siblings(".active_page");
            if (w.siblings(".page_link[data-longdesc=" + A + "]").css("display") == "none") {
                d.each(function () {
                    a(this).children(".page_link").hide().slice(A, A + parseInt(q.num_page_links_to_display)).show()
                })
            }
        }

        function u() {
            if (!d.children(".page_link:visible").hasClass("last")) {
                d.children(".more").show()
            } else {
                d.children(".more").hide()
            }
            if (!d.children(".page_link:visible").hasClass("first")) {
                d.children(".less").show()
            } else {
                d.children(".less").hide()
            }
        }

        function t() {
            if (d.children(".last").hasClass("active_page")) {
                d.children(".next_link").add(".last_link").addClass("no_more " + m)
            } else {
                d.children(".next_link").add(".last_link").removeClass("no_more " + m)
            }
            if (d.children(".first").hasClass("active_page")) {
                d.children(".previous_link").add(".first_link").addClass("no_more " + m)
            } else {
                d.children(".previous_link").add(".first_link").removeClass("no_more " + m)
            }
        }
    }
})(jQuery);
(function (a) {
    a.fn.clearSearch = function (b) {
        var c = a.extend({clearClass: "clear_input", divClass: this.clearClass + "_div", focusAfterClear: true, linkText: "&times;", distanceFromEdge: 5}, b);
        return this.each(function () {
            var d = a(this), e;
            if (!d.parent().hasClass(c.divClass)) {
                d.wrap('<div style="position: relative;" class="' + c.divClass + '">' + d.html() + "</div>");
                d.after('<a href="javascript:void(0)" style="position: absolute; cursor: pointer;" class="' + c.clearClass + '">' + c.linkText + "</a>")
            }
            e = d.next();
            function f() {
                d.val("").change();
                h();
                if (c.focusAfterClear) {
                    d.focus()
                }
                if (typeof(c.callback) === "function") {
                    c.callback()
                }
            }

            function h() {
                if (g()) {
                    e.show()
                } else {
                    e.hide()
                }
                j()
            }

            function g() {
                return d.val().replace(/^\s+|\s+$/g, "").length > 0
            }

            function j() {
                var k = d.outerHeight();
                e.css({top: k / 2 - e.height() / 2, right: c.distanceFromEdge})
            }

            e.on("click", f);
            d.on("keyup keydown change focus", h);
            h()
        })
    }
})(jQuery);
var Hogan = {};
(function (c, m) {
    c.Template = function (p, q, n, o) {
        this.r = p || this.r;
        this.c = n;
        this.options = o;
        this.text = q || "";
        this.buf = (m) ? [] : ""
    };
    c.Template.prototype = {r: function (n, p, o) {
        return""
    }, v: d, t: a, render: function h(n, p, o) {
        return this.ri([n], p || {}, o)
    }, ri: function (n, p, o) {
        return this.r(n, p, o)
    }, rp: function (p, n, r, o) {
        var q = r[p];
        if (!q) {
            return""
        }
        if (this.c && typeof q == "string") {
            q = this.c.compile(q, this.options)
        }
        return q.ri(n, r, o)
    }, rs: function (n, p, q) {
        var r = n[n.length - 1];
        if (!e(r)) {
            q(n, p, this);
            return
        }
        for (var o = 0; o < r.length; o++) {
            n.push(r[o]);
            q(n, p, this);
            n.pop()
        }
    }, s: function (u, n, q, p, s, o, t) {
        var r;
        if (e(u) && u.length === 0) {
            return false
        }
        if (typeof u == "function") {
            u = this.ls(u, n, q, p, s, o, t)
        }
        r = (u === "") || !!u;
        if (!p && r && n) {
            n.push((typeof u == "object") ? u : n[n.length - 1])
        }
        return r
    }, d: function (q, n, s, t) {
        var r = q.split("."), u = this.f(r[0], n, s, t), o = null;
        if (q === "." && e(n[n.length - 2])) {
            return n[n.length - 1]
        }
        for (var p = 1; p < r.length; p++) {
            if (u && typeof u == "object" && r[p] in u) {
                o = u;
                u = u[r[p]]
            } else {
                u = ""
            }
        }
        if (t && !u) {
            return false
        }
        if (!t && typeof u == "function") {
            n.push(o);
            u = this.lv(u, n, s);
            n.pop()
        }
        return u
    }, f: function (q, n, r, s) {
        var u = false, t = null, o = false;
        for (var p = n.length - 1; p >= 0; p--) {
            t = n[p];
            if (t && typeof t == "object" && q in t) {
                u = t[q];
                o = true;
                break
            }
        }
        if (!o) {
            return(s) ? false : ""
        }
        if (!s && typeof u == "function") {
            u = this.lv(u, n, r)
        }
        return u
    }, ho: function (t, o, q, s, r) {
        var n = this.c;
        var p = this.options;
        p.delimiters = r;
        var s = t.call(o, s);
        s = (s == null) ? String(s) : s.toString();
        this.b(n.compile(s, p).render(o, q));
        return false
    }, b: (m) ? function (n) {
        this.buf.push(n)
    } : function (n) {
        this.buf += n
    }, fl: (m) ? function () {
        var n = this.buf.join("");
        this.buf = [];
        return n
    } : function () {
        var n = this.buf;
        this.buf = "";
        return n
    }, ls: function (w, n, r, q, s, p, v) {
        var o = n[n.length - 1], u = null;
        if (!q && this.c && w.length > 0) {
            return this.ho(w, o, r, this.text.substring(s, p), v)
        }
        u = w.call(o);
        if (typeof u == "function") {
            if (q) {
                return true
            } else {
                if (this.c) {
                    return this.ho(u, o, r, this.text.substring(s, p), v)
                }
            }
        }
        return u
    }, lv: function (r, n, p) {
        var o = n[n.length - 1];
        var q = r.call(o);
        if (typeof q == "function") {
            q = a(q.call(o));
            if (this.c && ~q.indexOf("{\u007B")) {
                return this.c.compile(q, this.options).render(o, p)
            }
        }
        return a(q)
    }};
    var f = /&/g, k = /</g, j = />/g, g = /\'/g, l = /\"/g, b = /[&<>\"\']/;

    function a(n) {
        return String((n === null || n === undefined) ? "" : n)
    }

    function d(n) {
        n = a(n);
        return b.test(n) ? n.replace(f, "&amp;").replace(k, "&lt;").replace(j, "&gt;").replace(g, "&#39;").replace(l, "&quot;") : n
    }

    var e = Array.isArray || function (n) {
        return Object.prototype.toString.call(n) === "[object Array]"
    }
})(typeof exports !== "undefined" ? exports : Hogan);
(function (e) {
    var l = /\S/, n = /\"/g, m = /\n/g, k = /\r/g, o = /\\/g, s = {"#": 1, "^": 2, "/": 3, "!": 4, ">": 5, "<": 6, "=": 7, _v: 8, "{": 9, "&": 10};
    e.scan = function p(R, D) {
        var J = R.length, I = 0, H = 1, G = 2, O = I, Q = null, P = null, A = "", S = [], N = false, F = 0, L = 0, M = "{{", C = "}}";

        function z() {
            if (A.length > 0) {
                S.push(new String(A));
                A = ""
            }
        }

        function K() {
            var T = true;
            for (var U = L; U < S.length; U++) {
                T = (S[U].tag && s[S[U].tag] < s._v) || (!S[U].tag && S[U].match(l) === null);
                if (!T) {
                    return false
                }
            }
            return T
        }

        function E(T, W) {
            z();
            if (T && K()) {
                for (var U = L, V; U < S.length; U++) {
                    if (!S[U].tag) {
                        if ((V = S[U + 1]) && V.tag == ">") {
                            V.indent = S[U].toString()
                        }
                        S.splice(U, 1)
                    }
                }
            } else {
                if (!W) {
                    S.push({tag: "\n"})
                }
            }
            N = false;
            L = S.length
        }

        function B(X, W) {
            var T = "=" + C, U = X.indexOf(T, W), V = u(X.substring(X.indexOf("=", W) + 1, U)).split(" ");
            M = V[0];
            C = V[1];
            return U + T.length - 1
        }

        if (D) {
            D = D.split(" ");
            M = D[0];
            C = D[1]
        }
        for (F = 0; F < J; F++) {
            if (O == I) {
                if (r(M, R, F)) {
                    --F;
                    z();
                    O = H
                } else {
                    if (R.charAt(F) == "\n") {
                        E(N)
                    } else {
                        A += R.charAt(F)
                    }
                }
            } else {
                if (O == H) {
                    F += M.length - 1;
                    P = s[R.charAt(F + 1)];
                    Q = P ? R.charAt(F + 1) : "_v";
                    if (Q == "=") {
                        F = B(R, F);
                        O = I
                    } else {
                        if (P) {
                            F++
                        }
                        O = G
                    }
                    N = F
                } else {
                    if (r(C, R, F)) {
                        S.push({tag: Q, n: u(A), otag: M, ctag: C, i: (Q == "/") ? N - C.length : F + M.length});
                        A = "";
                        F += C.length - 1;
                        O = I;
                        if (Q == "{") {
                            if (C == "}}") {
                                F++
                            } else {
                                c(S[S.length - 1])
                            }
                        }
                    } else {
                        A += R.charAt(F)
                    }
                }
            }
        }
        E(N, true);
        return S
    };
    function c(z) {
        if (z.n.substr(z.n.length - 1) === "}") {
            z.n = z.n.substring(0, z.n.length - 1)
        }
    }

    function u(z) {
        if (z.trim) {
            return z.trim()
        }
        return z.replace(/^\s*|\s*$/g, "")
    }

    function r(C, D, A) {
        if (D.charAt(A) != C.charAt(0)) {
            return false
        }
        for (var z = 1, B = C.length; z < B; z++) {
            if (D.charAt(A + z) != C.charAt(z)) {
                return false
            }
        }
        return true
    }

    function a(F, B, D, z) {
        var A = [], C = null, E = null;
        while (F.length > 0) {
            E = F.shift();
            if (E.tag == "#" || E.tag == "^" || h(E, z)) {
                D.push(E);
                E.nodes = a(F, E.tag, D, z);
                A.push(E)
            } else {
                if (E.tag == "/") {
                    if (D.length === 0) {
                        throw new Error("Closing tag without opener: /" + E.n)
                    }
                    C = D.pop();
                    if (E.n != C.n && !g(E.n, C.n, z)) {
                        throw new Error("Nesting error: " + C.n + " vs. " + E.n)
                    }
                    C.end = E.i;
                    return A
                } else {
                    A.push(E)
                }
            }
        }
        if (D.length > 0) {
            throw new Error("missing closing tag: " + D.pop().n)
        }
        return A
    }

    function h(C, B) {
        for (var z = 0, A = B.length; z < A; z++) {
            if (B[z].o == C.n) {
                C.tag = "#";
                return true
            }
        }
    }

    function g(z, C, D) {
        for (var A = 0, B = D.length; A < B; A++) {
            if (D[A].c == z && D[A].o == C) {
                return true
            }
        }
    }

    e.generate = function (C, B, A) {
        var z = 'var _=this;_.b(i=i||"");' + y(C) + "return _.fl();";
        if (A.asString) {
            return"function(c,p,i){" + z + ";}"
        }
        return new e.Template(new Function("c", "p", "i", z), B, e, A)
    };
    function d(z) {
        return z.replace(o, "\\\\").replace(n, '\\"').replace(m, "\\n").replace(k, "\\r")
    }

    function b(z) {
        return(~z.indexOf(".")) ? "d" : "f"
    }

    function y(D) {
        var z = "";
        for (var A = 0, B = D.length; A < B; A++) {
            var C = D[A].tag;
            if (C == "#") {
                z += q(D[A].nodes, D[A].n, b(D[A].n), D[A].i, D[A].end, D[A].otag + " " + D[A].ctag)
            } else {
                if (C == "^") {
                    z += f(D[A].nodes, D[A].n, b(D[A].n))
                } else {
                    if (C == "<" || C == ">") {
                        z += j(D[A])
                    } else {
                        if (C == "{" || C == "&") {
                            z += v(D[A].n, b(D[A].n))
                        } else {
                            if (C == "\n") {
                                z += t('"\\n"' + (D.length - 1 == A ? "" : " + i"))
                            } else {
                                if (C == "_v") {
                                    z += w(D[A].n, b(D[A].n))
                                } else {
                                    if (C === undefined) {
                                        z += t('"' + d(D[A]) + '"')
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
        return z
    }

    function q(C, A, B, D, z, E) {
        return"if(_.s(_." + B + '("' + d(A) + '",c,p,1),c,p,0,' + D + "," + z + ',"' + E + '")){_.rs(c,p,function(c,p,_){' + y(C) + "});c.pop();}"
    }

    function f(B, z, A) {
        return"if(!_.s(_." + A + '("' + d(z) + '",c,p,1),c,p,1,0,0,"")){' + y(B) + "};"
    }

    function j(z) {
        return'_.b(_.rp("' + d(z.n) + '",c,p,"' + (z.indent || "") + '"));'
    }

    function v(z, A) {
        return"_.b(_.t(_." + A + '("' + d(z) + '",c,p,0)));'
    }

    function w(z, A) {
        return"_.b(_.v(_." + A + '("' + d(z) + '",c,p,0)));'
    }

    function t(z) {
        return"_.b(" + z + ");"
    }

    e.parse = function (B, A, z) {
        z = z || {};
        return a(B, "", [], z.sectionTags || [])
    }, e.cache = {};
    e.compile = function (C, A) {
        A = A || {};
        var z = C + "||" + !!A.asString;
        var B = this.cache[z];
        if (B) {
            return B
        }
        B = this.generate(this.parse(this.scan(C, A.delimiters), C, A), C, A);
        return this.cache[z] = B
    }
})(typeof exports !== "undefined" ? exports : Hogan);
/*
 * typeahead.js 0.10.1
 * https://github.com/twitter/typeahead.js
 * Copyright 2013 Twitter, Inc. and other contributors; Licensed MIT
 */
(function (a) {
    var b = {isMsie: function () {
        return/(msie|trident)/i.test(navigator.userAgent) ? navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2] : false
    }, isBlankString: function (u) {
        return !u || /^\s*$/.test(u)
    }, escapeRegExChars: function (u) {
        return u.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g, "\\$&")
    }, isString: function (u) {
        return typeof u === "string"
    }, isNumber: function (u) {
        return typeof u === "number"
    }, isArray: a.isArray, isFunction: a.isFunction, isObject: a.isPlainObject, isUndefined: function (u) {
        return typeof u === "undefined"
    }, bind: a.proxy, each: function (v, u) {
        a.each(v, w);
        function w(y, z) {
            return u(z, y)
        }
    }, map: a.map, filter: a.grep, every: function (u, w) {
        var v = true;
        if (!u) {
            return v
        }
        a.each(u, function (y, z) {
            if (!(v = w.call(null, z, y, u))) {
                return false
            }
        });
        return !!v
    }, some: function (u, w) {
        var v = false;
        if (!u) {
            return v
        }
        a.each(u, function (y, z) {
            if (v = w.call(null, z, y, u)) {
                return false
            }
        });
        return !!v
    }, mixin: a.extend, getUniqueId: function () {
        var u = 0;
        return function () {
            return u++
        }
    }(), templatify: function q(u) {
        return a.isFunction(u) ? u : v;
        function v() {
            return String(u)
        }
    }, defer: function (u) {
        setTimeout(u, 0)
    }, debounce: function (u, z, v) {
        var y, w;
        return function () {
            var C = this, A = arguments, D, B;
            D = function () {
                y = null;
                if (!v) {
                    w = u.apply(C, A)
                }
            };
            B = v && !y;
            clearTimeout(y);
            y = setTimeout(D, z);
            if (B) {
                w = u.apply(C, A)
            }
            return w
        }
    }, throttle: function (w, C) {
        var v, u, B, A, z, y;
        z = 0;
        y = function () {
            z = new Date();
            B = null;
            A = w.apply(v, u)
        };
        return function () {
            var D = new Date(), E = C - (D - z);
            v = this;
            u = arguments;
            if (E <= 0) {
                clearTimeout(B);
                B = null;
                z = D;
                A = w.apply(v, u)
            } else {
                if (!B) {
                    B = setTimeout(y, E)
                }
            }
            return A
        }
    }, noop: function () {
    }};
    var t = "0.10.1";
    var m = function (B, D) {
        function y(E) {
            this.maxSize = E || 100;
            this.size = 0;
            this.hash = {};
            this.list = new w()
        }

        b.mixin(y.prototype, {set: function C(E, H) {
            var G = this.list.tail, F;
            if (this.size >= this.maxSize) {
                this.list.remove(G);
                delete this.hash[G.key]
            }
            if (F = this.hash[E]) {
                F.val = H;
                this.list.moveToFront(F)
            } else {
                F = new z(E, H);
                this.list.add(F);
                this.hash[E] = F;
                this.size++
            }
        }, get: function v(E) {
            var F = this.hash[E];
            if (F) {
                this.list.moveToFront(F);
                return F.val
            }
        }});
        function w() {
            this.head = this.tail = null
        }

        b.mixin(w.prototype, {add: function u(E) {
            if (this.head) {
                E.next = this.head;
                this.head.prev = E
            }
            this.head = E;
            this.tail = this.tail || E
        }, remove: function A(E) {
            E.prev ? E.prev.next = E.next : this.head = E.next;
            E.next ? E.next.prev = E.prev : this.tail = E.prev
        }, moveToFront: function (E) {
            this.remove(E);
            this.add(E)
        }});
        function z(E, F) {
            this.key = E;
            this.val = F;
            this.prev = this.next = null
        }

        return y
    }(this);
    var o = function () {
        var y, z;
        try {
            y = window.localStorage;
            y.setItem("~~~", "!");
            y.removeItem("~~~")
        } catch (w) {
            y = null
        }
        function B(C) {
            this.prefix = ["__", C, "__"].join("");
            this.ttlKey = "__ttl__";
            this.keyMatcher = new RegExp("^" + this.prefix)
        }

        if (y && window.JSON) {
            z = {_prefix: function (C) {
                return this.prefix + C
            }, _ttlKey: function (C) {
                return this._prefix(C) + this.ttlKey
            }, get: function (C) {
                if (this.isExpired(C)) {
                    this.remove(C)
                }
                return u(y.getItem(this._prefix(C)))
            }, set: function (C, E, D) {
                if (b.isNumber(D)) {
                    y.setItem(this._ttlKey(C), v(A() + D))
                } else {
                    y.removeItem(this._ttlKey(C))
                }
                return y.setItem(this._prefix(C), v(E))
            }, remove: function (C) {
                y.removeItem(this._ttlKey(C));
                y.removeItem(this._prefix(C));
                return this
            }, clear: function () {
                var C, D, E = [], F = y.length;
                for (C = 0; C < F; C++) {
                    if ((D = y.key(C)).match(this.keyMatcher)) {
                        E.push(D.replace(this.keyMatcher, ""))
                    }
                }
                for (C = E.length; C--;) {
                    this.remove(E[C])
                }
                return this
            }, isExpired: function (C) {
                var D = u(y.getItem(this._ttlKey(C)));
                return b.isNumber(D) && A() > D ? true : false
            }}
        } else {
            z = {get: b.noop, set: b.noop, remove: b.noop, clear: b.noop, isExpired: b.noop}
        }
        b.mixin(B.prototype, z);
        return B;
        function A() {
            return new Date().getTime()
        }

        function v(C) {
            return JSON.stringify(b.isUndefined(C) ? null : C)
        }

        function u(C) {
            return JSON.parse(C)
        }
    }();
    var r = function () {
        var z = 0, y = {}, w = 6, A = new m(10);

        function C(D) {
            D = D || {};
            this._send = D.transport ? u(D.transport) : a.ajax;
            this._get = D.rateLimiter ? D.rateLimiter(this._get) : this._get
        }

        C.setMaxPendingRequests = function B(D) {
            w = D
        };
        C.resetCache = function v() {
            A = new m(10)
        };
        b.mixin(C.prototype, {_get: function (J, H, E) {
            var I = this, G;
            if (G = y[J]) {
                G.done(F)
            } else {
                if (z < w) {
                    z++;
                    y[J] = this._send(J, H).done(F).always(D)
                } else {
                    this.onDeckRequestArgs = [].slice.call(arguments, 0)
                }
            }
            function F(K) {
                E && E(K);
                A.set(J, K)
            }

            function D() {
                z--;
                delete y[J];
                if (I.onDeckRequestArgs) {
                    I._get.apply(I, I.onDeckRequestArgs);
                    I.onDeckRequestArgs = null
                }
            }
        }, get: function (H, E, D) {
            var G = this, F;
            if (b.isFunction(E)) {
                D = E;
                E = {}
            }
            if (F = A.get(H)) {
                b.defer(function () {
                    D && D(F)
                })
            } else {
                this._get(H, E, D)
            }
            return !!F
        }});
        return C;
        function u(E) {
            return function D(J, G) {
                var F = a.Deferred();
                E(J, G, I, H);
                return F;
                function I(K) {
                    b.defer(function () {
                        F.resolve(K)
                    })
                }

                function H(K) {
                    b.defer(function () {
                        F.reject(K)
                    })
                }
            }
        }
    }();
    var p = function () {
        function B(E) {
            E = E || {};
            if (!E.datumTokenizer || !E.queryTokenizer) {
                a.error("datumTokenizer and queryTokenizer are both required")
            }
            this.datumTokenizer = E.datumTokenizer;
            this.queryTokenizer = E.queryTokenizer;
            this.datums = [];
            this.trie = z()
        }

        b.mixin(B.prototype, {bootstrap: function v(E) {
            this.datums = E.datums;
            this.trie = E.trie
        }, add: function (E) {
            var F = this;
            E = b.isArray(E) ? E : [E];
            b.each(E, function (G) {
                var H, I;
                H = F.datums.push(G) - 1;
                I = A(F.datumTokenizer(G));
                b.each(I, function (N) {
                    var M, K, J, L;
                    M = F.trie;
                    K = N.split("");
                    while (J = K.shift()) {
                        M = M.children[J] || (M.children[J] = z());
                        M.ids.push(H)
                    }
                })
            })
        }, get: function w(F) {
            var G = this, H, E;
            H = A(this.queryTokenizer(F));
            b.each(H, function (M) {
                var L, J, I, K;
                if (E && E.length === 0) {
                    return false
                }
                L = G.trie;
                J = M.split("");
                while (L && (I = J.shift())) {
                    L = L.children[I]
                }
                if (L && J.length === 0) {
                    K = L.ids.slice(0);
                    E = E ? y(E, K) : K
                } else {
                    E = [];
                    return false
                }
            });
            return E ? b.map(D(E), function (I) {
                return G.datums[I]
            }) : []
        }, all: function u() {
            return this.datums.slice(0)
        }, serialize: function C() {
            return{datums: this.datums, trie: this.trie}
        }});
        return B;
        function A(E) {
            E = b.filter(E, function (F) {
                return !!F
            });
            E = b.map(E, function (F) {
                return F.toLowerCase()
            });
            return E
        }

        function z() {
            return{ids: [], children: {}}
        }

        function D(E) {
            var G = {}, H = [];
            for (var F = 0; F < E.length; F++) {
                if (!G[E[F]]) {
                    G[E[F]] = true;
                    H.push(E[F])
                }
            }
            return H
        }

        function y(F, G) {
            var E = 0, H = 0, J = [];
            F = F.sort(I);
            G = G.sort(I);
            while (E < F.length && H < G.length) {
                if (F[E] < G[H]) {
                    E++
                } else {
                    if (F[E] > G[H]) {
                        H++
                    } else {
                        J.push(F[E]);
                        E++;
                        H++
                    }
                }
            }
            return J;
            function I(K, L) {
                return K - L
            }
        }
    }();
    var n = function () {
        return{local: u, prefetch: v, remote: w};
        function u(z) {
            var y = z.local || null;
            if (b.isFunction(y)) {
                y = y.call(null)
            }
            return y
        }

        function v(z) {
            var A, y;
            y = {url: null, thumbprint: "", ttl: 24 * 60 * 60 * 1000, filter: null, ajax: {}};
            if (A = z.prefetch || null) {
                A = b.isString(A) ? {url: A} : A;
                A = b.mixin(y, A);
                A.thumbprint = t + A.thumbprint;
                A.ajax.type = A.ajax.type || "GET";
                A.ajax.dataType = A.ajax.dataType || "json";
                !A.url && a.error("prefetch requires url to be set")
            }
            return A
        }

        function w(B) {
            var C, A;
            A = {url: null, wildcard: "%QUERY", replace: null, rateLimitBy: "debounce", rateLimitWait: 300, send: null, filter: null, ajax: {}};
            if (C = B.remote || null) {
                C = b.isString(C) ? {url: C} : C;
                C = b.mixin(A, C);
                C.rateLimiter = /^throttle$/i.test(C.rateLimitBy) ? z(C.rateLimitWait) : y(C.rateLimitWait);
                C.ajax.type = C.ajax.type || "GET";
                C.ajax.dataType = C.ajax.dataType || "json";
                delete C.rateLimitBy;
                delete C.rateLimitWait;
                !C.url && a.error("remote requires url to be set")
            }
            return C;
            function y(D) {
                return function (E) {
                    return b.debounce(E, D)
                }
            }

            function z(D) {
                return function (E) {
                    return b.throttle(E, D)
                }
            }
        }
    }();
    var c = window.Bloodhound = function () {
        var C;
        C = {data: "data", protocol: "protocol", thumbprint: "thumbprint"};
        function v(J) {
            if (!J || !J.local && !J.prefetch && !J.remote) {
                a.error("one of local, prefetch, or remote is required")
            }
            this.limit = J.limit || 5;
            this.sorter = z(J.sorter);
            this.dupDetector = J.dupDetector || A;
            this.local = n.local(J);
            this.minLength = b.isNumber(J.minLength) ? J.minLength : 1;
            this.prefetch = n.prefetch(J);
            this.remote = n.remote(J);
            this.cacheKey = this.prefetch ? this.prefetch.cacheKey || this.prefetch.url : null;
            this.index = new p({datumTokenizer: J.datumTokenizer, queryTokenizer: J.queryTokenizer});
            this.storage = this.cacheKey ? new o(this.cacheKey) : null
        }

        v.tokenizers = {whitespace: function I(J) {
            return J.split(/\s+/)
        }, nonword: function E(J) {
            return J.split(/\W+/)
        }};
        b.mixin(v.prototype, {_loadPrefetch: function D(L) {
            var N = this, M, J;
            if (M = this._readFromStorage(L.thumbprint)) {
                this.index.bootstrap(M);
                J = a.Deferred().resolve()
            } else {
                J = a.ajax(L.url, L.ajax).done(K)
            }
            return J;
            function K(P) {
                var O;
                O = L.filter ? L.filter(P) : P;
                N.add(O);
                N._saveToStorage(N.index.serialize(), L.thumbprint, L.ttl)
            }
        }, _getFromRemote: function y(L, J) {
            var M = this, O, N;
            L = L || "";
            N = encodeURIComponent(L);
            O = this.remote.replace ? this.remote.replace(this.remote.url, L) : this.remote.url.replace(this.remote.wildcard, N);
            return this.transport.get(O, this.remote.ajax, K);
            function K(Q) {
                var P = M.remote.filter ? M.remote.filter(Q) : Q;
                J(P)
            }
        }, _saveToStorage: function G(J, K, L) {
            if (this.storage) {
                this.storage.set(C.data, J, L);
                this.storage.set(C.protocol, location.protocol, L);
                this.storage.set(C.thumbprint, K, L)
            }
        }, _readFromStorage: function F(L) {
            var K = {}, J;
            if (this.storage) {
                K.data = this.storage.get(C.data);
                K.protocol = this.storage.get(C.protocol);
                K.thumbprint = this.storage.get(C.thumbprint)
            }
            J = K.thumbprint !== L || K.protocol !== location.protocol;
            return K.data && !J ? K.data : null
        }, initialize: function B() {
            var M = this, K;
            K = this.prefetch ? this._loadPrefetch(this.prefetch) : a.Deferred().resolve();
            this.local && K.done(J);
            this.transport = this.remote ? new r(this.remote) : null;
            this.initialize = function L() {
                return K.promise()
            };
            return K.promise();
            function J() {
                M.add(M.local)
            }
        }, add: function u(J) {
            this.index.add(J)
        }, get: function w(M, K) {
            var O = this, L, J = false;
            if (M === "" && this.minLength === 0) {
                L = this.index.all()
            } else {
                if (M !== "" && M.length >= this.minLength) {
                    L = this.index.get(M);
                    if (L.length < this.limit && this.transport) {
                        J = this._getFromRemote(M, N)
                    }
                } else {
                    return
                }
            }
            L = this.sorter(L).slice(0, this.limit);
            !J && K && K(L);
            function N(Q) {
                var P = L.slice(0);
                b.each(Q, function (S) {
                    var R;
                    R = b.some(P, function (T) {
                        return O.dupDetector(S, T)
                    });
                    !R && P.push(S);
                    return P.length < O.limit
                });
                K && K(O.sorter(P))
            }
        }, ttAdapter: function H() {
            return b.bind(this.get, this)
        }});
        return v;
        function z(L) {
            return b.isFunction(L) ? K : J;
            function K(M) {
                return M.sort(L)
            }

            function J(M) {
                return M
            }
        }

        function A() {
            return false
        }
    }();
    var k = {wrapper: '<span class="twitter-typeahead"></span>', dropdown: '<span class="tt-dropdown-menu"></span>', dataset: '<div class="tt-dataset-%CLASS%"></div>', suggestions: '<span class="tt-suggestions"></span>', suggestion: '<div class="tt-suggestion">%BODY%</div>'};
    var d = {wrapper: {position: "relative", display: "inline-block"}, hint: {position: "absolute", top: "0", left: "0", borderColor: "transparent", boxShadow: "none"}, input: {position: "relative", verticalAlign: "top", backgroundColor: "transparent"}, inputWithNoHint: {position: "relative", verticalAlign: "top"}, dropdown: {position: "absolute", top: "100%", left: "0", zIndex: "100", display: "none"}, suggestions: {display: "block"}, suggestion: {whiteSpace: "nowrap", cursor: "pointer"}, suggestionChild: {whiteSpace: "normal"}, ltr: {left: "0", right: "auto"}, rtl: {left: "auto", right: " 0"}};
    if (b.isMsie()) {
        b.mixin(d.input, {backgroundImage: "url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)"})
    }
    if (b.isMsie() && b.isMsie() <= 7) {
        b.mixin(d.input, {marginTop: "-1px"})
    }
    var g = function () {
        var v = "typeahead:";

        function u(w) {
            if (!w || !w.el) {
                a.error("EventBus initialized without el")
            }
            this.$el = a(w.el)
        }

        b.mixin(u.prototype, {trigger: function (y) {
            var w = [].slice.call(arguments, 1);
            this.$el.trigger(v + y, w)
        }});
        return u
    }();
    var h = function () {
        var D = /\s+/, y = w();
        return{onSync: C, onAsync: B, off: z, trigger: E};
        function A(H, J, F, G) {
            var I;
            if (!F) {
                return this
            }
            J = J.split(D);
            F = G ? u(F, G) : F;
            this._callbacks = this._callbacks || {};
            while (I = J.shift()) {
                this._callbacks[I] = this._callbacks[I] || {sync: [], async: []};
                this._callbacks[I][H].push(F)
            }
            return this
        }

        function B(H, F, G) {
            return A.call(this, "async", H, F, G)
        }

        function C(H, F, G) {
            return A.call(this, "sync", H, F, G)
        }

        function z(G) {
            var F;
            if (!this._callbacks) {
                return this
            }
            G = G.split(D);
            while (F = G.shift()) {
                delete this._callbacks[F]
            }
            return this
        }

        function E(L) {
            var J = this, K, H, F, I, G;
            if (!this._callbacks) {
                return this
            }
            L = L.split(D);
            F = [].slice.call(arguments, 1);
            while ((K = L.shift()) && (H = this._callbacks[K])) {
                I = v(H.sync, this, [K].concat(F));
                G = v(H.async, this, [K].concat(F));
                I() && y(G)
            }
            return this
        }

        function v(G, H, F) {
            return I;
            function I() {
                var J;
                for (var K = 0; !J && K < G.length; K += 1) {
                    J = G[K].apply(H, F) === false
                }
                return !J
            }
        }

        function w() {
            var G, F;
            if (window.setImmediate) {
                G = function H(J) {
                    setImmediate(function () {
                        J()
                    })
                }
            } else {
                G = function I(J) {
                    setTimeout(function () {
                        J()
                    }, 0)
                }
            }
            return G
        }

        function u(G, F) {
            return G.bind ? G.bind(F) : function () {
                G.apply(F, [].slice.call(arguments, 0))
            }
        }
    }();
    var j = function (v) {
        var u = {node: null, pattern: null, tagName: "strong", className: null, wordsOnly: false, caseSensitive: false};
        return function y(A) {
            var B;
            A = b.mixin({}, u, A);
            if (!A.node || !A.pattern) {
                return
            }
            A.pattern = b.isArray(A.pattern) ? A.pattern : [A.pattern];
            B = w(A.pattern, A.caseSensitive, A.wordsOnly);
            C(A.node, z);
            function z(F) {
                var D, E;
                if (D = B.exec(F.data)) {
                    wrapperNode = v.createElement(A.tagName);
                    A.className && (wrapperNode.className = A.className);
                    E = F.splitText(D.index);
                    E.splitText(D[0].length);
                    wrapperNode.appendChild(E.cloneNode(true));
                    F.parentNode.replaceChild(wrapperNode, E)
                }
                return !!D
            }

            function C(E, F) {
                var D, H = 3;
                for (var G = 0; G < E.childNodes.length; G++) {
                    D = E.childNodes[G];
                    if (D.nodeType === H) {
                        G += F(D) ? 1 : 0
                    } else {
                        C(D, F)
                    }
                }
            }
        };
        function w(C, z, E) {
            var A = [], D;
            for (var B = 0; B < C.length; B++) {
                A.push(b.escapeRegExChars(C[B]))
            }
            D = E ? "\\b(" + A.join("|") + ")\\b" : "(" + A.join("|") + ")";
            return z ? new RegExp(D) : new RegExp(D, "i")
        }
    }(window.document);
    var l = function () {
        var S;
        S = {9: "tab", 27: "esc", 37: "left", 39: "right", 13: "enter", 38: "up", 40: "down"};
        function H(U) {
            var Z = this, V, W, Y, X;
            U = U || {};
            if (!U.input) {
                a.error("input is missing")
            }
            V = b.bind(this._onBlur, this);
            W = b.bind(this._onFocus, this);
            Y = b.bind(this._onKeydown, this);
            X = b.bind(this._onInput, this);
            this.$hint = a(U.hint);
            this.$input = a(U.input).on("blur.tt", V).on("focus.tt", W).on("keydown.tt", Y);
            if (this.$hint.length === 0) {
                this.setHintValue = this.getHintValue = this.clearHint = b.noop
            }
            if (!b.isMsie()) {
                this.$input.on("input.tt", X)
            } else {
                this.$input.on("keydown.tt keypress.tt cut.tt paste.tt", function (aa) {
                    if (S[aa.which || aa.keyCode]) {
                        return
                    }
                    b.defer(b.bind(Z._onInput, Z, aa))
                })
            }
            this.query = this.$input.val();
            this.$overflowHelper = w(this.$input)
        }

        H.normalizeQuery = function (U) {
            return(U || "").replace(/^\s*/g, "").replace(/\s{2,}/g, " ")
        };
        b.mixin(H.prototype, h, {_onBlur: function J(U) {
            this.resetInputValue();
            this.trigger("blurred")
        }, _onFocus: function K(U) {
            this.trigger("focused")
        }, _onKeydown: function M(U) {
            var V = S[U.which || U.keyCode];
            this._managePreventDefault(V, U);
            if (V && this._shouldTrigger(V, U)) {
                this.trigger(V + "Keyed", U)
            }
        }, _onInput: function L(U) {
            this._checkInputValue()
        }, _managePreventDefault: function I(X, U) {
            var Y, V, W;
            switch (X) {
                case"tab":
                    V = this.getHintValue();
                    W = this.getInputValue();
                    Y = V && V !== W && !T(U);
                    break;
                case"up":
                case"down":
                    Y = !T(U);
                    break;
                default:
                    Y = false
            }
            Y && U.preventDefault()
        }, _shouldTrigger: function R(V, U) {
            var W;
            switch (V) {
                case"tab":
                    W = !T(U);
                    break;
                default:
                    W = true
            }
            return W
        }, _checkInputValue: function y() {
            var W, U, V;
            W = this.getInputValue();
            U = u(W, this.query);
            V = U ? this.query.length !== W.length : false;
            if (!U) {
                this.trigger("queryChanged", this.query = W)
            } else {
                if (V) {
                    this.trigger("whitespaceChanged", this.query)
                }
            }
        }, focus: function B() {
            this.$input.focus()
        }, blur: function v() {
            this.$input.blur()
        }, getQuery: function F() {
            return this.query
        }, setQuery: function Q(U) {
            this.query = U
        }, getInputValue: function D() {
            return this.$input.val()
        }, setInputValue: function P(V, U) {
            this.$input.val(V);
            !U && this._checkInputValue()
        }, getHintValue: function C() {
            return this.$hint.val()
        }, setHintValue: function O(U) {
            this.$hint.val(U)
        }, resetInputValue: function N() {
            this.$input.val(this.query)
        }, clearHint: function z() {
            this.$hint.val("")
        }, getLanguageDirection: function E() {
            return(this.$input.css("direction") || "ltr").toLowerCase()
        }, hasOverflow: function G() {
            var U = this.$input.width() - 2;
            this.$overflowHelper.text(this.getInputValue());
            return this.$overflowHelper.width() >= U
        }, isCursorAtEnd: function () {
            var W, V, U;
            W = this.$input.val().length;
            V = this.$input[0].selectionStart;
            if (b.isNumber(V)) {
                return V === W
            } else {
                if (document.selection) {
                    U = document.selection.createRange();
                    U.moveStart("character", -W);
                    return W === U.text.length
                }
            }
            return true
        }, destroy: function A() {
            this.$hint.off(".tt");
            this.$input.off(".tt");
            this.$hint = this.$input = this.$overflowHelper = null
        }});
        return H;
        function w(U) {
            return a('<pre aria-hidden="true"></pre>').css({position: "absolute", visibility: "hidden", whiteSpace: "nowrap", fontFamily: U.css("font-family"), fontSize: U.css("font-size"), fontStyle: U.css("font-style"), fontVariant: U.css("font-variant"), fontWeight: U.css("font-weight"), wordSpacing: U.css("word-spacing"), letterSpacing: U.css("letter-spacing"), textIndent: U.css("text-indent"), textRendering: U.css("text-rendering"), textTransform: U.css("text-transform")}).insertAfter(U)
        }

        function u(U, V) {
            return H.normalizeQuery(U) === H.normalizeQuery(V)
        }

        function T(U) {
            return U.altKey || U.ctrlKey || U.metaKey || U.shiftKey
        }
    }();
    var e = function () {
        var w = "ttDataset", J = "ttValue", y = "ttDatum";

        function v(K) {
            K = K || {};
            K.templates = K.templates || {};
            if (!K.source) {
                a.error("missing source")
            }
            if (K.name && !G(K.name)) {
                a.error("invalid dataset name: " + K.name)
            }
            this.query = null;
            this.highlight = !!K.highlight;
            this.name = K.name || b.getUniqueId();
            this.source = K.source;
            this.displayFn = C(K.display || K.displayKey);
            this.templates = E(K.templates, this.displayFn);
            this.$el = a(k.dataset.replace("%CLASS%", this.name))
        }

        v.extractDatasetName = function A(K) {
            return a(K).data(w)
        };
        v.extractValue = function B(K) {
            return a(K).data(J)
        };
        v.extractDatum = function B(K) {
            return a(K).data(y)
        };
        b.mixin(v.prototype, h, {_render: function H(P, Q) {
            if (!this.$el) {
                return
            }
            var R = this, O;
            this.$el.empty();
            O = Q && Q.length;
            if (!O && this.templates.empty) {
                this.$el.html(K()).prepend(R.templates.header ? M() : null).append(R.templates.footer ? L() : null)
            } else {
                if (O) {
                    this.$el.html(N()).prepend(R.templates.header ? M() : null).append(R.templates.footer ? L() : null)
                }
            }
            this.trigger("rendered");
            function K() {
                return R.templates.empty({query: P, isEmpty: true})
            }

            function N() {
                var S, U;
                S = a(k.suggestions).css(d.suggestions);
                U = b.map(Q, T);
                S.append.apply(S, U);
                R.highlight && j({node: S[0], pattern: P});
                return S;
                function T(Y) {
                    var V, W, X;
                    W = R.templates.suggestion(Y);
                    X = k.suggestion.replace("%BODY%", W);
                    V = a(X).data(w, R.name).data(J, R.displayFn(Y)).data(y, Y);
                    V.children().each(function () {
                        a(this).css(d.suggestionChild)
                    });
                    return V
                }
            }

            function M() {
                return R.templates.header({query: P, isEmpty: !O})
            }

            function L() {
                return R.templates.footer({query: P, isEmpty: !O})
            }
        }, getRoot: function D() {
            return this.$el
        }, update: function I(K) {
            var M = this;
            this.query = K;
            this.source(K, L);
            function L(N) {
                K === M.query && M._render(K, N)
            }
        }, clear: function u() {
            this._render(this.query || "")
        }, isEmpty: function F() {
            return this.$el.is(":empty")
        }, destroy: function z() {
            this.$el = null
        }});
        return v;
        function C(K) {
            K = K || "value";
            return b.isFunction(K) ? K : L;
            function L(M) {
                return M[K]
            }
        }

        function E(M, K) {
            return{empty: M.empty && b.templatify(M.empty), header: M.header && b.templatify(M.header), footer: M.footer && b.templatify(M.footer), suggestion: M.suggestion || L};
            function L(N) {
                return"<p>" + K(N) + "</p>"
            }
        }

        function G(K) {
            return/^[_a-zA-Z0-9-]+$/.test(K)
        }
    }();
    var f = function () {
        function w(T) {
            var X = this, U, V, W;
            T = T || {};
            if (!T.menu) {
                a.error("menu is required")
            }
            this.isOpen = false;
            this.isEmpty = true;
            this.datasets = b.map(T.datasets, F);
            U = b.bind(this._onSuggestionClick, this);
            V = b.bind(this._onSuggestionMouseEnter, this);
            W = b.bind(this._onSuggestionMouseLeave, this);
            this.$menu = a(T.menu).on("click.tt", ".tt-suggestion", U).on("mouseenter.tt", ".tt-suggestion", V).on("mouseleave.tt", ".tt-suggestion", W);
            b.each(this.datasets, function (Y) {
                X.$menu.append(Y.getRoot());
                Y.onSync("rendered", X._onRendered, X)
            })
        }

        b.mixin(w.prototype, h, {_onSuggestionClick: function L(T) {
            this.trigger("suggestionClicked", a(T.currentTarget))
        }, _onSuggestionMouseEnter: function M(T) {
            this._removeCursor();
            this._setCursor(a(T.currentTarget), true)
        }, _onSuggestionMouseLeave: function N(T) {
            this._removeCursor()
        }, _onRendered: function K() {
            this.isEmpty = b.every(this.datasets, T);
            this.isEmpty ? this._hide() : this.isOpen && this._show();
            this.trigger("datasetRendered");
            function T(U) {
                return U.isEmpty()
            }
        }, _hide: function () {
            this.$menu.hide()
        }, _show: function () {
            this.$menu.css("display", "block")
        }, _getSuggestions: function E() {
            return this.$menu.find(".tt-suggestion")
        }, _getCursor: function A() {
            return this.$menu.find(".tt-cursor").first()
        }, _setCursor: function Q(T, U) {
            T.first().addClass("tt-cursor");
            !U && this.trigger("cursorMoved")
        }, _removeCursor: function P() {
            this._getCursor().removeClass("tt-cursor")
        }, _moveCursor: function H(W) {
            var V, U, X, T;
            if (!this.isOpen) {
                return
            }
            U = this._getCursor();
            V = this._getSuggestions();
            this._removeCursor();
            X = V.index(U) + W;
            X = (X + 1) % (V.length + 1) - 1;
            if (X === -1) {
                this.trigger("cursorRemoved");
                return
            } else {
                if (X < -1) {
                    X = V.length - 1
                }
            }
            this._setCursor(T = V.eq(X));
            this._ensureVisible(T)
        }, _ensureVisible: function z(T) {
            var V, U, X, W;
            V = T.position().top;
            U = V + T.outerHeight(true);
            X = this.$menu.scrollTop();
            W = this.$menu.height() + parseInt(this.$menu.css("paddingTop"), 10) + parseInt(this.$menu.css("paddingBottom"), 10);
            if (V < 0) {
                this.$menu.scrollTop(X + V)
            } else {
                if (W < U) {
                    this.$menu.scrollTop(X + (U - W))
                }
            }
        }, close: function u() {
            if (this.isOpen) {
                this.isOpen = false;
                this._removeCursor();
                this._hide();
                this.trigger("closed")
            }
        }, open: function O() {
            if (!this.isOpen) {
                this.isOpen = true;
                !this.isEmpty && this._show();
                this.trigger("opened")
            }
        }, setLanguageDirection: function R(T) {
            this.$menu.css(T === "ltr" ? d.ltr : d.rtl)
        }, moveCursorUp: function J() {
            this._moveCursor(-1)
        }, moveCursorDown: function I() {
            this._moveCursor(+1)
        }, getDatumForSuggestion: function C(T) {
            var U = null;
            if (T.length) {
                U = {raw: e.extractDatum(T), value: e.extractValue(T), datasetName: e.extractDatasetName(T)}
            }
            return U
        }, getDatumForCursor: function B() {
            return this.getDatumForSuggestion(this._getCursor().first())
        }, getDatumForTopSuggestion: function D() {
            return this.getDatumForSuggestion(this._getSuggestions().first())
        }, update: function S(T) {
            b.each(this.datasets, U);
            function U(V) {
                V.update(T)
            }
        }, empty: function y() {
            b.each(this.datasets, T);
            this.isEmpty = true;
            function T(U) {
                U.clear()
            }
        }, isVisible: function G() {
            return this.isOpen && !this.isEmpty
        }, destroy: function v() {
            this.$menu.off(".tt");
            b.each(this.datasets, T);
            function T(U) {
                U.destroy()
            }
        }});
        return w;
        function F(T) {
            return new e(T)
        }
    }();
    var s = function () {
        var u = "ttAttrs";

        function Y(ae) {
            var ac, ab, aa, ad;
            ae = ae || {};
            if (!ae.input) {
                a.error("missing input")
            }
            this.autoselect = !!ae.autoselect;
            this.minLength = b.isNumber(ae.minLength) ? ae.minLength : 1;
            this.$node = w(ae.input, ae.withHint);
            ac = this.$node.find(".tt-dropdown-menu");
            ab = this.$node.find(".tt-input");
            aa = this.$node.find(".tt-hint");
            this.eventBus = ae.eventBus || new g({el: ab});
            this.dropdown = new f({menu: ac, datasets: ae.datasets}).onSync("suggestionClicked", this._onSuggestionClicked, this).onSync("cursorMoved", this._onCursorMoved, this).onSync("cursorRemoved", this._onCursorRemoved, this).onSync("opened", this._onOpened, this).onSync("closed", this._onClosed, this).onAsync("datasetRendered", this._onDatasetRendered, this);
            this.input = new l({input: ab, hint: aa}).onSync("focused", this._onFocused, this).onSync("blurred", this._onBlurred, this).onSync("enterKeyed", this._onEnterKeyed, this).onSync("tabKeyed", this._onTabKeyed, this).onSync("escKeyed", this._onEscKeyed, this).onSync("upKeyed", this._onUpKeyed, this).onSync("downKeyed", this._onDownKeyed, this).onSync("leftKeyed", this._onLeftKeyed, this).onSync("rightKeyed", this._onRightKeyed, this).onSync("queryChanged", this._onQueryChanged, this).onSync("whitespaceChanged", this._onWhitespaceChanged, this);
            ac.on("mousedown.tt", function (af) {
                if (b.isMsie() && b.isMsie() < 9) {
                    ab[0].onbeforedeactivate = function () {
                        window.event.returnValue = false;
                        ab[0].onbeforedeactivate = null
                    }
                }
                af.preventDefault()
            })
        }

        b.mixin(Y.prototype, {_onSuggestionClicked: function Q(ac, aa) {
            var ab;
            if (ab = this.dropdown.getDatumForSuggestion(aa)) {
                this._select(ab)
            }
        }, _onCursorMoved: function F() {
            var aa = this.dropdown.getDatumForCursor();
            this.input.clearHint();
            this.input.setInputValue(aa.value, true);
            this.eventBus.trigger("cursorchanged", aa.raw, aa.datasetName)
        }, _onCursorRemoved: function G() {
            this.input.resetInputValue();
            this._updateHint()
        }, _onDatasetRendered: function H() {
            this._updateHint()
        }, _onOpened: function N() {
            if (this.minLength === 0 && this.input.getQuery() === "") {
                this.dropdown.update("")
            }
            this._updateHint();
            this.eventBus.trigger("opened")
        }, _onClosed: function E() {
            this.input.clearHint();
            this.eventBus.trigger("closed")
        }, _onFocused: function L() {
            this.dropdown.empty();
            this.dropdown.open()
        }, _onBlurred: function D() {
            this.dropdown.close()
        }, _onEnterKeyed: function J(ad, aa) {
            var ab, ac;
            ab = this.dropdown.getDatumForCursor();
            ac = this.dropdown.getDatumForTopSuggestion();
            if (ab) {
                this._select(ab);
                aa.preventDefault()
            } else {
                if (this.autoselect && ac) {
                    this._select(ac);
                    aa.preventDefault()
                }
            }
        }, _onTabKeyed: function R(ac, aa) {
            var ab;
            if (ab = this.dropdown.getDatumForCursor()) {
                this._select(ab);
                aa.preventDefault()
            } else {
                this._autocomplete()
            }
        }, _onEscKeyed: function K() {
            this.dropdown.close();
            this.input.resetInputValue()
        }, _onUpKeyed: function S() {
            var aa = this.input.getQuery();
            if (!this.dropdown.isOpen && aa.length >= this.minLength) {
                this.dropdown.update(aa)
            }
            this.dropdown.open();
            this.dropdown.moveCursorUp()
        }, _onDownKeyed: function I() {
            var aa = this.input.getQuery();
            if (!this.dropdown.isOpen && aa.length >= this.minLength) {
                this.dropdown.update(aa)
            }
            this.dropdown.open();
            this.dropdown.moveCursorDown()
        }, _onLeftKeyed: function M() {
            this.dir === "rtl" && this._autocomplete()
        }, _onRightKeyed: function P() {
            this.dir === "ltr" && this._autocomplete()
        }, _onQueryChanged: function O(aa, ab) {
            this.input.clearHint();
            this.dropdown.empty();
            ab.length >= this.minLength && this.dropdown.update(ab);
            this.dropdown.open();
            this._setLanguageDirection()
        }, _onWhitespaceChanged: function T() {
            this._updateHint();
            this.dropdown.open()
        }, _setLanguageDirection: function W() {
            var aa;
            if (this.dir !== (aa = this.input.getLanguageDirection())) {
                this.dir = aa;
                this.$node.css("direction", aa);
                this.dropdown.setLanguageDirection(aa)
            }
        }, _updateHint: function Z() {
            var aa, ad, af, ab, ac, ae;
            aa = this.dropdown.getDatumForTopSuggestion();
            if (aa && this.dropdown.isVisible() && !this.input.hasOverflow()) {
                ad = this.input.getInputValue();
                af = l.normalizeQuery(ad);
                ab = b.escapeRegExChars(af);
                ac = new RegExp("^(?:" + ab + ")(.*$)", "i");
                ae = ac.exec(aa.value);
                this.input.setHintValue(ad + (ae ? ae[1] : ""))
            }
        }, _autocomplete: function v() {
            var ab, ac, aa;
            ab = this.input.getHintValue();
            ac = this.input.getQuery();
            if (ab && ac !== ab && this.input.isCursorAtEnd()) {
                aa = this.dropdown.getDatumForTopSuggestion();
                aa && this.input.setInputValue(aa.value);
                this.eventBus.trigger("autocompleted", aa.raw, aa.datasetName)
            }
        }, _select: function V(aa) {
            this.input.clearHint();
            this.input.setQuery(aa.value);
            this.input.setInputValue(aa.value, true);
            this._setLanguageDirection();
            this.eventBus.trigger("selected", aa.raw, aa.datasetName);
            this.dropdown.close();
            b.defer(b.bind(this.dropdown.empty, this.dropdown))
        }, open: function U() {
            this.dropdown.open()
        }, close: function y() {
            this.dropdown.close()
        }, getQuery: function C() {
            return this.input.getQuery()
        }, setQuery: function X(aa) {
            this.input.setInputValue(aa)
        }, destroy: function z() {
            this.input.destroy();
            this.dropdown.destroy();
            A(this.$node);
            this.$node = null
        }});
        return Y;
        function w(af, ag) {
            var ac, ad, aa, ab;
            ac = a(af);
            ad = a(k.wrapper).css(d.wrapper);
            aa = a(k.dropdown).css(d.dropdown);
            ab = ac.clone().css(d.hint).css(B(ac));
            ab.val("").removeData().addClass("tt-hint").removeAttr("id name placeholder").prop("disabled", true).attr({autocomplete: "off", spellcheck: "false"});
            ac.data(u, {dir: ac.attr("dir"), autocomplete: ac.attr("autocomplete"), spellcheck: ac.attr("spellcheck"), style: ac.attr("style")});
            ac.addClass("tt-input").attr({autocomplete: "off", spellcheck: false}).css(ag ? d.input : d.inputWithNoHint);
            try {
                !ac.attr("dir") && ac.attr("dir", "auto")
            } catch (ae) {
            }
            return ac.wrap(ad).parent().prepend(ag ? ab : null).append(aa)
        }

        function B(aa) {
            return{backgroundAttachment: aa.css("background-attachment"), backgroundClip: aa.css("background-clip"), backgroundColor: aa.css("background-color"), backgroundImage: aa.css("background-image"), backgroundOrigin: aa.css("background-origin"), backgroundPosition: aa.css("background-position"), backgroundRepeat: aa.css("background-repeat"), backgroundSize: aa.css("background-size")}
        }

        function A(ab) {
            var aa = ab.find(".tt-input");
            b.each(aa.data(u), function (ad, ac) {
                b.isUndefined(ad) ? aa.removeAttr(ac) : aa.attr(ac, ad)
            });
            aa.detach().removeData(u).removeClass("tt-input").insertAfter(ab);
            ab.remove()
        }
    }();
    (function () {
        var A, C, y;
        A = a.fn.typeahead;
        C = "ttTypeahead";
        y = {initialize: function w(G, F) {
            F = b.isArray(F) ? F : [].slice.call(arguments, 1);
            G = G || {};
            return this.each(E);
            function E() {
                var H = a(this), I, J;
                b.each(F, function (K) {
                    K.highlight = !!G.highlight
                });
                J = new s({input: H, eventBus: I = new g({el: H}), withHint: b.isUndefined(G.hint) ? true : !!G.hint, minLength: G.minLength, autoselect: G.autoselect, datasets: F});
                H.data(C, J)
            }
        }, open: function B() {
            return this.each(E);
            function E() {
                var F = a(this), G;
                if (G = F.data(C)) {
                    G.open()
                }
            }
        }, close: function u() {
            return this.each(E);
            function E() {
                var F = a(this), G;
                if (G = F.data(C)) {
                    G.close()
                }
            }
        }, val: function D(F) {
            return !arguments.length ? E(this.first()) : this.each(G);
            function G() {
                var H = a(this), I;
                if (I = H.data(C)) {
                    I.setQuery(F)
                }
            }

            function E(H) {
                var J, I;
                if (J = H.data(C)) {
                    I = J.getQuery()
                }
                return I
            }
        }, destroy: function v() {
            return this.each(E);
            function E() {
                var F = a(this), G;
                if (G = F.data(C)) {
                    G.destroy();
                    F.removeData(C)
                }
            }
        }};
        a.fn.typeahead = function (E) {
            if (y[E]) {
                return y[E].apply(this, [].slice.call(arguments, 1))
            } else {
                return y.initialize.apply(this, arguments)
            }
        };
        a.fn.typeahead.noConflict = function z() {
            a.fn.typeahead = A;
            return this
        }
    })()
})(window.jQuery);
(function (a) {
    tfl.logs.create("tfl.storage: loaded");
    var b = window.localStorage;
    a.isLocalStorageSupported = function () {
        if ("localStorage" in window && window.localStorage !== null) {
            tfl.logs.create("tfl.storage: isLocalStorageSupported true");
            return true
        } else {
            tfl.logs.create("tfl.storage: isLocalStorageSupported false");
            return false
        }
    };
    a.set = function (d, g) {
        if (b && d != undefined) {
            try {
                var f = JSON.stringify(g);
                b.setItem(d, f);
                tfl.logs.create("tfl.storage.set: " + d + ":" + f)
            } catch (c) {
                tfl.logs.create("tfl.storage.set:" + c.message, "error")
            }
        }
    };
    a.get = function (f, c) {
        if (b) {
            try {
                var g = b.getItem(f);
                if (g != null) {
                    return JSON.parse(g)
                }
            } catch (d) {
                tfl.logs.create("tfl.storage.get:" + d.message, "error")
            }
        }
        if (c !== "") {
            tfl.logs.create("tfl.storage.get: " + f + ":" + c);
            return c
        }
        tfl.logs.create("tfl.storage.get: " + f + ": []");
        return[]
    };
    a.showIfNotDisabled = function (g, c) {
        if (b) {
            try {
                var f = JSON.parse(a.get(g, false));
                if (!f) {
                    c()
                }
            } catch (d) {
                c()
            }
        } else {
            c()
        }
    }
}(window.tfl.storage = window.tfl.storage || {}));
(function (a) {
    a.extend(a.fn, {validate: function (c) {
        if (!this.length) {
            c && c.debug && window.console && console.warn("nothing selected, can't validate, returning nothing");
            return
        }
        var d = a.data(this[0], "validator");
        if (d) {
            return d
        }
        this.attr("novalidate", "novalidate");
        d = new a.validator(c, this[0]);
        a.data(this[0], "validator", d);
        if (d.settings.onsubmit) {
            var b = this.find("input, button");
            b.filter(".cancel").click(function () {
                d.cancelSubmit = true
            });
            if (d.settings.submitHandler) {
                b.filter(":submit").click(function () {
                    d.submitButton = this
                })
            }
            this.submit(function (e) {
                if (d.settings.debug) {
                    e.preventDefault()
                }
                function f() {
                    if (d.settings.submitHandler) {
                        if (d.submitButton) {
                            var g = a("<input type='hidden'/>").attr("name", d.submitButton.name).val(d.submitButton.value).appendTo(d.currentForm)
                        }
                        d.settings.submitHandler.call(d, d.currentForm);
                        if (d.submitButton) {
                            g.remove()
                        }
                        return false
                    }
                    return true
                }

                if (d.cancelSubmit) {
                    d.cancelSubmit = false;
                    return f()
                }
                if (d.form()) {
                    if (d.pendingRequest) {
                        d.formSubmitted = true;
                        return false
                    }
                    return f()
                } else {
                    d.focusInvalid();
                    return false
                }
            })
        }
        return d
    }, valid: function () {
        if (a(this[0]).is("form")) {
            return this.validate().form()
        } else {
            var b = true;
            var c = a(this[0].form).validate();
            this.each(function () {
                b &= c.element(this)
            });
            return b
        }
    }, removeAttrs: function (c) {
        var d = {}, b = this;
        a.each(c.split(/\s/), function (e, f) {
            d[f] = b.attr(f);
            b.removeAttr(f)
        });
        return d
    }, rules: function (c, b) {
        var e = this[0];
        if (c) {
            var j = a.data(e.form, "validator").settings;
            var k = j.rules;
            var f = a.validator.staticRules(e);
            switch (c) {
                case"add":
                    a.extend(f, a.validator.normalizeRule(b));
                    k[e.name] = f;
                    if (b.messages) {
                        j.messages[e.name] = a.extend(j.messages[e.name], b.messages)
                    }
                    break;
                case"remove":
                    if (!b) {
                        delete k[e.name];
                        return f
                    }
                    var g = {};
                    a.each(b.split(/\s/), function (l, m) {
                        g[m] = f[m];
                        delete f[m]
                    });
                    return g
            }
        }
        var d = a.validator.normalizeRules(a.extend({}, a.validator.metadataRules(e), a.validator.classRules(e), a.validator.attributeRules(e), a.validator.staticRules(e)), e);
        if (d.required) {
            var h = d.required;
            delete d.required;
            d = a.extend({required: h}, d)
        }
        return d
    }});
    a.extend(a.expr[":"], {blank: function (b) {
        return !a.trim("" + b.value)
    }, filled: function (b) {
        return !!a.trim("" + b.value)
    }, unchecked: function (b) {
        return !b.checked
    }});
    a.validator = function (c, b) {
        this.settings = a.extend(true, {}, a.validator.defaults, c);
        this.currentForm = b;
        this.init()
    };
    a.validator.format = function (c, b) {
        if (arguments.length == 1) {
            return function () {
                var d = a.makeArray(arguments);
                d.unshift(c);
                return a.validator.format.apply(this, d)
            }
        }
        if (arguments.length > 2 && b.constructor != Array) {
            b = a.makeArray(arguments).slice(1)
        }
        if (b.constructor != Array) {
            b = [b]
        }
        a.each(b, function (d, e) {
            c = c.replace(new RegExp("\\{" + d + "\\}", "g"), e)
        });
        return c
    };
    a.extend(a.validator, {defaults: {messages: {}, groups: {}, rules: {}, errorClass: "error", validClass: "valid", errorElement: "label", focusInvalid: true, errorContainer: a([]), errorLabelContainer: a([]), onsubmit: true, ignore: ":hidden", ignoreTitle: false, onfocusin: function (b, c) {
        this.lastActive = b;
        if (this.settings.focusCleanup && !this.blockFocusCleanup) {
            this.settings.unhighlight && this.settings.unhighlight.call(this, b, this.settings.errorClass, this.settings.validClass);
            this.addWrapper(this.errorsFor(b)).hide()
        }
    }, onfocusout: function (b, c) {
        if (!this.checkable(b) && (b.name in this.submitted || !this.optional(b))) {
            this.element(b)
        }
    }, onkeyup: function (b, c) {
        if (b.name in this.submitted || b == this.lastElement) {
            this.element(b)
        }
    }, onclick: function (b, c) {
        if (b.name in this.submitted) {
            this.element(b)
        } else {
            if (b.parentNode.name in this.submitted) {
                this.element(b.parentNode)
            }
        }
    }, highlight: function (b, c, d) {
        if (b.type === "radio") {
            this.findByName(b.name).addClass(c).removeClass(d)
        } else {
            a(b).addClass(c).removeClass(d)
        }
    }, unhighlight: function (b, c, d) {
        if (b.type === "radio") {
            this.findByName(b.name).removeClass(c).addClass(d)
        } else {
            a(b).removeClass(c).addClass(d)
        }
    }}, setDefaults: function (b) {
        a.extend(a.validator.defaults, b)
    }, messages: {required: "This field is required.", remote: "Please fix this field.", email: "Please enter a valid email address.", url: "Please enter a valid URL.", date: "Please enter a valid date.", dateISO: "Please enter a valid date (ISO).", number: "Please enter a valid number.", digits: "Please enter only digits.", creditcard: "Please enter a valid credit card number.", equalTo: "Please enter the same value again.", accept: "Please enter a value with a valid extension.", maxlength: a.validator.format("Please enter no more than {0} characters."), minlength: a.validator.format("Please enter at least {0} characters."), rangelength: a.validator.format("Please enter a value between {0} and {1} characters long."), range: a.validator.format("Please enter a value between {0} and {1}."), max: a.validator.format("Please enter a value less than or equal to {0}."), min: a.validator.format("Please enter a value greater than or equal to {0}.")}, autoCreateRanges: false, prototype: {init: function () {
        this.labelContainer = a(this.settings.errorLabelContainer);
        this.errorContext = this.labelContainer.length && this.labelContainer || a(this.currentForm);
        this.containers = a(this.settings.errorContainer).add(this.settings.errorLabelContainer);
        this.submitted = {};
        this.valueCache = {};
        this.pendingRequest = 0;
        this.pending = {};
        this.invalid = {};
        this.reset();
        var c = (this.groups = {});
        a.each(this.settings.groups, function (e, f) {
            a.each(f.split(/\s/), function (g, h) {
                c[h] = e
            })
        });
        var d = this.settings.rules;
        a.each(d, function (e, f) {
            d[e] = a.validator.normalizeRule(f)
        });
        function b(e) {
            var g = a.data(this[0].form, "validator"), f = "on" + e.type.replace(/^validate/, "");
            g.settings[f] && g.settings[f].call(g, this[0], e)
        }

        a(this.currentForm).validateDelegate("[type='text'], [type='password'], [type='file'], select, textarea, [type='number'], [type='search'] ,[type='tel'], [type='url'], [type='email'], [type='datetime'], [type='date'], [type='month'], [type='week'], [type='time'], [type='datetime-local'], [type='range'], [type='color'] ", "focusin focusout keyup", b).validateDelegate("[type='radio'], [type='checkbox'], select, option", "click", b);
        if (this.settings.invalidHandler) {
            a(this.currentForm).bind("invalid-form.validate", this.settings.invalidHandler)
        }
    }, form: function () {
        this.checkForm();
        a.extend(this.submitted, this.errorMap);
        this.invalid = a.extend({}, this.errorMap);
        if (!this.valid()) {
            a(this.currentForm).triggerHandler("invalid-form", [this])
        }
        this.showErrors();
        return this.valid()
    }, checkForm: function () {
        this.prepareForm();
        for (var c = 0, b = (this.currentElements = this.elements()); b[c]; c++) {
            this.check(b[c])
        }
        return this.valid()
    }, element: function (b) {
        b = this.validationTargetFor(this.clean(b));
        this.lastElement = b;
        this.prepareElement(b);
        this.currentElements = a(b);
        var c = this.check(b);
        if (c) {
            delete this.invalid[b.name]
        } else {
            this.invalid[b.name] = true
        }
        if (!this.numberOfInvalids()) {
            this.toHide = this.toHide.add(this.containers)
        }
        this.showErrors();
        return c
    }, showErrors: function (b) {
        if (b) {
            a.extend(this.errorMap, b);
            this.errorList = [];
            for (var c in b) {
                this.errorList.push({message: b[c], element: this.findByName(c)[0]})
            }
            this.successList = a.grep(this.successList, function (d) {
                return !(d.name in b)
            })
        }
        this.settings.showErrors ? this.settings.showErrors.call(this, this.errorMap, this.errorList) : this.defaultShowErrors()
    }, resetForm: function () {
        if (a.fn.resetForm) {
            a(this.currentForm).resetForm()
        }
        this.submitted = {};
        this.lastElement = null;
        this.prepareForm();
        this.hideErrors();
        this.elements().removeClass(this.settings.errorClass)
    }, numberOfInvalids: function () {
        return this.objectLength(this.invalid)
    }, objectLength: function (d) {
        var b = 0;
        for (var c in d) {
            b++
        }
        return b
    }, hideErrors: function () {
        this.addWrapper(this.toHide).hide()
    }, valid: function () {
        return this.size() == 0
    }, size: function () {
        return this.errorList.length
    }, focusInvalid: function () {
        if (this.settings.focusInvalid) {
            try {
                a(this.findLastActive() || this.errorList.length && this.errorList[0].element || []).filter(":visible").focus().trigger("focusin")
            } catch (b) {
            }
        }
    }, findLastActive: function () {
        var b = this.lastActive;
        return b && a.grep(this.errorList, function (c) {
            return c.element.name == b.name
        }).length == 1 && b
    }, elements: function () {
        var c = this, b = {};
        return a(this.currentForm).find("input, select, textarea").not(":submit, :reset, :image, [disabled]").not(this.settings.ignore).filter(function () {
            !this.name && c.settings.debug && window.console && console.error("%o has no name assigned", this);
            if (this.name in b || !c.objectLength(a(this).rules())) {
                return false
            }
            b[this.name] = true;
            return true
        })
    }, clean: function (b) {
        return a(b)[0]
    }, errors: function () {
        return a(this.settings.errorElement + "." + this.settings.errorClass, this.errorContext)
    }, reset: function () {
        this.successList = [];
        this.errorList = [];
        this.errorMap = {};
        this.toShow = a([]);
        this.toHide = a([]);
        this.currentElements = a([])
    }, prepareForm: function () {
        this.reset();
        this.toHide = this.errors().add(this.containers)
    }, prepareElement: function (b) {
        this.reset();
        this.toHide = this.errorsFor(b)
    }, check: function (d) {
        d = this.validationTargetFor(this.clean(d));
        var j = a(d).rules();
        var b = false;
        for (var f in j) {
            var h = {method: f, parameters: j[f]};
            try {
                var g = a.validator.methods[f].call(this, d.value.replace(/\r/g, ""), d, h.parameters);
                if (g == "dependency-mismatch") {
                    b = true;
                    continue
                }
                b = false;
                if (g == "pending") {
                    this.toHide = this.toHide.not(this.errorsFor(d));
                    return
                }
                if (!g) {
                    this.formatAndAdd(d, h);
                    return false
                }
            } catch (c) {
                this.settings.debug && window.console && console.log("exception occured when checking element " + d.id + ", check the '" + h.method + "' method", c);
                throw c
            }
        }
        if (b) {
            return
        }
        if (this.objectLength(j)) {
            this.successList.push(d)
        }
        return true
    }, customMetaMessage: function (b, d) {
        if (!a.metadata) {
            return
        }
        var c = this.settings.meta ? a(b).metadata()[this.settings.meta] : a(b).metadata();
        return c && c.messages && c.messages[d]
    }, customMessage: function (d, c) {
        var b = this.settings.messages[d];
        return b && (b.constructor == String ? b : b[c])
    }, findDefined: function () {
        for (var b = 0; b < arguments.length; b++) {
            if (arguments[b] !== undefined) {
                return arguments[b]
            }
        }
        return undefined
    }, defaultMessage: function (b, c) {
        return this.findDefined(this.customMessage(b.name, c), this.customMetaMessage(b, c), !this.settings.ignoreTitle && b.title || undefined, a.validator.messages[c], "<strong>Warning: No message defined for " + b.name + "</strong>")
    }, formatAndAdd: function (b, d) {
        var c = this.defaultMessage(b, d.method), e = /\$?\{(\d+)\}/g;
        if (typeof c == "function") {
            c = c.call(this, d.parameters, b)
        } else {
            if (e.test(c)) {
                c = jQuery.format(c.replace(e, "{$1}"), d.parameters)
            }
        }
        this.errorList.push({message: c, element: b});
        this.errorMap[b.name] = c;
        this.submitted[b.name] = c
    }, addWrapper: function (b) {
        if (this.settings.wrapper) {
            b = b.add(b.parent(this.settings.wrapper))
        }
        return b
    }, defaultShowErrors: function () {
        for (var d = 0; this.errorList[d]; d++) {
            var c = this.errorList[d];
            this.settings.highlight && this.settings.highlight.call(this, c.element, this.settings.errorClass, this.settings.validClass);
            this.showLabel(c.element, c.message)
        }
        if (this.errorList.length) {
            this.toShow = this.toShow.add(this.containers)
        }
        if (this.settings.success) {
            for (var d = 0; this.successList[d]; d++) {
                this.showLabel(this.successList[d])
            }
        }
        if (this.settings.unhighlight) {
            for (var d = 0, b = this.validElements(); b[d]; d++) {
                this.settings.unhighlight.call(this, b[d], this.settings.errorClass, this.settings.validClass)
            }
        }
        this.toHide = this.toHide.not(this.toShow);
        this.hideErrors();
        this.addWrapper(this.toShow).show()
    }, validElements: function () {
        return this.currentElements.not(this.invalidElements())
    }, invalidElements: function () {
        return a(this.errorList).map(function () {
            return this.element
        })
    }, showLabel: function (b, d) {
        var c = this.errorsFor(b);
        if (c.length) {
            c.removeClass(this.settings.validClass).addClass(this.settings.errorClass);
            c.attr("generated") && c.html(d)
        } else {
            c = a("<" + this.settings.errorElement + "/>").attr({"for": this.idOrName(b), generated: true}).addClass(this.settings.errorClass).html(d || "");
            if (this.settings.wrapper) {
                c = c.hide().show().wrap("<" + this.settings.wrapper + "/>").parent()
            }
            if (!this.labelContainer.append(c).length) {
                this.settings.errorPlacement ? this.settings.errorPlacement(c, a(b)) : c.insertAfter(b)
            }
        }
        if (!d && this.settings.success) {
            c.text("");
            typeof this.settings.success == "string" ? c.addClass(this.settings.success) : this.settings.success(c)
        }
        this.toShow = this.toShow.add(c)
    }, errorsFor: function (b) {
        var c = this.idOrName(b);
        return this.errors().filter(function () {
            return a(this).attr("for") == c
        })
    }, idOrName: function (b) {
        return this.groups[b.name] || (this.checkable(b) ? b.name : b.id || b.name)
    }, validationTargetFor: function (b) {
        if (this.checkable(b)) {
            b = this.findByName(b.name).not(this.settings.ignore)[0]
        }
        return b
    }, checkable: function (b) {
        return/radio|checkbox/i.test(b.type)
    }, findByName: function (c) {
        var b = this.currentForm;
        return a(document.getElementsByName(c)).map(function (e, d) {
            return d.form == b && d.name == c && d || null
        })
    }, getLength: function (c, b) {
        switch (b.nodeName.toLowerCase()) {
            case"select":
                return a("option:selected", b).length;
            case"input":
                if (this.checkable(b)) {
                    return this.findByName(b.name).filter(":checked").length
                }
        }
        return c.length
    }, depend: function (c, b) {
        return this.dependTypes[typeof c] ? this.dependTypes[typeof c](c, b) : true
    }, dependTypes: {"boolean": function (c, b) {
        return c
    }, string: function (c, b) {
        return !!a(c, b.form).length
    }, "function": function (c, b) {
        return c(b)
    }}, optional: function (b) {
        return !a.validator.methods.required.call(this, a.trim(b.value), b) && "dependency-mismatch"
    }, startRequest: function (b) {
        if (!this.pending[b.name]) {
            this.pendingRequest++;
            this.pending[b.name] = true
        }
    }, stopRequest: function (b, c) {
        this.pendingRequest--;
        if (this.pendingRequest < 0) {
            this.pendingRequest = 0
        }
        delete this.pending[b.name];
        if (c && this.pendingRequest == 0 && this.formSubmitted && this.form()) {
            a(this.currentForm).submit();
            this.formSubmitted = false
        } else {
            if (!c && this.pendingRequest == 0 && this.formSubmitted) {
                a(this.currentForm).triggerHandler("invalid-form", [this]);
                this.formSubmitted = false
            }
        }
    }, previousValue: function (b) {
        return a.data(b, "previousValue") || a.data(b, "previousValue", {old: null, valid: true, message: this.defaultMessage(b, "remote")})
    }}, classRuleSettings: {required: {required: true}, email: {email: true}, url: {url: true}, date: {date: true}, dateISO: {dateISO: true}, dateDE: {dateDE: true}, number: {number: true}, numberDE: {numberDE: true}, digits: {digits: true}, creditcard: {creditcard: true}}, addClassRules: function (b, c) {
        b.constructor == String ? this.classRuleSettings[b] = c : a.extend(this.classRuleSettings, b)
    }, classRules: function (c) {
        var d = {};
        var b = a(c).attr("class");
        b && a.each(b.split(" "), function () {
            if (this in a.validator.classRuleSettings) {
                a.extend(d, a.validator.classRuleSettings[this])
            }
        });
        return d
    }, attributeRules: function (c) {
        var e = {};
        var b = a(c);
        for (var d in a.validator.methods) {
            var f;
            if (d === "required" && typeof a.fn.prop === "function") {
                f = b.prop(d)
            } else {
                f = b.attr(d)
            }
            if (f) {
                e[d] = f
            } else {
                if (b[0].getAttribute("type") === d) {
                    e[d] = true
                }
            }
        }
        if (e.maxlength && /-1|2147483647|524288/.test(e.maxlength)) {
            delete e.maxlength
        }
        return e
    }, metadataRules: function (b) {
        if (!a.metadata) {
            return{}
        }
        var c = a.data(b.form, "validator").settings.meta;
        return c ? a(b).metadata()[c] : a(b).metadata()
    }, staticRules: function (b) {
        var c = {};
        var d = a.data(b.form, "validator");
        if (d.settings.rules) {
            c = a.validator.normalizeRule(d.settings.rules[b.name]) || {}
        }
        return c
    }, normalizeRules: function (c, b) {
        a.each(c, function (e, f) {
            if (f === false) {
                delete c[e];
                return
            }
            if (f.param || f.depends) {
                var d = true;
                switch (typeof f.depends) {
                    case"string":
                        d = !!a(f.depends, b.form).length;
                        break;
                    case"function":
                        d = f.depends.call(b, b);
                        break
                }
                if (d) {
                    c[e] = f.param !== undefined ? f.param : true
                } else {
                    delete c[e]
                }
            }
        });
        a.each(c, function (e, d) {
            c[e] = a.isFunction(d) ? d(b) : d
        });
        a.each(["minlength", "maxlength", "min", "max"], function () {
            if (c[this]) {
                c[this] = Number(c[this])
            }
        });
        a.each(["rangelength", "range"], function () {
            if (c[this]) {
                c[this] = [Number(c[this][0]), Number(c[this][1])]
            }
        });
        if (a.validator.autoCreateRanges) {
            if (c.min && c.max) {
                c.range = [c.min, c.max];
                delete c.min;
                delete c.max
            }
            if (c.minlength && c.maxlength) {
                c.rangelength = [c.minlength, c.maxlength];
                delete c.minlength;
                delete c.maxlength
            }
        }
        if (c.messages) {
            delete c.messages
        }
        return c
    }, normalizeRule: function (b) {
        if (typeof b == "string") {
            var c = {};
            a.each(b.split(/\s/), function () {
                c[this] = true
            });
            b = c
        }
        return b
    }, addMethod: function (d, c, b) {
        a.validator.methods[d] = c;
        a.validator.messages[d] = b != undefined ? b : a.validator.messages[d];
        if (c.length < 3) {
            a.validator.addClassRules(d, a.validator.normalizeRule(d))
        }
    }, methods: {required: function (e, b, c) {
        if (!this.depend(c, b)) {
            return"dependency-mismatch"
        }
        switch (b.nodeName.toLowerCase()) {
            case"select":
                var d = a(b).val();
                return d && d.length > 0;
            case"input":
                if (this.checkable(b)) {
                    return this.getLength(e, b) > 0
                }
            default:
                return a.trim(e).length > 0
        }
    }, remote: function (g, c, d) {
        if (this.optional(c)) {
            return"dependency-mismatch"
        }
        var e = this.previousValue(c);
        if (!this.settings.messages[c.name]) {
            this.settings.messages[c.name] = {}
        }
        e.originalMessage = this.settings.messages[c.name].remote;
        this.settings.messages[c.name].remote = e.message;
        d = typeof d == "string" && {url: d} || d;
        if (this.pending[c.name]) {
            return"pending"
        }
        if (e.old === g) {
            return e.valid
        }
        e.old = g;
        var f = this;
        this.startRequest(c);
        var b = {};
        b[c.name] = g;
        a.ajax(a.extend(true, {url: d, mode: "abort", port: "validate" + c.name, dataType: "json", data: b, success: function (k) {
            f.settings.messages[c.name].remote = e.originalMessage;
            var m = k === true;
            if (m) {
                var l = f.formSubmitted;
                f.prepareElement(c);
                f.formSubmitted = l;
                f.successList.push(c);
                f.showErrors()
            } else {
                var h = {};
                var j = k || f.defaultMessage(c, "remote");
                h[c.name] = e.message = a.isFunction(j) ? j(g) : j;
                f.showErrors(h)
            }
            e.valid = m;
            f.stopRequest(c, m)
        }}, d));
        return"pending"
    }, minlength: function (d, b, c) {
        return this.optional(b) || this.getLength(a.trim(d), b) >= c
    }, maxlength: function (d, b, c) {
        return this.optional(b) || this.getLength(a.trim(d), b) <= c
    }, rangelength: function (e, b, d) {
        var c = this.getLength(a.trim(e), b);
        return this.optional(b) || (c >= d[0] && c <= d[1])
    }, min: function (d, b, c) {
        return this.optional(b) || d >= c
    }, max: function (d, b, c) {
        return this.optional(b) || d <= c
    }, range: function (d, b, c) {
        return this.optional(b) || (d >= c[0] && d <= c[1])
    }, email: function (c, b) {
        return this.optional(b) || /^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(c)
    }, url: function (c, b) {
        return this.optional(b) || /^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(c)
    }, date: function (c, b) {
        return this.optional(b) || !/Invalid|NaN/.test(new Date(c))
    }, dateISO: function (c, b) {
        return this.optional(b) || /^\d{4}[\/-]\d{1,2}[\/-]\d{1,2}$/.test(c)
    }, number: function (c, b) {
        return this.optional(b) || /^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/.test(c)
    }, digits: function (c, b) {
        return this.optional(b) || /^\d+$/.test(c)
    }, creditcard: function (h, d) {
        if (this.optional(d)) {
            return"dependency-mismatch"
        }
        if (/[^0-9 -]+/.test(h)) {
            return false
        }
        var f = 0, g = 0, b = false;
        h = h.replace(/\D/g, "");
        for (var e = h.length - 1; e >= 0; e--) {
            var c = h.charAt(e);
            var g = parseInt(c, 10);
            if (b) {
                if ((g *= 2) > 9) {
                    g -= 9
                }
            }
            f += g;
            b = !b
        }
        return(f % 10) == 0
    }, accept: function (d, b, c) {
        c = typeof c == "string" ? c.replace(/,/g, "|") : "png|jpe?g|gif";
        return this.optional(b) || d.match(new RegExp(".(" + c + ")$", "i"))
    }, equalTo: function (e, b, c) {
        var d = a(c).unbind(".validate-equalTo").bind("blur.validate-equalTo", function () {
            a(b).valid()
        });
        return e == d.val()
    }}});
    a.format = a.validator.format
})(jQuery);
(function (a) {
    var c = {};
    if (a.ajaxPrefilter) {
        a.ajaxPrefilter(function (f, d, g) {
            var e = f.port;
            if (f.mode == "abort") {
                if (c[e]) {
                    c[e].abort()
                }
                c[e] = g
            }
        })
    } else {
        var b = a.ajax;
        a.ajax = function (f) {
            var d = ("mode" in f ? f : a.ajaxSettings).mode, e = ("port" in f ? f : a.ajaxSettings).port;
            if (d == "abort") {
                if (c[e]) {
                    c[e].abort()
                }
                return(c[e] = b.apply(this, arguments))
            }
            return b.apply(this, arguments)
        }
    }
})(jQuery);
(function (a) {
    if (!jQuery.event.special.focusin && !jQuery.event.special.focusout && document.addEventListener) {
        a.each({focus: "focusin", blur: "focusout"}, function (d, b) {
            a.event.special[b] = {setup: function () {
                this.addEventListener(d, c, true)
            }, teardown: function () {
                this.removeEventListener(d, c, true)
            }, handler: function (f) {
                arguments[0] = a.event.fix(f);
                arguments[0].type = b;
                return a.event.handle.apply(this, arguments)
            }};
            function c(f) {
                f = a.event.fix(f);
                f.type = b;
                return a.event.handle.call(this, f)
            }
        })
    }
    a.extend(a.fn, {validateDelegate: function (b, d, c) {
        return this.bind(d, function (e) {
            var f = a(e.target);
            if (f.is(b)) {
                return c.apply(f, arguments)
            }
        })
    }})
})(jQuery);
(function (m) {
    var p = m.validator, n, r = "unobtrusiveValidation";

    function o(d, e, f) {
        d.rules[e] = f;
        if (d.message) {
            d.messages[e] = d.message
        }
    }

    function u(b) {
        return b.replace(/^\s+|\s+$/g, "").split(/\s*,\s*/g)
    }

    function s(b) {
        return b.substr(0, b.lastIndexOf(".") + 1)
    }

    function q(c, d) {
        if (c.indexOf("*.") === 0) {
            c = c.replace("*.", d)
        }
        return c
    }

    function y(f, g) {
        var a = m(this).find("[data-valmsg-for='" + g[0].name + "']"), h = m.parseJSON(a.attr("data-valmsg-replace")) !== false;
        a.removeClass("field-validation-valid").addClass("field-validation-error");
        f.data("unobtrusiveContainer", a);
        if (h) {
            a.empty();
            f.removeClass("input-validation-error").appendTo(a)
        } else {
            f.hide()
        }
    }

    function w(h, g) {
        var f = m(this).find("[data-valmsg-summary=true]"), a = f.find("ul");
        if (a && a.length && g.errorList.length) {
            a.empty();
            f.addClass("validation-summary-errors").removeClass("validation-summary-valid");
            m.each(g.errorList, function () {
                m("<li />").html(this.message).appendTo(a)
            })
        }
    }

    function v(e) {
        var a = e.data("unobtrusiveContainer"), f = m.parseJSON(a.attr("data-valmsg-replace"));
        if (a) {
            a.addClass("field-validation-valid").removeClass("field-validation-error");
            e.removeData("unobtrusiveContainer");
            f && a.empty()
        }
    }

    function t(f) {
        var a = m(f), e = a.data(r);
        if (!e) {
            e = {options: {errorClass: "input-validation-error", errorElement: "span", errorPlacement: m.proxy(y, f), invalidHandler: m.proxy(w, f), messages: {}, rules: {}, success: m.proxy(v, f)}, attachValidation: function () {
                a.validate(this.options)
            }, validate: function () {
                a.validate();
                return a.valid()
            }};
            a.data(r, e)
        }
        return e
    }

    p.unobtrusive = {adapters: [], parseElement: function (a, A) {
        var j = m(a), l = j.parents("form")[0], h, k, z;
        if (!l) {
            return
        }
        h = t(l);
        h.options.rules[a.name] = k = {};
        h.options.messages[a.name] = z = {};
        m.each(this.adapters, function () {
            var b = "data-val-" + this.name, e = j.attr(b), d = {};
            if (e !== undefined) {
                b += "-";
                m.each(this.params, function () {
                    d[this] = j.attr(b + this)
                });
                this.adapt({element: a, form: l, message: e, params: d, rules: k, messages: z})
            }
        });
        jQuery.extend(k, {__dummy__: true});
        !A && h.attachValidation()
    }, parse: function (a) {
        m(a).find(":input[data-val=true]").each(function () {
            p.unobtrusive.parseElement(this, true)
        });
        m("form").each(function () {
            var b = t(this);
            b && b.attachValidation()
        })
    }};
    n = p.unobtrusive.adapters;
    n.add = function (f, d, e) {
        if (!e) {
            e = d;
            d = []
        }
        this.push({name: f, params: d, adapt: e});
        return this
    };
    n.addBool = function (c, d) {
        return this.add(c, function (a) {
            o(a, d || c, true)
        })
    };
    n.addMinMax = function (k, z, l, c, j, h) {
        return this.add(k, [j || "min", h || "max"], function (a) {
            var g = a.params.min, f = a.params.max;
            if (g && f) {
                o(a, c, [g, f])
            } else {
                if (g) {
                    o(a, z, g)
                } else {
                    f && o(a, l, f)
                }
            }
        })
    };
    n.addSingleVal = function (c, e, f) {
        return this.add(c, [e || "val"], function (a) {
            o(a, f || c, a.params[e])
        })
    };
    p.addMethod("__dummy__", function () {
        return true
    });
    p.addMethod("regex", function (f, g, h) {
        var e;
        if (this.optional(g)) {
            return true
        }
        e = (new RegExp(h)).exec(f);
        return e && e.index === 0 && e[0].length === f.length
    });
    n.addSingleVal("accept", "exts").addSingleVal("regex", "pattern");
    n.addBool("creditcard").addBool("date").addBool("digits").addBool("email").addBool("number").addBool("url");
    n.addMinMax("length", "minlength", "maxlength", "rangelength").addMinMax("range", "min", "max", "range");
    n.add("equalto", ["other"], function (a) {
        var g = s(a.element.name), j = a.params.other, c = q(j, g), e = m(a.form).find(":input[name=" + c + "]")[0];
        o(a, "equalTo", e)
    });
    n.add("required", function (b) {
        (b.element.tagName.toUpperCase() !== "INPUT" || b.element.type.toUpperCase() !== "CHECKBOX") && o(b, "required", true)
    });
    n.add("remote", ["url", "type", "additionalfields"], function (a) {
        var c = {url: a.params.url, type: a.params.type || "GET", data: {}}, e = s(a.element.name);
        m.each(u(a.params.additionalfields || a.element.name), function (f, d) {
            var b = q(d, e);
            c.data[b] = function () {
                return m(a.form).find(":input[name='" + b + "']").val()
            }
        });
        o(a, "remote", c)
    });
    m(function () {
        p.unobtrusive.parse(document)
    })
})(jQuery);
(function (d) {
    tfl.logs.create("tfl.utils: loaded");
    d.supportsSVG = function () {
        if (!!document.createElementNS && !!document.createElementNS("http://www.w3.org/2000/svg", "svg").createSVGRect) {
            d.supportsSVG = function () {
                return true
            }
        } else {
            $(document.body).addClass("nosvg");
            d.supportsSVG = function () {
                return false
            }
        }
    };
    d.supportsFlexbox = function () {
        var f = ["flexWrap", "webkitFlexWrap", "mozFlexWrap", "msFlexWrap"];
        for (var e in f) {
            if (document.body.style[e] !== undefined) {
                $(document.body).addClass("flexbox");
                d.supportsFlexbox = function () {
                    return true
                };
                return true
            }
        }
        $(document.body).addClass("no-flexbox");
        d.supportsFlexbox = function () {
            return false
        };
        return false
    };
    d.isTouchDevice = function () {
        return !!("ontouchstart" in window) || !!("onmsgesturechange" in window)
    };
    d.requestAnimFrame;
    function b() {
        if (window.requestAnimationFrame) {
            d.requestAnimFrame = function (e) {
                window.requestAnimationFrame(e)
            }
        } else {
            if (window.webkitRequestAnimationFrame) {
                d.requestAnimFrame = function (e) {
                    window.webkitRequestAnimationFrame(e)
                }
            } else {
                if (window.mozRequestAnimationFrame) {
                    d.requestAnimFrame = function (e) {
                        window.mozRequestAnimationFrame(e)
                    }
                } else {
                    d.requestAnimFrame = function (e) {
                        window.setTimeout(e, 1000 / 60)
                    }
                }
            }
        }
    }

    function c() {
        Array.prototype.indexOf = function (h) {
            if (this == null) {
                throw new TypeError()
            }
            var g, e, j = Object(this), f = j.length >>> 0;
            if (f === 0) {
                return -1
            }
            g = 0;
            if (arguments.length > 1) {
                g = Number(arguments[1]);
                if (g != g) {
                    g = 0
                } else {
                    if (g != 0 && g != Infinity && g != -Infinity) {
                        g = (g > 0 || -1) * Math.floor(Math.abs(g))
                    }
                }
            }
            if (g >= f) {
                return -1
            }
            for (e = g >= 0 ? g : Math.max(f - Math.abs(g), 0); e < f; e++) {
                if (e in j && j[e] === h) {
                    return e
                }
            }
            return -1
        }
    }

    d.runOnImgComplete = function (f, e) {
        if (f.nodeType === 1 && f.tagName.toLowerCase() === "img" && f.src !== "") {
            if (f.complete || f.readyState === 4) {
                e()
            } else {
                if (f.readyState === "uninitialized" && f.src.indexOf("data:") === 0) {
                    tfl.logs.create("tfl.utils.runOnImgComplete: failed to load " + f.src)
                } else {
                    f.one("load", e)
                }
            }
        }
    };
    function a() {
        tfl.logs.create("tfl.utils: started");
        d.supportsSVG();
        d.supportsFlexbox();
        if (!Array.prototype.indexOf) {
            c()
        }
        b()
    }

    a()
})(window.tfl.utils = window.tfl.utils || {});
(function (a) {
    a.dictionary = {MoreOptions: "Accessibility & travel options", LessOptions: "Fewer options", CustomisedOptions: $.cookie("jp-pref") !== null ? " (customised)" : "", ShowDetailedView: "View Details", HideDetailedView: "Hide Details", ShowAllStops: "View all stops", HideAllStops: "Hide all stops", ShowTextInstructions: "View text instructions", HideTextInstructions: "Hide text instructions", NowText: "Now", TodayText: "Today", RemoveContentClass: ".remove-content", JpTypeCycling: "cycling", JpTypeWalking: "walking", FirstServiceText: "First service", LastServiceText: "Last service", CurrentLocationText: "Current location "};
    a.logs.create("tfl.dictionary: loaded")
})(window.tfl = window.tfl || {});
(function (b) {
    function a(c) {
        if (c === undefined) {
            tfl.logs.create("error instantiating object - mandatory field not populated");
            return false
        }
        return true
    }

    b.modes = [tfl.modeNameTube, tfl.modeNameBus, tfl.modeNameTram, tfl.modeNameRiver, tfl.modeNameCableCar, tfl.modeNameMultiModal];
    b.SSPObject = function (d, c, e) {
        var e = e || {};
        if (!a(d) || !a(c)) {
            return{error: "naptanId and mode are mandatory"}
        }
        if (b.modes.indexOf(c) < 0) {
            return{error: "invalid mode supplied"}
        }
        this.naptanId = d;
        this.mode = c;
        this.props = $.extend({lines: [], name: "", towards: ""}, e)
    };
    tfl.logs.create("tfl.objects: loaded")
})(window.tfl.objects = window.tfl.objects || {});
var tfl = tfl || {};
(function (a) {
    a.logs.create("tfl.core: loaded");
    a.init = function () {
        a.logs.create("tfl.core: started");
        a.responsive.init();
        a.interactions.init()
    };
    a.getQueryParam = function (b, f) {
        if (!f) {
            f = window.location.search
        }
        b = b.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]").toLowerCase();
        var d = "[\\?&]" + b + "=([^&#]*)";
        var c = new RegExp(d);
        var e = c.exec(f.toLowerCase());
        if (e == null) {
            return""
        } else {
            return decodeURIComponent(e[1].replace(/\+/g, " "))
        }
    };
    a.interactions = {init: function () {
        a.logs.create("tfl.interactions: started");
        a.interactions.externalLinks();
        $(".top-row .more").click(a.interactions.toggleNavigation);
        $(".show-mobile-search").click(a.interactions.toggleMobileSearch);
        $("#footer h2.heading").wrap('<a href="#info-for" class="info-for-link" />');
        $("#footer a.info-for-link").click(a.interactions.toggleFooter);
        $(".cookie-policy-button a").click(a.interactions.hideCookiesPolicyNotice);
        a.storage.showIfNotDisabled("cookiePolicyNoticeHidden", function () {
            $(".cookie-policy-notice").show()
        });
        $(document).keydown(function (d) {
            var f = [], b = $(document.activeElement);
            if (d.shiftKey && d.keyCode == 9) {
                var c = b.attr("data-jumpback") || b.data("jumpback");
                if (c !== undefined) {
                    f = typeof(c) === "string" ? $(c) : f = c
                }
            } else {
                if (d.which == 9) {
                    var g = b.attr("data-jumpto") || b.data("jumpto");
                    if (g !== undefined) {
                        f = typeof(g) === "string" ? $(g) : f = g
                    }
                }
            }
            if (f.length > 0) {
                f = f.length > 1 ? f.first() : f;
                f.focus();
                $(".ui-menu-item").hide();
                return false
            }
        });
        $("input[type='text']").attr("autocomplete", "off")
    }, hideCookiesPolicyNotice: function () {
        $(".cookie-policy-notice").hide();
        a.storage.set("cookiePolicyNoticeHidden", "true");
        if ($("html.lt-ie8").length > 0) {
            var b = $(".top-row, #full-width-content");
            b.addClass("ie7-fix");
            window.setTimeout(function () {
                b.removeClass("ie7-fix")
            }, 5)
        }
        return false
    }, toggleNavigation: function () {
        var b = $(".extra-nav");
        if ($(".top-row.show-search").is(":visible")) {
            a.interactions.toggleMobileSearch()
        }
        $(".top-row .more").children("a").toggleClass("expanded");
        b.toggleClass("expanded");
        $("#container").toggleClass("menu-visible");
        b.find(".menu-sub-section:last").find("ul").find("li:last").find("a").blur(function () {
            $("input#q").focus()
        });
        return false
    }, externalLinks: function () {
        a.logs.create("external link classes: initialised");
        $("a").filter(function () {
            return this.hostname && this.hostname !== location.hostname
        }).addClass("external-link");
        $("a.external-link,a.document-download-wrap").attr("target", "_parent");
        a.logs.create("external link classes: added");
        var b = $("p a.external-link").each(function () {
            var c = $(this).attr("href");
            $(this).after("<a class='ext-span' href=" + c + "></a>")
        })
    }, toggleMobileSearch: function () {
        if ($(".extra-nav.expanded").is(":visible")) {
            a.interactions.toggleNavigation()
        }
        var b = $(".show-mobile-search");
        var c = ".journey-form #plan-a-journey tabbable:first,#main-hero :tabbable:first";
        var d = "#query";
        if (b.attr("data-jumpto") === c) {
            b.attr("data-jumpto", d)
        } else {
            if (b.attr("data-jumpto") === d) {
                b.attr("data-jumpto", c)
            }
        }
        $(".search-tools").find("a").css("top", "5px");
        $(".top-row").toggleClass("show-search");
        return false
    }, toggleFooter: function () {
        $(".primary-footer").toggleClass("expanded");
        return false
    }};
    a.responsive = {init: function () {
        a.logs.create("tfl.responsive: started");
        a.responsive.setupBreakpoints();
        $(".top-row .logo").after("<ul class='collapsible-menu clearfix'>&nbsp;</ul>");
        var b = $(".collapsible-menu");
        b.append($(".plan-journey").clone());
        b.append($(".status-update").clone());
        b.append($(".maps").clone());
        b.append($(".fares-and-payments").clone());
        $(".collapsible-menu a").removeAttr("data-jumpback");
        b.append("<li class='more'><a href='javascript:void(0)' data-jumpto='.extra-nav a:visible:first'><span class='text'>More...</span><span class='arrow'>&nbsp;</span></a></li></li>");
        $(".texts").append('<div class="search"><a href="javascript:void(0);" class="show-mobile-search" data-jumpto=".journey-form #plan-a-journey tabbable:first,#main-hero :tabbable:first"><span class="search-icon hide-text">Search</span><span class="collapse"></span><span class="expand"></span></a></div>');
        $(".top-row-extras").prepend("<div class='more'><a href='javascript:void(0)' data-jumpto='.extra-nav a:first:visible'><span class='text'>Menu</span><span class='arrow'>&nbsp;</span></a></li></div>");
        $(".moving-source-order").appendAround();
        a.responsive.initLazyLoadedImages()
    }, setupBreakpoints: function () {
        $(window).setBreakpoints({distinct: false, breakpoints: a.settings.devices})
    }, initLazyLoadedImages: function () {
        $("[data-img]").each(function () {
            var c = $(this);
            var b = function () {
                $(c).children("img").remove();
                var d = $("<img>").attr({src: c.attr("data-img"), alt: c.attr("data-img-alt")}).load(function () {
                    if (c.data("img-background")) {
                        c.css("background-image", "url(" + c.attr("data-img") + ")")
                    } else {
                        c.prepend(d);
                        d.attr({width: d.width(), height: d.height()})
                    }
                });
                if (d[0].width) {
                    d.load()
                }
            };
            if ($(this).attr("data-img-breakpoint") === "medium") {
                $(window).one("enterBreakpointMedium", b);
                if ($("body.breakpoint-Medium").length > 0) {
                    $(window).trigger("enterBreakpointMedium")
                }
            } else {
                $(window).one("enterBreakpointLarge", b);
                if ($("body.breakpoint-Large").length > 0) {
                    $(window).trigger("enterBreakpointLarge")
                }
            }
        })
    }};
    $.fn.tflPopup = function (q) {
        var p = $(this);
        var t = $.extend({title: "This is the default title", content: "", showingPercentage: 100, displayNoThanksLink: true, displayNotAgainLink: true, noThanksLinkText: "No thanks", notAgainLinkText: "No thanks, and don't ask me again", links: [], campaignId: "DefaultPopup", }, q);
        if (a.storage.get("Popups." + t.campaignId)) {
            return
        }
        if (t.showingPercentage < 100) {
            var s = Math.floor(Math.random() * 100);
            if (s > t.showingPercentage) {
                return
            }
        }
        var r = $("<div></div>").addClass("popup");
        var u = $("<div></div>").addClass("popup-title").text(t.title);
        var j = $('<span class="popup-title-icon white-up-arrow"></span>');
        var c = $("<div></div>").addClass("popup-content");
        if (t.content.length > 0) {
            c.append($("<p></p>").text(t.content))
        }
        for (var h = 0; h < t.links.length; h++) {
            var k = t.links[h];
            var m = $("<a></a>").attr({href: k.url, title: k.title}).addClass("plain-button").text(k.title);
            c.append(m)
        }
        var g = function (l) {
            r.addClass("hidden");
            l.preventDefault()
        };
        var b = function (l) {
            a.storage.set("Popups." + t.campaignId, true);
            l.preventDefault()
        };
        if (t.displayNoThanksLink) {
            var o = $("<a></a>").attr({href: "#", title: t.noThanksLinkText}).addClass("plain-button").text(t.noThanksLinkText);
            c.append(o);
            o.click(g)
        }
        if (t.displayNotAgainLink && a.storage.isLocalStorageSupported()) {
            var n = $("<a></a>").attr({href: "#", title: t.notAgainLinkText}).addClass("plain-button").text(t.notAgainLinkText);
            c.append(n);
            n.click(g).click(b)
        }
        r.append(u.append(j)).append(c);
        p.append(r);
        var f = c.outerHeight(true);
        var d = {bottom: (f * -1) + "px"};
        var e = {bottom: 0};
        r.click(function () {
            var l = $(this);
            if (l.css("bottom") === "0px") {
                l.css(d);
                j.attr("class", "popup-title-icon white-up-arrow")
            } else {
                l.css(e);
                j.attr("class", "popup-title-icon white-down-arrow")
            }
        }).css(d)
    };
    $.fn.tflBanner = function (j) {
        var h = $(this);
        var n = $.extend({title: "This is the default title", showingPercentage: 100, links: [], campaignId: "DefaultBanner"}, j);
        if (n.showingPercentage === 0 || a.storage.get("Banners." + n.campaignId)) {
            return
        }
        if (n.showingPercentage < 100) {
            var m = Math.floor(Math.random() * 100);
            if (m > n.showingPercentage) {
                return
            }
        }
        var c = function (l) {
            k.addClass("hidden");
            l.preventDefault()
        };
        var b = function (l) {
            a.storage.set("Banners." + n.campaignId, true);
            l.preventDefault()
        };
        var k = $("<div></div>").addClass("popup-banner");
        var o = $("<span></span>").addClass("popup-title").text(n.title);
        var e = $('<a href="#" class="popup-title-icon close-icon-white hide-text"><span>Close this banner</span></a>');
        e.click(c).click(b);
        for (var d = 0; d < n.links.length; d++) {
            var f = n.links[d];
            var g = $("<a></a>").attr({href: f.url, title: f.title, "class": "popup-link"}).text(f.title);
            o.append(g)
        }
        k.append(o).append(e);
        h.append(k)
    };
    a.init()
})(tfl);
(function (c) {
    var a = new Array();
    c.api = {BikePoint: c.apiUrl + "BikePoint", BikePointId: c.apiUrl + "BikePoint/{0}", LineStatus: c.apiUrl + "Line/Mode/{0}/Status?detail=true", LinePlannedWorks: c.apiUrl + "Line/Mode/{0}/Status/{1}/to/{2}?detail=true", Routes: c.apiUrl + "Routes", RoutesSearch: c.apiUrl + "Search/Route/%QUERY?includelines=true&includestations=false&modes={0}", StopPointsDisruptions: c.apiUrl + "StopPoint/{0}/Disruption", StopPointsSearch: c.apiUrl + "StopPoint/search/%QUERY?modes={0}&maxResults=25&oysterOnly={1}", StopPointsDisruptionsTimePeriod: c.apiUrl + "StopPoint/{0}/Disruption/{1}/to/{2}", StopPointsDisruptionsByModeAndTimePeriod: c.apiUrl + "StopPoint/Mode/{0}/Disruption/{1}/to/{2}"};
    c.autoRefresh = {BikePoint: 305000, Predictions: 10000, ServiceBoard: 65000};
    var b = c.settings.debug ? {} : {app_id: c.appId, app_key: c.appKey};
    c.addAppIdAndKey = function (d) {
        if (!c.settings.debug) {
            if (d.indexOf("?") != -1) {
                return d + "&app_id=" + c.appId + "&app_key=" + c.appKey
            } else {
                return d + "?app_id=" + c.appId + "&app_key=" + c.appKey
            }
        } else {
            return d
        }
    };
    c.ajax = function (f) {
        if (typeof(f) !== "object" || !f.url || !f.success) {
            c.logs.create("invalid paramaters passed to tfl.ajax");
            c.logs.create(f);
            if (typeof(f.error) === "function") {
                f.error()
            }
            return false
        }
        var e = {data: b, dataType: "json", success: null, error: function (j, k, h) {
            c.logs.create("tfl.ajax: Error with ajax call");
            c.logs.create(k);
            c.logs.create(h);
            c.logs.create(j)
        }, autoRefreshInterval: null};
        var g = $.extend(true, {}, e, f);
        if (g.autoRefreshInterval !== null) {
            g.complete = function () {
                a[g.autoRefreshId] = setTimeout(function () {
                    c.ajax(f)
                }, parseInt(g.autoRefreshInterval))
            }
        }
        var d = function () {
            c.logs.create("tfl.ajax: " + g.url);
            $.ajax(g)
        };
        c.utils.requestAnimFrame(d)
    };
    c.stopAjaxAutoRefresh = function (d) {
        clearTimeout(a[d])
    };
    c.logs.create("tfl.ajax: loaded")
})(window.tfl = window.tfl || {});
(function (a) {
    a.settings = function () {
        $.validator.setDefaults({onfocusout: false, onfocusin: false, onkeyup: false, onclick: false})
    };
    a.setSelectBoxSpan = function (b) {
        var c = $(b).children("option:selected").text();
        $(b).attr("title", c).siblings("span").text(c)
    };
    a.updateSelectBox = function () {
        a.setSelectBoxSpan(this)
    }, a.setupSelectBoxes = function () {
        $(".selector select").before("<span />").each(function () {
            a.setSelectBoxSpan(this);
            $(this).focus(function () {
                $(this).parent().addClass("focus")
            });
            $(this).blur(function () {
                $(this).parent().removeClass("focus")
            })
        }).change(a.updateSelectBox)
    };
    a.setupSelectBox = function (b, c) {
        $(b + " select").before("<span />");
        $(b + " select").attr("title", c).siblings("span").text(c);
        $(b).focus(function () {
            $(b).parent().addClass("focus")
        });
        $(b).blur(function () {
            $(b).parent().removeClass("focus")
        });
        $(b + " select").change(a.updateSelectBox)
    };
    a.modeSelectAll = function (b) {
        $(b).click(function () {
            var c = $(this).parent().siblings("ul");
            if (!$(this).hasClass("select-all")) {
                c.children("li.ticked").each(function () {
                    $(this).children("input").trigger("click")
                })
            } else {
                c.children("li").not(".ticked").each(function () {
                    $(this).children("input").trigger("click")
                });
                $(this).removeClass("select-all").text("Deselect all")
            }
        })
    };
    a.setupCheckBoxSelectall = function (d) {
        var c = $("<div class='select-deselect-option'><a href='javascript:void(0);'>Deselect All</a></div>");
        var f = c.children("a");
        $(d).parent().prepend(c);
        var e = $(d).find("input");
        var b = function () {
            var g = true;
            for (var h = 0; h < e.length; h++) {
                if (!$(e[h]).is(":checked")) {
                    g = false;
                    break
                }
            }
            if (g) {
                f.text("Deselect all");
                f.removeClass("select-all")
            } else {
                f.text("Select all");
                f.addClass("select-all")
            }
        };
        e.click(b);
        b();
        a.modeSelectAll(f)
    };
    a.setupCheckboxLists = function () {
        tfl.logs.create("tfl.forms: setup checkbox lists");
        $(".to-checkbox-list").each(function () {
            var c = $("<ul class='clearfix'></ul>");
            var b = 1;
            var d = $(this).children("option").length;
            $(this).children().each(function () {
                var g = $("<li></li>");
                if (b % 2 === 1) {
                    g.addClass("odd")
                }
                var j = $(this).attr("value");
                var e = $(this).text();
                var f = $("<input type='checkbox' />").attr("id", j);
                if ($(this).attr("selected") !== undefined) {
                    f.attr("checked", "checked")
                }
                g.append(f);
                var h = $("<label for='" + j + "' class='" + j + "'></label>");
                h.append(e);
                g.append(h);
                c.append(g);
                b++
            });
            $(this).after(c);
            if ($(this).hasClass("select-all")) {
                c.addClass("select-all");
                a.setupCheckBoxSelectall(c)
            }
            $(this).hide()
        })
    };
    a.setupHorizontalToggles = function () {
        tfl.logs.create("tfl.forms: setup horizontal toggles");
        $(".horizontal-toggle-buttons").each(function () {
            var b = $(this).find("input");
            b.filter(":checked").parent().addClass("selected");
            b.focus(function () {
                $(this).parent().addClass("focus")
            });
            b.blur(function () {
                $(this).parent().removeClass("focus")
            });
            var c = b.parent();
            b.change(function () {
                c.removeClass("selected");
                $(this).parent().addClass("selected")
            })
        })
    };
    a.setupCustomInputs = function () {
        $(".checkbox-list input[type='checkbox'], .radiobutton-list input[type='radio'], .styled-checkbox input[type='checkbox']").each(function () {
            if ($(this).attr("checked") === "checked") {
                $(this).parent().addClass("ticked")
            }
            $(this).focus(function () {
                $(this).parent().addClass("focus")
            });
            $(this).blur(function () {
                $(this).parent().removeClass("focus")
            })
        })
    };
    a.toggleCustomInput = function (c) {
        var d = $(this).parents(".radiobutton-list");
        if (d.length > 0) {
            $(this).parent().parent().children("li,.radiobutton-list-item").removeClass("ticked")
        }
        $(this).parent().toggleClass("ticked");
        var f = $(this).parent().parent().prev("select.to-checkbox-list");
        if (f.length > 0) {
            var b = $(this);
            var g = function () {
                var e = b.attr("checked") === "checked";
                if (e) {
                    f.find("option[value='" + b.attr("id") + "']").attr("selected", "selected")
                } else {
                    f.find("option[value='" + b.attr("id") + "']").removeAttr("selected")
                }
            };
            setTimeout(g, 10)
        }
    };
    a.toggleMoreInfo = function (b) {
        b.preventDefault();
        $(this).closest(".more-info-header").toggleClass("expanded")
    };
    a.init = function (b) {
        a.settings();
        a.setupSelectBoxes();
        a.setupCheckboxLists();
        a.setupHorizontalToggles();
        a.setupCustomInputs();
        $(".checkbox-list input[type='checkbox'], .radiobutton-list input[type='radio']").click(a.toggleCustomInput);
        $(".styled-checkbox input[type='checkbox']").click(a.toggleCustomInput);
        $(".more-info-header .show-more-info").click(a.toggleMoreInfo)
    };
    a.init()
}(window.tfl.forms = window.tfl.forms || {}));
(function (a) {
    tfl.logs.create("tfl.geolocation: loaded");
    a.minAccuracy = 1000;
    a.geocoder = null;
    a.geolocationTimeout = 10000;
    a.isGeolocationSupported = function () {
        if ("geolocation" in navigator && navigator.geolocation !== null) {
            tfl.logs.create("tfl.geolocation: isGeolocationSupported true");
            return true
        } else {
            tfl.logs.create("tfl.geolocation: isGeolocationSupported false");
            return false
        }
    };
    a.geolocateMe = function (g, b) {
        tfl.logs.create("tfl.geolocation: geolocate me");
        a.clearGeolocationError();
        var d = $(g);
        d.typeahead("val", "");
        d.originalPlaceholder = d.attr("placeholder");
        d.attr("placeholder", "Finding address...");
        var h = function (e) {
            if (e.coords && e.coords.accuracy && e.coords.accuracy > tfl.geolocation.minAccuracy) {
                tfl.logs.create("tfl.geolocation.geolocate me: ERROR: inaccuracy too high: " + e.coords.accuracy + "m");
                a.geolocationError("We cannot find your current location. Please try again", d);
                d.parent().siblings(tfl.removableContent.RemoveContentClass).hide();
                return
            }
            $(g + "Geolocation").val(e.coords.longitude + "," + e.coords.latitude);
            a.setupInputBoxForGeolocation(d);
            if (b) {
                b()
            }
        };
        var f = function (e) {
            d.parent().siblings(tfl.removableContent.RemoveContentClass).hide();
            d.closest("[data-current-location]").removeAttr("data-current-location");
            if (e.code) {
                if (e.code === 1) {
                    tfl.logs.create("tfl.geolocation.geolocateMe: ERROR: permission denied");
                    a.geolocationError("Permission from browser needed before finding your location", d)
                } else {
                    if (e.code === 2) {
                        tfl.logs.create("tfl.geolocation.geolocateMe: ERROR: position unavailable");
                        a.geolocationError("We cannot find your current location. Please try again", d)
                    } else {
                        if (e.code === 3) {
                            tfl.logs.create("tfl.geolocation.geolocateMe: ERROR: timeout");
                            a.geolocationError("We cannot find your current location. Please try again", d)
                        }
                    }
                }
            } else {
                a.geolocationError("We cannot find your current location. Please try again", d)
            }
        };
        try {
            navigator.geolocation.getCurrentPosition(h, f, {timeout: a.geolocationTimeout})
        } catch (c) {
            a.geolocationError("Your device does not support the location feature", d)
        }
    };
    a.geolocationError = function (c, b) {
        $(".geolocation-error").text(c).removeClass("hidden");
        b.attr("placeholder", b.originalPlaceholder);
        $("[data-current-location]").removeAttr("data-current-location");
        b.focus()
    };
    a.clearGeolocationError = function () {
        $(".geolocation-error").addClass("hidden")
    };
    a.setupInputBoxForGeolocation = function (b) {
        var c = [9, 16, 17, 18, 19, 20, 33, 34, 35, 36, 37, 38, 39, 40, 45, 46, 91, 92, 93, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 144, 145];
        var d = b.parent();
        d.attr("data-current-location", "true");
        d.addClass("geocoded");
        b.typeahead("val", tfl.dictionary.CurrentLocationText);
        b.on("keydown", function (f) {
            if (c.indexOf(f.keyCode) > -1) {
                return
            }
            if (d.attr("data-current-location")) {
                d.removeAttr("data-current-location");
                d.removeClass("geocoded");
                b.typeahead("val", "");
                $(b.selector + "Geolocation").val("")
            }
        })
    }
}(window.tfl.geolocation = window.tfl.geolocation || {}));
window.tfl.autocomplete = window.tfl.autocomplete || {};
(function (b) {
    tfl.logs.create("tfl.autocomplete.sources: loaded");
    b.autocompleteDisplayNumberLimit = 10;
    b.stationsStopsSelectionCallback = function (h, f) {
        var g = $(h);
        var d = f.a || f.placeId;
        g.attr("data-" + g.attr("id").toLowerCase() + "-id", d);
        var e = JSON.stringify(f.c ? f.c : f.placeModes);
        g.attr("data-" + g.attr("id").toLowerCase() + "-modes", e)
    };
    b.stationsStopsRemoveContent = function (d) {
        var c = $(d);
        c.removeAttr("data-" + c.attr("id").toLowerCase() + "-id");
        c.removeAttr("data-" + c.attr("id").toLowerCase() + "-modes")
    };
    function a(c, d) {
        if (c.a.length < d.a.length) {
            return -1
        }
        if (c.a.length > d.a.length) {
            return 1
        }
        return 0
    }

    b.getGeolocation = function (e) {
        var c = function (f) {
            $(f).removeAttr("data-dataset-name");
            b.stationsStopsRemoveContent(f);
            tfl.geolocation.geolocateMe(f, e)
        };
        var d = Hogan.compile("<a class='geolocation-link' href='javascript:void(0)'><span class='geolocation-icon'>&nbsp</span>{{value}}</a>");
        return{typeaheadSource: {callback: c, displayKey: "value", name: "geolocation", templates: {suggestion: d.render.bind(d), footer: "<span class='source-footer'>&nbsp</span>"}}, dataEngine: new Bloodhound({datumTokenizer: function () {
            return[""]
        }, queryTokenizer: function () {
            return[""]
        }, limit: 1, minLength: 0, local: [
            {value: "Use my location"}
        ]})}
    };
    b.getRecentSearches = function (h, g, c, j, e, f) {
        if (f == null) {
            f = 5
        }
        var d = Hogan.compile(j);
        return{typeaheadSource: {callback: c, displayKey: e, name: h, templates: {suggestion: d.render.bind(d), footer: "<span class='source-footer'>&nbsp</span>", header: "<span class='source-header'>Recent searches</span>"}}, dataEngine: new Bloodhound({datumTokenizer: function () {
            return[""]
        }, queryTokenizer: function () {
            return[""]
        }, limit: f, minLength: 0, local: g})}
    };
    b.getTurnOnOffRecentSearches = function (e, d) {
        var c = Hogan.compile("<span class='recent-searches-on-off-footer'><a href='javascript:void(0)'>{{linkText}}</a></span>");
        d[0].dataset = e ? "recent-searches-footer-on" : "recent-searches-footer-off";
        return{typeaheadSource: {displayKey: "linkText", name: e ? "recent-searches-footer-on" : "recent-searches-footer-off", templates: {suggestion: c.render.bind(c), footer: "<span class='source-footer'>&nbsp</span>"}}, dataEngine: new Bloodhound({datumTokenizer: function () {
            return[""]
        }, queryTokenizer: function () {
            return[""]
        }, limit: 1, minLength: 0, local: d})}
    };
    b.getJourneyPlannerSuggestions = function () {
        var c = Hogan.compile("<div class='mode-icons'>{{#c}}<span class='mode-icon {{.}}-icon'>&nbsp;</span>{{/c}}</div><span class='stop-name'>{{b}}</span>");
        return{typeaheadSource: {displayKey: "b", name: "journey-planner-suggestions", templates: {suggestion: c.render.bind(c)}, callback: b.stationsStopsSelectionCallback, removeContent: b.stationsStopsRemoveContent}, dataEngine: new Bloodhound({datumTokenizer: function (e) {
            var f = tfl.autocomplete.tokenize(e, "b");
            return f.tokens != null ? f.tokens : Bloodhound.tokenizers.whitespace(e.b)
        }, queryTokenizer: Bloodhound.tokenizers.whitespace, limit: b.autocompleteDisplayNumberLimit, minLength: 1, prefetch: {url: "/cdn/static/feed/stations-list_typeahead.json", ttl: 2629740000}})}
    };
    b.routesSearchFactory = function (e, c, f) {
        var d = Hogan.compile("<span class='mode-icon {{c}}-icon'>&nbsp;<span class='{{f}}'>&nbsp;</span></span><span class='stop-name' data-id='{{b}}'>{{a}}{{#h.length}} (towards {{h}}){{/h.length}}</span>");
        return{typeaheadSource: {displayKey: "a", minLength: 1, name: "routes-search", templates: {suggestion: d.render.bind(d)}, callback: c}, dataEngine: new Bloodhound({datumTokenizer: function (g) {
            return Bloodhound.tokenizers.whitespace(g.a)
        }, queryTokenizer: Bloodhound.tokenizers.whitespace, limit: b.autocompleteDisplayNumberLimit, minLength: 1, remote: {url: tfl.addAppIdAndKey(tfl.api.RoutesSearch.format(e)), cache: true, replace: function (k, j) {
            var g = "";
            if (j !== null && j.length > 0) {
                var h = new RegExp(f, "g");
                g = k.replace("%QUERY", decodeURIComponent(j).replace(h, ""))
            }
            return g
        }, filter: function (o) {
            var q = [];
            var s = o.searchMatches;
            if (s != null) {
                for (var h = 0; h < s.length; h++) {
                    var r = s[h];
                    if (r.mode === tfl.modeNameTube) {
                        r.cssClass = r.lineName.indexOf(" ") != -1 ? r.lineName.substring(0, r.lineName.indexOf(" ")).toLowerCase() : r.lineName.toLowerCase()
                    } else {
                        r.cssClass = ""
                    }
                    if (r.mode === tfl.modeNameBus) {
                        for (var l = 0; l < r.lineRouteSection.length; l++) {
                            var g = true;
                            var n = r.lineRouteSection[l];
                            for (var m = 0; m < q.length; m++) {
                                var p = q[m];
                                if (p.b == r.lineId && p.g == n.direction) {
                                    g = false;
                                    break
                                }
                            }
                            if (r.lineName !== o.input) {
                                g = false
                            }
                            if (g) {
                                q.push({a: r.lineName, b: r.lineId, c: r.mode, f: r.cssClass, g: n.direction, h: [n.destination]})
                            }
                        }
                    } else {
                        q.push({a: r.lineName + (r.mode == tfl.modeNameTube ? " line" : ""), b: r.lineId, c: r.mode, f: r.cssClass})
                    }
                    q.sort(a)
                }
            }
            return q
        }}})}
    };
    b.stopPointsSearchFactory = function (f, c, e, h, g) {
        h = h != true ? false : true;
        if (e == null) {
            e = false
        }
        if (h == null) {
            h = false
        }
        if (g == null) {
            g = "stop-points-search"
        }
        var d = Hogan.compile("<div class='mode-icons'>{{#c}}<span class='mode-icon {{.}}-icon'>&nbsp;</span>{{/c}}</div><span class='stop-name' data-id='{{b}}'>{{a}}</span>");
        return{typeaheadSource: {displayKey: "a", minLength: 1, name: g, templates: {suggestion: d.render.bind(d)}, callback: c}, dataEngine: new Bloodhound({datumTokenizer: function (j) {
            return Bloodhound.tokenizers.whitespace(j.value)
        }, queryTokenizer: Bloodhound.tokenizers.whitespace, limit: b.autocompleteDisplayNumberLimit, minLength: 1, remote: {url: tfl.addAppIdAndKey(tfl.api.StopPointsSearch.format(f, h)), cache: true, replace: function (m, l) {
            var j = "";
            if (l !== null && l.length > 0) {
                var k = new RegExp("[^a-zA-Z0-9 &-/().']", "g");
                return m.replace("%QUERY", decodeURIComponent(l).replace(k, ""))
            }
            return j
        }, filter: function (m) {
            function l(r, s) {
                var t = s.c.length - r.c.length;
                if (t === 0) {
                    return r.a > s.a ? 1 : -1
                } else {
                    return t
                }
            }

            function k(s, t) {
                for (var r = 0; r < t.length; r++) {
                    if (t[r].id == s.parentId) {
                        return false
                    }
                }
                return true
            }

            function q(r) {
                if (r.modes && r.modes.length > 2) {
                    return false
                } else {
                    return true
                }
            }

            var p = m.matches;
            var n = [];
            if (p != null) {
                for (var j = 0; j < p.length; j++) {
                    var o = p[j];
                    if (e) {
                        if (q(o)) {
                            n.push({a: o.name, b: o.id, c: o.modes, d: o.lat, e: o.lon})
                        }
                    } else {
                        if (k(o, p)) {
                            n.push({a: o.name, b: o.id, c: o.modes, d: o.lat, e: o.lon})
                        }
                    }
                }
                n.sort(l)
            }
            return n
        }}})}
    }
})(window.tfl.autocomplete.sources = window.tfl.autocomplete.sources || {});
(function (b) {
    tfl.logs.create("tfl.autocomplete: loaded");
    b.ClearSearchBox = "clear-search-box";
    var a = {highlight: true, hint: false, minLength: 0};
    b.setup = function (f, e, h, d) {
        if ($("html").hasClass("lt-ie8")) {
            return
        }
        tfl.logs.create("tfl.autocomplete.setup: started");
        var c = $(f);
        if (h === null) {
            h = a
        }
        var g = [];
        $(e).each(function () {
            if (typeof this === "function") {
                return
            }
            var o = this.typeaheadSource;
            var j = this.dataEngine;
            if (j.remote && j.remote.filter && j.remote.replace) {
                var m = j.remote.replace;
                var n = function (q, p) {
                    c.parent(".twitter-typeahead").addClass("downloading");
                    return m(q, p)
                };
                j.remote.replace = n;
                var l = j.remote.filter;
                var k = function (q) {
                    var p = l(q);
                    c.parent(".twitter-typeahead").removeClass("downloading");
                    return p
                };
                j.remote.filter = k
            }
            j.initialize();
            o.source = j.ttAdapter();
            g.push(o)
        });
        c.typeahead(h, g).on("keydown.autocomplete", function (l) {
            var j = c.attr("data-dataset-name");
            if (j) {
                for (var m = 0; m < g.length; m++) {
                    var k = g[m];
                    if (j === k.name) {
                        if (k.keydown) {
                            k.keydown(l, f)
                        }
                        break
                    }
                }
            }
        }).on("typeahead:selected typeahead:autocompleted", function (m, l, j) {
            c.trigger("focus");
            if (j) {
                for (var n = 0; n < g.length; n++) {
                    var k = g[n];
                    if (j === k.name) {
                        if (k.callback) {
                            k.callback(f, l, j)
                        }
                        if (k.contextCallback) {
                            k.contextCallback(f, l, j)
                        }
                        break
                    }
                }
                c.attr("data-dataset-name", j)
            }
        }).parent().siblings(tfl.dictionary.RemoveContentClass).bind(b.ClearSearchBox, function () {
            $(this).click()
        });
        if (d) {
            c.parent().siblings(tfl.dictionary.RemoveContentClass).click(function () {
                var j = c.attr("data-dataset-name");
                if (j) {
                    for (var l = 0; l < g.length; l++) {
                        var k = g[l];
                        if (j === k.name) {
                            if (k.removeContent) {
                                k.removeContent(c)
                            }
                            break
                        }
                    }
                    c.removeAttr("data-dataset-name")
                }
                c.typeahead("val", "")
            })
        }
    };
    b.tokenize = function (m, s) {
        var j = ["'", "(", "&", "-", ")"];
        var o = s != null ? m[s].trim().split(" ") : m.trim().split(" ");
        var q = s != null ? m[s].trim().split(" ") : m.trim().split(" ");
        var t = false;
        for (var g = 0; g < o.length; g++) {
            var n = o[g];
            switch (n.toLowerCase()) {
                case"st":
                    q.push("st.");
                    t = true;
                    break;
                case"st.":
                    q.push("st");
                    t = true;
                    break;
                case"&":
                    q.push("and");
                    t = true;
                    break;
                case"and":
                    q.push("&");
                    t = true;
                    break
            }
            for (var h = 0; h < j.length; h++) {
                var u = j[h];
                if (n.indexOf(u) !== -1) {
                    q.push.apply(q, n.trim().split(u));
                    t = true
                }
            }
        }
        if (t && q.length > 0) {
            var k = [];
            for (var l = 0; l < q.length; l++) {
                var f = true;
                var p = q[l];
                if (q.length >= l + 1 && q[l + 1] === "s") {
                    p += "s"
                }
                for (var r = 0; r < k.length; r++) {
                    if (p === k[r]) {
                        f = false;
                        break
                    }
                }
                if (p !== "s" && p !== "" && f) {
                    k.push(p)
                }
            }
            if (k.length > 0) {
                m.tokens = k
            }
        }
        return m
    }
})(window.tfl.autocomplete = window.tfl.autocomplete || {});
window.tfl.autocomplete = window.tfl.autocomplete || {};
(function (a) {
    tfl.logs.create("tfl.autocomplete.recentMagicSearches: loaded");
    a.searches = {};
    a.usingRecentSearches = tfl.storage.get("usingRecentMagicSearches", true);
    a.isLoaded = false;
    a.recentSearchNumberLimit = 5;
    a.recentSearchTimeLimit = 2629740000;
    a.useRecentSearches = function (b) {
        a.usingRecentSearches = b;
        tfl.storage.set("usingRecentMagicSearches", a.usingRecentSearches);
        a.searches = {};
        tfl.storage.set("recentMagicSearches", a.searches);
        return false
    };
    a.loadSearches = function () {
        tfl.logs.create("tfl.autocomplete.recentMagicSearches.loadSearches: initialised");
        if (!a.isLoaded) {
            if (a.usingRecentSearches) {
                a.searches = tfl.storage.get("recentMagicSearches", {});
                var f = new Date().getTime();
                var d;
                for (var g in a.searches) {
                    if (a.searches.hasOwnProperty(g)) {
                        for (var e in a.searches[g]) {
                            if (a.searches[g].hasOwnProperty(e)) {
                                for (var b = 0; b < a.searches[g][e].length; b++) {
                                    if (a.searches[g][e][b] !== undefined) {
                                        var c = a.searches[g][e][b];
                                        if (!c.hasOwnProperty("lastSearchDate") || c.lastSearchDate < (f - a.recentSearchTimeLimit)) {
                                            tfl.logs.create("tfl.autocomplete.recentMagicSearches: removing old searches");
                                            a.searches[g][e].splice(b, 1);
                                            d = true
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                if (d) {
                    tfl.storage.set("recentMagicSearches", a.searches)
                }
            }
            a.isLoaded = true
        }
    };
    a.saveSearch = function (q, m, p, s, j, l, f, h, g) {
        tfl.logs.create("tfl.autocomplete.recentMagicSearches.saveSearch: initialised");
        a.loadSearches();
        if (q === "") {
            return true
        }
        if (m === null) {
            m = ""
        }
        if (f === null) {
            f = ""
        }
        if (h === null) {
            h = ""
        }
        if (g === null) {
            g = ""
        }
        if (typeof p == "string" && p !== "") {
            p = jQuery.parseJSON(p)
        }
        if (p === null) {
            p = []
        }
        var u = new Date().getTime();
        if (s == "lines") {
            var o = p[0].toString();
            if (a.searches[s]) {
                if (a.searches[s][o]) {
                    for (var d = 0; d < a.searches[s][o].length; d++) {
                        var k = a.searches[s][o][d];
                        if (k.id.toLowerCase() == m.toLowerCase()) {
                            a.searches[s][o].splice(d, 1);
                            break
                        }
                    }
                } else {
                    a.searches[s][o] = []
                }
            } else {
                a.searches[s] = {};
                a.searches[s][o] = []
            }
            var n = {lastSearchDate: u, name: q, id: m, mode: o, cssClass: f, direction: h, destination: g, type: s};
            a.searches[s][o].splice(0, 0, n);
            if (a.searches[s][o].length > a.recentSearchNumberLimit) {
                a.searches[s][o].length = a.recentSearchNumberLimit
            }
        } else {
            if (s == "stops") {
                if (a.searches[s]) {
                    for (var e = 0; e < a.searches[s].length; e++) {
                        var t = a.searches[s][e];
                        if (t.id.toLowerCase() == m.toLowerCase()) {
                            a.searches[s].splice(e, 1);
                            break
                        }
                    }
                } else {
                    a.searches[s] = []
                }
                var r = {lastSearchDate: u, name: q, id: m, modes: p, lat: j, lon: l, type: s};
                a.searches[s].splice(0, 0, r);
                if (a.searches[s].length > a.recentSearchNumberLimit) {
                    a.searches[s].length = a.recentSearchNumberLimit
                }
            }
        }
        tfl.storage.set("recentMagicSearches", a.searches);
        return true
    };
    a.geolocateMe = function (h, b) {
        var g = function (e) {
            $(".geolocation-error").text(e).removeClass("hidden")
        };
        tfl.logs.create("tfl.autocomplete.recentMagicSearches.geolocateMe: initialised");
        var d = $(h);
        d.typeahead("val", "");
        d.attr("placeholder", "Finding address...");
        var j = function (e) {
            if (e.coords && e.coords.accuracy && e.coords.accuracy > 1000000) {
                tfl.logs.create("tfl.journeyPlanner.searchForm.geolocate me: ERROR: inaccuracy too high: " + e.coords.accuracy + "m");
                g("We cannot find your current location. Please try again");
                return
            }
            d.val(e.coords.longitude + "," + e.coords.latitude);
            $(h).append("<input type='hidden' id='lat' name='lat' value='" + e.coords.latitude + "' />");
            $(h).append("<input type='hidden' id='lon' name='lon' value='" + e.coords.longitude + "' />");
            if (b) {
                b()
            }
        };
        var f = function (e) {
            if (e.code) {
                if (e.code === 1) {
                    tfl.logs.create("tfl.journeyPlanner.searchForm.geolocateMe: ERROR: permission denied");
                    g("Permission from browser needed before finding your location")
                } else {
                    if (e.code === 2) {
                        tfl.logs.create("tfl.journeyPlanner.searchForm.geolocateMe: ERROR: position unavailable");
                        g("We cannot find your current location. Please try again")
                    } else {
                        if (e.code === 3) {
                            tfl.logs.create("tfl.journeyPlanner.searchForm.geolocateMe: ERROR: timeout");
                            g("We cannot find your current location. Please try again")
                        }
                    }
                }
            } else {
                g("We cannot find your current location. Please try again")
            }
        };
        try {
            navigator.geolocation.getCurrentPosition(j, f)
        } catch (c) {
            g("Your device does not support the location feature")
        }
    }
})(window.tfl.autocomplete.recentMagicSearches = window.tfl.autocomplete.recentMagicSearches || {});
(function (c) {
    var b = "data-highlight-image";
    var a = "data-highlight-file";
    c.init = function () {
        var f = "no-background-image";
        var e = $("[" + b + "]");
        e.push($("[" + a + "]"));
        var d = [];
        $(window).one("enterBreakpointMedium", function () {
            $.each(e, function (m, q) {
                var o = $(q), l = $(o.attr("data-highlight-for"));
                d.push(l);
                if (o.attr(b)) {
                    l.attr("style", "background-image: url(" + o.attr(b) + ")")
                } else {
                    if (o.attr(a)) {
                        tfl.ajax({url: o.attr(a), success: p})
                    }
                }
                function p(s) {
                    var k = $.grep(s, function (u) {
                        return u.active
                    });
                    var t = k[Math.floor(Math.random() * (k.length))];
                    l.attr("style", "background-image: url(" + t.backgroundImage + ")");
                    var r = l.find(".advert-link-box").attr("href", t.link).show();
                    r.find("h2").text(t.headline);
                    r.find("p").text(t.text);
                    r.find("img").attr("src", t.imageURL)
                }

                var n = o.clone();
                n.find("img").each(function () {
                    $(this).remove()
                });
                l.find(".content-area").append(n);
                o.addClass(o.attr("data-highlight-size"));
                var g = o.find(".caption");
                if (g) {
                    if (g.parent().hasClass("small")) {
                        var h = l.find(".content-area.medium-large");
                        h.addClass("no-caption");
                        var j = Math.max(415, l.find(".hero-row").height());
                        h.find(".advert-tile").css({height: j + "px"})
                    }
                }
            })
        });
        $(window).bind("exitBreakpointMedium", function () {
            $.each(d, function (g, h) {
                $(h).addClass(f)
            })
        });
        $(window).bind("enterBreakpointMedium", function () {
            $.each(d, function (g, h) {
                $(h).removeClass(f)
            })
        });
        if ($("body.breakpoint-Medium").length > 0) {
            $(window).trigger("enterBreakpointMedium")
        }
        if ($("body.breakpoint-Large").length > 0) {
            $(window).trigger("enterBreakpointLarge")
        }
    };
    c.init()
}(window.tfl.heroTakeover = window.tfl.heroTakeover || {}));
(function (c) {
    tfl.logs.create("tfl.recent: loaded");
    var d = 5;

    function f(g) {
        return g.replace(/-([a-z])/g, function (h) {
            return h[1] !== undefined ? h[1].toUpperCase() : h[1]
        })
    }

    function b() {
        var g;
        c.values = {};
        for (g = 0; g < tfl.objects.modes.length; g += 1) {
            c.values[f(tfl.objects.modes[g])] = []
        }
    }

    function e() {
        var h = tfl.storage.get("recent");
        if (h != null) {
            for (var g in h) {
                if (h.hasOwnProperty(g)) {
                    if (!c.values.hasOwnProperty(g)) {
                        delete h[g]
                    }
                }
            }
            c.values = $.extend(c.values, h)
        }
    }

    c.saveRecent = function () {
        tfl.storage.set("recent", c.values)
    };
    Array.prototype.remove = function (g, j) {
        var h = this.slice((j || g) + 1 || this.length);
        this.length = g < 0 ? this.length + g : g;
        return this.push.apply(this, h)
    };
    c.addRecent = function (j) {
        if (typeof(j) !== "object" || !j.hasOwnProperty("mode") || j.mode === "" || !j.hasOwnProperty("naptanId") || j.naptanId === "") {
            tfl.logs.create("Add recent expects object defined in tfl.objects");
            return false
        } else {
            var g = false;
            for (var h = 0; h < c.values[f(j.mode)].length; h += 1) {
                if (c.values[f(j.mode)][h].naptanId === j.naptanId) {
                    g = true;
                    c.values[f(j.mode)].remove(h);
                    c.values[f(j.mode)].unshift(j);
                    break
                }
            }
            if (!g) {
                c.values[f(j.mode)].unshift(j);
                if (c.values[f(j.mode)].length > d) {
                    c.values[f(j.mode)].remove(d)
                }
            }
            c.saveRecent();
            return true
        }
    };
    c.getRecent = function (j) {
        if (typeof(j) === "string") {
            for (var h in c.values) {
                if (c.values.hasOwnProperty(h)) {
                    for (var g = 0; g < c.values[h].length; g += 1) {
                        if (c.values[h][g].naptanId === j) {
                            return c.values[h][g]
                        }
                    }
                }
            }
        } else {
            tfl.logs.create("Error in tfl.favourites.getRecent - Expected naptanId");
            return false
        }
        return false
    };
    c.getRecentArray = function (g) {
        var h = [];
        if (c.values.hasOwnProperty(g)) {
            h = c.values[g]
        } else {
            for (var g in c.values) {
                if (c.values.hasOwnProperty(g)) {
                    h = h.concat(tfl.recent.values[g])
                }
            }
        }
        return h
    };
    c.removeRecent = function (j) {
        if (typeof(j) === "string" || typeof(j) === "number") {
            for (var h in c.values) {
                if (c.values.hasOwnProperty(h)) {
                    for (var g = 0; g < c.values[h].length; g += 1) {
                        if (c.values[h][g].naptanId === j) {
                            delete c.values[h][g]
                        }
                    }
                }
            }
        } else {
            tfl.logs.create("Error in tfl.recent.removeRecent - Expected naptanId");
            return false
        }
        c.saveRecent();
        return true
    };
    c.clearRecent = function () {
        b();
        c.saveRecent()
    };
    function a() {
        if (tfl.storage.isLocalStorageSupported()) {
            b();
            e()
        }
        tfl.logs.create("tfl.recent: setup")
    }

    a()
})(window.tfl.recent = window.tfl.recent || {});
(function (f) {
    tfl.logs.create("tfl.favourites: loaded");
    var b = {};

    function h(j) {
        return j.replace(/-([a-z])/g, function (k) {
            return k[1] !== undefined ? k[1].toUpperCase() : k[1]
        })
    }

    function d() {
        var j;
        f.values = {};
        for (j = 0; j < tfl.objects.modes.length; j += 1) {
            f.values[h(tfl.objects.modes[j])] = {}
        }
    }

    function g() {
        var j = tfl.storage.get("favourites");
        if (j != null) {
            for (var k in j) {
                if (j.hasOwnProperty(k)) {
                    if (!f.values.hasOwnProperty(k)) {
                        delete j[k]
                    }
                }
            }
            f.values = $.extend(f.values, j)
        }
    }

    f.saveFavourites = function () {
        tfl.storage.set("favourites", f.values)
    };
    f.addFavourite = function (k) {
        if (typeof(k) !== "object" || !k.hasOwnProperty("mode") || k.mode === "" || !k.hasOwnProperty("naptanId") || k.naptanId === "") {
            tfl.logs.create("Add Favourite expects object defined in tfl.objects");
            return false
        } else {
            f.values[h(k.mode)][k.naptanId] = k;
            f.saveFavourites();
            if (b.hasOwnProperty(k.naptanId)) {
                for (var j = 0; j < b[k.naptanId].dom.length; j += 1) {
                    b[k.naptanId].dom[j].addClass("active")
                }
            }
            return true
        }
    };
    f.getFavourite = function (j) {
        if (typeof(j) === "string") {
            for (mode in f.values) {
                if (f.values.hasOwnProperty(mode)) {
                    if (f.values[mode][j] !== undefined) {
                        return f.values[mode][j]
                    }
                }
            }
        } else {
            tfl.logs.create("Error in tfl.favourites.getFavourite - Expected naptanId");
            return false
        }
        return false
    };
    f.getFavouritesArray = function (j) {
        var k = [];
        if (f.values.hasOwnProperty(j)) {
            for (var l in f.values[j]) {
                if (f.values[j].hasOwnProperty(l)) {
                    k.push(f.values[j][l])
                }
            }
        } else {
            for (var j in f.values) {
                if (f.values.hasOwnProperty(j)) {
                    for (var l in f.values[j]) {
                        if (tfl.favourites.values[j].hasOwnProperty(l)) {
                            k.push(tfl.favourites.values[j][l])
                        }
                    }
                }
            }
        }
        return k
    };
    f.removeFavourite = function (l) {
        if (typeof(l) === "string" || typeof(l) === "number") {
            for (var k in f.values) {
                if (f.values.hasOwnProperty(k)) {
                    delete f.values[k][l]
                }
            }
        } else {
            tfl.logs.create("Error in tfl.favourites.removeFavourite - Expected naptanId");
            return false
        }
        f.saveFavourites();
        if (b.hasOwnProperty(l)) {
            for (var j = 0; j < b[l].dom.length; j += 1) {
                b[l].dom[j].removeClass("active")
            }
        }
        return true
    };
    f.clearFavourites = function () {
        d();
        f.saveFavourites();
        for (var k in b) {
            if (b.hasOwnProperty(k)) {
                for (var j = 0; j < b[k].dom.length; j += 1) {
                    b[k].dom[j].removeClass("active")
                }
            }
        }
    };
    function a(j, k) {
        var l = k ? "active" : "";
        j.append('<a href="javascript:void(0)" class="plain-link with-icon favourite ' + l + '"><span class="i favourite-icon"></span><span class="inactive">Add Favourite</span><span class="active">Favourited <span class="visually-hidden">Click to remove from favourites</span></span></a>');
        return j.find(">.favourite")
    }

    f.setupButtons = function () {
        var j = $("[data-favourite]"), k;
        j.each(function () {
            var m = $(this), n = m.data("favourite"), p = false, r, l, o;
            if (typeof(n) === "string") {
                var q = f.getFavourite(n);
                if (!q) {
                    m.removeAttr("data-favourite");
                    tfl.logs.create("tfl.favourites: fail to set up button, string provided - doesnt match existing favourite");
                    return true
                }
                p = true;
                r = q
            } else {
                if (typeof(n) !== "object") {
                    m.removeAttr("data-favourite");
                    tfl.logs.create("tfl.favourites: neither string nor object passed to setupButtons");
                    return true
                }
            }
            if (!p) {
                if (!n.hasOwnProperty("naptanId") || !n.hasOwnProperty("mode")) {
                    m.removeAttr("data-favourite");
                    tfl.logs.create("tfl.favourites: object passed to setup button has no mode or naptanId");
                    return true
                }
                r = new tfl.objects.SSPObject(n.naptanId, n.mode, n.props);
                if (r.hasOwnProperty("error")) {
                    m.removeAttr("data-favourite");
                    tfl.logs.create("tfl.favourites: properties passed to setup button generate invalid SSPObject");
                    return true
                }
            }
            l = a(m, f.values[h(r.mode)].hasOwnProperty(r.naptanId));
            if (!b.hasOwnProperty(r.naptanId)) {
                b[r.naptanId] = {data: r, dom: [l]}
            } else {
                if (p) {
                    b[r.naptanId].data = $.extend(r, b[r.naptanId].data)
                } else {
                    b[r.naptanId].data = $.extend(b[r.naptanId].data, r)
                }
                b[r.naptanId].dom.push(l)
            }
            l.on("click", function (s) {
                s.preventDefault();
                if ($(this).hasClass("active")) {
                    f.removeFavourite(r.naptanId)
                } else {
                    f.addFavourite(b[r.naptanId].data)
                }
            });
            o = m.data("favourite-class");
            if (o !== undefined) {
                l.addClass(o)
            }
            m.parent().addClass("with-favourite");
            m.removeAttr("data-favourite");
            tfl.recent.addRecent(r)
        })
    };
    function e(j, q) {
        var v = Hogan.compile(q);
        var n = f.getFavouritesArray(tfl.modeNameBus);
        var s = tfl.recent.getRecentArray(tfl.modeNameBus);

        function t() {
            var y = v.render({items: n, name: "favourite", hidden: "", itemsHeading: "favourited bus stops", noItemsMessage: "You currently don't have an favourite bus stops saved, save some bus stops as your favourites and they shall appear here in future!"});
            var z = v.render({items: s, name: "recent", hidden: "hidden", itemsHeading: "recently searched bus stops", noItemsMessage: "No bus stops in your recent search history."});
            var w = $('<div class="tab-wrapper"><ul class="tabs-style-2"><li class="selected" data-target="favourite"><a href="#">Favourites</a></li><li data-target="recent"><a href="#">Recent</a></li></ul></div>');
            w.append(y);
            w.append(z);
            j.append(w);
            f.setupButtons();
            if (n.length > 5) {
                tfl.navigation.pagination.setup(j.find(".favourite .bus-stops").parent(), ".bus-stops", 5, n.length)
            }
            if (s.length > 5) {
                tfl.navigation.pagination.setup(j.find(".recent .bus-stops").parent(), ".bus-stops", 5, s.length)
            }
            var w = j.find(".tabs-style-2 > li:not(.not-for-beta)");
            w.on("click", function (C) {
                C.preventDefault();
                C.stopPropagation();
                var B = $(this);
                if (!B.hasClass("selected")) {
                    var A = B.parent().siblings();
                    A.addClass("hidden");
                    A.filter("." + B.data("target")).removeClass("hidden");
                    B.addClass("selected").siblings(".selected").removeClass("selected")
                }
            });
            if (!$(q).find(".links-only").length) {
                tfl.expandableBox.init()
            }
        }

        var m = n.concat(s);
        if (m.length) {
            var r = m.length;
            var o = 0;
            var k = {};
            var l = [];
            for (var p = 0; p < r; p += 1) {
                if (l.indexOf(m[p].naptanId) < 0) {
                    l.push(m[p].naptanId)
                }
            }
            var u = tfl.tools.getQueryStringParameter("startDate");
            if (u !== null) {
                k.url = tfl.api.StopPointsDisruptionsTimePeriod.format(l.join(","), u, tfl.tools.getQueryStringParameter("endDate"))
            } else {
                k.url = tfl.api.StopPointsDisruptions.format(l.join(","))
            }
            k.success = function (A) {
                for (var w = 0; w < A.length; w += 1) {
                    var y = A[w];
                    favs:for (var z = 0; z < n.length; z += 1) {
                        if (n[z].naptanId === y.stationAtcoCode) {
                            console.log("FOUND " + y.stationAtcoCode);
                            n[z].props.disrupted = "disrupted";
                            if (!n[z].props.hasOwnProperty("disruptionInfo")) {
                                n[z].props.disruptionInfo = ""
                            }
                            n[z].props.disruptionInfo += "<p>" + A[w].description + "</p>";
                            break favs
                        }
                    }
                    rec:for (var z = 0; z < s.length; z += 1) {
                        if (s[z].naptanId === y.stationAtcoCode) {
                            console.log("FOUND " + y.stationAtcoCode);
                            s[z].props.disrupted = "disrupted";
                            if (!s[z].props.hasOwnProperty("disruptionInfo")) {
                                s[z].props.disruptionInfo = ""
                            }
                            s[z].props.disruptionInfo += "<p>" + A[w].description + "</p>";
                            break rec
                        }
                    }
                }
                t()
            };
            tfl.ajax(k)
        }
    }

    f.setupFavouritesAndRecent = function (k) {
        var j = $(k.selector);
        if (j.length) {
            tfl.ajax({url: "/static/" + tfl.settings.version + "/templates/" + k.markup + ".html", success: function (l) {
                e(j, l)
            }, dataType: "html"})
        }
    };
    function c() {
        if (tfl.storage.isLocalStorageSupported()) {
            d();
            g();
            f.setupButtons();
            f.setupFavouritesAndRecent({selector: ".favourite-and-recent", markup: "bus-stop-disruption"})
        }
        tfl.logs.create("tfl.favourites: setup")
    }

    c()
})(window.tfl.favourites = window.tfl.favourites || {});
(function (e) {
    tfl.logs.create("tfl.navigation.pullContent: started");
    var d, b, a, f;
    e.dataAttr = "data-pull-content";
    var c = "data-pull-content-storage";
    e.pullContentHandler = function (j) {
        j.preventDefault();
        f = $(this);
        var o = f.attr(c), n;
        if (o) {
            n = tfl.storage.get(o);
            if (n) {
                return false
            } else {
                tfl.storage.set(o, "true")
            }
        }
        var h = f.attr(e.dataAttr).split(","), p = f.attr("href"), m = f.attr("data-light-box-type"), l = parseInt(f.attr("data-light-box-min-width"), 10);
        tfl.logs.create("tfl.navigation.pullContent: Clicked a pull link for " + p);
        if (!isNaN(l) && l > $(window).width()) {
            window.open(p, "_blank");
            return false
        }
        m = m === undefined ? "alert" : m;
        d.attr("data-type", m);
        var g = function (t) {
            var r = $(t), q = false, u;
            for (var s = 0; s < h.length; s++) {
                $.each(r.find($.trim(h[s])), function (w, z) {
                    q = true;
                    var y = $("<p></p>").append($(z)).html();
                    b.append(y)
                })
            }
            if (!q) {
                document.location.href = p;
                return true
            }
            a.focus();
            u = b.find(":tabbable");
            $(u[u.length - 1]).addClass("light-box-last-tab-target").attr("data-jumpto", ".close-light-box")
        };
        if (p.length > 0) {
            if (m === "image") {
                var k = new Image();
                k.src = p;
                k.alt = f.text();
                b.append(k);
                d.addClass("active");
                a.focus()
            } else {
                tfl.ajax({url: p, success: g, dataType: "text"});
                d.addClass("active")
            }
        }
    };
    e.initialised = false;
    e.init = function () {
        var h = $("[" + e.dataAttr + "]");
        var g = function (j) {
            d = $(j);
            a = d.find(".close-light-box");
            b = d.find(".content");
            d.on("click.lightBox", function (k) {
                a.trigger("click.lightBox")
            });
            d.find(".content-wrap").on("click.lightBox", function (k) {
                k.stopPropagation()
            });
            a.on("click.lightBox", function () {
                b.empty();
                d.removeClass("active");
                f.focus()
            });
            $(document.body).append(d);
            h.click(e.pullContentHandler);
            e.initialised = true;
            tfl.logs.create("tfl.navigation.pullContent: initialised")
        };
        if (h.length && !e.initialised) {
            tfl.ajax({url: "/static/" + tfl.settings.version + "/templates/light-box.html", success: g, dataType: "text"})
        } else {
            h.off("click").click(e.pullContentHandler)
        }
    };
    e.init()
})(window.tfl.navigation = window.tfl.navigation || {});
var tfl = tfl || {};
(function (b) {
    b.logs.create("tfl.serviceStatus: loaded");
    var a = function (e) {
        var d = e.closest(".rainbow-list-wrapper, .rainbow-board.roads");
        var c = e.parent(".rainbow-list-item");
        if (c.hasClass("expandable")) {
            var f = c.data("line-id");
            if (!c.hasClass("expanded")) {
                $(".rainbow-list-item.expanded", d).removeClass("expanded");
                c.addClass("expanded");
                d.addClass("fade-to-black");
                if (b.hasOwnProperty("tubeMap")) {
                    b.tubeMap.zoomToLineId(f)
                }
                c.trigger("rainbow-list.expanded");
                if (f !== undefined && f !== null) {
                    window.location.hash = "line-" + f
                }
            } else {
                c.removeClass("expanded");
                d.removeClass("fade-to-black");
                if (b.hasOwnProperty("tubeMap")) {
                    b.tubeMap.resetToInitialView()
                }
                c.trigger("rainbow-list.collapsed");
                if (f !== undefined && f !== null) {
                    var g = window.scrollY;
                    window.location.hash = "";
                    window.scrollTo(0, g)
                }
            }
        }
    };
    b.serviceStatus = {initServiceBoardPage: function () {
        b.logs.create("tfl.serviceStatus: initialised");
        b.serviceStatus.serviceUpdatesBoard()
    }, pageSetup: function () {
        var e = $(".stations-tab");
        $(".lines-stations-tab li").click(function () {
            f($(this))
        });
        $(".lines-stations-tab .lines-tab").click(function () {
            b.serviceStatus.appendHashToDatePickerAnchors("")
        });
        $(".lines-stations-tab .stations-tab").click(function () {
            b.serviceStatus.appendHashToDatePickerAnchors("#stations-status")
        });
        var f = function (m) {
            b.logs.create("tfl.serviceStatus: click on tab");
            if (m.hasClass("selected")) {
                return
            }
            var j = $(".lines-status"), l = $(".stations-status"), k = $(".lines-tab");
            if (j.hasClass("visible")) {
                j.removeClass("visible");
                l.addClass("visible");
                k.removeClass("selected");
                e.addClass("selected")
            } else {
                l.removeClass("visible");
                j.addClass("visible");
                e.removeClass("selected");
                k.addClass("selected")
            }
        };
        if (window.location.hash !== "") {
            var g = window.location.hash;
            b.logs.create("tfl.serviceStatus: page hash is " + g);
            var h = g.substr(6);
            if (h === "stations-status") {
                $(".lines-stations-tab .stations-tab").click()
            } else {
                var c = $("[data-line-class=" + h.toLowerCase() + "]");
                if (c.length > 0) {
                    a(c)
                } else {
                    var d = $("[data-station-class=" + h.toLowerCase() + "]");
                    if (d.length > 0) {
                        f(e);
                        a(d)
                    }
                }
            }
        }
    }, serviceUpdatesBoard: function () {
        var c = $(".rainbow-list-wrapper, .rainbow-board.roads");
        $(".close-disruption-info").click(function () {
            $(this).closest(".info-dropdown").prev().removeClass("selected");
            $(".rainbow-board").removeClass("fade-to-black")
        });
        $(".rainbow-list-content .close-message", c).on("click", function (d) {
            d.preventDefault();
            $(this).closest(".rainbow-list-item").removeClass("expanded");
            c.removeClass("fade-to-black")
        });
        $("[data-line-class], [data-station-class]").click(function (d) {
            a($(this));
            d.preventDefault();
            d.stopPropagation()
        })
    }, updateServiceBoard: function (f, k) {
        var j = window.location.hash;
        var g;
        var h;
        var d = $(".lines-status .expanded");
        if (d.length) {
            g = d.find(".rainbow-list-link").data("line-class")
        }
        var e = $(".stations-status .expanded");
        if (e.length) {
            h = e.find(".rainbow-list-link").data("naptan-id")
        }
        $("#" + f).parent().html(k);
        var c = $(".datepicker-dropdown.dropdown-button");
        if (c.length) {
            b.serviceStatus.initServiceBoardPage();
            c.html(b.tools.getTime(new Date()))
        }
        if (j !== undefined && j !== null) {
            j = j.substr(1)
        }
        if (j === "stations-status") {
            $(".lines-stations-tab .stations-tab").removeClass("selected");
            $(".lines-stations-tab .stations-tab").click()
        }
        if (g !== undefined && g !== null) {
            a($(".lines-status").find("[data-line-class='" + g + "']"))
        }
        if (h !== undefined && h !== null) {
            a($(".stations-status").find("[data-naptan-id='" + h + "']"))
        }
    }, ajaxServiceBoard: function (c, d) {
        b.ajax({url: c, success: function (e) {
            b.serviceStatus.updateServiceBoard(d, e)
        }, autoRefreshInterval: b.autoRefresh.ServiceBoard, autoRefreshId: d, dataType: "text"})
    }, initServiceBoardAutoRefresh: function (f, g) {
        var c = $("#" + g).parents(".expandable-box");
        if (c.length) {
            var d = c.find(".always-visible");
            d.on("expandable-box.expanded", function () {
                b.serviceStatus.ajaxServiceBoard(f, g)
            });
            d.on("expandable-box.collapsed", function () {
                b.stopAjaxAutoRefresh(g)
            });
            var e = c.find(".content.expanded");
            if (e.length) {
                b.serviceStatus.ajaxServiceBoard(f, g)
            }
        } else {
            window.setTimeout(function () {
                b.serviceStatus.ajaxServiceBoard(f, g)
            }, b.autoRefresh.ServiceBoard)
        }
    }, appendHashToDatePickerAnchors: function (c) {
        if (window.location.hash !== "" || c !== null) {
            $(".datepicker-dropdown a").each(function () {
                var d = $(this).attr("href");
                d = d.indexOf("#") !== -1 ? d.substr(0, d.indexOf("#")) : d;
                c = c != null ? c : window.location.hash;
                $(this).attr("href", d + c)
            })
        }
    }};
    b.serviceStatus.pageSetup()
})(tfl);
(function (a) {
    tfl.logs.create("tfl.socialMedia: loaded");
    a.init = function () {
        var f = $(".share-widget-wrapper");
        if (f.length > 0) {
            var c = $(".section-overview");
            if (c.length > 0 && !c.hasClass("full-width")) {
                f.css({marginTop: 0, display: "block", cssFloat: "none"})
            }
            f.append('<a href="javascript:void(0)" class="share-widget clearfix"><div class="twitter-icon icon"></div><div class="facebook-icon icon"></div><div class="share-icon icon"></div><span class="share-text">Share <span class="visually-hidden">on social media</span></span><span class="down-arrow icon"></span></a>');
            var e = window.location.href;
            var d = $("h1").text();
            var b = $('<ul class="share-list"></ul>');
            b.append('<li><a href="http://www.facebook.com/share.php?u=' + e + "&t=" + d + '" class="share-facebook clearfix" tabindex="0"><span class="facebook-icon icon"></span><span class="text">Facebook</span></a></li>');
            b.append('<li><a href="http://twitter.com/home?status=' + d + " " + e + '" class="share-twitter clearfix" tabindex="0"><span class="twitter-icon icon"></span><span class="text">Twitter</span></a></li>');
            f.append(b);
            b.find("a").focus(function () {
                b.addClass("visible-for-focus")
            }).blur(function () {
                b.removeClass("visible-for-focus")
            });
            f.removeClass("hidden")
        }
    };
    a.init()
}(window.tfl.socialMedia = window.tfl.socialMedia || {}));
window.tfl.journeyPlanner = window.tfl.journeyPlanner || {};
(function (a) {
    tfl.logs.create("tfl.journeyPlanner.recentJourneys: loaded");
    a.journeys = [];
    a.usingRecentJourneys = tfl.storage.get("usingRecentJourneys", true);
    a.isLoaded = false;
    a.recentJourneyNumberLimit = 5;
    a.loadJourneys = function () {
        if (!a.isLoaded) {
            if (a.usingRecentJourneys) {
                a.journeys = tfl.storage.get("recentJourneys", [])
            }
            a.isLoaded = true
        }
    };
    a.useJourneys = function (b) {
        tfl.journeyPlanner.recentJourneys.usingRecentJourneys = b;
        tfl.storage.set("usingRecentJourneys", a.usingRecentJourneys);
        a.journeys = [];
        tfl.storage.set("recentJourneys", a.journeys);
        tfl.journeyPlanner.recentSearches.searches = [];
        tfl.storage.set("recentSearches", tfl.journeyPlanner.recentSearches.searches);
        return false
    };
    a.saveJourney = function (b, c, g, h, k, l) {
        if ($("#From").val() === tfl.dictionary.CurrentLocationText || $("#From").val() === tfl.dictionary.CurrentLocationText || $("#From").val() === tfl.dictionary.CurrentLocationText) {
            return true
        }
        a.loadJourneys();
        var f = {from: $("#From").val().replace(/^\s+|\s+$/g, ""), fromId: b, fromModes: c ? jQuery.parseJSON(c) : "", to: $("#To").val().replace(/^\s+|\s+$/g, ""), toId: g, toModes: h ? jQuery.parseJSON(h) : "", via: $("#Via").val().replace(/^\s+|\s+$/g, ""), viaId: k, viaModes: l ? jQuery.parseJSON(l) : ""};
        if (f.from === "" || f.to === "") {
            return true
        }
        for (var d = 0; d < tfl.journeyPlanner.recentJourneys.journeys.length; d++) {
            var e = tfl.journeyPlanner.recentJourneys.journeys[d];
            if (e.from.toLowerCase().replace(/ /g, "") === f.from.toLowerCase().replace(/ /g, "") && e.to.toLowerCase().replace(/ /g, "") === f.to.toLowerCase().replace(/ /g, "") && e.via.toLowerCase().replace(/ /g, "") === f.via.toLowerCase().replace(/ /g, "")) {
                if (f.fromId == "" && e.fromId !== "") {
                    f.fromId = e.fromId
                }
                if (f.fromModes == "" && e.fromModes !== "") {
                    f.fromModes = e.fromModes
                }
                if (f.toId == "" && e.toId !== "") {
                    f.toId = e.toId
                }
                if (f.toModes == "" && e.toModes !== "") {
                    f.toModes = e.toModes
                }
                if (f.viaId == "" && e.viaId !== "") {
                    f.viaId = e.viaId
                }
                if (f.viaModes == "" && e.viaModes !== "") {
                    f.viaModes = e.viaModes
                }
                tfl.journeyPlanner.recentJourneys.journeys.splice(d, 1);
                break
            }
        }
        tfl.journeyPlanner.recentJourneys.journeys.splice(0, 0, f);
        if (tfl.journeyPlanner.recentJourneys.journeys.length > a.recentJourneyNumberLimit) {
            tfl.journeyPlanner.recentJourneys.journeys.length = a.recentJourneyNumberLimit
        }
        tfl.storage.set("recentJourneys", tfl.journeyPlanner.recentJourneys.journeys);
        return true
    }
})(window.tfl.journeyPlanner.recentJourneys = window.tfl.journeyPlanner.recentJourneys || {});
window.tfl.journeyPlanner = window.tfl.journeyPlanner || {};
(function (a) {
    tfl.logs.create("tfl.journeyPlanner.recentSearches: loaded");
    a.searches = [];
    a.isLoaded = false;
    a.recentSearchNumberLimit = 5;
    a.recentSearchTimeLimit = 2629740000;
    a.loadSearches = function () {
        if (!a.isLoaded) {
            if (tfl.journeyPlanner.recentJourneys.usingRecentJourneys) {
                a.searches = tfl.storage.get("recentSearches", []);
                if (a.searches.length > 0) {
                    var d = new Date().getTime();
                    for (var b = 0; b < a.searches.length; b++) {
                        var c = a.searches[b];
                        if (c.lastSearchDate < (d - a.recentSearchTimeLimit)) {
                            a.searches.splice(b, 1)
                        }
                    }
                }
            }
            a.isLoaded = true
        }
    };
    a.saveSearch = function (f, d, e) {
        if (f === "" || f === tfl.dictionary.CurrentLocationText) {
            return true
        }
        f = f.replace(/^\s+|\s+$/g, "");
        if (d === null) {
            d = ""
        }
        if (typeof e == "string" && e !== "") {
            e = jQuery.parseJSON(e)
        }
        var h = new Date().getTime();
        for (var b = 0; b < tfl.journeyPlanner.recentSearches.searches.length; b++) {
            var c = tfl.journeyPlanner.recentSearches.searches[b];
            if (c.placeName.toLowerCase() === f.toLowerCase()) {
                if (d == "" && c.placeId !== "") {
                    d = c.placeId
                }
                if (e == "" && c.placeModes !== "") {
                    e = c.placeModes
                }
                tfl.journeyPlanner.recentSearches.searches.splice(b, 1);
                break
            }
        }
        var g = {placeName: f, placeId: d, placeModes: e, lastSearchDate: h};
        tfl.journeyPlanner.recentSearches.searches.splice(0, 0, g);
        if (tfl.journeyPlanner.recentSearches.searches.length > a.recentSearchNumberLimit) {
            tfl.journeyPlanner.recentSearches.searches.length = a.recentSearchNumberLimit
        }
        tfl.storage.set("recentSearches", tfl.journeyPlanner.recentSearches.searches);
        return true
    }
})(window.tfl.journeyPlanner.recentSearches = window.tfl.journeyPlanner.recentSearches || {});
(function (b) {
    tfl.logs.create("tfl.journeyPlanner: loaded");
    tfl.cachingSettings = {daily: a()};
    function a() {
        var c = new Date();
        var e = String(c.getFullYear()) + String(c.getMonth()) + String(c.getDay()) + String(c.getHours());
        return e
    }

    b.settings = {disambiguationItemsPerPage: 9};
    b.init = function () {
        tfl.logs.create("tfl.journeyPlanner.init: started");
        b.createJourneys()
    };
    b.createJourneys = function () {
        if (!tfl.storage.isLocalStorageSupported()) {
            tfl.logs.create("tfl.journeyplanner: Not creating recent journeys box - localStorage not present.");
            return
        }
        tfl.logs.create("tfl.journeyplanner: Creating recent journeys box");
        $("#recent-journeys").empty();
        if ($("div[data-set=recent-journeys]").length === 0) {
            $("#more-journey-options").after("<div class='small' data-set='recent-journeys' />");
            $("#plan-a-journey").after("<div class='medium-large' data-set='recent-journeys'><div id='recent-journeys' class='moving-source-order' /></div>")
        }
        var d = $("#recent-journeys");
        d.empty();
        d.append("<h3>Recent journeys</h3>");
        if (!tfl.journeyPlanner.recentJourneys.usingRecentJourneys) {
            d.append("<p>Turn on recent searches so you can access them easily again<br/><a href='javascript:void(0)' class='turn-on-recent-journeys' data-jumpback='#SavePreferences:visible' data-jumpto='#footer a:first'>Turn on recent journeys</a></p>")
        } else {
            tfl.journeyPlanner.recentJourneys.loadJourneys();
            if (tfl.journeyPlanner.recentJourneys.journeys.length > 0) {
                var c = $("<div class='vertical-button-container' />");
                $(tfl.journeyPlanner.recentJourneys.journeys).each(function (e) {
                    var g = "<strong>" + this.from + "</strong> to <strong>" + this.to + "</strong>";
                    if (this.via !== "") {
                        g += " via <strong>" + this.via + "</strong>"
                    }
                    var f;
                    if (e === 0) {
                        f = $("<a href='javscript:void(0)' class='plain-button' data-jumpback='#SavePreferences:visible'>" + g + "</a>")
                    } else {
                        f = $("<a href='javscript:void(0)' class='plain-button'>" + g + "</a>")
                    }
                    f.click(function () {
                        b.redoJourney(e);
                        return false
                    });
                    c.append(f)
                });
                d.append(c);
                d.append("<p><a href='javascript:void(0)' class='turn-off-recent-journeys' data-jumpto='#footer a:first' data-jumpback='#SavePreferences:visible'>Turn off and clear recent journeys</a></p>")
            } else {
                d.append("<p>You currently have no saved journeys<br/><a href='javascript:void(0)' class='turn-off-recent-journeys' data-jumpto='#footer a:first' data-jumpback='#SavePreferences:visible'>Turn off recent journeys</a></p>")
            }
        }
        $("div.medium-large[data-set=recent-journeys]").append(d);
        $(".moving-source-order").appendAround();
        $(".turn-on-recent-journeys").click(function (e) {
            e.preventDefault();
            tfl.journeyPlanner.recentJourneys.useJourneys(true);
            tfl.journeyPlanner.searchForm.destroyAutocomplete();
            tfl.journeyPlanner.searchForm.setupAutocomplete(false);
            if ($("#recent-journeys").length != 0) {
                b.createJourneys()
            }
        });
        $(".turn-off-recent-journeys").click(function (e) {
            e.preventDefault();
            tfl.journeyPlanner.recentJourneys.useJourneys(false);
            tfl.journeyPlanner.searchForm.destroyAutocomplete();
            tfl.journeyPlanner.searchForm.setupAutocomplete(false);
            if ($("#recent-journeys").length != 0) {
                b.createJourneys()
            }
        })
    };
    b.redoJourney = function (e) {
        var f = tfl.journeyPlanner.recentJourneys.journeys[e];
        var c = false;
        var d = function () {
            $("#jp-search-form").submit()
        };
        if (f.from === tfl.dictionary.CurrentLocationText) {
            c = true;
            tfl.journeyPlanner.searchForm.geolocateMe("#From", d)
        } else {
            $("#From").val(f.from);
            $("#From").attr("data-from-id", f.fromId);
            $("#From").attr("data-from-modes", JSON.stringify(f.fromModes))
        }
        if (f.to === tfl.dictionary.CurrentLocationText) {
            c = true;
            tfl.journeyPlanner.searchForm.geolocateMe("#To", d)
        } else {
            $("#To").val(f.to);
            $("#To").attr("data-to-id", f.toId);
            $("#To").attr("data-to-modes", JSON.stringify(f.toModes))
        }
        if (f.via !== null) {
            if (f.via === tfl.dictionary.CurrentLocationText) {
                c = true;
                tfl.journeyPlanner.searchForm.geolocateMe("#Via", d)
            } else {
                $("#Via").val(f.via);
                $("#Via").attr("data-via-id", f.viaId);
                $("#Via").attr("data-via-modes", JSON.stringify(f.viaModes))
            }
        } else {
            $("#Via").val("")
        }
        if (!c) {
            d()
        }
    }
})(window.tfl.journeyPlanner = window.tfl.journeyPlanner || {});
(function (a) {
    tfl.logs.create("tfl.journeyPlanner.results: loaded");
    a.init = function (b) {
        tfl.logs.create("tfl.journeyPlanner.results.init: started (isAjax: " + b + ")");
        if (!b) {
            a.resultsFormInit();
            a.processResults();
            a.initSteal()
        } else {
            a.initAjaxPage()
        }
        if ($("html").hasClass("lt-ie8")) {
            a.initIE7()
        }
    };
    a.initGlobal = function () {
        tfl.logs.create("tfl.journeyPlanner.initGlobal: started");
        tfl.expandableBox.init()
    };
    a.initAjaxPage = function () {
        tfl.logs.create("tfl.journeyPlanner.results.initAjaxPage: started");
        var c = $("#JpType").val() == "" ? "publictransport" : $("#JpType").val();
        a.setupLoader(c);
        a.resultsFormInit();
        var e = window.location.href, d = tfl.jPResultsPageUrl;
        e = e.substring(e.indexOf("?"), e.length);
        var b = function (h) {
            data = $(h).find(".ajax-response");
            $(".journey-details-ajax").replaceWith($(data));
            var g = $(".walking-box .journey-time");
            if (g.length == 1 && $('[data-jp-tabs="true"] .walking.selected').length < 1) {
                g.find(".visually-hidden").remove();
                g = $("<span></span>").addClass("tabs-time").text("Walk this in " + g.text());
                $('[data-jp-tabs="true"] [data-jptype="walking"]').addClass("has-time").append(g)
            }
            var f = $(".cycling-box .journey-time");
            if (f.length == 1 && $('[data-jp-tabs="true"] .cycling.selected').length < 1) {
                f.find(".visually-hidden").remove();
                f = $("<span></span>").addClass("tabs-time").text("Cycle in " + f.text());
                $('[data-jp-tabs="true"] [data-jptype="cycling"]').addClass("has-time").append(f)
            }
            a.processResults();
            a.initGlobal();
            if ($(".disambiguation-form").length > 0) {
                tfl.journeyPlanner.disambiguation.init()
            } else {
                $(".summary-results > .expandable-box").css({opacity: 0}).each(function (j) {
                    $(this).delay(150 * j).animate({opacity: 1}, 100, function () {
                        $(this).removeAttr("style")
                    })
                })
            }
            a.initSteal();
            $("#alternatives").find("[data-pull-content]").click(tfl.navigation.pullContentHandler)
        };
        tfl.ajax({url: d + e + "&ispostback=true", success: b, dataType: "html"})
    };
    a.initSteal = function () {
        steal(tfl.mapScriptPath).then(function () {
            tfl.logs.create("tfl.journeyPlanner.results.initSteal: started");
            var e = false;
            var d = null;
            var c = null;

            function b() {
                tfl.fullscreen.display(d, false, true);
                d.controller().divResized()
            }

            $(".view-on-a-map").click(function (h, g) {
                var f = $(this);
                $(".view-on-a-map").not(this).removeClass("show-all");
                f.toggleClass("show-all");
                var j;
                if (g && g.isHideAll) {
                    j = $(".view-on-a-map.hide-map")
                } else {
                    j = $(".view-on-a-map.hide-map").not(this)
                }
                j.text("View on a map").removeClass("hide-map");
                if (f.hasClass("hide-map")) {
                    f.text("View on a map").removeClass("hide-map");
                    d.hide()
                } else {
                    if (!e) {
                        f.after("<div id='leg_map' class='leg-map'></div>");
                        $.fixture.on = false;
                        d = $("#leg_map").tfl_maps_journey_planner_leg_map({url: $(".journey-results").data("api-uri"), isNationalBounds: tfl.getQueryParam("NationalSearch") === "true", mapDeactivated: function () {
                            if (!$(document.body).hasClass("breakpoint-Medium")) {
                                tfl.fullscreen.hide()
                            }
                            d.siblings(".view-on-a-map").trigger("click")
                        }});
                        c = d.controller();
                        c.mapLoading.done(function () {
                            $(window).on("enterBreakpointSmall exitBreakpointMedium", function () {
                                if (d.is(":visible")) {
                                    b()
                                }
                            }).on("enterBreakpointMedium", function () {
                                tfl.fullscreen.hide()
                            });
                            if (!$(document.body).hasClass("breakpoint-Medium")) {
                                b()
                            }
                        });
                        e = true
                    } else {
                        d.show();
                        d.insertAfter($(this));
                        if (!$(document.body).hasClass("breakpoint-Medium")) {
                            b()
                        }
                    }
                    c.chooseLeg(f.data("journeyindex"), f.data("legindex"));
                    f.text("Hide map").addClass("hide-map")
                }
                h.preventDefault()
            })
        })
    };
    a.initIE7 = function () {
        $(".cancel-button, .toggle-options, .edit-button").click(function () {
            var b = $(".journey-form").parents(".r").next();
            b.attr("class", b.attr("class"))
        })
    };
    a.maps = function (d) {
        var b = "cycling";
        var e = "walking";
        if (d == b || d == e) {
            var c = (d == b) ? $(".summary-results.cycling .cycling-box") : $(".summary-results.walking .walking-box");
            if (c.length == 1) {
                c.find(".always-visible .show-detailed-results").click();
                a.triggerMapLink($(".full-results-container .view-on-a-map"))
            }
        }
    };
    a.triggerMapLink = function (b) {
        tfl.logs.create("tfl.journeyPlanner.results: trigger click on map link");
        b.trigger("click", {isHideAll: true})
    };
    a.setupLoader = function (g) {
        var b = $('<div id="loader-background"></div>');
        var c = $('<div id="loader-birds"></div>');
        var k = $('<div id="loader-trees"></div>');
        var l = $('<div class="tree-segment"></div>');
        var f;
        for (f = 0; f < 8; f++) {
            k.append(l.clone())
        }
        var j = $('<div id="loader-transport-method"></div>');
        var d = $('<div id="loader-grass"></div>');
        var e = $('<div class="grass-segment"></div>');
        for (f = 0; f < 18; f++) {
            d.append(e.clone())
        }
        var h = $('<div id="loader-message">Fetching results</div>');
        $("#loader-window").addClass(g).append(b).append(k).append(c).append(j).append(d).append(h)
    };
    a.processResults = function () {
        $(".summary-results > .expandable-box > .content > .always-visible").click(function () {
            if ($(this).parents(".not-selected").length > 0) {
                a.unshowAllDetailedResults();
                a.currentlyShowing = null
            }
        });
        var l = $(".summary-results");
        if (l.hasClass("cycling")) {
            a.maps("cycling")
        } else {
            if (l.hasClass("walking")) {
                a.maps("walking")
            }
        }
        $(".always-visible .journey-price").after("<button class='primary-button show-detailed-results' data-jumpto=''>" + tfl.dictionary.ShowDetailedView + "</button>");
        $(".back-to-link").click(a.unshowAllDetailedResults);
        var d = 1;
        if ($(".journey-details").length > 0) {
            if (tfl.journeyPlanner.recentJourneys.usingRecentJourneys) {
                tfl.journeyPlanner.recentJourneys.saveJourney($("#From").attr("data-from-id"), $("#From").attr("data-from-modes"), $("#To").attr("data-to-id"), $("#To").attr("data-to-modes"));
                tfl.journeyPlanner.recentSearches.saveSearch($("#From").val(), $("#From").attr("data-from-id"), $("#From").attr("data-from-modes"));
                tfl.journeyPlanner.recentSearches.saveSearch($("#To").val(), $("#To").attr("data-to-id"), $("#To").attr("data-to-modes"));
                if ($("#Via").val() !== "") {
                    tfl.journeyPlanner.recentSearches.saveSearch($("#Via").val(), $("#Via").attr("data-via-id"), $("#Via").attr("data-via-modes"))
                }
            }
        }
        $(".journey-details").each(a.generateJourneySummary);
        var g = $(".journey-steps .message-toggle");
        var h = $(".journey-detail-step .line-status .message-toggle");
        var b;
        for (var e = 0; e < g.length; e++) {
            b = $(g[e]);
            (function () {
                var j = e;
                b.click(function () {
                    if (!$(h[j]).parent().parent().hasClass("expanded")) {
                        $(h[j]).click()
                    }
                    $(this).parents(".summary").find(".show-detailed-results").click()
                })
            })()
        }
        $(".line-status-info .start-hidden");
        var c = $(".line-status-info .hide-link");
        for (var f = 0; f < g.length; f++) {
            b = $(c[f]);
            (function () {
                var j = f;
                b.click(function () {
                    $(h[j]).click()
                })
            })()
        }
        $(".show-detailed-results").click(a.viewDetailsClick);
        a.expandableBoxes = $(".summary-results > .expandable-box");
        $(".json-all-stops").click(a.showAllStops);
        $(".text-instructions-link").click(a.showTextInstructions);
        $(".disruption-heading").append('<span class="link-style show-details">Show details...</span><span class="link-style hide-details">Hide details...</span>');
        $(".accessibility-details").append('<div class="show-hide-links"><a href="javascript:void(0)" class="show-link">Show details...</a><a href="javascript:void(0)" class="hide-link">Hide details...</a></div>');
        $(".show-hide-links a").click(function (j) {
            $(".accessibility-details").toggleClass("expanded");
            j.preventDefault()
        });
        $(".journey-detail-step.terminus").after("<div class='jp-print-button clearfix'><a href='javascript:window.print()' class='secondary-button print-button'>Print this route</a></div>")
    };
    a.generateJourneySummary = function () {
        var b = $("<table></table>").attr("class", "journey-steps").append("<caption class='visually-hidden'>Steps for journey option " + i + "</caption><thead><tr><th>Time</th><th>Mode of Transport</th><th>Instructions</th></tr></thead>");
        $(this).find(".journey-detail-step:not(.terminus)").each(function (e) {
            var d = "";
            var h = $(this).find(".step-heading .time-and-mode .centred").html();
            var j = $("<tr></tr>");
            var f = false;
            if ($(this).find(".details .instructions .line-status").length > 0) {
                f = true
            }
            var c = "time";
            if ($(this).find(".duration").text().indexOf("hour") > 0) {
                c = c + " wide"
            }
            j.append("<td class='" + c + "'><strong>" + $(this).find(".duration").text().replace("minute", "min").replace("hour", "hr") + "</strong></td>");
            var g = f ? $("<td class='logo disrupted'></td>") : $("<td class='logo'></td>");
            g.append($(this).find(".time-and-mode .centred").clone());
            j.append(g);
            if (f) {
                j.append("<td class='description disrupted'>" + $(this).find(".step-summary").html() + "</td>")
            } else {
                j.append("<td class='description'>" + $(this).find(".step-summary").html() + "</td>")
            }
            b.append(j);
            if ($(this).find(".line-status").length > 0) {
                var k = $("<td class='disrupted'></td>").append($(this).find(".disruption-messages .line-status .message-toggle").eq(0).clone());
                b.append($("<tr><td class='time'>&nbsp;</td><td class='logo disrupted'><div class='disruption-icon centred hide-text'>Disruption</div></td></tr>").append(k))
            }
        });
        b.insertBefore(this);
        b.after($(this).parents(".content").find(".price-and-details").clone());
        i++
    };
    a.viewDetailsClick = function (b) {
        b.stopPropagation();
        var c = 0;
        c = $.inArray($(this).parents(".expandable-box").get(0), a.expandableBoxes);
        a.unshowAllDetailedResults();
        tfl.logs.create("tfl.journeyPlanner.results: view details clicked: (index: " + c + ", currentlyshowing: " + a.currentlyShowing + ")");
        if (c != a.currentlyShowing) {
            a.showDetailedResults(c)
        } else {
            a.currentlyShowing = null
        }
        return false
    };
    a.showDetailedResults = function (g) {
        tfl.logs.create("tfl.journeyPlanner.results: Show detailed results. Index: " + g);
        var e = a.expandableBoxes;
        a.currentlyShowing = g;
        e.removeClass("selected").addClass("not-selected");
        var l = $(e[g]);
        var k = $(e[g + 1]);
        var h = $(e[e.length - 1]);
        $(h).find(".show-detailed-results").attr("data-jumpto", ".earlier:tabbable:first");
        $(h).find(".show-detailed-results").addClass("last-show-details");
        l.removeClass("not-selected").addClass("selected");
        var j = l.find(".show-detailed-results:visible");
        $(".show-detailed-results").text(tfl.dictionary.ShowDetailedView);
        $(l).find(".show-detailed-results").text(tfl.dictionary.HideDetailedView);
        $(l).find(".show-detailed-results").addClass("hide-details");
        $(k).find(".show-detailed-results").addClass("next-show-details");
        $(l).find(".show-detailed-results").attr("data-jumpto", ".journey-details :tabbable:first:visible");
        $(l).find(".show-detailed-results").removeClass("last-show-details");
        $(e[a.currentlyShowing]).children(".content").children(".start-hidden").appendTo(".full-results-container");
        $(".replan-route").remove();
        $(".full-results-container").append("<div class='replan-route'><a href='javascript:void(0)' class='replan-from-current-location' data-jumpto='.next-show-details:visible'>Replan route from current location</a></div>");
        $(".replan-from-current-location").click(function () {
            tfl.geolocation.geolocateMe("#From", function () {
                var n = $("#From");
                n.removeAttr("data-from-id");
                n.removeAttr("data-from-modes");
                n.removeAttr("data-dataset-name");
                $("#jp-search-form").submit()
            });
            $(".secondary-button.edit-button").click();
            return false
        });
        $(".full-results-container").removeClass("hidden").addClass($("#JpType").val());
        $(document.body).addClass("showing-full-details");
        var d = $(".full-results-container").offset().top;
        $("html, body").animate({scrollTop: d - 10});
        $(".journey-details :tabbable:first").focus();
        var f = $(".full-results-container");
        var m = f.find(".journey-detail-step");
        if (!$("html").hasClass("breakpoint-Medium")) {
            if (history.pushState) {
                var c = $(".back-to-link");
                var b = function () {
                    window.onpopstate = null;
                    history.go(-1);
                    c.off("click", this)
                };
                history.pushState({}, null);
                c.on("click", b);
                window.onpopstate = function () {
                    a.unshowAllDetailedResults();
                    window.onpopstate = null
                }
            }
        }
        return false
    };
    a.unshowAllDetailedResults = function () {
        tfl.logs.create("tfl.journeyPlanner.results: Unshow all detailed results.");
        var b = a.expandableBoxes;
        $(".full-results-container").addClass("hidden");
        $(".full-results-container > .start-hidden").appendTo($(b[a.currentlyShowing]).children(".content"));
        $(".show-detailed-results").text(tfl.dictionary.ShowDetailedView);
        $(".show-detailed-results").removeClass("hide-details");
        $(".show-detailed-results").removeClass("next-show-details");
        $(".show-detailed-results").attr("data-jumpto", "");
        b.removeClass("not-selected selected");
        $(document.body).removeClass("showing-full-details");
        $(".json-all-stops").text(tfl.dictionary.ShowAllStops);
        $(".json-all-stops").parent().siblings(".all-stops").hide();
        $(".text-instructions-link").text(tfl.dictionary.ShowTextInstructions).removeClass("hide");
        $(".details .text-instructions-list").hide();
        return false
    };
    a.showAllStops = function () {
        var b = this;
        if ($(b).text() == tfl.dictionary.ShowAllStops) {
            $(b).text(tfl.dictionary.HideAllStops);
            $(b).parent().siblings(".all-stops").show()
        } else {
            $(b).text(tfl.dictionary.ShowAllStops);
            $(b).parent().siblings(".all-stops").hide()
        }
        $(b).toggleClass("hide");
        return false
    };
    a.showTextInstructions = function () {
        var c = $(this);
        var b = c.parent().siblings(".text-instructions-list");
        if (c.text() == tfl.dictionary.ShowTextInstructions) {
            c.text(tfl.dictionary.HideTextInstructions);
            b.show()
        } else {
            c.text(tfl.dictionary.ShowTextInstructions);
            b.hide()
        }
        c.toggleClass("hide");
        return false
    };
    a.resultsFormInit = function () {
        tfl.logs.create("tfl.journeyPlanner.results: resultsFormInit started");
        $(".plan-journey-button").wrap("<div class='clearfix update-buttons' />").before("<input type='button' class='secondary-button cancel-button' value='Cancel' />");
        $(".plan-journey-button").val("Update journey").submit(function () {
            $(".cancel-button").remove()
        });
        $(".plan-journey-button-second").val("Update journey");
        tfl.journeyPlanner.searchForm.buildSwitchButton();
        $(".switch-button").click(tfl.journeyPlanner.searchForm.switchFromTo);
        var h = tfl.utils.isTouchDevice();
        if ($("#From").val() !== "" && $("#To").val() !== "") {
            var s = "";
            if (h) {
                s = " touch"
            }
            var j = $("<div class='journey-result-summary" + s + "' ><div class='from-to-wrapper'></div></div>");
            j.children(".from-to-wrapper").append("<div class='summary-row clearfix'><span class='label'>From:</span><strong>" + $("#From").val() + "</strong></div>");
            j.children(".from-to-wrapper").append("<div class='summary-row clearfix'><span class='label'>To:</span><strong>" + $("#To").val() + "</strong></div>");
            var k = $(".leaving-or-arriving li.selected").text().replace(/^\s+|\s+$/g, "");
            var c = $("#Date").val();
            if (c !== null) {
                var m = parseInt(c.substring(4, 6), 10);
                m--;
                c = new Date(parseInt(c.substring(0, 4), 10), m, parseInt(c.substring(6, 8), 10))
            } else {
                c = new Date()
            }
            var n = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
            var e = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
            var p = "<sup>th</sup>";
            var d = c.getDate();
            var l = d % 10;
            if (l === 1 && d !== 11) {
                p = "<sup>st</sup>"
            } else {
                if (l === 2 && d !== 12) {
                    p = "<sup>nd</sup>"
                } else {
                    if (l === 3 && d !== 13) {
                        p = "<sup>rd</sup>"
                    }
                }
            }
            var r = e[c.getDay()] + " " + c.getDate() + p + " " + n[c.getMonth()];
            r += ", " + $("#Time option:selected").text();
            var t = "";
            var v = $("#Via").val();
            if (v !== "") {
                t += "<strong class='via-destination'>Via " + v + "</strong> "
            }
            var q = $(".jp-mode-cycling .accessibility-options .ticked label").html();
            t += '<strong class="travelpreferences-cycling">' + q + "</strong>";
            var o = $("#WalkingSpeed :selected").text();
            t += '<strong class="travelpreferences-walking">' + o + " walking speed</strong>";
            t += '<strong class="travelpreferences-publictransport">Showing ' + $("#JourneyPreference option:selected").text().toLowerCase() + "</strong> ";
            var u = $(".modes-of-transport option:selected");
            t += '<strong class="travelpreferences-publictransport">Using ';
            var g = 0;
            if ($(".modes-of-transport option:not(:selected)").length === 0) {
                t += "all transport modes"
            } else {
                if (u.length <= 4) {
                    for (g = 0; g < u.length; g++) {
                        if (g > 0 && g === u.length - 1) {
                            t += " and "
                        } else {
                            if (g > 0) {
                                t += ", "
                            }
                        }
                        t += $(u[g]).text().replace(/^\s+|\s+$/g, "")
                    }
                } else {
                    for (g = 0; g < 3; g++) {
                        if (g > 0) {
                            t += ", "
                        }
                        t += $(u[g]).text().replace(/^\s+|\s+$/g, "")
                    }
                    t += " and " + (u.length - 3) + " others"
                }
            }
            t += "</strong> ";
            var b = $(".accessibility-options li.ticked input").val();
            if (b && b !== "" && b.toLowerCase() !== "norequirements") {
                t += '<strong class="travelpreferences-publictransport">Step free access required</strong> '
            }
            t += '<strong class="travelpreferences-publictransport">Max walk time ' + $("#MaxWalkingMinutes").val() + " mins</strong>";
            j.append("<div class='summary-row clearfix'><span class='label'>" + k + ":</span><strong>" + r + "</strong></div>");
            var f = $("<button></button>").addClass("secondary-button edit-button").text("Edit").click(function (w) {
                w.preventDefault();
                $("#plan-a-journey").addClass("editing");
                $("#plan-a-journey :tabbable:first:visible").focus();
                $("#From, #To, #Via").trigger("change")
            });
            j.append($("<div></div>").addClass("summary-row").append(f));
            j.append("<div class='travel-preferences clearfix'><div class='left-shadow' /><div class='scroller'><div><span>Travel preferences: </span>" + t + "</div></div><div class='right-shadow' /></div>");
            $("#plan-a-journey").append(j)
        }
        if (h) {
            tfl.journeyPlanner.travelPrefsInnerWidth = $(".scroller > div").get(0).scrollWidth;
            tfl.journeyPlanner.travelPrefsScrollMax = tfl.journeyPlanner.travelPrefsInnerWidth - $(".scroller").width();
            tfl.journeyPlanner.travelPrefsLeftShadow = $(".left-shadow");
            tfl.journeyPlanner.travelPrefsRightShadow = $(".right-shadow");
            $(".scroller").scroll(function () {
                var w = $(this).scrollLeft();
                tfl.journeyPlanner.travelPrefsLeftShadow.css({left: Math.min(0, -40 + w)});
                tfl.journeyPlanner.travelPrefsRightShadow.css({right: Math.min(0, tfl.journeyPlanner.travelPrefsScrollMax - w - 40)})
            }).scroll();
            $(window).resize(function () {
                tfl.journeyPlanner.travelPrefsScrollMax = tfl.journeyPlanner.travelPrefsInnerWidth - $(".scroller").width();
                $(".scroller").scroll()
            })
        }
        $(".cancel-button").click(function () {
            $(".toggle-options.less-options").click();
            $("#plan-a-journey").removeClass("editing").parents(".r").removeClass("expanded");
            $(".journey-result-summary .secondary-button").focus();
            return false
        })
    }
})(window.tfl.journeyPlanner.results = window.tfl.journeyPlanner.results || {});
window.tfl.journeyPlanner = window.tfl.journeyPlanner || {};
(function (a) {
    tfl.logs.create("tfl.journeyPlanner.disambiguation: loaded");
    a.init = function () {
        tfl.logs.create("tfl.journeyPlanner.disambiguation: initialised");
        var b = $(".disambiguation-wrapper");
        var d = b.length;
        var c = 0;
        if (d > 0) {
            $(".disambiguation-extras").prepend("<div class='pagination' />");
            $(".disambiguation-box").each(function () {
                var h = $(this).find(".disambiguation-option").length;
                if (h > tfl.journeyPlanner.settings.disambiguationItemsPerPage) {
                    tfl.navigation.pagination.setup($(this), ".disambiguation-items", tfl.journeyPlanner.settings.disambiguationItemsPerPage, h, true)
                }
                var j = $(this).parents(".disambiguation-wrapper");
                var f = j.hasClass("from-results");
                if (f) {
                    $(".summary-row").eq(0).addClass("disambiguating")
                } else {
                    var g = j.hasClass("to-results");
                    if (g) {
                        $(".summary-row").eq(1).addClass("disambiguating")
                    } else {
                        $(".via-destination").addClass("disambiguating")
                    }
                }
            })
        }
        $(".disambiguation-link").click(function () {
            var g = $(this).parents(".disambiguation-wrapper");
            if (g.hasClass("from-results")) {
                $("#From").val($(this).find(".place-name").text()).after("<input type='hidden' name='FromId' value='" + $(this).attr("data-param") + "' />");
                $("#disambiguation-map-from").html("")
            } else {
                if (g.hasClass("to-results")) {
                    $("#To").val($(this).find(".place-name").text()).after("<input type='hidden' name='ToId' value='" + $(this).attr("data-param") + "' />");
                    $("#disambiguation-map-to").html("")
                } else {
                    if (g.hasClass("via-results")) {
                        $("#Via").val($(this).find(".place-name").text()).after("<input type='hidden' name='ViaId' value='" + $(this).attr("data-param") + "' />");
                        $("#disambiguation-map-via").html("")
                    }
                }
            }
            var f = g.next(".disambiguation-wrapper");
            if (f.length >= 1) {
                g.hide();
                f.show();
                f.find(".disambiguation-map").controller().divResized()
            } else {
                $("#jp-search-form").submit()
            }
            return false
        });
        b.each(function () {
            if (c > 0) {
                $(this).hide()
            }
            c++
        });
        tfl.mapInteractions.init();
        function e(h, f) {
            var j = tfl.maps[h].googleMap;
            j.on("optionChosen", function (k) {
                f.find(".disambiguation-option[data-id='" + k.id + "'] .disambiguation-link")[0].click()
            });
            var g = f.parent().find(".pagination");
            if (g.length) {
                tfl.navigation.pagination.addMapControls(g, j.controller)
            }
        }

        $("#disambiguation-options-from, #disambiguation-options-to, #disambiguation-options-via").each(function () {
            var f = $(this);
            if (f.find(".disambiguation-option").length > 0) {
                var g = $(this).attr("id").replace("-options-", "-map-").replace("-", "");
                if (tfl.maps[g] !== undefined) {
                    e(g, f)
                } else {
                    $(window).on("map-object-created-" + g, function () {
                        e(g, f)
                    })
                }
            }
        })
    }
})(window.tfl.journeyPlanner.disambiguation = window.tfl.disambiguation || {});
window.tfl.journeyPlanner = window.tfl.journeyPlanner || {};
(function (c) {
    tfl.logs.create("tfl.journeyPlanner.searchForm: loaded");
    c.isWidget;
    c.widgetInit = function () {
        tfl.logs.create("tfl.journeyPlanner.searchForm: started widgetInit");
        $(".toggle-options, .change-departure-time").click(function (k) {
            var j = $(this);
            var m = j.attr("href");
            var n = m.substr(0, m.indexOf("#"));
            var l = m.substr(m.indexOf("#"));
            $.each(["From", "To", "FromId", "ToId", "FromGeolocation", "ToGeolocation"], function (o, p) {
                var q = $("#" + p).val();
                if (q !== undefined && q !== "") {
                    if (o == 0) {
                        n += "?"
                    }
                    if (o > 0) {
                        n += "&"
                    }
                    n += p + "=" + q
                }
            });
            j.attr("href", n + l)
        })
    };
    c.setupDateOptions = function () {
        var j = new Date();
        var k = ((15 - j.getMinutes() % 15) * 60000);
        var l = ((60 - j.getSeconds() % 60) * 1000);
        setTimeout(c.incrementCurrentTime, (k - l))
    };
    c.processTempLocalStorage = function () {
        var k = tfl.storage.get("tempJPLocalStorage", [
            []
        ]);
        if (k.length > 0) {
            for (var j = 0; j < k.length; j++) {
                $(k[j][0]).attr(k[j][1], k[j][2])
            }
        }
    };
    c.submitSearchForm = function () {
        var j = $("#From");
        var l = $("#To");
        var m = $("#Via");
        if (j.attr("data-from-id")) {
            if ($("#FromId").length == 0) {
                $(this).append("<input type='hidden' id='FromId' name='FromId' value='" + j.attr("data-from-id") + "' />")
            } else {
                $("#FromId").val(j.attr("data-from-id"))
            }
        }
        if (l.attr("data-to-id")) {
            if ($("#ToId").length == 0) {
                $(this).append("<input type='hidden' id='ToId' name='ToId' value='" + l.attr("data-to-id") + "' />")
            } else {
                $("#ToId").val(l.attr("data-to-id"))
            }
        }
        if (m.attr("data-via-id")) {
            $(this).append("<input type='hidden' id='ViaId' name='ViaId' value='" + m.attr("data-via-id") + "' />")
        }
        var k = [
            []
        ];
        if (j.attr("data-from-modes")) {
            k.push(["#From", "data-from-modes", j.attr("data-from-modes")])
        }
        if (j.attr("data-dataset-name")) {
            k.push(["#From", "data-dataset-name", j.attr("data-dataset-name")])
        }
        if (l.attr("data-to-modes")) {
            k.push(["#To", "data-to-modes", l.attr("data-to-modes")])
        }
        if (l.attr("data-dataset-name")) {
            k.push(["#To", "data-dataset-name", l.attr("data-dataset-name")])
        }
        if (m.attr("data-via-modes")) {
            k.push(["#Via", "data-via-modes", m.attr("data-via-modes")])
        }
        if (m.attr("data-dataset-name")) {
            k.push(["#Via", "data-dataset-name", m.attr("data-dataset-name")])
        }
        if (k.length > 0) {
            tfl.storage.set("tempJPLocalStorage", k)
        }
        if (j.val() !== tfl.dictionary.CurrentLocationText) {
            $("#FromGeolocation").val("")
        }
        if (l.val() !== tfl.dictionary.CurrentLocationText) {
            $("#ToGeolocation").val("")
        }
        if (m.val() !== tfl.dictionary.CurrentLocationText) {
            $("#ViaGeolocation").val("")
        }
        return true
    };
    c.changeTabs = function () {
        var k = $('[data-jp-tabs="true"]');
        var j = k.parents(".journey-planner-results").length > 0;
        k.children().click(function () {
            var l = $("#JpType");
            var o = l.val();
            var m = $(this).children("a");
            var n = m.attr("data-jptype");
            k.removeClass(o).addClass(n);
            $("#jp-search-form").removeClass(o).addClass(n);
            l.val(n);
            if (j) {
                var p = $("#OptionsForPublictransport");
                if (l.val() == tfl.dictionary.JpTypeCycling || l.val() == tfl.dictionary.JpTypeWalking) {
                    p.hide()
                } else {
                    p.show()
                }
                if (m.hasClass("has-time")) {
                    $(".summary-results").removeClass(o).addClass(n);
                    window.tfl.journeyPlanner.results.unshowAllDetailedResults();
                    window.tfl.journeyPlanner.results.currentlyShowing = null
                } else {
                    $("#jp-search-form").submit()
                }
                window.tfl.journeyPlanner.results.maps(n);
                if (n === "publictransport") {
                    $(".no-public-transport").show()
                } else {
                    $(".no-public-transport").hide()
                }
            }
        })
    };
    c.incrementCurrentTime = function () {
        if ($(".time-options.change-time").length === 0) {
            c.setCurrentTime()
        }
        setTimeout(c.incrementCurrentTime, 900000)
    };
    c.getCurrentDate = function () {
        var j = new Date();
        var m = j.getFullYear().toString();
        var l = (j.getMonth() + 1).toString();
        var k = j.getDate().toString();
        return m + (l[1] ? l : "0" + l[0]) + (k[1] ? k : "0" + k[0])
    };
    c.getCurrentTime = function () {
        var j = new Date();
        var m = j.getMinutes();
        m = m = 0 ? m : (m + (15 - (m % 15)));
        var k = j.getHours();
        if (m === 60) {
            m = 0;
            k++;
            if (k === 24) {
                k = 0
            }
        }
        var n = "" + m;
        if (n.length === 1) {
            n = "0" + n
        }
        var l = "" + k;
        if (l.length === 1) {
            l = "0" + l
        }
        return l + n
    };
    c.setCurrentTime = function () {
        var j = new Date();
        var m = j.getMinutes();
        m = (m + (15 - (m % 15)));
        var k = j.getHours();
        if (m === 60) {
            m = 0;
            k++;
            if (k === 24) {
                k = 0;
                $("#Date").val($("#Date option:selected").next().val());
                $(".date-of-departure > span").text("Tomorrow")
            }
        }
        var n = "" + m;
        if (n.length === 1) {
            n = "0" + n
        }
        var l = "" + k;
        if (l.length === 1) {
            l = "0" + l
        }
        $("#Time").val(l + n);
        $(".hours span").text(l + ":" + n)
    };
    c.changeDepartureTime = function () {
        $(".time-options").toggleClass("change-time");
        return false
    };
    c.toggleMoreOptions = function () {
        $(this).parents(".r").toggleClass("expanded");
        var j = $(".toggle-options");
        if (j.hasClass("more-options")) {
            j.removeClass("more-options").addClass("less-options").text(tfl.dictionary.LessOptions)
        } else {
            j.removeClass("less-options").addClass("more-options").text(tfl.dictionary.MoreOptions + tfl.dictionary.CustomisedOptions)
        }
        return false
    };
    c.toggleMoreOptionsIsWidget = function () {
        var j = $(this);
        var n = j.attr("href");
        var o = n;
        if (n.indexOf("?") != -1) {
            o = n.substr(0, n.indexOf("?"))
        } else {
            o = n.substr(0, n.indexOf("#"))
        }
        var s = "";
        var m = n.substr(n.indexOf("#"));
        $.each(["From", "To", "FromGeolocation", "ToGelocation"], function (t, u) {
            var w = $("#" + u).val();
            if (w !== undefined && w !== "") {
                if (t == 0) {
                    s += "?"
                }
                if (t > 0) {
                    s += "&"
                }
                s += u + "=" + w
            }
        });
        var k = [];
        var l = $("#From");
        var r = $("#To");
        if (l.attr("data-from-id")) {
            k.push(["fromId", l.attr("data-from-id")])
        }
        if (r.attr("data-to-id")) {
            k.push(["toId", r.attr("data-to-id")])
        }
        k.push(["date", $("#Date").find("option:selected").val()]);
        k.push(["timeIs", $(".leaving-or-arriving .selected input").val()]);
        k.push(["time", $("#Time").find("option:selected").val()]);
        if (s.indexOf("?") == -1) {
            s += "?"
        }
        for (var p = 0; p < k.length; p++) {
            s += "&" + k[p][0] + "=" + k[p][1]
        }
        j.attr("href", o + s + m);
        var q = [
            []
        ];
        if (l.attr("data-from-modes")) {
            q.push(["#From", "data-from-modes", l.attr("data-from-modes")])
        }
        if (l.attr("data-dataset-name")) {
            q.push(["#From", "data-dataset-name", l.attr("data-dataset-name")])
        }
        if (r.attr("data-to-modes")) {
            q.push(["#To", "data-to-modes", r.attr("data-to-modes")])
        }
        if (r.attr("data-dataset-name")) {
            q.push(["#To", "data-dataset-name", r.attr("data-dataset-name")])
        }
        if (q.length > 0) {
            tfl.storage.set("tempJPLocalStorage", q)
        }
    };
    c.buildSwitchButton = function () {
        $(".geolocation-box").after("<a href='javascript:void(0)' class='switch-button hide-text'>Switch from and to<a>")
    };
    c.switchFromTo = function () {
        var m = $("#From");
        var n = $("#FromGeolocation");
        var u = $("#To");
        var v = $("#ToGeolocation");
        var j = m.val();
        var p = m.attr("data-from-id") ? m.attr("data-from-id") : "";
        var q = m.attr("data-from-modes") ? m.attr("data-from-modes") : "";
        var l = m.attr("data-dataset-name") ? m.attr("data-dataset-name") : "";
        var k = m.parent().attr("data-current-location") ? m.parent().attr("data-current-location") : "";
        var o = n.val();
        var r = u.val();
        var y = u.attr("data-to-id") ? u.attr("data-to-id") : "";
        var z = u.attr("data-to-modes") ? u.attr("data-to-modes") : "";
        var t = u.attr("data-dataset-name") ? u.attr("data-dataset-name") : "";
        var s = u.parent().attr("data-current-location") ? u.parent().attr("data-current-location") : "";
        var w = v.val();
        m.typeahead("val", r);
        m.attr("data-from-id", y);
        m.attr("data-from-modes", z);
        m.attr("data-dataset-name", t);
        if (s !== "") {
            m.parent().attr("data-current-location", s)
        } else {
            m.parent().removeAttr("data-current-location")
        }
        m.trigger("change");
        u.typeahead("val", j);
        u.val(j);
        u.attr("data-to-id", p);
        u.attr("data-to-modes", q);
        u.attr("data-dataset-name", l);
        if (k !== "") {
            u.parent().attr("data-current-location", k)
        } else {
            u.parent().removeAttr("data-current-location")
        }
        u.trigger("change");
        n.val(w);
        v.val(o)
    };
    tfl.journeyPlanner.recentSearches.loadSearches();
    var d = tfl.autocomplete.sources.getRecentSearches("journey-planner-recent-searches", tfl.journeyPlanner.recentSearches.searches, tfl.autocomplete.sources.stationsStopsSelectionCallback, "<div class='mode-icons'>{{#placeModes}}<span class='mode-icon {{.}}-icon'>&nbsp;</span>{{/placeModes}}</div><span class='stop-name'>{{placeName}}</span>", "placeName", tfl.journeyPlanner.recentSearches.recentSearchNumberLimit);
    d.typeaheadSource.removeContent = tfl.autocomplete.sources.stationsStopsRemoveContent;
    var a = [tfl.autocomplete.sources.getJourneyPlannerSuggestions()];
    var f, e;
    var g = tfl.autocomplete.sources.getTurnOnOffRecentSearches(false, [
        {linkText: "Turn off recent journeys"}
    ]);
    var h = tfl.autocomplete.sources.getTurnOnOffRecentSearches(true, [
        {linkText: "Turn on recent journeys"}
    ]);
    c.setupAutocomplete = function (j) {
        f = a.slice(0);
        e = a.slice(0);
        c.autocompleteAddRecentSearches(!j);
        c.autocompleteAddGeolocation();
        g.typeaheadSource.callback = function (k) {
            tfl.journeyPlanner.recentJourneys.useJourneys(false);
            if ($("#recent-journeys").length != 0) {
                tfl.journeyPlanner.createJourneys()
            }
            $(k).parent().siblings(tfl.dictionary.RemoveContentClass).trigger("clear-search-box");
            c.destroyAutocomplete();
            $("#From, #To, #Via").each(function () {
                tfl.autocomplete.setup("#" + $(this).attr("id"), f, null, true);
                $("#" + $(this).attr("id")).attr("placeholder", $(this).attr("id"))
            })
        };
        h.typeaheadSource.callback = function (k) {
            tfl.journeyPlanner.recentJourneys.useJourneys(true);
            if ($("#recent-journeys").length != 0) {
                tfl.journeyPlanner.createJourneys()
            }
            $(k).parent().siblings(tfl.dictionary.RemoveContentClass).trigger("clear-search-box");
            c.destroyAutocomplete();
            $("#From, #To, #Via").each(function () {
                tfl.autocomplete.setup("#" + $(this).attr("id"), e, null, true);
                $("#" + $(this).attr("id")).attr("placeholder", $(this).attr("id"))
            })
        };
        if (tfl.journeyPlanner.recentJourneys.usingRecentJourneys) {
            tfl.autocomplete.setup("#From", e, null, j);
            tfl.autocomplete.setup("#To", e, null, j);
            tfl.autocomplete.setup("#Via", e, null, j)
        } else {
            tfl.autocomplete.setup("#From", f, null, j);
            tfl.autocomplete.setup("#To", f, null, j);
            tfl.autocomplete.setup("#Via", f, null, j)
        }
    };
    c.destroyAutocomplete = function () {
        $("#From, #To, #Via").each(function () {
            $(this).parent().siblings(tfl.dictionary.RemoveContentClass).unbind("clear-search-box");
            $(this).typeahead("destroy");
            $(this).off("typeahead:selected typeahead:autocompleted keydown.autocomplete")
        });
        e = a.slice(0);
        f = a.slice(0);
        c.autocompleteAddRecentSearches(true);
        c.autocompleteAddGeolocation()
    };
    c.autocompleteAddRecentSearches = function (j) {
        if (tfl.storage.isLocalStorageSupported()) {
            e.splice(0, 0, g);
            if (tfl.journeyPlanner.recentJourneys.usingRecentJourneys && !j) {
                e.splice(0, 0, d)
            }
            f.splice(0, 0, h)
        }
    };
    c.autocompleteAddGeolocation = function () {
        var j = tfl.autocomplete.sources.getGeolocation(null);
        if (tfl.geolocation.isGeolocationSupported()) {
            e.splice(0, 0, j);
            f.splice(0, 0, j)
        }
    };
    function b() {
        $("#From, #To, #Via").each(function () {
            $(this).on("keydown", function (k) {
                if (k.which !== 9 && k.which !== 13 && (k.which < 33 || k.which > 40) && (k.which < 16 || k.which > 20) && k.which !== 45 && k.which !== 91) {
                    j($(this))
                }
            });
            $(this).on("paste", function () {
                j($(this))
            })
        });
        function j(k) {
            k.removeAttr("data-" + k.attr("id").toLowerCase() + "-id");
            k.removeAttr("data-" + k.attr("id").toLowerCase() + "-modes");
            k.removeAttr("data-dataset-name")
        }
    }

    c.init = function (l) {
        tfl.logs.create("tfl.journeyPlanner.searchForm.init: started (widget = " + l + ")");
        c.isWidget = l || false;
        c.processTempLocalStorage();
        var j = $(".leaving-or-arriving .selected label").text();
        $(".time-options").prepend("<div class='time-defaults'><p><strong>" + j + ":</strong> <span>now</span></p><a href='javascript:void(0)' class='change-departure-time'>change time</a></div>");
        if (!String.prototype.indexOf || window.location.href.indexOf("&time=") > 0) {
            $(".change-time-options").show();
            $(".time-defaults").hide()
        }
        $(".extra-options").prepend('<a href="' + tfl.jPLandingPageUrl + '#more-options" class="toggle-options more-options">Accessibility &amp; travel options</a>');
        $("#jp-search-form").submit(c.submitSearchForm);
        tfl.journeyPlanner.recentSearches.loadSearches();
        $(".change-departure-time").click(c.changeDepartureTime);
        c.setupDateOptions();
        if (!c.isWidget) {
            c.changeTabs();
            $(".toggle-options").click(c.toggleMoreOptions)
        } else {
            $(".toggle-options").click(c.toggleMoreOptionsIsWidget)
        }
        if (window.location.hash === "#more-options") {
            $(".toggle-options").click()
        } else {
            if (window.location.hash === "#change-time") {
                c.changeDepartureTime()
            }
        }
        $("#IsAsync").val(true);
        c.setupAutocomplete(true);
        b();
        var k = $("#From"), m = $("#To"), n = $("#Via");
        $([k, m, n]).each(function () {
            if (this.val() === tfl.dictionary.CurrentLocationText) {
                tfl.geolocation.setupInputBoxForGeolocation(this)
            }
        })
    }
}(window.tfl.journeyPlanner.searchForm = window.tfl.journeyPlanner.searchForm || {}));
(function (a) {
    a.initialize = function () {
        a.setUpResultTags();
        a.populateSearchBoxes();
        a.resetSelectBoxes();
        a.checkQueryString();
        a.selectBoxFiltering();
        a.selectBoxChange()
    };
    a.resetSelectBoxes = function () {
        $(".reset-filters").click(function () {
            $(".selector").children(".filter-box").each(function () {
                $(this).prop("selectedIndex", 0);
                $(this).siblings("span").text($(this).children("option:first-child").text());
                a.selectBoxFiltering()
            })
        })
    };
    a.checkQueryString = function () {
        var g = $(location).attr("href");
        if (g.indexOf("?") >= 0) {
            var h = g.split("?");
            var b = h[1].split("&");
            var e = (b.length);
            var d = 0;
            var f = new Array();
            while (d < e) {
                f.push(b[d].replace(/%20/g, " "));
                d++
            }
            var c = 0;
            $(".filter-box").each(function () {
                var l = $(this).attr("name");
                for (x = 0; x < f.length; x++) {
                    var k = f[x].split("=");
                    if (k[0] == l) {
                        var j = $(this).children().text();
                        if (j.indexOf(k[1]) <= 0) {
                        } else {
                            $(this).siblings("span").text(k[1])
                        }
                    } else {
                    }
                    a.selectBoxFiltering()
                }
            })
        } else {
        }
    };
    a.tagSet = function () {
        var b = $(this).text()
    };
    a.selectBoxChange = function () {
        $("select.filter-box").change(function () {
            a.selectBoxFiltering()
        })
    };
    a.setUpResultTags = function () {
        $(".results-list-all").find("data-pull-content").click(tfl.navigation.pullContentHandler);
        $(".results-list-all").hide();
        $(".results-list-all").children("#results-list").children("li.search-results").each(function () {
            var d = $(this).children(".search-tags");
            var f = d.text();
            var e = f.split(",");
            var c = (e.length);
            for (var g = 0; g < c; g++) {
                d.append("<a class='result-tag'>" + e[g] + "</a>")
            }
            var b = d.children().remove();
            d.text("").append(b)
        })
    };
    a.selectBoxFiltering = function () {
        $("#pagination-items").empty();
        $(".pagination").remove();
        $(".search-results").each(function () {
            var c = false;
            var d = new Array();
            $(this).find("a.result-tag").each(function () {
                var e = $(this).text();
                d[d.length] = e
            });
            $(".selector").children(".filter-box").each(function () {
                var f = $(this).siblings("span").text();
                if (f == "All") {
                    return true
                }
                var e = ($.inArray(f, d));
                if (e == -1) {
                    c = true;
                    return false
                }
            });
            if (!c) {
                $(this).clone(true).appendTo("#pagination-items")
            }
        });
        var b = $("#pagination-items > li").length;
        if (b === 0) {
            if ($(".field-validation-information").length < 1) {
                $(".results-wrapper").append("<p class='field-validation-information' id='search-filters-no-results'>There is nothing matching your search.</p>")
            }
        } else {
            $("#search-filters-no-results").remove()
        }
        a.PaginateSearchFilters()
    };
    a.PaginateSearchFilters = function () {
        var b = 5;
        $(".pagination-controls").remove();
        if ($("#pagination-items .search-results").length > b) {
            $(".results-wrapper ul").after("<div class='pagination' />");
            tfl.navigation.pagination.setup($(".results-wrapper"), "#pagination-items", b, $("#pagination-items .search-results").length, true)
        }
    };
    a.populateSearchBoxes = function () {
        $(".search-filters-wrapper").append("<div class='search-filter filter-by-box'><a class='reset-filters'>Reset</a><p class='heading'>Filter by:</p>");
        for (var c = 0; c <= filters.length; c++) {
            for (var b in filters[c]) {
                $(".filter-by-box").append("<div class='filter-box-wrap'></div");
                $(".filter-box-wrap").eq(c).append("<label for='" + b + "' class='heading'>" + b + ":</label><div class='selector'><select class='filter-box' name=" + b + " class='valid'><option selected='selected'>All</option></select></div>");
                for (var d = 0; d < filters[c][b].length; d++) {
                    $(".filter-box-wrap").eq(c).find(".filter-box").append("<option>" + filters[c][b][d] + "</option>")
                }
            }
        }
        tfl.forms.setupSelectBoxes()
    };
    $(document).ready(function () {
        tfl.logs.create("tfl.searchFilters: looking for search filters");
        var b = $(".search-filters-wrapper");
        if (b.length > 0) {
            tfl.logs.create("tfl.searchFilters: loading search filters");
            a.initialize()
        }
    })
})(window.tfl.searchFilters = window.tfl.searchFilters || {});
(function (a) {
    a.tabs = function (b) {
        tfl.logs.create("tfl.navigation.tabs: loaded");
        var c = $(b).children();
        c.click(function (d) {
            d.preventDefault();
            c.removeClass("selected");
            $(this).addClass("selected");
            tfl.logs.create("tfl.navigation.tabs: " + $(this).find("a").attr("href"))
        })
    };
    a.tabs("[data-tabs='true']")
}(window.tfl.navigation = window.tfl.navigation || {}));
(function (a) {
    a.RemoveContentClass = ".remove-content";
    tfl.logs.create("tfl.removableContent.initRemoveContents: loaded");
    a.initRemoveContents = function () {
        tfl.logs.create("tfl.removableContent.initRemoveContents: started");
        var b = $(":input:text").not(".disable-removable-content");
        b.clearSearch({divClass: "remove-content-container", clearClass: "remove-content", linkText: "Clear search"});
        b.not(".tt-hint").each(function () {
            if ($(this).val() === "") {
                $(this).closest(".remove-content-container").addClass("empty")
            }
        }).on("keyup", function () {
            if ($(this).val() === "") {
                $(this).closest(".remove-content-container").addClass("empty")
            } else {
                $(this).closest(".remove-content-container").removeClass("empty")
            }
        });
        $(".remove-content").addClass("hide-text").click(function () {
            var c = $(this).siblings("[data-current-location]");
            if (c.length === 0) {
                c = $(this).parent("[data-current-location]")
            }
            if (c.length > 0) {
                c.removeAttr("data-current-location");
                c.find("input[type='text']").trigger("geolocation-cleared")
            }
            $(this).closest(".remove-content-container").addClass("empty")
        })
    };
    a.initRemoveContents()
}(window.tfl.removableContent = window.tfl.removableContent || {}));
(function (a) {
    tfl.logs.create("tfl.survey: started");
    a.success = function () {
        $("#survey").removeAttr("src");
        d(true)
    };
    $.ajax({url: "/corporate/feedback/"}).done(function (e) {
        $(".cookie-policy-notice").after(e);
        $(".beta-banner-link").click(function () {
            b();
            d(false)
        })
    });
    function d(e) {
        if ($("html.lt-ie8").length > 0) {
            $(".beta-banner-form").toggle();
            c()
        } else {
            $(".beta-banner-form").slideToggle("slow", function () {
                if (e) {
                    $(".beta-banner-submit").slideDown("slow", function () {
                        c()
                    }).delay(1000).slideUp("slow", function () {
                        c()
                    })
                }
                c()
            })
        }
    }

    function b() {
        var e = $("body");
        var f = "small";
        if (e.hasClass("breakpoint-Large")) {
            f = "large"
        } else {
            if (e.hasClass("breakpoint-Medium")) {
                f = "medium"
            }
        }
        var g = $("#survey");
        if (g.attr("src") === null || g.attr("src") === undefined || g.attr("src") === "") {
            var h = "https://www.research.net/s/tfl_beta?layout=" + f + "&page=" + encodeURIComponent(location.href) + "&device=" + encodeURIComponent(navigator.userAgent);
            g.attr("src", h)
        }
    }

    function c() {
        var g = $(".beta-banner-link");
        var e = "link-accordion-expanded";
        g.toggleClass(e);
        if ($("html.lt-ie8").length > 0) {
            var f = $(".top-row, #full-width-content");
            f.addClass("ie7-fix");
            window.setTimeout(function () {
                f.removeClass("ie7-fix")
            }, 5)
        }
    }
})(tfl.survey = tfl.survey || {});
window.tfl.navigation = window.tfl.navigation || {};
(function (a) {
    tfl.logs.create("tfl.navigation.pagination: loaded");
    a.setup = function (b, d, e, j, c, f) {
        tfl.logs.create("tfl.navigation.pagination: setup");
        var g = j % e > 0 ? Math.floor(j / e) + 1 : Math.floor(j / e);
        var h = g > 5 ? 3 : g;
        if (!c) {
            b.append("<div class='pagination' />")
        }
        b.pajinate({items_per_page: e, item_container_id: d, nav_panel_id: ".pagination", num_page_links_to_display: h, nav_label_first: "1", nav_label_prev: "", nav_label_next: "", nav_label_last: g, show_first_last: true, show_prev_next: false, abort_on_small_lists: true});
        b.find(".pagination").wrap("<div class='pagination-controls' />");
        b.find(".previous_link").prependTo(b.find(".pagination"));
        b.find(".next_link").appendTo(b.find(".pagination"));
        a.checkPageLinks(b, g);
        b.find(".pagination a").click(function () {
            a.checkPageLinks(b, g);
            if ($(window).scrollTop() > b.offset().top) {
                window.scrollTo(0, b.offset().top)
            }
        })
    };
    a.addMapControls = function (b, c) {
        var d = 1;
        if (c) {
            b.find(".page_link").click(function () {
                d = parseInt($(this).attr("data-longdesc"), 10);
                c.choosePage(d)
            });
            b.find(".previous_link").click(function () {
                c.choosePage(--d)
            });
            b.find(".next_link").click(function () {
                c.choosePage(++d)
            });
            b.find(".first_link").click(function () {
                d = 1;
                c.choosePage(1)
            });
            b.find(".last_link").click(function () {
                b.find(".page_link.last").trigger("click")
            })
        }
    };
    a.checkPageLinks = function (b, d) {
        if (d < 6) {
            b.find(".first_link,.last_link").hide()
        } else {
            var e = b.find(".page_link");
            if ($(e[0]).hasClass("active_page")) {
                $(e[0]).hide();
                $(e[3]).show();
                b.find(".next_link").prepend("<span>next-page</span>");
                b.find(".previous_link").prepend("<span>previous-page</span>");
                b.find(".first_link").addClass("active_page")
            } else {
                if ($(e[e.length - 1]).hasClass("active_page")) {
                    $(e[e.length - 1]).hide();
                    $(e[e.length - 4]).show();
                    b.find(".last_link").addClass("active_page")
                } else {
                    for (var c = 2; c < e.length - 2; c++) {
                        if ($(e[c]).hasClass("active_page")) {
                            $(e[c + 2]).hide();
                            $(e[c + 1]).show();
                            $(e[c - 1]).show();
                            $(e[c - 2]).hide();
                            break
                        }
                    }
                }
            }
        }
    }
}(window.tfl.navigation.pagination = window.tfl.navigation.pagination || {}));
(function (a) {
    a.getQueryStringParameter = function (d) {
        var e = window.location.search.substring(1), f = e.split("&"), b;
        for (b = 0; b < f.length; b += 1) {
            var c = f[b].split("=");
            if (decodeURIComponent(c[0]) === d) {
                return decodeURIComponent(c[1])
            }
        }
        return null
    };
    a.setQueryStringParameter = function (e, g) {
        if (window.history.pushState !== undefined) {
            var f = window.location.search.substring(1), h = f.split("&"), c, b = false;
            for (c = 0; c < h.length; c += 1) {
                var d = h[c].split("=");
                if (decodeURIComponent(d[0]) === e) {
                    d[1] = encodeURIComponent(g);
                    h[c] = d.join("=");
                    window.history.pushState({}, "", "?" + h.join("&"));
                    b = true;
                    break
                }
            }
            if (!b) {
                if (f.length === 0) {
                    f += "?" + encodeURIComponent(e) + "=" + encodeURIComponent(g);
                    window.history.pushState({}, "", f)
                } else {
                    f += "&" + encodeURIComponent(e) + "=" + encodeURIComponent(g);
                    window.history.pushState({}, "", "?" + f)
                }
            }
        }
    };
    a.removeQueryStringParameter = function (e) {
        if (window.history.pushState !== undefined) {
            var f = window.location.search.substring(1), g = f.split("&"), c, b = false;
            for (c = 0; c < g.length; c += 1) {
                var d = g[c].split("=");
                if (decodeURIComponent(d[0]) === e) {
                    g.splice(c, 1);
                    window.history.pushState({}, "", "?" + g.join("&"));
                    b = true;
                    break
                }
            }
        }
    };
    a.measureElementHeight = function (b, c) {
        var e = b.attr("style");
        b.removeAttr("style").css({position: "fixed", left: "-10000px", display: c || "block"});
        var d = b.height();
        return d
    };
    a.measureElementWidth = function (b, c) {
        var e = b.attr("style");
        b.removeAttr("style").css({position: "fixed", left: "-10000px", display: c || "block"});
        var d = b.width();
        b.removeAttr("style").attr("style", e);
        return d
    };
    a.makeMVCDate = function (c) {
        function b(e) {
            var f = "";
            if (e < 10) {
                f += "0"
            }
            f += e;
            return f
        }

        var d = "";
        d += c.getFullYear() + "-";
        d += b(c.getMonth() + 1) + "-";
        d += b(c.getDate()) + "T";
        d += b(c.getHours()) + ":";
        d += b(c.getMinutes()) + ":";
        d += b(c.getSeconds());
        return d
    };
    a.makeDateFromQueryStringDate = function (c) {
        var b = new Date();
        b.setDate(c.substring(8, 10));
        b.setMonth(c.substring(5, 7) - 1);
        b.setYear(c.substring(0, 4));
        b.setHours(c.substring(11, 13));
        b.setMinutes(c.substring(14, 16));
        b.setSeconds(c.substring(17, 19));
        return b
    };
    a.getTime = function (b) {
        return(b.getHours() < 10 ? "0" : "") + b.getHours() + ":" + (b.getMinutes() < 10 ? "0" : "") + b.getMinutes()
    };
    if (!String.prototype.format) {
        String.prototype.format = function () {
            var b = arguments;
            return this.replace(/{(\d+)}/g, function (c, d) {
                return typeof b[d] != "undefined" ? b[d] : c
            })
        }
    }
}(window.tfl.tools = window.tfl.tools || {}));
(function (a) {
    a.init = function () {
        $(".always-visible").off("click.expandableBox").on("click.expandableBox", function () {
            var b = $(this).parent();
            if (!b.hasClass("expanded")) {
                b.addClass("expanded");
                $(this).attr("aria-expanded", "true").trigger("expandable-box.expanded")
            } else {
                b.removeClass("expanded");
                $(this).attr("aria-expanded", "false").trigger("expandable-box.collapsed")
            }
            return false
        }).keypress(function (b) {
            if (b.which == 13) {
                $(this).click()
            }
        })
    };
    a.init()
}(window.tfl.expandableBox = window.tfl.expandableBox || {}));
(function (b) {
    function a(d) {
        var c = d, g = c.parent(), f = c.find(">li"), e = null, l = 0, h = 13, n = [], j = [], q = 0, r = 0, k = 0, m = false, p = false, o = null;
        return{init: function () {
            e = $("<li class='ellipsis hidden'><a href='javascript:void(0)'>...</a></li>");
            f.eq(0).after(e);
            l = e.width();
            e.click(this.makeScrollable);
            f.each(function () {
                var u = $(this).width();
                n.push(u);
                q += u
            });
            q += h;
            j.push(q);
            var s = q;
            for (var t = 1; t < n.length; t++) {
                s -= n[t];
                j.push(s + l)
            }
            o = $.proxy(this.onResize, this);
            $(window).on("resize", o);
            this.onResize()
        }, onResize: function () {
            r = c.width();
            if (r < q) {
                if (r <= j[k]) {
                    m = true;
                    e.removeClass("hidden");
                    while (r <= j[k]) {
                        this.hideItem(k);
                        k++
                    }
                } else {
                    if (r > j[k]) {
                        while (r > j[k]) {
                            this.showItem(k);
                            k--
                        }
                    }
                }
            } else {
                if (m) {
                    e.addClass("hidden");
                    m = false;
                    while (r >= j[k]) {
                        this.showItem(k);
                        k--
                    }
                    if (k < 0) {
                        k = 0
                    }
                }
            }
        }, hideItem: function (s) {
            f.eq(s + 1).hide()
        }, showItem: function (s) {
            f.eq(s + 1).show()
        }, makeScrollable: function () {
            if (tfl.utils.isTouchDevice()) {
                g.addClass("scrolling");
                c.css({width: q + "px"})
            }
            e.addClass("hidden");
            f.each(function () {
                $(this).show()
            });
            $(window).off("resize", o);
            return false
        }}
    }

    b.init = function () {
        var d = $("ul.breadcrumbs");
        var c = d.length;
        $("ul.breadcrumbs").each(function () {
            d = $(this);
            new a(d).init()
        })
    };
    b.init()
}(window.tfl.breadcrumb = window.tfl.breadcrumb || {}));
(function (a) {
    a.init = function (b) {
        $(b).each(function () {
            var e = $(this);
            e.wrap('<div class="fc-calendar-wrapper clearfix" />');
            var f = e.parent();
            var c = e.calendario({weekabbrs: ["S", "M", "T", "W", "T", "F", "S"], displayWeekAbbr: true, month: e.attr("data-month"), year: e.attr("data-year")});
            f.prepend("<div class='current-month'><a href='javascript:void(0);' class='calendar-previous-month hide-text'>Previous month</a><span class='calendar-month'>" + c.getMonthName() + "</span> <span class='calendar-year'>" + c.getYear() + "</span><a href='javascript:void(0);' class='calendar-next-month hide-text'>Next month</a></div>");
            f.find(".calendar-next-month").on("click", function () {
                if (!$(this).hasClass("disabled")) {
                    c.gotoNextMonth(function () {
                        h();
                        e.attr("data-month", c.getMonth());
                        e.attr("data-year", c.getYear());
                        $(window).trigger("calendar-next-month")
                    })
                }
            });
            f.find(".calendar-previous-month").on("click", function () {
                if (!$(this).hasClass("disabled")) {
                    c.gotoPreviousMonth(function () {
                        h();
                        e.attr("data-month", c.getMonth());
                        e.attr("data-year", c.getYear());
                        $(window).trigger("calendar-previous-month")
                    })
                }
            });
            var d = f.find(".calendar-month");
            var g = f.find(".calendar-year");
            var h = function () {
                d.html(c.getMonthName());
                g.html(c.getYear())
            }
        })
    };
    a.init(".fc-calendar-container")
}(window.tfl.calendar = window.tfl.calendar || {}));
(function (a) {
    a.allTables = [];
    a.tableCellPadding = 5;
    a.tableShadowWidth = 15;
    a.ResponsiveTable = function (b) {
        var t = b;
        var p = $(t).parent();
        var n = null;
        var u = null;
        var v = null;
        var l = null;
        var m = false;
        var o = null;
        var r = null;
        var q = null;
        var s = null;
        var f = null;
        var h = 0;
        var k = 0;
        var j = 0;
        var g = false;
        var c = null;
        var e = 0;
        var d = 0;
        return{init: function () {
            var w = this;
            w.onResize();
            p.scroll(w.onParentScroll);
            if ($(p).closest(".expandable-box").length) {
                $(p).closest(".expandable-box").find(".always-visible").on("click", function () {
                    w.onResize()
                })
            }
        }, onResize: function () {
            var z = this.isVisible;
            if ($(p).is(":visible")) {
                this.isVisible = true
            } else {
                this.isVisible = false
            }
            if (!z && this.isVisible) {
                this.stopHiding();
                this.startHiding()
            }
            var w = $(p).offset();
            n = w.left;
            u = w.top;
            v = $(t).width();
            l = $(t).height();
            q = $(p).width();
            if (f) {
                h = f.height() ? f.height() : h;
                var y = $(t).offset();
                k = y.top;
                j = y.left;
                if (m) {
                    f.parent().css({width: q, left: n});
                    this.onWindowScroll($(window).scrollTop())
                }
            }
            if (c) {
                e = c.width() - 2 * a.tableCellPadding
            }
            if (v > q) {
                if (!m) {
                    this.startHiding()
                } else {
                    s = v - q;
                    this.onParentScroll()
                }
            } else {
                if (m) {
                    this.stopHiding()
                }
            }
        }, onWindowScroll: function (y) {
            var w = $(p).offset();
            n = w.left;
            u = w.top;
            if (m && !g && (u < y && y <= u + l - h)) {
                g = true;
                $(f).css({marginLeft: -1 * $(p).scrollLeft()});
                $(f).parent().removeClass("hidden")
            } else {
                if (g) {
                    if (u >= y || y > u + l - h) {
                        g = false;
                        $(f).parent().addClass("hidden")
                    }
                }
            }
        }, onParentScroll: function () {
            var w = $(p).scrollLeft();
            $(f).css({marginLeft: (-1 * w)});
            o.css({left: e + 2 * a.tableCellPadding - a.tableShadowWidth + Math.min(w, a.tableShadowWidth)});
            var y = Math.min(s - w, a.tableShadowWidth) - a.tableShadowWidth;
            if (y === -1 * a.tableShadowWidth) {
                y++
            }
            r.css({right: y})
        }, startHiding: function () {
            m = true;
            p.addClass("hiding");
            if (p.children(".hiding-table").length > 0) {
                f.css({width: v});
                p.children(".hiding-table").show()
            } else {
                this.createFixedHeadings()
            }
            p.parent().addClass("hiding")
        }, stopHiding: function () {
            m = false;
            p.removeClass("hiding");
            p.parent().removeClass("hiding");
            p.parent().find(".hiding-table").hide();
            g = false;
            $(f).parent().addClass("hidden")
        }, createFixedHeadings: function () {
            v = $(t).width();
            f = $("<table class='first-row'></table>");
            var w = $(t).find("tr:first-child");
            h = w.height();
            f.append(w.clone().css({height: h, width: v}));
            f.find("th").replaceWith(function () {
                return $("<td />", {html: $(this).html()})
            });
            var y = w.find("th, td");
            $(f).find("th, td").each(function (z) {
                if (z === 0) {
                    $(this).html("<span>" + $(this).html() + "</span>")
                }
                $(this).width($(y.get(z)).width())
            });
            c = $("<table class='hiding-table first-col'></table>").css({top: 0});
            e = 0;
            d = 0;
            $(t).find("th:first-child,td:first-child").each(function (z) {
                if (z === 0) {
                    e = $(this).width();
                    d = $(this).offset().left
                }
                var A = $("<tr></tr>");
                A.append($(this).clone().css({height: $(this).height()}));
                c.append(A)
            });
            p.wrap("<div class='responsive-table-wrapper'></div>");
            p.parent().append(c.css({width: e, position: "absolute"}));
            f.wrap("<div class='hidden'></div>");
            c.after(f.css({width: v}).parent().css({overflow: "hidden", width: q, position: "fixed", top: 0, boxShadow: "0px 5px 5px -3px rgba(0, 0, 0, 0.3)"}));
            l = $(t).height();
            k = $(f).parent().offset().top;
            j = $(t).offset().left;
            o = $("<div class='responsive-table-shadow left-shadow' />");
            o.css({left: e + 2 * a.tableCellPadding - a.tableShadowWidth, height: l});
            r = $("<div class='responsive-table-shadow right-shadow' />");
            r.css({right: 0, height: l});
            c.before(o);
            c.before(r);
            s = v - q;
            this.onWindowScroll($(window).scrollTop())
        }}
    };
    a.init = function (b) {
        $(b).each(function (c) {
            var d = new a.ResponsiveTable(this);
            d.init();
            a.allTables.push(d)
        });
        if (a.allTables.length > 0) {
            $(window).resize(function () {
                for (var c = 0; c < a.allTables.length; c++) {
                    a.allTables[c].onResize()
                }
            });
            $(window).scroll(function () {
                var d = $(this).scrollTop();
                for (var c = 0; c < a.allTables.length; c++) {
                    a.allTables[c].onWindowScroll(d)
                }
            })
        }
    };
    a.init(".table-container table")
}(window.tfl.responsiveTables = window.tfl.responsiveTables || {}));
(function (g) {
    tfl.logs.create("tfl.fullscreen stage: loaded");
    var c, b, a, e = [], f = false, l = false, j = [], k = [], q = false, m = 0, h = {id: "fullscreen-stage", stageActiveClass: "stage-active"};

    function p(r) {
        var o = $('<div id="' + h.id + '"></div>');
        if (!r) {
            a = $('<button id="close-fullscreen-stage" class="fullscreen-stage-button"><span class="icon close-icon"></span></button>');
            o.append(a);
            a.on("click", n)
        }
        $(document.body).append(o);
        f = true;
        return o
    }

    function d(o) {
        tfl.logs.create("tfl.fullscreen: enter fullscreen stage");
        g.addItemToStage(o);
        $(document.body).addClass(h.stageActiveClass);
        $(window).trigger("enter-fullscreen-stage");
        if (q && e.length === 1) {
            $(document.body).addClass("panzoom");
            tfl.zoomableContent.init(o)
        }
    }

    function n() {
        tfl.logs.create("tfl.fullscreen: exit fullscreen stage");
        var o;
        for (var r = e.length - 1; r >= 0; r--) {
            o = e[r];
            if (k[r]) {
                j[r].append(o)
            } else {
                j[r].before(o)
            }
        }
        e = [];
        j = [];
        k = [];
        if (q) {
            $(document.body).removeClass("panzoom");
            o.trigger("destroy-panzoom")
        }
        $(document.body).removeClass(h.stageActiveClass);
        $(window).trigger("exit-fullscreen-stage")
    }

    g.addItemToStage = function (o) {
        if (!c) {
            tfl.logs.create("tfl.fullscreen: Tried to add item to stage before stage was initialised");
            return
        }
        var r = o.next();
        if (r.length === 0) {
            j[j.length] = o.parent();
            k[k.length] = true
        } else {
            j[j.length] = r;
            k[k.length] = false
        }
        e.push(o);
        c.append(o)
    };
    g.hide = function () {
        if (e.length !== 0) {
            n()
        }
        document.body.scrollTop = m
    };
    g.display = function (o, s, r) {
        if (!f) {
            c = p(r || false)
        }
        q = s;
        if (e.length !== 0) {
            n()
        }
        m = document.body.scrollTop;
        d(o)
    }
})(window.tfl.fullscreen = window.tfl.fullscreen || {});
(function (b) {
    tfl.logs.create("tfl.listToDropdown: loaded");
    var c, a;
    b.init = function () {
        tfl.logs.create("tfl.listToDropdown: initialised");
        b.buildHtmlDropdown();
        b.dropDownMouseFunctionality();
        b.hideShowList();
        b.datePickerDropdownBuilding()
    };
    b.buildHtmlDropdown = function () {
        $(".links-list").each(function () {
            var h = $(this);
            h.addClass("hidden");
            var g = h.data("dropdown-target");
            var e = h.data("dropdown-label");
            var j = h.data("selected-item-id");
            var f = h.data("dropdown-option");
            var d = "";
            if (g == "date-dropdown-placeholder") {
                d = "datepicker-dropdown";
                h.addClass(d)
            }
            h.find('li[data-item-id="' + j + '"]').hide();
            h.wrap('<div class="for-dropdown" />');
            if (h.attr("id") == "gla-list") {
                h.parent().prepend('<div role="button" tabindex="0"  class="dropdown-button ' + f + " dropdown-closed " + d + '"><img src="/static/cms/images/MoL.png" alt="Mayor of London"><span class="mol-gla">GLA</span></div>')
            } else {
                h.parent().prepend('<div tabindex="0" role="button" aria-label="' + e + '" class="dropdown-button ' + f + " dropdown-closed " + d + '" >' + j + "</div>")
            }
            $("." + g).append(h.parent());
            if (!h.attr("id") == "gla-list" || !h.attr("id")) {
                $(h).find("li:visible:first").css("border-top", "solid 1px #cacaca")
            }
            h.siblings(".dropdown-button").click(function () {
                b.hideShowList(h.siblings(".dropdown-button"))
            }).keypress(function (k) {
                if (k.which == 13) {
                    $(this).click()
                }
            })
        })
    };
    b.hideShowList = function (d) {
        if ($(d).hasClass("dropdown-closed")) {
            clearTimeout(c);
            c = 0;
            a = undefined;
            $('ul.links-list:not(".hidden")').addClass("hidden").prev(".dropdown-button").addClass("dropdown-closed")
        }
        $(d).next("ul.links-list").toggleClass("hidden");
        $("ul.links-list li:visible:first").css("border-top-width", "1px");
        $(d).toggleClass("dropdown-closed");
        clearTimeout(c);
        c = 0;
        a = undefined
    };
    b.dropDownMouseFunctionality = function () {
        $(".for-dropdown").on("mouseleave", function () {
            var d = $(this);
            a = d;
            c = setTimeout(function () {
                if (!d.children(".dropdown-button").hasClass("dropdown-closed")) {
                    b.hideShowList(d.children(".dropdown-button"))
                }
            }, 500)
        }).on("mouseenter", function () {
            if (c && $(this).is(a)) {
                clearTimeout(c);
                c = 0;
                a = undefined
            }
        })
    };
    b.datePickerDropdownBuilding = function () {
        $(".advance-month-container").parent().addClass("no-hover")
    };
    b.init()
})(window.tfl.listToDropdown = window.tfl.listToDropdown || {});
(function (a) {
    tfl.logs.create("tfl.search-icon-toggle: loaded");
    var b = $(".search-tools input:text");
    var c = b.val();
    b.on("keyup", function () {
        a.toggleSearchIcon()
    }), $(".search-tools a.remove-content").click(function () {
        a.toggleSearchIcon()
    });
    a.toggleSearchIcon = function () {
        var d = b.val();
        if (d.length == 0) {
            $("#search-button").show()
        } else {
            $("#search-button").hide()
        }
    };
    a.h1Fix = function () {
        var f = $(".search-title");
        var d = $(".dots").length;
        if (d == 0) {
            f.append("<span class='hero-headline dots visually-hidden'>...</span>")
        }
        f.css("display", "inline-block");
        var g = f.outerWidth();
        var e = f.parent().outerWidth();
        e = e * 0.95;
        e = e - 20;
        if (g > e) {
            f.css("display", "block");
            $(".dots").removeClass("visually-hidden")
        } else {
            f.css("display", "inline-block");
            $(".dots").addClass("visually-hidden")
        }
    };
    a.toggleSearchIcon();
    a.h1Fix();
    $(window).on("resize", function () {
        a.h1Fix()
    })
}(window.tfl.searchIcon = window.tfl.searchIcon || {}));